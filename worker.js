import{connect as e}from"cloudflare:sockets";let n="uuid",t="",o="",a=[],r=[],i=!1,s=!1,l=!1,c=!0,d="",u="",p="",m="",g=!0,f=!1,h=!1,b=!1,y=!1,C=!1,P=!1,S=!1,I="",x=!1,v="https://dns.joeyblog.eu.org/joeyblog",w="cloudflare-ech.com",k="https://url.v1.mk/sub";let E=!1,D=!0,R=!0,L=!1,T=null,U={};let H=[{domain:"ProxyIP.US.CMLiussss.net",region:"US",regionCode:"US",port:443},{domain:"ProxyIP.SG.CMLiussss.net",region:"SG",regionCode:"SG",port:443},{domain:"ProxyIP.JP.CMLiussss.net",region:"JP",regionCode:"JP",port:443},{domain:"ProxyIP.KR.CMLiussss.net",region:"KR",regionCode:"KR",port:443},{domain:"ProxyIP.DE.CMLiussss.net",region:"DE",regionCode:"DE",port:443},{domain:"ProxyIP.SE.CMLiussss.net",region:"SE",regionCode:"SE",port:443},{domain:"ProxyIP.NL.CMLiussss.net",region:"NL",regionCode:"NL",port:443},{domain:"ProxyIP.FI.CMLiussss.net",region:"FI",regionCode:"FI",port:443},{domain:"ProxyIP.GB.CMLiussss.net",region:"GB",regionCode:"GB",port:443},{domain:"ProxyIP.FR.CMLiussss.net",region:"FR",regionCode:"FR",port:443},{domain:"ProxyIP.CA.CMLiussss.net",region:"CA",regionCode:"CA",port:443},{domain:"ProxyIP.AU.CMLiussss.net",region:"AU",regionCode:"AU",port:443},{domain:"ProxyIP.HK.CMLiussss.net",region:"HK",regionCode:"HK",port:443},{domain:"ProxyIP.TW.CMLiussss.net",region:"TW",regionCode:"TW",port:443},{domain:"ProxyIP.IN.CMLiussss.net",region:"IN",regionCode:"IN",port:443},{domain:"ProxyIP.BR.CMLiussss.net",region:"BR",regionCode:"BR",port:443},{domain:"ProxyIP.PL.CMLiussss.net",region:"PL",regionCode:"PL",port:443},{domain:"ProxyIP.RU.CMLiussss.net",region:"RU",regionCode:"RU",port:443},{domain:"ProxyIP.LV.CMLiussss.net",region:"LV",regionCode:"LV",port:443},{domain:"ProxyIP.IR.CMLiussss.net",region:"IR",regionCode:"IR",port:443},{domain:"ProxyIP.Oracle.cmliussss.net",region:"Oracle",regionCode:"Oracle",port:443},{domain:"ProxyIP.DigitalOcean.CMLiussss.net",region:"DigitalOcean",regionCode:"DigitalOcean",port:443},{domain:"ProxyIP.Vultr.CMLiussss.net",region:"Vultr",regionCode:"Vultr",port:443},{domain:"ProxyIP.Multacom.CMLiussss.net",region:"Multacom",regionCode:"Multacom",port:443}];const M=[{name:"cloudflare.182682.xyz",domain:"cloudflare.182682.xyz"},{name:"speed.marisalnc.com",domain:"speed.marisalnc.com"},{domain:"freeyx.cloudflare88.eu.org"},{domain:"bestcf.top"},{domain:"cdn.2020111.xyz"},{domain:"cfip.cfcdn.vip"},{domain:"cf.0sm.com"},{domain:"cf.090227.xyz"},{domain:"cf.zhetengsha.eu.org"},{domain:"cloudflare.9jy.cc"},{domain:"cf.zerone-cdn.pp.ua"},{domain:"cfip.1323123.xyz"},{domain:"cnamefuckxxs.yuchen.icu"},{domain:"cloudflare-ip.mofashi.ltd"},{domain:"115155.xyz"},{domain:"cname.xirancdn.us"},{domain:"f3058171cad.002404.xyz"},{domain:"8.889288.xyz"},{domain:"cdn.tzpro.xyz"},{domain:"cf.877771.xyz"},{domain:"xn--b6gac.eu.org"}],A=atob("aW52YWxpZCBkYXRh"),N=atob("aW52YWxpZCB1c2Vy"),F=atob("Y29tbWFuZCBpcyBub3Qgc3VwcG9ydGVk"),$=atob("VURQIHByb3h5IG9ubHkgZW5hYmxlIGZvciBETlMgd2hpY2ggaXMgcG9ydCA1Mw=="),B=atob("aW52YWxpZCBhZGRyZXNzVHlwZQ=="),V=atob("YWRkcmVzc1ZhbHVlIGlzIGVtcHR5"),O=atob("d2ViU29ja2V0LmVhZHlTdGF0ZSBpcyBub3Qgb3Blbg=="),K=atob("U3RyaW5naWZpZWQgaWRlbnRpZmllciBpcyBpbnZhbGlk"),j=atob("SW52YWxpZCBTT0NLUyBhZGRyZXNzIGZvcm1hdA=="),W=atob("bm8gYWNjZXB0YWJsZSBtZXRob2Rz"),G=atob("c29ja3Mgc2VydmVyIG5lZWRzIGF1dGg="),z=atob("ZmFpbCB0byBhdXRoIHNvY2tzIHNlcnZlcg=="),Y=atob("ZmFpbCB0byBvcGVuIHNvY2tzIGNvbm5lY3Rpb24=");let J={},q=!1;function X(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}function Z(e){if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e))return!0;if(/^(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(e))return!0;return!!/^::1$|^::$|^(?:[0-9a-fA-F]{1,4}:)*::(?:[0-9a-fA-F]{1,4}:)*[0-9a-fA-F]{1,4}$/.test(e)}async function _(e){if(e.C)try{T=e.C,await async function(){if(!T)return;try{const e=await T.get("c");e&&(U=JSON.parse(e))}catch(e){U={}}}()}catch(e){T=null}}async function Q(){if(T)try{const e=JSON.stringify(U);await T.put("c",e)}catch(e){throw e}}function ee(e,n=""){return void 0!==U[e]?U[e]:n}async function ne(e,n){U[e]=n,await Q()}async function te(e){try{const n=e.cf?.country;if(n){const e={US:"US",SG:"SG",JP:"JP",KR:"KR",DE:"DE",SE:"SE",NL:"NL",FI:"FI",GB:"GB",FR:"FR",CA:"CA",AU:"AU",HK:"HK",TW:"TW",IN:"IN",BR:"BR",PL:"PL",RU:"RU",CN:"SG",IT:"DE",ES:"DE",CH:"DE",AT:"DE",BE:"NL",DK:"SE",NO:"SE",IE:"GB",NZ:"AU",MY:"SG",ID:"SG",TH:"SG",VN:"SG",PH:"SG",BD:"IN",LK:"IN",NP:"IN",PK:"IN",AR:"BR",CL:"BR",CO:"BR",PE:"BR",CZ:"PL",SK:"PL",HU:"PL",UA:"PL",BY:"PL",KZ:"RU",UZ:"RU"};if(e[n])return e[n]}return"SG"}catch(e){return"SG"}}async function oe(e=""){if(0===H.length)return null;const n=H.map(e=>({...e,available:!0}));if(c&&e){const t=function(e,n){if(!c||!e)return n;const t=function(e){const n=function(e){return{US:["SG","JP","KR","BR"],SG:["JP","KR","US","IN"],JP:["SG","KR","US"],KR:["JP","SG","US"],DE:["NL","GB","SE","FI","PL","RU"],SE:["DE","NL","FI","GB","PL","RU"],NL:["DE","GB","SE","FI","PL"],FI:["SE","DE","NL","GB","RU"],GB:["DE","NL","SE","FI"],IN:["SG"],BR:["US"],PL:["DE","SE","FI","NL","RU"],RU:["FI","SE","DE","PL"],LV:["FI","SE","PL","RU"],IR:["LV","SG","JP","KR","DE","SE","NL","FI","GB","FR","PL","RU","US","CA","BR","IN","AU","HK","TW"]}[e]||[]}(e),t=["US","SG","JP","KR","DE","SE","NL","FI","GB","IN","BR","PL","RU","LV","IR","AU","HK","TW"];return[e,...n,...t.filter(t=>t!==e&&!n.includes(t))]}(e),o=[];for(const e of t){const t=n.filter(n=>n.regionCode===e);o.push(...t)}return o}(e,n);if(t.length>0){return t[0]}}return n[0]}function ae(e){if(e.includes("[")&&e.includes("]")){const n=e.match(/^\[([^\]]+)\](?::(\d+))?$/);if(n)return{address:n[1],port:n[2]?parseInt(n[2],10):null}}const n=e.lastIndexOf(":");if(n>0){const t=e.substring(0,n),o=e.substring(n+1),a=parseInt(o,10);if(!isNaN(a)&&a>0&&a<=65535)return{address:t,port:a}}return{address:e,port:null}}export default{async fetch(O,j,W){try{await _(j),n=(j.u||j.U||n).toLowerCase();const G=(j.d||j.D||n).toLowerCase(),z=ee("p",j.p||j.P);let Y=!1;const ie=ee("wk",j.wk||j.WK);ie&&ie.trim()?(u=ie.trim().toUpperCase(),d=u):z&&z.trim()?(Y=!0,d="CUSTOM"):d=await te(O);const le=j.rm||j.RM;le&&"no"===le.toLowerCase()&&(c=!1);const ge=ee("p",j.p||j.P);if(ge&&(t=ge.trim()),o=ee("s",j.s||j.S)||o,o)try{J=de(o),q=!0}catch(e){q=!1}const Pe=ee("yx",j.yx||j.YX);if(Pe)try{const e=Pe.split(",").map(e=>e.trim()).filter(e=>e);a=[],r=[],e.forEach(e=>{let n="",t=e;if(e.includes("#")){const o=e.split("#");t=o[0].trim(),n=o[1].trim()}const{address:o,port:i}=ae(t);n||(n="CustomPreferred-"+o+(i?":"+i:"")),Z(o)?a.push({ip:o,port:i,isp:n}):r.push({domain:o,port:i,name:n})})}catch(e){a=[],r=[]}const He=ee("qj",j.qj||j.QJ);He&&"no"===He.toLowerCase()&&(i=!0);const Me=ee("dkby",j.dkby||j.DKBY);Me&&"yes"===Me.toLowerCase()&&(s=!0);const Ae=j.yxby||j.YXBY;Ae&&"yes"===Ae.toLowerCase()&&(l=!0);const Ne=ee("ev",j.ev);void 0!==Ne&&""!==Ne&&(g="yes"===Ne||!0===Ne||"true"===Ne);const Fe=ee("et",j.et);void 0!==Fe&&""!==Fe&&(f="yes"===Fe||!0===Fe||"true"===Fe),I=ee("tp",j.tp)||"";const $e=ee("ex",j.ex);void 0!==$e&&""!==$e&&(h="yes"===$e||!0===$e||"true"===$e);const Be=ee("evm",j.evm);void 0!==Be&&""!==Be&&(b="yes"===Be||!0===Be||"true"===Be);const Ve=ee("ess",j.ess);void 0!==Ve&&""!==Ve&&(y="yes"===Ve||!0===Ve||"true"===Ve);const Oe=ee("etu",j.etu);void 0!==Oe&&""!==Oe&&(C="yes"===Oe||!0===Oe||"true"===Oe);const Ke=ee("ehy",j.ehy);void 0!==Ke&&""!==Ke&&(P="yes"===Ke||!0===Ke||"true"===Ke);const je=ee("eg",j.eg);void 0!==je&&""!==je&&(S="yes"===je||!0===je||"true"===je),k=ee("scu",j.scu)||"https://url.v1.mk/sub";const We=ee("epd",j.epd||"no");void 0!==We&&""!==We&&(E="no"!==We&&!1!==We&&"false"!==We);const Ge=ee("epi",j.epi);void 0!==Ge&&""!==Ge&&(D="no"!==Ge&&!1!==Ge&&"false"!==Ge);const ze=ee("egi",j.egi);void 0!==ze&&""!==ze&&(R="no"!==ze&&!1!==ze&&"false"!==ze);const Ye=ee("edp",j.edp);void 0!==Ye&&""!==Ye&&(L="yes"===Ye||!0===Ye||"true"===Ye);const Je=ee("ech",j.ech);void 0!==Je&&""!==Je&&(x="yes"===Je||!0===Je||"true"===Je);const qe=ee("customDNS","");qe&&qe.trim()&&(v=qe.trim());const Xe=ee("customECHDomain","");if(Xe&&Xe.trim()&&(w=Xe.trim()),x){s=!0;"yes"!==ee("dkby","")&&await ne("dkby","yes")}g||f||h||b||y||(g=!0),p=ee("yxURL",j.yxURL||j.YXURL)||"https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt",m=ee("d",j.d||j.D)||"";p!=="https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt"&&(M.length=0,a=[],r=[]);const Ze=new URL(O.url);if("/dns-query"===Ze.pathname)return await async function(e){const n=new URL(e.url);if("OPTIONS"===e.method)return new Response(null,{status:204,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Accept","Access-Control-Max-Age":"86400"}});const t="GET"===e.method,o="POST"===e.method;if(!t&&!o)return new Response("Method not allowed",{status:405});if(t&&!n.searchParams.has("dns"))return new Response("Missing DNS query parameter",{status:400});const a=function(e){const n=e.reduce((e,n)=>e+n.weight,0);let t=Math.random()*n;for(const n of e){if(t<n.weight)return n;t-=n.weight}return e[0]}(Te);try{const t=a.url+n.search,r=new Headers(e.headers);o?r.set("Content-Type","application/dns-message"):r.set("Accept","application/dns-message"),r.set("User-Agent","DoH-Proxy-Worker/1.0");const i=new Request(t,{method:e.method,headers:r,body:o?await e.arrayBuffer():null,redirect:"follow"}),s=await fetch(i),l=new Headers(s.headers);return l.set("Access-Control-Allow-Origin","*"),l.set("Access-Control-Allow-Methods","GET, POST, OPTIONS"),l.set("Access-Control-Allow-Headers","Content-Type, Accept"),l.set("Cache-Control",`public, max-age=${Ue}`),new Response(s.body,{status:s.status,statusText:s.statusText,headers:l})}catch(t){return await async function(e,n,t){const o=Te.filter(e=>e.name!==t.name);for(const t of o.slice(0,2))try{const o=t.url+n.search,a=new Headers(e.headers);"POST"===e.method?a.set("Content-Type","application/dns-message"):a.set("Accept","application/dns-message");const r=new Request(o,{method:e.method,headers:a,body:"POST"===e.method?await e.arrayBuffer():null}),i=await fetch(r);if(i.ok){const e=new Headers(i.headers);return e.set("Access-Control-Allow-Origin","*"),new Response(i.body,{status:i.status,headers:e})}}catch(e){continue}return new Response("All DNS providers failed",{status:503})}(e,n,a)}}(O);if("/dns-encoding"===Ze.pathname)return new Response("DNS Encoding Explanation: GET requests must use base64url encoded DNS query in ?dns= param. POST requests send raw binary.",{status:200});if(Ze.pathname.includes("/api/config")){const e=Ze.pathname.split("/").filter(e=>e),i=e.indexOf("api");if(i>0){const L=e.slice(0,i).join("/");let A=!1;if(m&&m.trim()){A=L===(m.trim().startsWith("/")?m.trim().substring(1):m.trim())}else A=X(L)&&L===n;return A?await async function(e){if("GET"===e.method)return T?new Response(JSON.stringify({...U,kvEnabled:!0}),{headers:{"Content-Type":"application/json"}}):new Response(JSON.stringify({error:"KV Storage Not Configured",kvEnabled:!1}),{status:503,headers:{"Content-Type":"application/json"}});if("POST"===e.method){if(!T)return new Response(JSON.stringify({success:!1,message:"KVå­˜å‚¨æœªé…ç½®ï¼Œæ— æ³•ä¿å­˜é…ç½®"}),{status:503,headers:{"Content-Type":"application/json"}});try{const n=await e.json();for(const[e,t]of Object.entries(n))""===t||null==t?delete U[e]:U[e]=t;await Q(),function(){const e=ee("wk","");if(e&&e.trim())u=e.trim().toUpperCase(),d=u;else{const e=ee("p","");e&&e.trim()?d="CUSTOM":u=""}const n=ee("rm","");c=!n||"no"!==n.toLowerCase();const i=ee("ev","");void 0!==i&&""!==i&&(g="yes"===i||!0===i||"true"===i);const L=ee("et","");void 0!==L&&""!==L&&(f="yes"===L||!0===L||"true"===L);I=ee("tp","")||"";const T=ee("ex","");void 0!==T&&""!==T&&(h="yes"===T||!0===T||"true"===T);const U=ee("evm","");void 0!==U&&""!==U&&(b="yes"===U||!0===U||"true"===U);const H=ee("ess","");void 0!==H&&""!==H&&(y="yes"===H||!0===H||"true"===H);const A=ee("etu","");void 0!==A&&""!==A&&(C="yes"===A||!0===A||"true"===A);const N=ee("ehy","");void 0!==N&&""!==N&&(P="yes"===N||!0===N||"true"===N);const F=ee("eg","");void 0!==F&&""!==F&&(S="yes"===F||!0===F||"true"===F);g||f||h||b||y||C||P||S||(g=!0);k=ee("scu","")||"https://url.v1.mk/sub";const $=ee("epd","no");void 0!==$&&""!==$&&(E="no"!==$&&!1!==$&&"false"!==$);const B=ee("epi","");void 0!==B&&""!==B&&(D="no"!==B&&!1!==B&&"false"!==B);const V=ee("egi","");void 0!==V&&""!==V&&(R="no"!==V&&!1!==V&&"false"!==V);const O=ee("ech","");void 0!==O&&""!==O&&(x="yes"===O||!0===O||"true"===O);const K=ee("customDNS","");v=K&&K.trim()?K.trim():"https://dns.joeyblog.eu.org/joeyblog";const j=ee("customECHDomain","");w=j&&j.trim()?j.trim():"cloudflare-ech.com";x&&(s=!0);const W=ee("dkby","");W&&"yes"===W.toLowerCase()&&(s=!0);m=ee("d","")||"",p=ee("yxURL","")||"https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt";const G=ee("p","");t=G?G.trim():"";if(o=ee("s","")||"",o)try{J=de(o),q=!0}catch(e){q=!1}else q=!1;const z=ee("yxby","");l=!(!z||"yes"!==z.toLowerCase());const Y="https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt";p!==Y&&(M.length=0,a=[],r=[])}(),void 0!==n.yx&&Ee();const i=ee("yxURL","")||"https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt";return i!=="https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt"?(M.length=0,a=[],r=[]):(H=[{domain:"ProxyIP.US.CMLiussss.net",region:"US",regionCode:"US",port:443},{domain:"ProxyIP.SG.CMLiussss.net",region:"SG",regionCode:"SG",port:443},{domain:"ProxyIP.JP.CMLiussss.net",region:"JP",regionCode:"JP",port:443},{domain:"ProxyIP.KR.CMLiussss.net",region:"KR",regionCode:"KR",port:443},{domain:"ProxyIP.DE.CMLiussss.net",region:"DE",regionCode:"DE",port:443},{domain:"ProxyIP.SE.CMLiussss.net",region:"SE",regionCode:"SE",port:443},{domain:"ProxyIP.NL.CMLiussss.net",region:"NL",regionCode:"NL",port:443},{domain:"ProxyIP.FI.CMLiussss.net",region:"FI",regionCode:"FI",port:443},{domain:"ProxyIP.GB.CMLiussss.net",region:"GB",regionCode:"GB",port:443},{domain:"ProxyIP.IN.CMLiussss.net",region:"IN",regionCode:"IN",port:443},{domain:"ProxyIP.BR.CMLiussss.net",region:"BR",regionCode:"BR",port:443},{domain:"ProxyIP.PL.CMLiussss.net",region:"PL",regionCode:"PL",port:443},{domain:"ProxyIP.RU.CMLiussss.net",region:"RU",regionCode:"RU",port:443},{domain:"ProxyIP.LV.CMLiussss.net",region:"LV",regionCode:"LV",port:443},{domain:"ProxyIP.IR.CMLiussss.net",region:"IR",regionCode:"IR",port:443},{domain:"ProxyIP.Oracle.cmliussss.net",region:"Oracle",regionCode:"Oracle",port:443},{domain:"ProxyIP.DigitalOcean.CMLiussss.net",region:"DigitalOcean",regionCode:"DigitalOcean",port:443},{domain:"ProxyIP.Vultr.CMLiussss.net",region:"Vultr",regionCode:"Vultr",port:443},{domain:"ProxyIP.Multacom.CMLiussss.net",region:"Multacom",regionCode:"Multacom",port:443}],M.length=0,M.push({name:"cloudflare.182682.xyz",domain:"cloudflare.182682.xyz"},{name:"speed.marisalnc.com",domain:"speed.marisalnc.com"},{domain:"freeyx.cloudflare88.eu.org"},{domain:"bestcf.top"},{domain:"cdn.2020111.xyz"},{domain:"cfip.cfcdn.vip"},{domain:"cf.0sm.com"},{domain:"cf.090227.xyz"},{domain:"cf.zhetengsha.eu.org"},{domain:"cloudflare.9jy.cc"},{domain:"cf.zerone-cdn.pp.ua"},{domain:"cfip.1323123.xyz"},{domain:"cnamefuckxxs.yuchen.icu"},{domain:"cloudflare-ip.mofashi.ltd"},{domain:"115155.xyz"},{domain:"cname.xirancdn.us"},{domain:"f3058171cad.002404.xyz"},{domain:"8.889288.xyz"},{domain:"cdn.tzpro.xyz"},{domain:"cf.877771.xyz"},{domain:"xn--b6gac.eu.org"})),new Response(JSON.stringify({success:!0,message:"é…ç½®å·²ä¿å­˜",config:U}),{headers:{"Content-Type":"application/json"}})}catch(e){return new Response(JSON.stringify({success:!1,message:"ä¿å­˜é…ç½®å¤±è´¥: "+e.message}),{status:500,headers:{"Content-Type":"application/json"}})}}return new Response(JSON.stringify({error:"Method not allowed"}),{status:405,headers:{"Content-Type":"application/json"}})}(O):new Response(JSON.stringify({error:"è·¯å¾„éªŒè¯å¤±è´¥"}),{status:403,headers:{"Content-Type":"application/json"}})}return new Response(JSON.stringify({error:"Invalid API Path"}),{status:404,headers:{"Content-Type":"application/json"}})}if(Ze.pathname.includes("/api/preferred-ips")){const e=Ze.pathname.split("/").filter(e=>e),t=e.indexOf("api");if(t>0){const o=e.slice(0,t).join("/");let a=!1;if(m&&m.trim()){a=o===(m.trim().startsWith("/")?m.trim().substring(1):m.trim())}else a=X(o)&&o===n;return a?await async function(e){if(!T)return new Response(JSON.stringify({success:!1,error:"KV Storage Not Configured",message:"Requires KV storage configuration"}),{status:503,headers:{"Content-Type":"application/json"}});if("yes"!==ee("ae",""))return new Response(JSON.stringify({success:!1,error:"API Disabled",message:'API disabled for security. Enable "Allow API Management" in settings.'}),{status:403,headers:{"Content-Type":"application/json"}});try{if("GET"===e.method){const e=De(ee("yx",""));return new Response(JSON.stringify({success:!0,count:e.length,data:e}),{headers:{"Content-Type":"application/json"}})}if("POST"===e.method){const n=await e.json(),t=Array.isArray(n)?n:[n];if(0===t.length)return new Response(JSON.stringify({success:!1,error:"Request Body Empty",message:"Please provide IP data"}),{status:400,headers:{"Content-Type":"application/json"}});let o=De(ee("yx",""));const a=[],r=[],i=[];for(const e of t){if(!e.ip){i.push({ip:"Unknown",reason:"IP address is required"});continue}const n=e.port||443,t=e.name||`APIä¼˜é€‰-${e.ip}:${n}`;if(!Z(e.ip)&&!Le(e.ip)){i.push({ip:e.ip,reason:"Invalid IP or domain format"});continue}if(o.some(t=>t.ip===e.ip&&t.port===n)){r.push({ip:e.ip,port:n,reason:"Already exists"});continue}const s={ip:e.ip,port:n,name:t,addedAt:(new Date).toISOString()};o.push(s),a.push(s)}if(a.length>0){const e=Re(o);await ne("yx",e),Ee()}return new Response(JSON.stringify({success:a.length>0,message:`Successfully added ${a.length} IPs`,added:a.length,skipped:r.length,errors:i.length,data:{addedIPs:a,skippedIPs:r.length>0?r:void 0,errors:i.length>0?i:void 0}}),{headers:{"Content-Type":"application/json"}})}if("DELETE"===e.method){const n=await e.json();if(!0===n.all){const e=ee("yx",""),n=De(e).length;return await ne("yx",""),Ee(),new Response(JSON.stringify({success:!0,message:`All preferred IPs cleared, deleted ${n}`,deletedCount:n}),{headers:{"Content-Type":"application/json"}})}if(!n.ip)return new Response(JSON.stringify({success:!1,error:"IP address is required",message:'Provide ip field to delete, or use {"all": true} to clear all'}),{status:400,headers:{"Content-Type":"application/json"}});const t=n.port||443;let o=De(ee("yx",""));const a=o.length,r=o.filter(e=>!(e.ip===n.ip&&e.port===t));if(r.length===a)return new Response(JSON.stringify({success:!1,error:"Preferred IP Not Found",message:`${n.ip}:${t} not found`}),{status:404,headers:{"Content-Type":"application/json"}});const i=Re(r);return await ne("yx",i),Ee(),new Response(JSON.stringify({success:!0,message:"Preferred IP Deleted",deleted:{ip:n.ip,port:t}}),{headers:{"Content-Type":"application/json"}})}return new Response(JSON.stringify({success:!1,error:"Method Not Allowed",message:"Supported methods: GET, POST, DELETE"}),{status:405,headers:{"Content-Type":"application/json"}})}catch(e){return new Response(JSON.stringify({success:!1,error:"Processing Failed",message:e.message}),{status:500,headers:{"Content-Type":"application/json"}})}}(O):new Response(JSON.stringify({error:"è·¯å¾„éªŒè¯å¤±è´¥"}),{status:403,headers:{"Content-Type":"application/json"}})}return new Response(JSON.stringify({error:"Invalid API Path"}),{status:404,headers:{"Content-Type":"application/json"}})}if("POST"===O.method&&"application/grpc"===O.headers.get("content-type")&&S)return await async function(e){if(!t)return new Response("No backend for gRPC",{status:503});const n=new URL(e.url),{address:o,port:a}=ae(t),r=`https://${o}:${a||443}${n.pathname}${n.search}`;try{const n=new Request(r,{method:e.method,headers:e.headers,body:e.body,redirect:"follow"});return await fetch(n)}catch(e){return new Response("gRPC Proxy Error: "+e.message,{status:502})}}(O);if("POST"===O.method&&h){const o=await async function(o){try{return await async function(n,o){if(me>=ye)return new Response("Too many connections",{status:429});me++;let a=!1;const r=()=>{a||(me=Math.max(0,me-1),a=!0)};try{const a=await async function(e,n){const t=e.getReader({mode:"byob"});try{let e=await t.readAtLeast(18,Ie()),o=0,a=0,r=e.value;o+=e.value.length;const i=r[0],s=r.slice(1,17),l=function(e){e=e.replaceAll("-","");const n=[];for(let t=0;t<16;t++){const o=parseInt(e.substr(2*t,2),16);n.push(o)}return n}(n);if(!function(e,n){for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}(s,l))return"invalid UUID";const c=r[17],d=18+c+1+2+1;if(d+1>o){if(e.done)return"header too short";a=d+1-o,e=await t.readAtLeast(a,Ie()),o+=e.value.length,r=Se(r,e.value)}const u=r[18+c];if(1!==u)return`unsupported command: ${u}`;const p=(r[d-1-2]<<8)+r[d-1-1],m=r[d-1];let g=-1;if(1===m?g=d+4:3===m?g=d+16:2===m&&(g=d+1+r[d]),g<0)return"read address type failed";if(a=g-o,a>0){if(e.done)return"read address failed";e=await t.readAtLeast(a,Ie()),o+=e.value.length,r=Se(r,e.value)}let f="";switch(a=d,m){case 1:f=r.slice(a,a+4).join(".");break;case 2:f=(new TextDecoder).decode(r.slice(a+1,a+1+r[a]));break;case 3:f=r.slice(a,a+16).reduce((e,n,t,o)=>t%2?e.concat(((o[t-1]<<8)+n).toString(16)):e,[]).join(":")}if(f.length<1)return"failed to parse hostname";return{hostname:f,port:p,data:r.slice(g),resp:new Uint8Array([i,0]),reader:t,done:e.done}}catch(e){try{t.releaseLock()}catch(e){}throw e}}(n,o);if("object"!=typeof a||!a)return null;const i=await async function(n,...t){let o,a=0;const r=[n.hostname,...t.filter(e=>e&&e!==n.hostname)];for(const t of r)if(t)for(a=0;a<be;){a++;try{const o=e({hostname:t,port:n.port}),a=Ce(fe).then(()=>{throw new Error(atob("Y29ubmVjdCB0aW1lb3V0"))});await Promise.race([o.opened,a]);const r=xe(n,o.writable);return{downloader:ve(n.resp,o.readable),uploader:r,close:()=>{try{o.close()}catch(e){}}}}catch(e){o=e,a<be&&await Ce(500*a)}}return null}(a,t,"13.230.34.30");if(null===i)return null;const s=Promise.race([(async()=>{try{await i.downloader.done}catch(e){}})(),(async()=>{try{await i.uploader.done}catch(e){}})(),Ce(he).then(()=>{})]).finally(()=>{try{i.close()}catch(e){}try{i.downloader.abort()}catch(e){}try{i.uploader.abort()}catch(e){}r()});return{readable:i.downloader.readable,closed:s}}catch(e){return r(),null}}(o.body,n)}catch(e){return null}}(O);return o?(W.waitUntil(o.closed),new Response(o.readable,{headers:{"X-Accel-Buffering":"no","Cache-Control":"no-store",Connection:"keep-alive","User-Agent":"Go-http-client/2.0","Content-Type":"application/grpc"}})):new Response("Internal Server Error",{status:500})}if(O.headers.get("Upgrade")===atob("d2Vic29ja2V0"))return await async function(e){d&&""!==d||(d=u&&u.trim()?u.trim().toUpperCase():await te(e));const o=new WebSocketPair,[a,r]=Object.values(o);r.accept();let i={socket:null},s=!1,l=null;const c=e.headers.get(atob("c2VjLXdlYnNvY2tldC1wcm90b2NvbA=="))||"",p=function(e,n){let t=!1;return new ReadableStream({start(o){e.addEventListener("message",e=>{t||o.enqueue(e.data)}),e.addEventListener("close",()=>{t||(we(e),o.close())}),e.addEventListener("error",e=>o.error(e));const{earlyData:a,error:r}=function(e){if(!e)return{error:null};try{return e=e.replace(/-/g,"+").replace(/_/g,"/"),{earlyData:Uint8Array.from(atob(e),e=>e.charCodeAt(0)).buffer,error:null}}catch(e){return{error:e}}}(n);r?o.error(r):a&&o.enqueue(a)},cancel(){t=!0,we(e)}})}(r,c),m=new URL(e.url);return p.pipeTo(new WritableStream({async write(e){if(s)return await ce(e,r,null);if(i.socket){const n=i.socket.writable.getWriter();return await n.write(e),void n.releaseLock()}if(!l){const o=b&&m.pathname.startsWith("/vm"),a=y&&m.pathname.startsWith("/ss");if(o||a){l=o?"vmess":"shadowsocks";let n=t;if(!n&&d){const e=await oe(d);e&&(n=e.domain+":"+e.port)}if(n){const{address:t,port:o}=ae(n);return void await se(2,t,o||80,e,r,null,i)}throw new Error("No backend configured for VMess/SS relay")}if(g&&e.byteLength>=24){const t=function(e,n){if(e.byteLength<24)return{hasError:!0,message:A};const t=new Uint8Array(e.slice(0,1));if(function(e,n=0){const t=(ke[e[n]]+ke[e[n+1]]+ke[e[n+2]]+ke[e[n+3]]+"-"+ke[e[n+4]]+ke[e[n+5]]+"-"+ke[e[n+6]]+ke[e[n+7]]+"-"+ke[e[n+8]]+ke[e[n+9]]+"-"+ke[e[n+10]]+ke[e[n+11]]+ke[e[n+12]]+ke[e[n+13]]+ke[e[n+14]]+ke[e[n+15]]).toLowerCase();if(!X(t))throw new TypeError(K);return t}(new Uint8Array(e.slice(1,17)))!==n)return{hasError:!0,message:N};const o=new Uint8Array(e.slice(17,18))[0],a=new Uint8Array(e.slice(18+o,19+o))[0];let r=!1;if(1===a);else{if(2!==a)return{hasError:!0,message:F};r=!0}const i=19+o,s=new DataView(e.slice(i,i+2)).getUint16(0);let l=i+2,c=0,d=l+1,u="";const p=new Uint8Array(e.slice(l,d))[0];switch(p){case 1:c=4,u=new Uint8Array(e.slice(d,d+c)).join(".");break;case 2:c=new Uint8Array(e.slice(d,d+1))[0],d+=1,u=(new TextDecoder).decode(e.slice(d,d+c));break;case 3:c=16;const n=[],t=new DataView(e.slice(d,d+c));for(let e=0;e<8;e++)n.push(t.getUint16(2*e).toString(16));u=n.join(":");break;default:return{hasError:!0,message:`${B}: ${p}`}}return u?{hasError:!1,addressType:p,port:s,hostname:u,isUDP:r,rawIndex:d+c,version:t}:{hasError:!0,message:`${V}: ${p}`}}(e,n);if(!t.hasError){l="vless";const{addressType:n,port:o,hostname:a,rawIndex:c,version:d,isUDP:u}=t;if(u){if(53!==o)throw new Error($);s=!0}const p=new Uint8Array([d[0],0]),m=e.slice(c);return s?ce(m,r,p):void await se(n,a,o,m,r,p,i)}}if(f&&e.byteLength>=56){const t=await async function(e,n){const t=I||n,o=await async function(e){const n=(new TextEncoder).encode(e),t=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];let o=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428];const a=n.length,r=8*a,i=64*Math.ceil((a+9)/64),s=new Uint8Array(i);s.set(n),s[a]=128;const l=new DataView(s.buffer);l.setUint32(i-4,r,!1);for(let e=0;e<i;e+=64){const n=new Uint32Array(64);for(let t=0;t<16;t++)n[t]=l.getUint32(e+4*t,!1);for(let e=16;e<64;e++){const t=pe(n[e-15],7)^pe(n[e-15],18)^n[e-15]>>>3,o=pe(n[e-2],17)^pe(n[e-2],19)^n[e-2]>>>10;n[e]=n[e-16]+t+n[e-7]+o>>>0}let[a,r,i,s,c,d,u,p]=o;for(let e=0;e<64;e++){const o=p+(pe(c,6)^pe(c,11)^pe(c,25))+(c&d^~c&u)+t[e]+n[e]>>>0,l=a&r^a&i^r&i;p=u,u=d,d=c,c=s+o>>>0,s=i,i=r,r=a,a=o+((pe(a,2)^pe(a,13)^pe(a,22))+l>>>0)>>>0}o[0]=o[0]+a>>>0,o[1]=o[1]+r>>>0,o[2]=o[2]+i>>>0,o[3]=o[3]+s>>>0,o[4]=o[4]+c>>>0,o[5]=o[5]+d>>>0,o[6]=o[6]+u>>>0,o[7]=o[7]+p>>>0}const c=[];for(let e=0;e<7;e++)c.push((o[e]>>>24&255).toString(16).padStart(2,"0"),(o[e]>>>16&255).toString(16).padStart(2,"0"),(o[e]>>>8&255).toString(16).padStart(2,"0"),(255&o[e]).toString(16).padStart(2,"0"));return c.join("")}(t);if(e.byteLength<56)return{hasError:!0,message:"invalid "+atob("dHJvamFu")+" data - too short"};let a=56;if(13!==new Uint8Array(e.slice(56,57))[0]||10!==new Uint8Array(e.slice(57,58))[0])return{hasError:!0,message:"invalid "+atob("dHJvamFu")+" header format (missing CR LF)"};if((new TextDecoder).decode(e.slice(0,a))!==o)return{hasError:!0,message:"invalid "+atob("dHJvamFu")+" password"};const r=e.slice(a+2);if(r.byteLength<6)return{hasError:!0,message:atob("aW52YWxpZCBTT0NLUzUgcmVxdWVzdCBkYXRh")};const i=new DataView(r);if(1!==i.getUint8(0))return{hasError:!0,message:"unsupported command, only TCP (CONNECT) is allowed"};const s=i.getUint8(1);let l=0,c=2,d="";switch(s){case 1:l=4,d=new Uint8Array(r.slice(c,c+l)).join(".");break;case 3:l=new Uint8Array(r.slice(c,c+1))[0],c+=1,d=(new TextDecoder).decode(r.slice(c,c+l));break;case 4:l=16;const e=new DataView(r.slice(c,c+l)),n=[];for(let t=0;t<8;t++)n.push(e.getUint16(2*t).toString(16));d=n.join(":");break;default:return{hasError:!0,message:`invalid addressType is ${s}`}}if(!d)return{hasError:!0,message:`address is empty, addressType is ${s}`};const u=c+l,p=r.slice(u,u+2),m=new DataView(p).getUint16(0);return{hasError:!1,addressRemote:d,addressType:s,port:m,hostname:d,rawClientData:r.slice(u+4)}}(e,n);if(!t.hasError){l=atob("dHJvamFu");const{addressType:e,port:n,hostname:o,rawClientData:a}=t;return void await se(e,o,n,a,r,null,i)}}throw new Error("Invalid protocol or authentication failed")}}})).catch(e=>{}),new Response(null,{status:101,webSocket:a})}(O);if("GET"===O.method){if(Ze.pathname.endsWith("/region")){const e=Ze.pathname.split("/").filter(e=>e);if(2===e.length&&"region"===e[1]){const t=e[0];let o=!1;if(m&&m.trim()){o=t===(m.trim().startsWith("/")?m.trim().substring(1):m.trim())}else o=X(t)&&t===n;if(o){const e=ee("p",j.p||j.P),n=ee("wk",j.wk||j.WK);if(n&&n.trim())return new Response(JSON.stringify({region:n.trim().toUpperCase(),detectionMethod:"Manual Region",manualRegion:n.trim().toUpperCase(),timestamp:(new Date).toISOString()}),{headers:{"Content-Type":"application/json"}});if(e&&e.trim())return new Response(JSON.stringify({region:"CUSTOM",detectionMethod:"Custom ProxyIP Mode",ci:e,timestamp:(new Date).toISOString()}),{headers:{"Content-Type":"application/json"}});{const e=await te(O);return new Response(JSON.stringify({region:e,detectionMethod:"API Detection",timestamp:(new Date).toISOString()}),{headers:{"Content-Type":"application/json"}})}}return new Response(JSON.stringify({error:"Access Denied",message:"Path Validation Failed"}),{status:403,headers:{"Content-Type":"application/json"}})}}if(Ze.pathname.endsWith("/test-api")){const e=Ze.pathname.split("/").filter(e=>e);if(2===e.length&&"test-api"===e[1]){const t=e[0];let o=!1;if(m&&m.trim()){o=t===(m.trim().startsWith("/")?m.trim().substring(1):m.trim())}else o=X(t)&&t===n;if(!o)return new Response(JSON.stringify({error:"Access Denied",message:"Path Validation Failed"}),{status:403,headers:{"Content-Type":"application/json"}});try{const e=await te(O);return new Response(JSON.stringify({detectedRegion:e,message:"API Test Completed",timestamp:(new Date).toISOString()}),{headers:{"Content-Type":"application/json"}})}catch(e){return new Response(JSON.stringify({error:e.message,message:"API Test Failed"}),{status:500,headers:{"Content-Type":"application/json"}})}}}if("/"===Ze.pathname){const e=ee("homepage",j.homepage||j.HOMEPAGE);if(e&&e.trim())try{const n=new URL(e.trim());if("https:"!==n.protocol)throw new Error("Invalid homepage URL protocol");const t=await fetch(n.toString(),{method:"GET",headers:{"User-Agent":O.headers.get("User-Agent")||"Mozilla/5.0",Accept:O.headers.get("Accept")||"*/*","Accept-Language":O.headers.get("Accept-Language")||"en-US,en;q=0.9"},redirect:"follow"});if(t.ok){const e=t.headers.get("Content-Type")||"text/html; charset=utf-8",n=await t.text();return new Response(n,{status:t.status,headers:{"Content-Type":e,"Cache-Control":"no-cache, no-store, must-revalidate"}})}}catch(e){console.error("Failed to fetch custom homepage:",e)}const n=O.headers.get("Cookie")||"";let t=null;if(n){const e=n.split(";").map(e=>e.trim());for(const n of e)if(n.startsWith("preferredLanguage=")){t=n.split("=")[1];break}}let o=!1;if("fa"===t||"fa-IR"===t)o=!0;else if("en"===t||"en-US"===t)o=!1;else{const e=O.headers.get("Accept-Language")||"";o="fa"===e.split(",")[0].split("-")[0].toLowerCase()||e.includes("fa-IR")||e.includes("fa")}const a={en:{title:"Terminal",terminal:"Terminal",congratulations:"Congratulations, you made it!",enterU:"Please enter the value of your U variable",enterD:"Please enter the value of your D variable",command:"Command: connect [",uuid:"UUID",path:"PATH",inputU:"Enter content of U variable and press Enter...",inputD:"Enter content of D variable and press Enter...",connecting:"Connecting...",invading:"Invading...",success:"Connection successful! Returning result...",error:"Error: Invalid UUID format",reenter:"Please re-enter a valid UUID",subtitle:"Multi-client Support â€¢ Smart Optimization â€¢ One-Click Generation",selectClient:"[ Select Client ]",systemStatus:"[ System Status ]",configManagement:"[ Config Management ]",relatedLinks:"[ Related Links ]",checking:"Checking...",workerRegion:"Worker Region: ",detectionMethod:"Detection Method: ",proxyIPStatus:"ProxyIP Status: ",currentIP:"Current IP: ",regionMatch:"Region Match: ",selectionLogic:"Selection Logic: ",kvStatusChecking:"Checking KV Status...",kvEnabled:"âœ… KV Storage Enabled, Config Management Available",kvDisabled:"âš ï¸ KV Storage Disabled or Not Configured",specifyRegion:"Specify Region (wk):",autoDetect:"Auto Detect",saveRegion:"Save Region Config",protocolSelection:"Protocol Selection:",enableVLESS:"Enable VLESS Protocol",enableVMess:"Enable VMess Protocol",enableShadowsocks:"Enable Shadowsocks Protocol",enableTrojan:"Enable Trojan Protocol",enableXhttp:"Enable xhttp Protocol",enableTUIC:"Enable TUIC Protocol",enableHysteria2:"Enable Hysteria 2 Protocol",enableVLESSgRPC:"Enable VLESS gRPC Protocol",linkOnlyHint:"Requires External Backend (Link-Only)",grpcHint:"Requires Custom Domain (gRPC)",trojanPassword:"Trojan Password (Optional):",customPath:"Custom Path (d):",customPathPlaceholder:"e.g., /secret-path",customIP:"Custom ProxyIP (p):",customIPPlaceholder:"e.g., 1.2.3.4 or proxy.example.com",preferredIPs:"Preferred IP List (yx):",preferredIPsPlaceholder:"e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA",preferredIPsURL:"Preferred IP Source URL (yxURL):",latencyTest:"Latency Test",latencyTestIP:"Test IP/Domain:",latencyTestIPPlaceholder:"Enter IP or Domain, comma separated",latencyTestPort:"Port:",startTest:"Start Test",stopTest:"Stop Test",testResult:"Test Result:",addToYx:"Add to Preferred List",addSelectedToYx:"Add Selected to Preferred List",selectAll:"Select All",deselectAll:"Deselect All",testingInProgress:"Testing...",testComplete:"Test Complete",latencyMs:"Latency (HTTP Handshake)",timeout:"Timeout",ipSource:"IP Source:",manualInput:"Manual Input",cfRandomIP:"CF Random IP",urlFetch:"URL Fetch",randomCount:"Generate Count:",fetchURL:"Fetch URL:",fetchURLPlaceholder:"Enter URL of IP list",generateIP:"Generate IP",fetchIP:"Fetch IP",socks5Config:"SOCKS5 Config (s):",customHomepage:"Custom Homepage URL (homepage):",customHomepagePlaceholder:"e.g., https://example.com",customHomepageHint:"Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.",customPathHint:"Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.",customIPHint:"Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.",preferredIPsHint:"Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.",socks5ConfigHint:"Format: user:pass@host:port. Worker will connect to target via this proxy.",saveConfig:"Save Config",advancedControl:"Advanced Control",subscriptionConverter:"Sub Converter URL:",builtinPreferred:"Built-in Preferred Type:",enablePreferredDomain:"Enable Preferred Domain",enablePreferredIP:"Enable Preferred IP",enableGitHubPreferred:"Enable GitHub Default Preferred",enableDiverseProxies:"Enable Diverse Proxies (Generate all ports)",enableDiverseProxiesHint:"Generate nodes for all supported ports (80, 443, 2053, etc.) for each IP. Increases subscription size significantly.",allowAPIManagement:"Allow API Management (ae):",regionMatching:"Region Matching (rm):",downgradeControl:"Downgrade Control (qj):",tlsControl:"TLS Control (dkby):",preferredControl:"Preferred Control (yxby):",saveAdvanced:"Save Advanced Config",loading:"Loading...",currentConfig:"ğŸ“ Current Path Config",refreshConfig:"Refresh Config",resetConfig:"Reset Config",subscriptionCopied:"Subscription Link Copied",autoSubscriptionCopied:"Auto-detected subscription link copied. Client will be recognized by User-Agent.",trojanPasswordPlaceholder:"Leave empty to use UUID",trojanPasswordHint:"Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.",protocolHint:"Multiple protocols can be enabled.<br>â€¢ VLESS WS: Standard WebSocket protocol<br>â€¢ VMess WS: WebSocket-based VMess (link generation)<br>â€¢ Shadowsocks: WebSocket-based SS (link generation)<br>â€¢ Trojan: Uses SHA224 password auth<br>â€¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)",enableECH:"Enable ECH (Encrypted Client Hello)",enableECHHint:"When enabled, ECH config is fetched from DoH and added to links on every sub refresh",customDNS:"Custom DNS Server",customDNSPlaceholder:"e.g., https://dns.joeyblog.eu.org/joeyblog",customDNSHint:"DNS server for ECH config query (DoH format)",customECHDomain:"Custom ECH Domain",customECHDomainPlaceholder:"e.g., cloudflare-ech.com",customECHDomainHint:"Domain used in ECH config, leave empty for default",saveProtocol:"Save Protocol Config",subscriptionConverterPlaceholder:"Default: https://url.v1.mk/sub",subscriptionConverterHint:"Custom subscription converter API, leave empty for default",builtinPreferredHint:"Control which built-in preferred nodes are included. Default all enabled.",apiEnabledDefault:"Default (API Disabled)",apiEnabledYes:"Enable API Management",apiEnabledHint:"âš ï¸ Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.",regionMatchingDefault:"Default (Enable Region Match)",regionMatchingNo:"Disable Region Match",regionMatchingHint:'Smart region matching disabled when set to "Disable"',downgradeControlDefault:"Default (Disable Downgrade)",downgradeControlNo:"Enable Downgrade Mode",downgradeControlHint:"When enabled: CF Direct Fail -> SOCKS5 -> Fallback",tlsControlDefault:"Default (Keep All Nodes)",tlsControlYes:"TLS Nodes Only",tlsControlHint:'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',preferredControlDefault:"Default (Enable Preferred)",preferredControlYes:"Disable Preferred",preferredControlHint:'When set to "Disable Preferred", only native address is used',regionNames:{US:"ğŸ‡ºğŸ‡¸ US",SG:"ğŸ‡¸ğŸ‡¬ Singapore",JP:"ğŸ‡¯ğŸ‡µ Japan",KR:"ğŸ‡°ğŸ‡· South Korea",DE:"ğŸ‡©ğŸ‡ª Germany",SE:"ğŸ‡¸ğŸ‡ª Sweden",NL:"ğŸ‡³ğŸ‡± Netherlands",FI:"ğŸ‡«ğŸ‡® Finland",GB:"ğŸ‡¬ğŸ‡§ UK",FR:"ğŸ‡«ğŸ‡· France",CA:"ğŸ‡¨ğŸ‡¦ Canada",AU:"ğŸ‡¦ğŸ‡º Australia",HK:"ğŸ‡­ğŸ‡° Hong Kong",TW:"ğŸ‡¹ğŸ‡¼ Taiwan"},terminal:"Terminal v2.9.3",githubProject:"GitHub Project",autoDetectClient:"Auto Detect",selectionLogicText:"Same Region -> Nearby Region -> Other Regions",customIPDisabledHint:"Region selection disabled when using Custom ProxyIP",customIPMode:"Custom ProxyIP Mode (p variable enabled)",customIPModeDesc:"Custom IP Mode (Region match disabled)",usingCustomProxyIP:"Using Custom ProxyIP: ",customIPConfig:" (p variable config)",customIPModeDisabled:"Custom IP Mode, region selection disabled",manualRegion:"Manual Region",manualRegionDesc:" (Manual)",proxyIPAvailable:"10/10 Available (ProxyIP Domain Pre-set)",smartSelection:"Smart Nearby Selection",sameRegionIP:"Same Region IP Available (1)",cloudflareDetection:"Cloudflare Built-in Detection",detectionFailed:"Detection Failed",apiTestResult:"API Detection Result: ",apiTestTime:"Detection Time: ",apiTestFailed:"API Detection Failed: ",unknownError:"Unknown Error",apiTestError:"API Test Failed: ",kvNotConfigured:"KV Storage not configured. Config management unavailable.\\n\\nPlease in Cloudflare Workers:\\n1. Create KV Namespace\\n2. Bind variable C\\n3. Redeploy",kvNotEnabled:"KV Storage Not Configured",kvCheckFailed:"KV Check Failed: Invalid Response",kvCheckFailedStatus:"KV Check Failed - Status: ",kvCheckFailedError:"KV Check Failed - Error: "},fa:{title:"ØªØ±Ù…ÛŒÙ†Ø§Ù„",terminal:"ØªØ±Ù…ÛŒÙ†Ø§Ù„",congratulations:"ØªØ¨Ø±ÛŒÚ© Ù…ÛŒâ€ŒÚ¯ÙˆÛŒÛŒÙ… Ø¨Ù‡ Ø´Ù…Ø§",enterU:"Ù„Ø·ÙØ§ Ù…Ù‚Ø¯Ø§Ø± Ù…ØªØºÛŒØ± U Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",enterD:"Ù„Ø·ÙØ§ Ù…Ù‚Ø¯Ø§Ø± Ù…ØªØºÛŒØ± D Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",command:"Ø¯Ø³ØªÙˆØ±: connect [",uuid:"UUID",path:"PATH",inputU:"Ù…Ø­ØªÙˆÛŒØ§Øª Ù…ØªØºÛŒØ± U Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù‡ Ùˆ Enter Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯...",inputD:"Ù…Ø­ØªÙˆÛŒØ§Øª Ù…ØªØºÛŒØ± D Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù‡ Ùˆ Enter Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯...",connecting:"Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...",invading:"Ø¯Ø± Ø­Ø§Ù„ Ù†ÙÙˆØ°...",success:"Ø§ØªØµØ§Ù„ Ù…ÙˆÙÙ‚! Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ØªÛŒØ¬Ù‡...",error:"Ø®Ø·Ø§: ÙØ±Ù…Øª UUID Ù†Ø§Ù…Ø¹ØªØ¨Ø±",reenter:"Ù„Ø·ÙØ§ UUID Ù…Ø¹ØªØ¨Ø± Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"}}[o?"fa":"en"],r=`<!DOCTYPE html>\n        <html lang="${o?"fa-IR":"en-US"}" dir="${o?"rtl":"ltr"}">\n    <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n            <title>${a.title}</title>\n        <style>\n            * { margin: 0; padding: 0; box-sizing: border-box; }\n            body {\n                font-family: "Courier New", monospace;\n                background: #000; color: #00ff00; min-height: 100vh;\n                overflow-x: hidden; position: relative;\n                display: flex; justify-content: center; align-items: center;\n            }\n            .matrix-bg {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                background: #000;\n                z-index: -1;\n            }\n            @keyframes bg-pulse {\n                0%, 100% { background: linear-gradient(45deg, #000 0%, #001100 50%, #000 100%); }\n                50% { background: linear-gradient(45deg, #000 0%, #002200 50%, #000 100%); }\n            }\n            .matrix-rain {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                background: transparent;\n                z-index: -1;\n                display: none;\n            }\n            @keyframes matrix-fall {\n                0% { transform: translateY(-100%); }\n                100% { transform: translateY(100vh); }\n            }\n            .matrix-code-rain {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                pointer-events: none; z-index: -1;\n                overflow: hidden;\n                display: none;\n            }\n            .matrix-column {\n                position: absolute; top: -100%; left: 0;\n                color: #00ff00; font-family: "Courier New", monospace;\n                font-size: 14px; line-height: 1.2;\n                text-shadow: 0 0 5px #00ff00;\n            }\n            @keyframes matrix-drop {\n                0% { top: -100%; opacity: 1; }\n                10% { opacity: 1; }\n                90% { opacity: 0.3; }\n                100% { top: 100vh; opacity: 0; }\n            }\n            .matrix-column:nth-child(odd) {\n                animation-duration: 12s;\n                animation-delay: -2s;\n            }\n            .matrix-column:nth-child(even) {\n                animation-duration: 18s;\n                animation-delay: -5s;\n            }\n            .matrix-column:nth-child(3n) {\n                animation-duration: 20s;\n                animation-delay: -8s;\n            }\n            .terminal {\n                width: 90%; max-width: 800px; height: 500px;\n                background: rgba(0, 0, 0, 0.9);\n                border: 2px solid #00ff00;\n                border-radius: 8px;\n                box-shadow: 0 0 30px rgba(0, 255, 0, 0.5), inset 0 0 20px rgba(0, 255, 0, 0.1);\n                backdrop-filter: blur(10px);\n                position: relative; z-index: 1;\n                overflow: hidden;\n            }\n            .terminal-header {\n                background: rgba(0, 20, 0, 0.8);\n                padding: 10px 15px;\n                border-bottom: 1px solid #00ff00;\n                display: flex; align-items: center;\n            }\n            .terminal-buttons {\n                display: flex; gap: 8px;\n            }\n            .terminal-button {\n                width: 12px; height: 12px; border-radius: 50%;\n                background: #ff5f57; border: none;\n            }\n            .terminal-button:nth-child(2) { background: #ffbd2e; }\n            .terminal-button:nth-child(3) { background: #28ca42; }\n            .terminal-title {\n                margin-left: 15px; color: #00ff00;\n                font-size: 14px; font-weight: bold;\n            }\n            .terminal-body {\n                padding: 20px; height: calc(100% - 50px);\n                overflow-y: auto; font-size: 14px;\n                line-height: 1.4;\n            }\n            .terminal-line {\n                margin-bottom: 8px; display: flex; align-items: center;\n            }\n            .terminal-prompt {\n                color: #00ff00; margin-right: 10px;\n                font-weight: bold;\n            }\n            .terminal-input {\n                background: transparent; border: none; outline: none;\n                color: #00ff00; font-family: "Courier New", monospace;\n                font-size: 14px; flex: 1;\n                caret-color: #00ff00;\n            }\n            .terminal-input::placeholder {\n                color: #00aa00; opacity: 0.7;\n            }\n            .terminal-cursor {\n                display: inline-block; width: 8px; height: 16px;\n                background: #00ff00;\n                margin-left: 2px;\n            }\n            @keyframes blink {\n                0%, 50% { opacity: 1; }\n                51%, 100% { opacity: 0; }\n            }\n            .terminal-output {\n                color: #00aa00; margin: 5px 0;\n            }\n            .terminal-error {\n                color: #ff4444; margin: 5px 0;\n            }\n            .terminal-success {\n                color: #44ff44; margin: 5px 0;\n            }\n            .matrix-text {\n                position: fixed; top: 20px; right: 20px;\n                color: #00ff00; font-family: "Courier New", monospace;\n                font-size: 0.8rem; opacity: 0.6;\n            }\n            @keyframes matrix-flicker {\n                0%, 100% { opacity: 0.6; }\n                50% { opacity: 1; }\n            }\n        </style>\n    </head>\n    <body>\n        <div class="matrix-bg"></div>\n        <div class="matrix-rain"></div>\n        <div class="matrix-code-rain" id="matrixCodeRain"></div>\n            <div class="matrix-text">${a.terminal}</div>\n            <div style="position: fixed; top: 20px; left: 20px; z-index: 1000;">\n                <select id="languageSelector" style="background: rgba(0, 20, 0, 0.9); border: 2px solid #00ff00; color: #00ff00; padding: 8px 12px; font-family: 'Courier New', monospace; font-size: 14px; cursor: pointer; text-shadow: 0 0 5px #00ff00; box-shadow: 0 0 15px rgba(0, 255, 0, 0.4);" onchange="changeLanguage(this.value)">\n                    <option value="en" ${o?"":"selected"}>ğŸ‡ºğŸ‡¸ English</option>\n                    <option value="fa" ${o?"selected":""}>ğŸ‡®ğŸ‡· ÙØ§Ø±Ø³ÛŒ</option>\n                </select>\n            </div>\n        <div class="terminal">\n            <div class="terminal-header">\n                <div class="terminal-buttons">\n                    <div class="terminal-button"></div>\n                    <div class="terminal-button"></div>\n                    <div class="terminal-button"></div>\n                </div>\n                    <div class="terminal-title">${a.terminal}</div>\n            </div>\n            <div class="terminal-body" id="terminalBody">\n                <div class="terminal-line">\n                    <span class="terminal-prompt">root:~$</span>\n                        <span class="terminal-output">${a.congratulations}</span>\n                </div>\n                <div class="terminal-line">\n                    <span class="terminal-prompt">root:~$</span>\n                        <span class="terminal-output">${m&&m.trim()?a.enterD:a.enterU}</span>\n                </div>\n                <div class="terminal-line">\n                    <span class="terminal-prompt">root:~$</span>\n                        <span class="terminal-output">${a.command}${m&&m.trim()?a.path:a.uuid}]</span>\n                </div>\n                <div class="terminal-line">\n                    <span class="terminal-prompt">root:~$</span>\n                        <input type="text" class="terminal-input" id="uuidInput" placeholder="${m&&m.trim()?a.inputD:a.inputU}" autofocus>\n                    <span class="terminal-cursor"></span>\n                </div>\n            </div>\n        </div>\n        <script>\n            function createMatrixRain() {\n                const matrixContainer = document.getElementById('matrixCodeRain');\n                const matrixChars = '01ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\n                const columns = Math.floor(window.innerWidth / 18);\n\n                for (let i = 0; i < columns; i++) {\n                    const column = document.createElement('div');\n                    column.className = 'matrix-column';\n                    column.style.left = (i * 18) + 'px';\n                    column.style.animationDelay = Math.random() * 15 + 's';\n                    column.style.animationDuration = (Math.random() * 15 + 8) + 's';\n                    column.style.fontSize = (Math.random() * 4 + 12) + 'px';\n                    column.style.opacity = Math.random() * 0.8 + 0.2;\n\n                    let text = '';\n                    const charCount = Math.floor(Math.random() * 30 + 20);\n                    for (let j = 0; j < charCount; j++) {\n                        const char = matrixChars[Math.floor(Math.random() * matrixChars.length)];\n                        const brightness = Math.random() > 0.1 ? '#00ff00' : '#00aa00';\n                        text += '<span style="color: ' + brightness + ';">' + char + '</span><br>';\n                    }\n                    column.innerHTML = text;\n                    matrixContainer.appendChild(column);\n                }\n\n                setInterval(function() {\n                    const columns = matrixContainer.querySelectorAll('.matrix-column');\n                    columns.forEach(function(column) {\n                        if (Math.random() > 0.95) {\n                            const chars = column.querySelectorAll('span');\n                            if (chars.length > 0) {\n                                const randomChar = chars[Math.floor(Math.random() * chars.length)];\n                                randomChar.style.color = '#ffffff';\n                                setTimeout(function() {\n                                    randomChar.style.color = '#00ff00';\n                                }, 200);\n                            }\n                        }\n                    });\n                }, 100);\n            }\n\n            function isValidUUID(uuid) {\n                const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n                return uuidRegex.test(uuid);\n            }\n\n            function addTerminalLine(content, type = 'output') {\n                const terminalBody = document.getElementById('terminalBody');\n                const line = document.createElement('div');\n                line.className = 'terminal-line';\n\n                const prompt = document.createElement('span');\n                prompt.className = 'terminal-prompt';\n                prompt.textContent = 'root:~$';\n\n                const output = document.createElement('span');\n                output.className = 'terminal-' + type;\n                output.textContent = content;\n\n                line.appendChild(prompt);\n                line.appendChild(output);\n                terminalBody.appendChild(line);\n\n                terminalBody.scrollTop = terminalBody.scrollHeight;\n            }\n\n            function handleUUIDInput() {\n                const input = document.getElementById('uuidInput');\n                const inputValue = input.value.trim();\n                const cp = '${m}';\n\n                if (inputValue) {\n                    addTerminalLine(atob('Y29ubmVjdCA=') + inputValue, 'output');\n\n                        const translations = {\n                            en: {\n                    title: 'Terminal',\n                    terminal: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n                    \n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support â€¢ Smart Optimization â€¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: 'âœ… KV Storage Enabled, Config Management Available',\n                    kvDisabled: 'âš ï¸ KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'ğŸ“ Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>â€¢ VLESS WS: Standard WebSocket protocol<br>â€¢ VMess WS: WebSocket-based VMess (link generation)<br>â€¢ Shadowsocks: WebSocket-based SS (link generation)<br>â€¢ Trojan: Uses SHA224 password auth<br>â€¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: 'âš ï¸ Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'ğŸ‡ºğŸ‡¸ US', SG: 'ğŸ‡¸ğŸ‡¬ Singapore', JP: 'ğŸ‡¯ğŸ‡µ Japan',\n                        KR: 'ğŸ‡°ğŸ‡· South Korea', DE: 'ğŸ‡©ğŸ‡ª Germany', SE: 'ğŸ‡¸ğŸ‡ª Sweden', NL: 'ğŸ‡³ğŸ‡± Netherlands',\n                        FI: 'ğŸ‡«ğŸ‡® Finland', GB: 'ğŸ‡¬ğŸ‡§ UK', FR: 'ğŸ‡«ğŸ‡· France', CA: 'ğŸ‡¨ğŸ‡¦ Canada',\n                        AU: 'ğŸ‡¦ğŸ‡º Australia', HK: 'ğŸ‡­ğŸ‡° Hong Kong', TW: 'ğŸ‡¹ğŸ‡¼ Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                            fa: {\n                                connecting: 'Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...',\n                                invading: 'Ø¯Ø± Ø­Ø§Ù„ Ù†ÙÙˆØ°...',\n                                success: 'Ø§ØªØµØ§Ù„ Ù…ÙˆÙÙ‚! Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ØªÛŒØ¬Ù‡...',\n                                error: 'Ø®Ø·Ø§: ÙØ±Ù…Øª UUID Ù†Ø§Ù…Ø¹ØªØ¨Ø±',\n                                reenter: 'Ù„Ø·ÙØ§ UUID Ù…Ø¹ØªØ¨Ø± Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'\n                            }\n                        };\n                        const browserLang = navigator.language || navigator.userLanguage || '';\n                        const isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                        const t = translations[isFarsi ? 'fa' : 'en'];\n\n                    if (cp) {\n                        const cleanInput = inputValue.startsWith('/') ? inputValue : '/' + inputValue;\n                            addTerminalLine(t.connecting, 'output');\n                        setTimeout(() => {\n                                addTerminalLine(t.success, 'success');\n                            setTimeout(() => {\n                                window.location.href = cleanInput;\n                            }, 1000);\n                        }, 500);\n                    } else {\n                        if (isValidUUID(inputValue)) {\n                            addTerminalLine(t.invading, 'output');\n                        setTimeout(() => {\n                                addTerminalLine(t.success, 'success');\n                            setTimeout(() => {\n                                    window.location.href = '/' + inputValue;\n                            }, 1000);\n                        }, 500);\n                    } else {\n                            addTerminalLine(t.error, 'error');\n                            addTerminalLine(t.reenter, 'output');\n                        }\n                    }\n\n                    input.value = '';\n                }\n            }\n\n                function changeLanguage(lang) {\n                    localStorage.setItem('preferredLanguage', lang);\n                    // Set Cookie (valid for 1 year)\n                    const expiryDate = new Date();\n                    expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n                    document.cookie = 'preferredLanguage=' + lang + '; path=/; expires=' + expiryDate.toUTCString() + '; SameSite=Lax';\n                    // Reload page, do not use URL parameters\n                    window.location.reload();\n                }\n\n                // Check localStorage and Cookie on page load, and clean up URL parameters\n                window.addEventListener('DOMContentLoaded', function() {\n                    function getCookie(name) {\n                        const value = '; ' + document.cookie;\n                        const parts = value.split('; ' + name + '=');\n                        if (parts.length === 2) return parts.pop().split(';').shift();\n                        return null;\n                    }\n\n                    const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                    const urlParams = new URLSearchParams(window.location.search);\n                    const urlLang = urlParams.get('lang');\n\n                    // If URL has language parameter, remove it and set Cookie\n                    if (urlLang) {\n                        const currentUrl = new URL(window.location.href);\n                        currentUrl.searchParams.delete('lang');\n                        const newUrl = currentUrl.toString();\n\n                        // è®¾ç½®Cookie\n                        const expiryDate = new Date();\n                        expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n                        document.cookie = 'preferredLanguage=' + urlLang + '; path=/; expires=' + expiryDate.toUTCString() + '; SameSite=Lax';\n                        localStorage.setItem('preferredLanguage', urlLang);\n\n                        // Use history API to remove URL parameter, do not reload page\n                        window.history.replaceState({}, '', newUrl);\n                    } else if (savedLang) {\n                        // If present in localStorage but not in Cookie, sync to Cookie\n                        const expiryDate = new Date();\n                        expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n                        document.cookie = 'preferredLanguage=' + savedLang + '; path=/; expires=' + expiryDate.toUTCString() + '; SameSite=Lax';\n                    }\n                });\n\n            document.addEventListener('DOMContentLoaded', function() {\n                const input = document.getElementById('uuidInput');\n                input.focus();\n                input.addEventListener('keypress', function(e) {\n                    if (e.key === 'Enter') {\n                        handleUUIDInput();\n                    }\n                });\n            });\n        <\/script>\n    </body>\n    </html>`;return new Response(r,{status:200,headers:{"Content-Type":"text/html; charset=utf-8"}})}if(m&&m.trim()){const e=m.trim().startsWith("/")?m.trim():"/"+m.trim(),t=e.endsWith("/")&&e.length>1?e.slice(0,-1):e,o=Ze.pathname.endsWith("/")&&Ze.pathname.length>1?Ze.pathname.slice(0,-1):Ze.pathname;if(o===t)return await ue(O,n);if(o===t+"/sub")return await re(O,n,Ze);if(Ze.pathname.length>1&&"/"!==Ze.pathname){if(X(Ze.pathname.replace(/\/$/,"").replace("/sub","").substring(1)))return new Response(JSON.stringify({error:"Access Denied",message:"Custom path mode enabled, UUID access disabled"}),{status:403,headers:{"Content-Type":"application/json"}})}}else{if(Ze.pathname.length>1&&"/"!==Ze.pathname&&!Ze.pathname.includes("/sub")){const e=Ze.pathname.replace(/\/$/,"").substring(1);if(X(e))return e===n?await ue(O,e):new Response(JSON.stringify({error:"UUID Error: Please note the variable name is u, not uuid"}),{status:403,headers:{"Content-Type":"application/json"}})}if(Ze.pathname.includes("/sub")){const e=Ze.pathname.split("/");if(2===e.length&&"sub"===e[1]){const t=e[0].substring(1);if(X(t))return t===n?await re(O,t,Ze):new Response(JSON.stringify({error:"UUID Error"}),{status:403,headers:{"Content-Type":"application/json"}})}}}const e=Ze.pathname.replace(/\/+$/,"").toLowerCase();if(e===`/${G}`.toLowerCase())return await re(O,n)}return new Response(JSON.stringify({error:"Not Found"}),{status:404,headers:{"Content-Type":"application/json"}})}catch(e){return new Response(e.toString(),{status:500})}}};async function re(e,n,o=null){o||(o=new URL(e.url));const i=[],c=o.hostname,u=o.searchParams.get("target")||"base64";let m=null;if(x){m=`${w||"cloudflare-ech.com"}+${v||"https://dns.joeyblog.eu.org/joeyblog"}`}async function T(e){g&&i.push(...function(e,n,t){const o=[80,8080,8880,2052,2082,2086,2095],a=[443,2053,2083,2087,2096,8443],r=[443],i=s?[]:[80],l=[],c="/?ed=2048",d=atob("dmxlc3M=");return e.forEach(e=>{let u=e.isp.replace(/\s/g,"_");e.colo&&e.colo.trim()&&(u=`${u}-${e.colo.trim()}`);const p=e.ip.includes(":")?`[${e.ip}]`:e.ip;let m=[];if(L)a.forEach(e=>{m.push({port:e,tls:!0})}),s||o.forEach(e=>{m.push({port:e,tls:!1})});else if(e.port){const n=e.port;a.includes(n)?m.push({port:n,tls:!0}):o.includes(n)?s||m.push({port:n,tls:!1}):m.push({port:n,tls:!0})}else r.forEach(e=>{m.push({port:e,tls:!0})}),i.forEach(e=>{m.push({port:e,tls:!1})});m.forEach(({port:e,tls:o})=>{if(o){const o=`${u}-${e}-WS-TLS`,a=new URLSearchParams({encryption:"none",security:"tls",sni:t,fp:x?"chrome":"randomized",type:"ws",host:t,path:c});if(x){const e=v||"https://dns.joeyblog.eu.org/joeyblog",n=w||"cloudflare-ech.com";a.set("alpn","h3,h2,http/1.1"),a.set("ech",`${n}+${e}`)}l.push(`${d}://${n}@${p}:${e}?${a.toString()}#${encodeURIComponent(o)}`)}else{const o=`${u}-${e}-WS`,a=new URLSearchParams({encryption:"none",security:"none",type:"ws",host:t,path:c});l.push(`${d}://${n}@${p}:${e}?${a.toString()}#${encodeURIComponent(o)}`)}})}),l}(e,n,c,m)),f&&i.push(...await async function(e,n,t){const o=[80,8080,8880,2052,2082,2086,2095],a=[443,2053,2083,2087,2096,8443],r=[443],i=s?[]:[80],l=[],c="/?ed=2048",d=I||n;return e.forEach(e=>{let n=e.isp.replace(/\s/g,"_");e.colo&&e.colo.trim()&&(n=`${n}-${e.colo.trim()}`);const u=e.ip.includes(":")?`[${e.ip}]`:e.ip;let p=[];if(e.port){const n=e.port;a.includes(n)?p.push({port:n,tls:!0}):o.includes(n)?s||p.push({port:n,tls:!1}):p.push({port:n,tls:!0})}else r.forEach(e=>{p.push({port:e,tls:!0})}),i.forEach(e=>{p.push({port:e,tls:!1})});p.forEach(({port:e,tls:o})=>{if(o){const o=`${n}-${e}-${atob("VHJvamFu")}-WS-TLS`,a=new URLSearchParams({security:"tls",sni:t,fp:"chrome",type:"ws",host:t,path:c});if(x){const e=v||"https://dns.joeyblog.eu.org/joeyblog",n=w||"cloudflare-ech.com";a.set("alpn","h3,h2,http/1.1"),a.set("ech",`${n}+${e}`)}l.push(`${atob("dHJvamFuOi8v")}${d}@${u}:${e}?${a.toString()}#${encodeURIComponent(o)}`)}else{const o=`${n}-${e}-${atob("VHJvamFu")}-WS`,a=new URLSearchParams({security:"none",type:"ws",host:t,path:c});l.push(`${atob("dHJvamFuOi8v")}${d}@${u}:${e}?${a.toString()}#${encodeURIComponent(o)}`)}})}),l}(e,n,c,m)),h&&i.push(...function(e,n,t){const o=[],a=n.substring(0,8);return e.forEach(e=>{let r=e.isp.replace(/\s/g,"_");e.colo&&e.colo.trim()&&(r=`${r}-${e.colo.trim()}`);const i=e.ip.includes(":")?`[${e.ip}]`:e.ip,s=e.port||443,l=`${r}-${s}-xhttp`,c=new URLSearchParams({encryption:"none",security:"tls",sni:t,fp:"chrome",type:"xhttp",host:t,path:`/${a}`,mode:"stream-one"});if(x){const e=v||"https://dns.joeyblog.eu.org/joeyblog",n=w||"cloudflare-ech.com";c.set("alpn","h3,h2,http/1.1"),c.set("ech",`${n}+${e}`)}o.push(`vless://${n}@${i}:${s}?${c.toString()}#${encodeURIComponent(l)}`)}),o}(e,n,c,m)),b&&i.push(...function(e,n,t){const o=[],a="/vm?ed=2048",r=[443,2053,2083,2087,2096,8443];return e.forEach(e=>{let i=e.isp.replace(/\s/g,"_");e.colo&&e.colo.trim()&&(i+=`-${e.colo.trim()}`);const l=parseInt(e.port||443),c=r.includes(l);if(!c&&s)return;const d={v:"2",ps:i,add:e.ip,port:l,id:n,aid:"0",scy:"auto",net:"ws",type:"none",host:t,path:a,tls:c?"tls":"",sni:c?t:"",alpn:c?"h2,http/1.1":""},u=btoa(JSON.stringify(d));o.push(`vmess://${u}`)}),o}(e,n,c)),y&&i.push(...function(e,n,t){const o=[],a="chacha20-ietf-poly1305",r=n,i="/ss?ed=2048",l=[443,2053,2083,2087,2096,8443];return e.forEach(e=>{let n=e.isp.replace(/\s/g,"_");e.colo&&e.colo.trim()&&(n+=`-${e.colo.trim()}`);const c=parseInt(e.port||443),d=l.includes(c);if(!d&&s)return;const u=btoa(`${a}:${r}`);let p=`v2ray-plugin;mode=websocket;host=${t};path=${encodeURIComponent(i)}`;d&&(p+=";tls"),o.push(`ss://${u}@${e.ip}:${c}?plugin=${encodeURIComponent(p)}#${encodeURIComponent(n)}`)}),o}(e,n,c)),C&&i.push(...function(e,n,t){const o=[];return e.forEach(e=>{const a=e.isp.replace(/\s/g,"_")+(e.colo?`-${e.colo}`:""),r=e.port||443;o.push(`tuic://${n}:${n}@${e.ip}:${r}?congestion_control=bbr&alpn=h3&sni=${t}&udp_relay_mode=native&allow_insecure=1#${encodeURIComponent(a)}`)}),o}(e,n,c)),P&&i.push(...function(e,n,t){const o=[];return e.forEach(e=>{const a=e.isp.replace(/\s/g,"_")+(e.colo?`-${e.colo}`:""),r=e.port||443;o.push(`hy2://${n}@${e.ip}:${r}?insecure=1&sni=${t}#${encodeURIComponent(a)}`)}),o}(e,n,c)),S&&i.push(...function(e,n,t){const o=[],a="grpc",r=[443,2053,2083,2087,2096,8443];return e.forEach(e=>{let i=e.isp.replace(/\s/g,"_");e.colo&&e.colo.trim()&&(i+=`-${e.colo.trim()}`);const s=parseInt(e.port||443);if(r.includes(s)){const r=`vless://${n}@${e.ip}:${s}?encryption=none&security=tls&type=grpc&serviceName=${a}&sni=${t}&fp=chrome#${encodeURIComponent(i+"-gRPC")}`;o.push(r)}}),o}(e,n,c))}if("CUSTOM"===d){const e=[{ip:c,isp:"Native Address"}];await T(e)}else try{const e=[{ip:c,isp:"Native Address"}];await T(e)}catch(n){d||(d=await te(e));const o=await oe(d);if(o){t=o.domain+":"+o.port;const e=[{ip:o.domain,isp:"ProxyIP-"+d}];await T(e)}else{const e=[{ip:c,isp:"Native Address"}];await T(e)}}const U=a.length>0||r.length>0;if(l);else if(U){if(a.length>0&&D&&await T(a),r.length>0&&E){const e=r.map(e=>({ip:e.domain,isp:e.name||e.domain}));await T(e)}}else{if(E){const e=M.map(e=>({ip:e.domain,isp:e.name||e.domain}));await T(e)}if(D){if(p==="https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt")try{const e=await async function(){const e="https://www.wetest.vip/page/cloudflare/address_v4.html",n="https://www.wetest.vip/page/cloudflare/address_v6.html";let t=[];const o=""===ee("ipv4","")||"no"!==ee("ipv4","yes"),a=""===ee("ipv6","")||"no"!==ee("ipv6","yes"),r=""===ee("ispMobile","")||"no"!==ee("ispMobile","yes"),i=""===ee("ispUnicom","")||"no"!==ee("ispUnicom","yes"),s=""===ee("ispTelecom","")||"no"!==ee("ispTelecom","yes");try{const l=[];o?l.push(ie(e)):l.push(Promise.resolve([])),a?l.push(ie(n)):l.push(Promise.resolve([]));const[c,d]=await Promise.all(l);if(t=[...c,...d],t.length>0&&(t=t.filter(e=>{const n=e.isp||"";return!(n.includes("ç§»åŠ¨")&&!r)&&(!(n.includes("è”é€š")&&!i)&&!(n.includes("ç”µä¿¡")&&!s))})),t.length>0)return t}catch(e){}return[]}();e.length>0&&await T(e)}catch(n){d||(d=await te(e));const o=await oe(d);if(o){t=o.domain+":"+o.port;const e=[{ip:o.domain,isp:"ProxyIP-"+d}];await T(e)}}}if(R)try{const e=await async function(){const e=p||"https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt";try{const n=e.includes(",")?e.split(",").map(e=>e.trim()).filter(e=>e):[e],t=await async function(e,n="443",t=3e3){if(!e?.length)return[];const o=new Set;return await Promise.allSettled(e.map(async e=>{try{const a=new AbortController,r=setTimeout(()=>a.abort(),t),i=await fetch(e,{signal:a.signal});clearTimeout(r);let s="";try{const e=await i.arrayBuffer(),n=(i.headers.get("content-type")||"").toLowerCase(),t=n.match(/charset=([^\s;]+)/i)?.[1]?.toLowerCase()||"";let o=["utf-8","gb2312"];(t.includes("gb")||t.includes("gbk")||t.includes("gb2312"))&&(o=["gb2312","utf-8"]);let a=!1;for(const n of o)try{const t=new TextDecoder(n).decode(e);if(t&&t.length>0&&!t.includes("ï¿½")){s=t,a=!0;break}if(t&&t.length>0)continue}catch(e){continue}if(a||(s=await i.text()),!s||0===s.trim().length)return}catch(e){return}const l=s.trim().split("\n").map(e=>e.trim()).filter(e=>e),c=l.length>1&&l[0].includes(","),d=/^[^\[\]]*:[^\[\]]*:[^\[\]]/;if(c){const t=l[0].split(",").map(e=>e.trim()),a=l.slice(1);if(t.includes("IPåœ°å€")&&t.includes("ç«¯å£")&&t.includes("æ•°æ®ä¸­å¿ƒ")){const e=t.indexOf("IPåœ°å€"),n=t.indexOf("ç«¯å£"),r=t.indexOf("å›½å®¶")>-1?t.indexOf("å›½å®¶"):t.indexOf("åŸå¸‚")>-1?t.indexOf("åŸå¸‚"):t.indexOf("æ•°æ®ä¸­å¿ƒ"),i=t.indexOf("TLS");a.forEach(t=>{const a=t.split(",").map(e=>e.trim());if(-1!==i&&"true"!==a[i]?.toLowerCase())return;const s=d.test(a[e])?`[${a[e]}]`:a[e];o.add(`${s}:${a[n]}#${a[r]}`)})}else if(t.some(e=>e.includes("IP"))&&t.some(e=>e.includes("å»¶è¿Ÿ"))&&t.some(e=>e.includes("ä¸‹è½½é€Ÿåº¦"))){const r=t.findIndex(e=>e.includes("IP")),i=t.findIndex(e=>e.includes("å»¶è¿Ÿ")),s=t.findIndex(e=>e.includes("ä¸‹è½½é€Ÿåº¦")),l=new URL(e).searchParams.get("port")||n;a.forEach(e=>{const n=e.split(",").map(e=>e.trim()),t=d.test(n[r])?`[${n[r]}]`:n[r];o.add(`${t}:${l}#CF Preferred ${n[i]}ms ${n[s]}MB/s`)})}}else l.forEach(t=>{const a=t.indexOf("#"),[r,i]=a>-1?[t.substring(0,a),t.substring(a)]:[t,""];let s=!1;if(r.startsWith("["))s=/\]:(\d+)$/.test(r);else{const e=r.lastIndexOf(":");s=e>-1&&/^\d+$/.test(r.substring(e+1))}const l=new URL(e).searchParams.get("port")||n;o.add(s?t:`${r}:${l}${i}`)})}catch(e){}})),Array.from(o)}(n,"443",5e3);if(t.length>0){const e=[],n=/^(\[[\da-fA-F:]+\]|[\d.]+|[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?)*)(?::(\d+))?(?:#(.+))?$/;for(const o of t){const t=o.match(n);t&&e.push({ip:t[1],port:parseInt(t[2]||"443",10),name:t[3]?.trim()||t[1]})}return e}const o=await fetch(e);if(!o.ok)return[];const a=await o.text(),r=[],i=a.trim().replace(/\r/g,"").split("\n"),s=/^([^:]+):(\d+)#(.*)$/;for(const e of i){const n=e.trim();if(!n)continue;const t=n.match(s);t&&r.push({ip:t[1],port:parseInt(t[2],10),name:t[3].trim()||t[1]})}return r}catch(e){return[]}}();e.length>0&&(g&&i.push(...function(e,n,t){const o=[80,8080,8880,2052,2082,2086,2095],a=[443,2053,2083,2087,2096,8443],r=[],i="/?ed=2048",l=atob("dmxlc3M=");return e.forEach(e=>{const c=e.name.replace(/\s/g,"_"),d=e.port;if(a.includes(d)){const o=`${c}-${d}-WS-TLS`;let a=`${l}://${n}@${e.ip}:${d}?encryption=none&security=tls&sni=${t}&fp=${x?"chrome":"randomized"}&type=ws&host=${t}&path=${i}`;if(x){a+=`&alpn=h3%2Ch2%2Chttp%2F1.1&ech=${encodeURIComponent(`${w||"cloudflare-ech.com"}+${v||"https://dns.joeyblog.eu.org/joeyblog"}`)}`}a+=`#${encodeURIComponent(o)}`,r.push(a)}else if(o.includes(d)){if(!s){const o=`${c}-${d}-WS`,a=`${l}://${n}@${e.ip}:${d}?encryption=none&security=none&type=ws&host=${t}&path=${i}#${encodeURIComponent(o)}`;r.push(a)}}else{const o=`${c}-${d}-WS-TLS`;let a=`${l}://${n}@${e.ip}:${d}?encryption=none&security=tls&sni=${t}&fp=${x?"chrome":"randomized"}&type=ws&host=${t}&path=${i}`;if(x){a+=`&alpn=h3%2Ch2%2Chttp%2F1.1&ech=${encodeURIComponent(`${w||"cloudflare-ech.com"}+${v||"https://dns.joeyblog.eu.org/joeyblog"}`)}`}a+=`#${encodeURIComponent(o)}`,r.push(a)}}),r}(e,n,c,m)),f&&i.push(...await async function(e,n,t){const o=[80,8080,8880,2052,2082,2086,2095],a=[443,2053,2083,2087,2096,8443],r=[],i="/?ed=2048",l=I||n;return e.forEach(e=>{const n=e.name.replace(/\s/g,"_"),c=e.port;if(a.includes(c)){const o=`${n}-${c}-${atob("VHJvamFu")}-WS-TLS`;let a=`${atob("dHJvamFuOi8v")}${l}@${e.ip}:${c}?security=tls&sni=${t}&fp=chrome&type=ws&host=${t}&path=${i}`;if(x){a+=`&alpn=h3%2Ch2%2Chttp%2F1.1&ech=${encodeURIComponent(`${w||"cloudflare-ech.com"}+${v||"https://dns.joeyblog.eu.org/joeyblog"}`)}`}a+=`#${encodeURIComponent(o)}`,r.push(a)}else if(o.includes(c)){if(!s){const o=`${n}-${c}-${atob("VHJvamFu")}-WS`,a=`${atob("dHJvamFuOi8v")}${l}@${e.ip}:${c}?security=none&type=ws&host=${t}&path=${i}#${encodeURIComponent(o)}`;r.push(a)}}else{const o=`${n}-${c}-${atob("VHJvamFu")}-WS-TLS`;let a=`${atob("dHJvamFuOi8v")}${l}@${e.ip}:${c}?security=tls&sni=${t}&fp=chrome&type=ws&host=${t}&path=${i}`;if(x){a+=`&alpn=h3%2Ch2%2Chttp%2F1.1&ech=${encodeURIComponent(`${w||"cloudflare-ech.com"}+${v||"https://dns.joeyblog.eu.org/joeyblog"}`)}`}a+=`#${encodeURIComponent(o)}`,r.push(a)}}),r}(e,n,c,m)),b&&i.push(...function(e,n,t){const o=[],a="/vm?ed=2048",r=[443,2053,2083,2087,2096,8443];return e.forEach(e=>{const i=e.name.replace(/\s/g,"_"),l=parseInt(e.port),c=r.includes(l);if(!c&&s)return;const d={v:"2",ps:i,add:e.ip,port:l,id:n,aid:"0",scy:"auto",net:"ws",type:"none",host:t,path:a,tls:c?"tls":"",sni:c?t:"",alpn:c?"h2,http/1.1":""},u=btoa(JSON.stringify(d));o.push(`vmess://${u}`)}),o}(e,n,c)),y&&i.push(...function(e,n,t){const o=[],a="chacha20-ietf-poly1305",r=n,i="/ss?ed=2048",l=[443,2053,2083,2087,2096,8443];return e.forEach(e=>{const n=e.name.replace(/\s/g,"_"),c=parseInt(e.port),d=l.includes(c);if(!d&&s)return;const u=btoa(`${a}:${r}`);let p=`v2ray-plugin;mode=websocket;host=${t};path=${encodeURIComponent(i)}`;d&&(p+=";tls"),o.push(`ss://${u}@${e.ip}:${c}?plugin=${encodeURIComponent(p)}#${encodeURIComponent(n)}`)}),o}(e,n,c)),C&&i.push(...function(e,n,t){const o=[];return e.forEach(e=>{const a=e.name.replace(/\s/g,"_"),r=e.port||443;o.push(`tuic://${n}:${n}@${e.ip}:${r}?congestion_control=bbr&alpn=h3&sni=${t}&udp_relay_mode=native&allow_insecure=1#${encodeURIComponent(a)}`)}),o}(e,n,c)),P&&i.push(...function(e,n,t){const o=[];return e.forEach(e=>{const a=e.name.replace(/\s/g,"_"),r=e.port||443;o.push(`hy2://${n}@${e.ip}:${r}?insecure=1&sni=${t}#${encodeURIComponent(a)}`)}),o}(e,n,c)),S&&i.push(...function(e,n,t){const o=[],a="grpc",r=[443,2053,2083,2087,2096,8443];return e.forEach(e=>{const i=e.name.replace(/\s/g,"_"),s=parseInt(e.port);if(r.includes(s)){const r=`vless://${n}@${e.ip}:${s}?encryption=none&security=tls&type=grpc&serviceName=${a}&sni=${t}&fp=chrome#${encodeURIComponent(i+"-gRPC")}`;o.push(r)}}),o}(e,n,c)))}catch(n){d||(d=await te(e));const o=await oe(d);if(o){t=o.domain+":"+o.port;const e=[{ip:o.domain,isp:"ProxyIP-"+d}];await T(e)}}}if(0===i.length){const e="æ‰€æœ‰èŠ‚ç‚¹è·å–å¤±è´¥",n=`${atob("dmxlc3M=")}://00000000-0000-0000-0000-000000000000@127.0.0.1:80?encryption=none&security=none&type=ws&host=error.com&path=%2F#${encodeURIComponent(e)}`;i.push(n)}let H,A="text/plain; charset=utf-8";switch(u.toLowerCase()){case atob("Y2xhc2g="):case atob("Y2xhc2hy"):H=await async function(e,n){const t=new URL(n.url);t.pathname=t.pathname.replace(/\/sub$/,"")+"/sub",t.searchParams.set("target","base64");const o=encodeURIComponent(t.toString()),a=`${k}?target=clash&url=${o}&insert=false&emoji=true&list=false&xudp=false&udp=false&tfo=false&expand=true&scv=false&fdn=false&new_name=true`;try{const e=await fetch(a);if(!e.ok)throw new Error("è®¢é˜…è½¬æ¢æœåŠ¡å¤±è´¥");let n=await e.text();return x&&(n=n.split("\n").map(e=>{if(/^\s*-\s*\{/.test(e)&&e.includes("name:")&&e.includes("server:")){if(e.includes("ech-opts"))return e;const n=e.lastIndexOf("}");if(n>0){const t=e.substring(0,n).trim();if(t.length>0){const o=w||"cloudflare-ech.com",a=!t.endsWith(",")&&!t.endsWith("{");return e.substring(0,n)+(a?", ":" ")+`ech-opts: {enable: true, query-server-name: ${o}}`+e.substring(n)}}}return e}).join("\n")),n=n.replace(/^(\s*nameserver:\s*\n)((?:\s*-\s*[^\n]+\n)*)/m,(e,n,t)=>n+`    - ${v||"https://dns.joeyblog.eu.org/joeyblog"}\n`),n}catch(e){throw new Error("æ— æ³•è·å– Clash é…ç½®: "+e.message)}}(0,e),A="text/yaml; charset=utf-8";break;case atob("c3VyZ2U="):case atob("c3VyZ2Uy"):case atob("c3VyZ2Uz"):case atob("c3VyZ2U0"):H=generateSurgeConfig(i);break;case atob("cXVhbnR1bXVsdA=="):case atob("cXVhbng="):case"quanx":H=btoa(i.join("\n"));break;case atob("c3M="):case atob("c3Ny"):H=generateSSConfig(i);break;case atob("djJyYXk="):H=generateV2RayConfig(i);break;case atob("bG9vbg=="):H=generateLoonConfig(i);break;default:H=btoa(i.join("\n"))}const N={"Content-Type":A,"Cache-Control":"no-store, no-cache, must-revalidate, max-age=0"};return x&&(N["X-ECH-Status"]="ENABLED",m&&(N["X-ECH-Config-Length"]=String(m.length))),new Response(H,{headers:N})}async function ie(e){try{const n=await fetch(e,{headers:{"User-Agent":"Mozilla/5.0"}});if(!n.ok)return[];const t=await n.text(),o=[],a=/<tr[\s\S]*?<\/tr>/g,r=/<td data-label="çº¿è·¯åç§°">(.+?)<\/td>[\s\S]*?<td data-label="ä¼˜é€‰åœ°å€">([\d.:a-fA-F]+)<\/td>[\s\S]*?<td data-label="æ•°æ®ä¸­å¿ƒ">(.+?)<\/td>/;let i;for(;null!==(i=a.exec(t));){const e=i[0].match(r);if(e&&e[1]&&e[2]){const n=e[3]?e[3].trim().replace(/<.*?>/g,""):"";let t=e[1].trim().replace(/<.*?>/g,"");"ç§»åŠ¨"===t&&(t="Mobile"),"è”é€š"===t&&(t="Unicom"),"ç”µä¿¡"===t&&(t="Telecom"),o.push({isp:t,ip:e[2].trim(),colo:n})}}return o.length,o}catch(e){return[]}}async function se(n,o,a,r,s,l,c){async function u(t,o,a=!1){const i=a?await async function(n,t,o){const{username:a,password:r,hostname:i,socksPort:s}=J,l=e({hostname:i,port:s}),c=l.writable.getWriter();await c.write(new Uint8Array(a?[5,2,0,2]:[5,1,0]));const d=l.readable.getReader();let u=(await d.read()).value;if(5!==u[0]||255===u[1])throw new Error(W);if(2===u[1]){if(!a||!r)throw new Error(G);const e=new TextEncoder,n=new Uint8Array([1,a.length,...e.encode(a),r.length,...e.encode(r)]);if(await c.write(n),u=(await d.read()).value,1!==u[0]||0!==u[1])throw new Error(z)}const p=new TextEncoder;let m;switch(n){case 1:m=new Uint8Array([1,...t.split(".").map(Number)]);break;case 2:m=new Uint8Array([3,t.length,...p.encode(t)]);break;case 3:m=new Uint8Array([4,...t.split(":").flatMap(e=>[parseInt(e.slice(0,2),16),parseInt(e.slice(2),16)])]);break;default:throw new Error(B)}if(await c.write(new Uint8Array([5,1,0,...m,o>>8,255&o])),u=(await d.read()).value,0!==u[1])throw new Error(Y);return c.releaseLock(),d.releaseLock(),l}(n,t,o):e({hostname:t,port:o}),s=i.writable.getWriter();return await s.write(r),s.releaseLock(),i}async function p(){if(i&&q)try{const e=await u(o,a,!0);return c.socket=e,e.closed.catch(()=>{}).finally(()=>we(s)),void le(e,s,l,null)}catch(e){let n,r;if(t&&t.trim()){const e=ae(t);n=e.address,r=e.port||a}else{const e=await oe(d);n=e?e.domain:o,r=e?e.port:a}try{const e=await u(n,r,!1);c.socket=e,e.closed.catch(()=>{}).finally(()=>we(s)),le(e,s,l,null)}catch(e){we(s)}}else{let e,n;if(t&&t.trim()){const o=ae(t);e=o.address,n=o.port||a}else{const t=await oe(d);e=t?t.domain:o,n=t?t.port:a}try{const t=await u(e,n,q);c.socket=t,t.closed.catch(()=>{}).finally(()=>we(s)),le(t,s,l,null)}catch(e){we(s)}}}try{const e=await u(o,a,!i&&q);c.socket=e,le(e,s,l,p)}catch(e){p()}}async function le(e,n,t,o){let a=t,r=!1;await e.readable.pipeTo(new WritableStream({async write(e,t){r=!0,1!==n.readyState&&t.error(O),a?(n.send(await new Blob([a,e]).arrayBuffer()),a=null):n.send(e)},abort(e){}})).catch(e=>{we(n)}),!r&&o&&o()}async function ce(n,t,o){try{const a=e({hostname:"8.8.4.4",port:53});let r=o;const i=a.writable.getWriter();await i.write(n),i.releaseLock(),await a.readable.pipeTo(new WritableStream({async write(e){1===t.readyState&&(r?(t.send(await new Blob([r,e]).arrayBuffer()),r=null):t.send(e))}}))}catch(e){}}function de(e){let n,t,o,a,[r,i]=e.split("@").reverse();if(i){const e=i.split(":");if(2!==e.length)throw new Error(j);[n,t]=e}const s=r.split(":");if(a=Number(s.pop()),isNaN(a))throw new Error(j);if(o=s.join(":"),o.includes(":")&&!/^\[.*\]$/.test(o))throw new Error(j);return{username:n,password:t,hostname:o,socksPort:a}}async function ue(e,t=null){t||(t=n);new URL(e.url);const o=e.headers.get("Cookie")||"";let a=null;if(o){const e=o.split(";").map(e=>e.trim());for(const n of e)if(n.startsWith("preferredLanguage=")){a=n.split("=")[1];break}}let r=!1;if("fa"===a||"fa-IR"===a)r=!0;else if("en"===a||"en-US"===a)r=!1;else{const n=e.headers.get("Accept-Language")||"";r="fa"===n.split(",")[0].split("-")[0].toLowerCase()||n.includes("fa-IR")||n.includes("fa")}const i={en:{title:"Terminal",terminal:"Terminal",congratulations:"Congratulations, you made it!",enterU:"Please enter the value of your U variable",enterD:"Please enter the value of your D variable",command:"Command: connect [",uuid:"UUID",path:"PATH",inputU:"Enter content of U variable and press Enter...",inputD:"Enter content of D variable and press Enter...",connecting:"Connecting...",invading:"Invading...",success:"Connection successful! Returning result...",error:"Error: Invalid UUID format",reenter:"Please re-enter a valid UUID",subtitle:"Multi-client Support â€¢ Smart Optimization â€¢ One-Click Generation",selectClient:"[ Select Client ]",systemStatus:"[ System Status ]",configManagement:"[ Config Management ]",relatedLinks:"[ Related Links ]",checking:"Checking...",workerRegion:"Worker Region: ",detectionMethod:"Detection Method: ",proxyIPStatus:"ProxyIP Status: ",currentIP:"Current IP: ",regionMatch:"Region Match: ",selectionLogic:"Selection Logic: ",kvStatusChecking:"Checking KV Status...",kvEnabled:"âœ… KV Storage Enabled, Config Management Available",kvDisabled:"âš ï¸ KV Storage Disabled or Not Configured",specifyRegion:"Specify Region (wk):",autoDetect:"Auto Detect",saveRegion:"Save Region Config",protocolSelection:"Protocol Selection:",enableVLESS:"Enable VLESS Protocol",enableVMess:"Enable VMess Protocol",enableShadowsocks:"Enable Shadowsocks Protocol",enableTrojan:"Enable Trojan Protocol",enableXhttp:"Enable xhttp Protocol",enableTUIC:"Enable TUIC Protocol",enableHysteria2:"Enable Hysteria 2 Protocol",enableVLESSgRPC:"Enable VLESS gRPC Protocol",linkOnlyHint:"Requires External Backend (Link-Only)",grpcHint:"Requires Custom Domain (gRPC)",trojanPassword:"Trojan Password (Optional):",customPath:"Custom Path (d):",customPathPlaceholder:"e.g., /secret-path",customIP:"Custom ProxyIP (p):",customIPPlaceholder:"e.g., 1.2.3.4 or proxy.example.com",preferredIPs:"Preferred IP List (yx):",preferredIPsPlaceholder:"e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA",preferredIPsURL:"Preferred IP Source URL (yxURL):",latencyTest:"Latency Test",latencyTestIP:"Test IP/Domain:",latencyTestIPPlaceholder:"Enter IP or Domain, comma separated",latencyTestPort:"Port:",startTest:"Start Test",stopTest:"Stop Test",testResult:"Test Result:",addToYx:"Add to Preferred List",addSelectedToYx:"Add Selected to Preferred List",selectAll:"Select All",deselectAll:"Deselect All",testingInProgress:"Testing...",testComplete:"Test Complete",latencyMs:"Latency (HTTP Handshake)",timeout:"Timeout",ipSource:"IP Source:",manualInput:"Manual Input",cfRandomIP:"CF Random IP",urlFetch:"URL Fetch",randomCount:"Generate Count:",fetchURL:"Fetch URL:",fetchURLPlaceholder:"Enter URL of IP list",generateIP:"Generate IP",fetchIP:"Fetch IP",socks5Config:"SOCKS5 Config (s):",customHomepage:"Custom Homepage URL (homepage):",customHomepagePlaceholder:"e.g., https://example.com",customHomepageHint:"Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.",customPathHint:"Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.",customIPHint:"Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.",preferredIPsHint:"Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.",socks5ConfigHint:"Format: user:pass@host:port. Worker will connect to target via this proxy.",saveConfig:"Save Config",advancedControl:"Advanced Control",subscriptionConverter:"Sub Converter URL:",builtinPreferred:"Built-in Preferred Type:",enablePreferredDomain:"Enable Preferred Domain",enablePreferredIP:"Enable Preferred IP",enableGitHubPreferred:"Enable GitHub Default Preferred",allowAPIManagement:"Allow API Management (ae):",regionMatching:"Region Matching (rm):",downgradeControl:"Downgrade Control (qj):",tlsControl:"TLS Control (dkby):",preferredControl:"Preferred Control (yxby):",saveAdvanced:"Save Advanced Config",loading:"Loading...",currentConfig:"ğŸ“ Current Path Config",refreshConfig:"Refresh Config",resetConfig:"Reset Config",subscriptionCopied:"Subscription Link Copied",autoSubscriptionCopied:"Auto-detected subscription link copied. Client will be recognized by User-Agent.",trojanPasswordPlaceholder:"Leave empty to use UUID",trojanPasswordHint:"Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.",protocolHint:"Multiple protocols can be enabled.<br>â€¢ VLESS WS: Standard WebSocket protocol<br>â€¢ VMess WS: WebSocket-based VMess (link generation)<br>â€¢ Shadowsocks: WebSocket-based SS (link generation)<br>â€¢ Trojan: Uses SHA224 password auth<br>â€¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)",enableECH:"Enable ECH (Encrypted Client Hello)",enableECHHint:"When enabled, ECH config is fetched from DoH and added to links on every sub refresh",customDNS:"Custom DNS Server",customDNSPlaceholder:"e.g., https://dns.joeyblog.eu.org/joeyblog",customDNSHint:"DNS server for ECH config query (DoH format)",customECHDomain:"Custom ECH Domain",customECHDomainPlaceholder:"e.g., cloudflare-ech.com",customECHDomainHint:"Domain used in ECH config, leave empty for default",saveProtocol:"Save Protocol Config",subscriptionConverterPlaceholder:"Default: https://url.v1.mk/sub",subscriptionConverterHint:"Custom subscription converter API, leave empty for default",builtinPreferredHint:"Control which built-in preferred nodes are included. Default all enabled.",apiEnabledDefault:"Default (API Disabled)",apiEnabledYes:"Enable API Management",apiEnabledHint:"âš ï¸ Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.",regionMatchingDefault:"Default (Enable Region Match)",regionMatchingNo:"Disable Region Match",regionMatchingHint:'Smart region matching disabled when set to "Disable"',downgradeControlDefault:"Default (Disable Downgrade)",downgradeControlNo:"Enable Downgrade Mode",downgradeControlHint:"When enabled: CF Direct Fail -> SOCKS5 -> Fallback",tlsControlDefault:"Default (Keep All Nodes)",tlsControlYes:"TLS Nodes Only",tlsControlHint:'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',preferredControlDefault:"Default (Enable Preferred)",preferredControlYes:"Disable Preferred",preferredControlHint:'When set to "Disable Preferred", only native address is used',regionNames:{US:"ğŸ‡ºğŸ‡¸ US",SG:"ğŸ‡¸ğŸ‡¬ Singapore",JP:"ğŸ‡¯ğŸ‡µ Japan",KR:"ğŸ‡°ğŸ‡· South Korea",DE:"ğŸ‡©ğŸ‡ª Germany",SE:"ğŸ‡¸ğŸ‡ª Sweden",NL:"ğŸ‡³ğŸ‡± Netherlands",FI:"ğŸ‡«ğŸ‡® Finland",GB:"ğŸ‡¬ğŸ‡§ UK",FR:"ğŸ‡«ğŸ‡· France",CA:"ğŸ‡¨ğŸ‡¦ Canada",AU:"ğŸ‡¦ğŸ‡º Australia",HK:"ğŸ‡­ğŸ‡° Hong Kong",TW:"ğŸ‡¹ğŸ‡¼ Taiwan"},terminal:"Terminal v2.9.3",githubProject:"GitHub Project",autoDetectClient:"Auto Detect",selectionLogicText:"Same Region -> Nearby Region -> Other Regions",customIPDisabledHint:"Region selection disabled when using Custom ProxyIP",customIPMode:"Custom ProxyIP Mode (p variable enabled)",customIPModeDesc:"Custom IP Mode (Region match disabled)",usingCustomProxyIP:"Using Custom ProxyIP: ",customIPConfig:" (p variable config)",customIPModeDisabled:"Custom IP Mode, region selection disabled",manualRegion:"Manual Region",manualRegionDesc:" (Manual)",proxyIPAvailable:"10/10 Available (ProxyIP Domain Pre-set)",smartSelection:"Smart Nearby Selection",sameRegionIP:"Same Region IP Available (1)",cloudflareDetection:"Cloudflare Built-in Detection",detectionFailed:"Detection Failed",apiTestResult:"API Detection Result: ",apiTestTime:"Detection Time: ",apiTestFailed:"API Detection Failed: ",unknownError:"Unknown Error",apiTestError:"API Test Failed: ",kvNotConfigured:"KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy",kvNotEnabled:"KV Storage Not Configured",kvCheckFailed:"KV Check Failed: Invalid Response",kvCheckFailedStatus:"KV Check Failed - Status: ",kvCheckFailedError:"KV Check Failed - Error: "},fa:{title:"Ù…Ø±Ú©Ø² Ø§Ø´ØªØ±Ø§Ú©",subtitle:"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ú†Ù†Ø¯ Ú©Ù„Ø§ÛŒÙ†Øª â€¢ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡ÙˆØ´Ù…Ù†Ø¯ â€¢ ØªÙˆÙ„ÛŒØ¯ ÛŒÚ© Ú©Ù„ÛŒÚ©ÛŒ",selectClient:"[ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù„Ø§ÛŒÙ†Øª ]",systemStatus:"[ ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ… ]",configManagement:"[ Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª ]",relatedLinks:"[ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· ]",checking:"Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...",workerRegion:"Ù…Ù†Ø·Ù‚Ù‡ Worker: ",detectionMethod:"Ø±ÙˆØ´ ØªØ´Ø®ÛŒØµ: ",proxyIPStatus:"ÙˆØ¶Ø¹ÛŒØª ProxyIP: ",currentIP:"IP ÙØ¹Ù„ÛŒ: ",regionMatch:"ØªØ·Ø¨ÛŒÙ‚ Ù…Ù†Ø·Ù‚Ù‡: ",selectionLogic:"Ù…Ù†Ø·Ù‚ Ø§Ù†ØªØ®Ø§Ø¨: ",kvStatusChecking:"Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª KV...",kvEnabled:"âœ… Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV ÙØ¹Ø§Ù„ Ø§Ø³ØªØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯",kvDisabled:"âš ï¸ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª ÛŒØ§ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª",specifyRegion:"ØªØ¹ÛŒÛŒÙ† Ù…Ù†Ø·Ù‚Ù‡ (wk):",autoDetect:"ØªØ´Ø®ÛŒØµ Ø®ÙˆØ¯Ú©Ø§Ø±",saveRegion:"Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ù†Ø·Ù‚Ù‡",protocolSelection:"Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø±ÙˆØªÚ©Ù„:",enableVLESS:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±ÙˆØªÚ©Ù„ VLESS",enableVMess:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±ÙˆØªÚ©Ù„ VMess",enableShadowsocks:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±ÙˆØªÚ©Ù„ Shadowsocks",enableTrojan:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±ÙˆØªÚ©Ù„ Trojan",enableXhttp:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±ÙˆØªÚ©Ù„ xhttp",enableTUIC:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±ÙˆØªÚ©Ù„ TUIC",enableHysteria2:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±ÙˆØªÚ©Ù„ Hysteria 2",enableVLESSgRPC:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±ÙˆØªÚ©Ù„ VLESS gRPC",linkOnlyHint:"Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¨Ú©â€ŒØ§Ù†Ø¯ (Link-Only)",grpcHint:"Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ Ø¯Ø§Ù…Ù†Ù‡ Ø´Ø®ØµÛŒ (gRPC)",enableECH:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ ECH (Encrypted Client Hello)",enableECHHint:"Ù¾Ø³ Ø§Ø² ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒØŒ Ø¯Ø± Ù‡Ø± Ø¨Ø§Ø± ØªØ§Ø²Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø´ØªØ±Ø§Ú©ØŒ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ ECH Ø¨Ù‡â€ŒØ±ÙˆØ² Ø¨Ù‡â€ŒØ·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø² DoH Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡ Ùˆ Ø¨Ù‡ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯",customDNS:"Ø³Ø±ÙˆØ± DNS Ø³ÙØ§Ø±Ø´ÛŒ",customDNSPlaceholder:"Ù…Ø«Ø§Ù„: https://dns.joeyblog.eu.org/joeyblog",customDNSHint:"Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆØ± DNS Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ ECH (ÙØ±Ù…Øª DoH)",customECHDomain:"Ø¯Ø§Ù…Ù†Ù‡ ECH Ø³ÙØ§Ø±Ø´ÛŒ",customECHDomainPlaceholder:"Ù…Ø«Ø§Ù„: cloudflare-ech.com",customECHDomainHint:"Ø¯Ø§Ù…Ù†Ù‡ Ù…ÙˆØ±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ ECHØŒ Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ Ø§Ø² Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯",trojanPassword:"Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Trojan (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):",customPath:"Ù…Ø³ÛŒØ± Ø³ÙØ§Ø±Ø´ÛŒ (d):",customPathPlaceholder:"Ù…Ø«Ø§Ù„: /secret-path",customIP:"ProxyIP Ø³ÙØ§Ø±Ø´ÛŒ (p):",customIPPlaceholder:"Ù…Ø«Ø§Ù„: 1.2.3.4 ÛŒØ§ proxy.example.com",preferredIPs:"Ù„ÛŒØ³Øª IP ØªØ±Ø¬ÛŒØ­ÛŒ (yx):",preferredIPsPlaceholder:"Ù…Ø«Ø§Ù„: 1.1.1.1:443#HongKong, 8.8.8.8:443#USA",preferredIPsURL:"URL Ù…Ù†Ø¨Ø¹ IP ØªØ±Ø¬ÛŒØ­ÛŒ (yxURL):",latencyTest:"ØªØ³Øª ØªØ§Ø®ÛŒØ±",latencyTestIP:"IP/Ø¯Ø§Ù…Ù†Ù‡ ØªØ³Øª:",latencyTestIPPlaceholder:"IP ÛŒØ§ Ø¯Ø§Ù…Ù†Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ØŒ Ú†Ù†Ø¯ Ù…ÙˆØ±Ø¯ Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ø´ÙˆÙ†Ø¯",latencyTestPort:"Ù¾ÙˆØ±Øª:",startTest:"Ø´Ø±ÙˆØ¹ ØªØ³Øª",stopTest:"ØªÙˆÙ‚Ù ØªØ³Øª",testResult:"Ù†ØªÛŒØ¬Ù‡ ØªØ³Øª:",addToYx:"Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª ØªØ±Ø¬ÛŒØ­ÛŒ",addSelectedToYx:"Ø§ÙØ²ÙˆØ¯Ù† Ù…ÙˆØ§Ø±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡",selectAll:"Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡",deselectAll:"Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨",testingInProgress:"Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª...",testComplete:"ØªØ³Øª Ú©Ø§Ù…Ù„ Ø´Ø¯",latencyMs:"ØªØ§Ø®ÛŒØ± (Ù‡Ù†Ø¯Ø´ÛŒÚ©)",timeout:"Ø²Ù…Ø§Ù† ØªÙ…Ø§Ù… Ø´Ø¯",ipSource:"Ù…Ù†Ø¨Ø¹ IP:",manualInput:"ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø³ØªÛŒ",cfRandomIP:"IP ØªØµØ§Ø¯ÙÛŒ CF",urlFetch:"Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² URL",randomCount:"ØªØ¹Ø¯Ø§Ø¯ ØªÙˆÙ„ÛŒØ¯:",fetchURL:"URL Ø¯Ø±ÛŒØ§ÙØª:",fetchURLPlaceholder:"Ø¢Ø¯Ø±Ø³ URL Ù„ÛŒØ³Øª IP Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",generateIP:"ØªÙˆÙ„ÛŒØ¯ IP",fetchIP:"Ø¯Ø±ÛŒØ§ÙØª IP",socks5Config:"ØªÙ†Ø¸ÛŒÙ…Ø§Øª SOCKS5 (s):",customHomepage:"URL ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ (homepage):",customHomepagePlaceholder:"Ù…Ø«Ø§Ù„: https://example.com",customHomepageHint:"ØªÙ†Ø¸ÛŒÙ… URL Ø³ÙØ§Ø±Ø´ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø§Ø³ØªØªØ§Ø± ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ. Ù‡Ù†Ú¯Ø§Ù… Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…Ø³ÛŒØ± Ø§ØµÙ„ÛŒ / Ù…Ø­ØªÙˆØ§ÛŒ Ø§ÛŒÙ† URL Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ ØµÙØ­Ù‡ ØªØ±Ù…ÛŒÙ†Ø§Ù„ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.",customPathHint:"Ù¾Ø³ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…ØŒ ÙÙ‚Ø· Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø§ÛŒÙ† Ù…Ø³ÛŒØ± Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯. Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª Ø¨ÛŒØ´ØªØ± Ø§Ø² Ù…Ø³ÛŒØ± Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",customIPHint:"Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† IP Ø§ØµÙ„ÛŒ Worker ÛŒØ§ Ø­Ù„ Ù…Ø´Ú©Ù„ Cloudflare Loop. ÙØ±Ù…Øª: IP:Port ÛŒØ§ Domain:Port.",preferredIPsHint:"ØªØ¹ÛŒÛŒÙ† Ø¯Ø³ØªÛŒ Ù†ÙˆØ¯Ù‡Ø§ÛŒ ØªØ±Ø¬ÛŒØ­ÛŒ. Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ø§ÙˆÙ„ÙˆÛŒØª. ÙØ±Ù…Øª: IP:Port#ØªÙˆØ¶ÛŒØ­Ø§Øª.",socks5ConfigHint:"ÙØ±Ù…Øª: user:pass@host:port. Worker Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø§ÛŒÙ† Ù¾Ø±ÙˆÚ©Ø³ÛŒ Ø¨Ù‡ Ù‡Ø¯Ù Ù…ØªØµÙ„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.",saveConfig:"Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª",advancedControl:"Ú©Ù†ØªØ±Ù„ Ù¾ÛŒØ´Ø±ÙØªÙ‡",subscriptionConverter:"Ø¢Ø¯Ø±Ø³ ØªØ¨Ø¯ÛŒÙ„ Ø§Ø´ØªØ±Ø§Ú©:",builtinPreferred:"Ù†ÙˆØ¹ ØªØ±Ø¬ÛŒØ­ÛŒ Ø¯Ø§Ø®Ù„ÛŒ:",enablePreferredDomain:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ù…Ù†Ù‡ ØªØ±Ø¬ÛŒØ­ÛŒ",enablePreferredIP:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ IP ØªØ±Ø¬ÛŒØ­ÛŒ",enableGitHubPreferred:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ ØªØ±Ø¬ÛŒØ­ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ GitHub",enableDiverseProxies:"Enable Diverse Proxies (Generate all ports)",enableDiverseProxiesHint:"Generate nodes for all supported ports (80, 443, 2053, etc.) for each IP.",allowAPIManagement:"Ø§Ø¬Ø§Ø²Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª API (ae):",regionMatching:"ØªØ·Ø¨ÛŒÙ‚ Ù…Ù†Ø·Ù‚Ù‡ (rm):",downgradeControl:"Ú©Ù†ØªØ±Ù„ Ú©Ø§Ù‡Ø´ Ø³Ø·Ø­ (qj):",tlsControl:"Ú©Ù†ØªØ±Ù„ TLS (dkby):",preferredControl:"Ú©Ù†ØªØ±Ù„ ØªØ±Ø¬ÛŒØ­ÛŒ (yxby):",saveAdvanced:"Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡",loading:"Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...",currentConfig:"ğŸ“ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù…Ø³ÛŒØ± ÙØ¹Ù„ÛŒ",refreshConfig:"ØªØ§Ø²Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª",resetConfig:"Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª",subscriptionCopied:"Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú© Ú©Ù¾ÛŒ Ø´Ø¯",autoSubscriptionCopied:"Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú© ØªØ´Ø®ÛŒØµ Ø®ÙˆØ¯Ú©Ø§Ø± Ú©Ù¾ÛŒ Ø´Ø¯ØŒ Ú©Ù„Ø§ÛŒÙ†Øª Ù‡Ù†Ú¯Ø§Ù… Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ User-Agent Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ùˆ Ù‚Ø§Ù„Ø¨ Ù…Ø±Ø¨ÙˆØ·Ù‡ Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯",trojanPasswordPlaceholder:"Ø®Ø§Ù„ÛŒ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ ØªØ§ Ø§Ø² UUID Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯",trojanPasswordHint:"Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Trojan Ø³ÙØ§Ø±Ø´ÛŒ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯. Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ Ø§Ø² UUID Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ú©Ù„Ø§ÛŒÙ†Øª Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ Ø¨Ø§ SHA224 Ù‡Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.",protocolHint:"Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú†Ù†Ø¯ÛŒÙ† Ù¾Ø±ÙˆØªÚ©Ù„ Ø±Ø§ Ù‡Ù…Ø²Ù…Ø§Ù† ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯. Ø§Ø´ØªØ±Ø§Ú© Ú¯Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±ÙˆØªÚ©Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø±Ø§ ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.<br>â€¢ VLESS WS: Ù¾Ø±ÙˆØªÚ©Ù„ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± WebSocket<br>â€¢ VMess WS: Ù¾Ø±ÙˆØªÚ©Ù„ VMess Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± WebSocket (ØªÙˆÙ„ÛŒØ¯ Ù„ÛŒÙ†Ú©)<br>â€¢ Shadowsocks: Ù¾Ø±ÙˆØªÚ©Ù„ SS Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± WebSocket (ØªÙˆÙ„ÛŒØ¯ Ù„ÛŒÙ†Ú©)<br>â€¢ Trojan: Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø¨Ø§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± SHA224<br>â€¢ xhttp: Ù¾Ø±ÙˆØªÚ©Ù„ Ø§Ø³ØªØªØ§Ø± Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± HTTP POST (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§ØªØµØ§Ù„ Ø¯Ø§Ù…Ù†Ù‡ Ø³ÙØ§Ø±Ø´ÛŒ Ùˆ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ gRPC Ø¯Ø§Ø±Ø¯)",saveProtocol:"Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø±ÙˆØªÚ©Ù„",subscriptionConverterPlaceholder:"Ù¾ÛŒØ´â€ŒÙØ±Ø¶: https://url.v1.mk/sub",subscriptionConverterHint:"Ø¢Ø¯Ø±Ø³ API ØªØ¨Ø¯ÛŒÙ„ Ø§Ø´ØªØ±Ø§Ú© Ø³ÙØ§Ø±Ø´ÛŒØŒ Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ Ø§Ø² Ø¢Ø¯Ø±Ø³ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯",builtinPreferredHint:"Ú©Ù†ØªØ±Ù„ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø¯Ø§Ù… Ú¯Ø±Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ±Ø¬ÛŒØ­ÛŒ Ø¯Ø§Ø®Ù„ÛŒ Ø¯Ø± Ø§Ø´ØªØ±Ø§Ú© Ú¯Ù†Ø¬Ø§Ù†Ø¯Ù‡ Ø´ÙˆÙ†Ø¯. Ø¨Ù‡ Ø·ÙˆØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù‡Ù…Ù‡ ÙØ¹Ø§Ù„ Ù‡Ø³ØªÙ†Ø¯.",apiEnabledDefault:"Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ø¨Ø³ØªÙ† API)",apiEnabledYes:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª API",apiEnabledHint:"âš ï¸ Ù‡Ø´Ø¯Ø§Ø± Ø§Ù…Ù†ÛŒØªÛŒ: ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§ÛŒÙ† Ú¯Ø²ÛŒÙ†Ù‡ Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ IP Ù‡Ø§ÛŒ ØªØ±Ø¬ÛŒØ­ÛŒ Ø§Ø² Ø·Ø±ÛŒÙ‚ API Ø¨Ù‡ Ø·ÙˆØ± Ù¾ÙˆÛŒØ§ Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆÙ†Ø¯. ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.",regionMatchingDefault:"Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ ØªØ·Ø¨ÛŒÙ‚ Ù…Ù†Ø·Ù‚Ù‡)",regionMatchingNo:"Ø¨Ø³ØªÙ† ØªØ·Ø¨ÛŒÙ‚ Ù…Ù†Ø·Ù‚Ù‡",regionMatchingHint:'ÙˆÙ‚ØªÛŒ "Ø¨Ø³ØªÙ†" ØªÙ†Ø¸ÛŒÙ… Ø´ÙˆØ¯ØŒ ØªØ·Ø¨ÛŒÙ‚ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…Ù†Ø·Ù‚Ù‡ Ø§Ù†Ø¬Ø§Ù… Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯',downgradeControlDefault:"Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ø¹Ø¯Ù… ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù‡Ø´ Ø³Ø·Ø­)",downgradeControlNo:"ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø­Ø§Ù„Øª Ú©Ø§Ù‡Ø´ Ø³Ø·Ø­",downgradeControlHint:'ÙˆÙ‚ØªÛŒ "ÙØ¹Ø§Ù„" ØªÙ†Ø¸ÛŒÙ… Ø´ÙˆØ¯: Ø§ØªØµØ§Ù„ Ù…Ø³ØªÙ‚ÛŒÙ… CF Ù†Ø§Ù…ÙˆÙÙ‚ â†’ Ø§ØªØµØ§Ù„ SOCKS5 â†’ Ø¢Ø¯Ø±Ø³ fallback',tlsControlDefault:"Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ø­ÙØ¸ Ù‡Ù…Ù‡ Ú¯Ø±Ù‡â€ŒÙ‡Ø§)",tlsControlYes:"ÙÙ‚Ø· Ú¯Ø±Ù‡â€ŒÙ‡Ø§ÛŒ TLS",tlsControlHint:'ÙˆÙ‚ØªÛŒ "ÙÙ‚Ø· Ú¯Ø±Ù‡â€ŒÙ‡Ø§ÛŒ TLS" ØªÙ†Ø¸ÛŒÙ… Ø´ÙˆØ¯ØŒ ÙÙ‚Ø· Ú¯Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ TLS ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ØŒ Ú¯Ø±Ù‡â€ŒÙ‡Ø§ÛŒ ØºÛŒØ± TLS (Ù…Ø§Ù†Ù†Ø¯ Ù¾ÙˆØ±Øª 80) ØªÙˆÙ„ÛŒØ¯ Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯',preferredControlDefault:"Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ ØªØ±Ø¬ÛŒØ­)",preferredControlYes:"Ø¨Ø³ØªÙ† ØªØ±Ø¬ÛŒØ­",preferredControlHint:'ÙˆÙ‚ØªÛŒ "Ø¨Ø³ØªÙ† ØªØ±Ø¬ÛŒØ­" ØªÙ†Ø¸ÛŒÙ… Ø´ÙˆØ¯ØŒ ÙÙ‚Ø· Ø§Ø² Ø¢Ø¯Ø±Ø³ Ø§ØµÙ„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ú¯Ø±Ù‡â€ŒÙ‡Ø§ÛŒ IP Ùˆ Ø¯Ø§Ù…Ù†Ù‡ ØªØ±Ø¬ÛŒØ­ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯',regionNames:{US:"ğŸ‡ºğŸ‡¸ Ø¢Ù…Ø±ÛŒÚ©Ø§",SG:"ğŸ‡¸ğŸ‡¬ Ø³Ù†Ú¯Ø§Ù¾ÙˆØ±",JP:"ğŸ‡¯ğŸ‡µ Ú˜Ø§Ù¾Ù†",KR:"ğŸ‡°ğŸ‡· Ú©Ø±Ù‡ Ø¬Ù†ÙˆØ¨ÛŒ",DE:"ğŸ‡©ğŸ‡ª Ø¢Ù„Ù…Ø§Ù†",SE:"ğŸ‡¸ğŸ‡ª Ø³ÙˆØ¦Ø¯",NL:"ğŸ‡³ğŸ‡± Ù‡Ù„Ù†Ø¯",FI:"ğŸ‡«ğŸ‡® ÙÙ†Ù„Ø§Ù†Ø¯",GB:"ğŸ‡¬ğŸ‡§ Ø¨Ø±ÛŒØªØ§Ù†ÛŒØ§",FR:"ğŸ‡«ğŸ‡· ÙØ±Ø§Ù†Ø³Ù‡",CA:"ğŸ‡¨ğŸ‡¦ Ú©Ø§Ù†Ø§Ø¯Ø§",AU:"ğŸ‡¦ğŸ‡º Ø§Ø³ØªØ±Ø§Ù„ÛŒØ§",HK:"ğŸ‡­ğŸ‡° Ù‡Ù†Ú¯ Ú©Ù†Ú¯",TW:"ğŸ‡¹ğŸ‡¼ ØªØ§ÛŒÙˆØ§Ù†"},terminal:"ØªØ±Ù…ÛŒÙ†Ø§Ù„ v2.9.3",githubProject:"Ù¾Ø±ÙˆÚ˜Ù‡ GitHub",autoDetectClient:"ØªØ´Ø®ÛŒØµ Ø®ÙˆØ¯Ú©Ø§Ø±",selectionLogicText:"Ù‡Ù…â€ŒÙ…Ù†Ø·Ù‚Ù‡ â†’ Ù…Ù†Ø·Ù‚Ù‡ Ù…Ø¬Ø§ÙˆØ± â†’ Ø³Ø§ÛŒØ± Ù…Ù†Ø§Ø·Ù‚",customIPDisabledHint:"Ù‡Ù†Ú¯Ø§Ù… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ProxyIP Ø³ÙØ§Ø±Ø´ÛŒØŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù†Ø·Ù‚Ù‡ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª",customIPMode:"Ø­Ø§Ù„Øª ProxyIP Ø³ÙØ§Ø±Ø´ÛŒ (Ù…ØªØºÛŒØ± p ÙØ¹Ø§Ù„ Ø§Ø³Øª)",customIPModeDesc:"Ø­Ø§Ù„Øª IP Ø³ÙØ§Ø±Ø´ÛŒ (ØªØ·Ø¨ÛŒÙ‚ Ù…Ù†Ø·Ù‚Ù‡ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª)",usingCustomProxyIP:"Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ProxyIP Ø³ÙØ§Ø±Ø´ÛŒ: ",customIPConfig:" (Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù…ØªØºÛŒØ± p)",customIPModeDisabled:"Ø­Ø§Ù„Øª IP Ø³ÙØ§Ø±Ø´ÛŒØŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù†Ø·Ù‚Ù‡ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª",manualRegion:"ØªØ¹ÛŒÛŒÙ† Ù…Ù†Ø·Ù‚Ù‡ Ø¯Ø³ØªÛŒ",manualRegionDesc:" (ØªØ¹ÛŒÛŒÙ† Ø¯Ø³ØªÛŒ)",proxyIPAvailable:"10/10 Ø¯Ø± Ø¯Ø³ØªØ±Ø³ (Ø¯Ø§Ù…Ù†Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ ProxyIP Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø§Ø³Øª)",smartSelection:"Ø§Ù†ØªØ®Ø§Ø¨ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù†Ø²Ø¯ÛŒÚ© Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… Ø§Ø³Øª",sameRegionIP:"IP Ù‡Ù…â€ŒÙ…Ù†Ø·Ù‚Ù‡ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø§Ø³Øª (1)",cloudflareDetection:"ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø®Ù„ÛŒ Cloudflare",detectionFailed:"ØªØ´Ø®ÛŒØµ Ù†Ø§Ù…ÙˆÙÙ‚",apiTestResult:"Ù†ØªÛŒØ¬Ù‡ ØªØ´Ø®ÛŒØµ API: ",apiTestTime:"Ø²Ù…Ø§Ù† ØªØ´Ø®ÛŒØµ: ",apiTestFailed:"ØªØ´Ø®ÛŒØµ API Ù†Ø§Ù…ÙˆÙÙ‚: ",unknownError:"Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡",apiTestError:"ØªØ³Øª API Ù†Ø§Ù…ÙˆÙÙ‚: ",kvNotConfigured:"Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³ØªØŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.\\n\\nÙ„Ø·ÙØ§ Ø¯Ø± Cloudflare Workers:\\n1. ÙØ¶Ø§ÛŒ Ù†Ø§Ù… KV Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯\\n2. Ù…ØªØºÛŒØ± Ù…Ø­ÛŒØ·ÛŒ C Ø±Ø§ Ù¾ÛŒÙˆÙ†Ø¯ Ø¯Ù‡ÛŒØ¯\\n3. Ú©Ø¯ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù…Ø³ØªÙ‚Ø± Ú©Ù†ÛŒØ¯",kvNotEnabled:"Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª",kvCheckFailed:"Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV Ù†Ø§Ù…ÙˆÙÙ‚: Ø®Ø·Ø§ÛŒ ÙØ±Ù…Øª Ù¾Ø§Ø³Ø®",kvCheckFailedStatus:"Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV Ù†Ø§Ù…ÙˆÙÙ‚ - Ú©Ø¯ ÙˆØ¶Ø¹ÛŒØª: ",kvCheckFailedError:"Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV Ù†Ø§Ù…ÙˆÙÙ‚ - Ø®Ø·Ø§: "}}[r?"fa":"en"],s=`<!DOCTYPE html>\n        <html lang="${r?"fa-IR":"en-US"}" dir="${r?"rtl":"ltr"}">\n    <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n            <title>${i.title}</title>\n        <style>\n            * { margin: 0; padding: 0; box-sizing: border-box; }\n            body {\n                font-family: "Courier New", monospace;\n                background: #000; color: #00ff00; min-height: 100vh;\n                overflow-x: hidden; position: relative;\n            }\n            .matrix-bg {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                background: #000;\n                z-index: -1;\n            }\n            @keyframes bg-pulse {\n                0%, 100% { background: linear-gradient(45deg, #000 0%, #001100 50%, #000 100%); }\n                50% { background: linear-gradient(45deg, #000 0%, #002200 50%, #000 100%); }\n            }\n            .matrix-rain {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                background: transparent;\n                z-index: -1;\n                display: none;\n            }\n            @keyframes matrix-fall {\n                0% { transform: translateY(-100%); }\n                100% { transform: translateY(100vh); }\n            }\n            .matrix-code-rain {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                pointer-events: none; z-index: -1;\n                overflow: hidden;\n                display: none;\n            }\n            .matrix-column {\n                position: absolute; top: -100%; left: 0;\n                color: #00ff00; font-family: "Courier New", monospace;\n                font-size: 14px; line-height: 1.2;\n                text-shadow: 0 0 5px #00ff00;\n            }\n            @keyframes matrix-drop {\n                0% { top: -100%; opacity: 1; }\n                10% { opacity: 1; }\n                90% { opacity: 0.3; }\n                100% { top: 100vh; opacity: 0; }\n            }\n            .matrix-column:nth-child(odd) {\n                animation-duration: 12s;\n                animation-delay: -2s;\n            }\n            .matrix-column:nth-child(even) {\n                animation-duration: 18s;\n                animation-delay: -5s;\n            }\n            .matrix-column:nth-child(3n) {\n                animation-duration: 20s;\n                animation-delay: -8s;\n            }\n            .container { max-width: 900px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }\n            .header { text-align: center; margin-bottom: 40px; }\n            .title {\n                font-size: 3.5rem; font-weight: bold;\n                text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00, 0 0 40px #00ff00;\n                margin-bottom: 10px;\n                position: relative;\n                color: #00ff00;\n            }\n            @keyframes matrix-glow {\n                from { text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00, 0 0 40px #00ff00; }\n                to { text-shadow: 0 0 20px #00ff00, 0 0 30px #00ff00, 0 0 40px #00ff00, 0 0 50px #00ff00; }\n            }\n            @keyframes matrix-pulse {\n                0%, 100% { background-position: 0% 50%; }\n                50% { background-position: 100% 50%; }\n            }\n            .subtitle { color: #00aa00; margin-bottom: 30px; font-size: 1.2rem; }\n            .card {\n                background: rgba(0, 20, 0, 0.9);\n                border: 2px solid #00ff00;\n                border-radius: 0; padding: 30px; margin-bottom: 20px;\n                box-shadow: 0 0 30px rgba(0, 255, 0, 0.5), inset 0 0 20px rgba(0, 255, 0, 0.1);\n                position: relative;\n                backdrop-filter: blur(10px);\n                box-sizing: border-box;\n                width: 100%;\n                max-width: 100%;\n            }\n            @keyframes card-glow {\n                0%, 100% { box-shadow: 0 0 30px rgba(0, 255, 0, 0.5), inset 0 0 20px rgba(0, 255, 0, 0.1); }\n                50% { box-shadow: 0 0 40px rgba(0, 255, 0, 0.7), inset 0 0 30px rgba(0, 255, 0, 0.2); }\n            }\n            .card::before {\n                content: ""; position: absolute; top: 0; left: 0;\n                width: 100%; height: 100%;\n                background: none;\n                opacity: 0; pointer-events: none;\n            }\n            @keyframes scan-line {\n                0% { transform: translateX(-100%); }\n                100% { transform: translateX(100%); }\n            }\n            .card-title {\n                font-size: 1.8rem; margin-bottom: 20px;\n                color: #00ff00; text-shadow: 0 0 5px #00ff00;\n            }\n            .client-grid {\n                display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n                gap: 15px; margin: 20px 0;\n            }\n            .client-btn {\n                background: rgba(0, 20, 0, 0.8);\n                border: 2px solid #00ff00;\n                padding: 15px 20px; color: #00ff00;\n                font-family: "Courier New", monospace; font-weight: bold;\n                cursor: pointer; transition: all 0.4s ease;\n                text-align: center; position: relative;\n                overflow: hidden;\n                text-shadow: 0 0 5px #00ff00;\n                box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);\n            }\n            .client-btn::before {\n                content: ""; position: absolute; top: 0; left: -100%;\n                width: 100%; height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(0,255,0,0.4), transparent);\n                transition: left 0.6s ease;\n            }\n            .client-btn::after {\n                content: ""; position: absolute; top: 0; left: 0;\n                width: 100%; height: 100%;\n                background: linear-gradient(45deg, transparent 30%, rgba(0,255,0,0.1) 50%, transparent 70%);\n                opacity: 0;\n                transition: opacity 0.3s ease;\n            }\n            .client-btn:hover::before { left: 100%; }\n            .client-btn:hover::after { opacity: 1; }\n            .client-btn:hover {\n                background: rgba(0, 255, 0, 0.3);\n                box-shadow: 0 0 25px #00ff00, 0 0 35px rgba(0, 255, 0, 0.5);\n                transform: translateY(-3px) scale(1.05);\n                text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;\n            }\n            .generate-btn {\n                background: rgba(0, 255, 0, 0.15);\n                border: 2px solid #00ff00; padding: 15px 30px;\n                color: #00ff00; font-family: "Courier New", monospace;\n                font-weight: bold; cursor: pointer;\n                transition: all 0.4s ease; margin-right: 15px;\n                text-shadow: 0 0 8px #00ff00;\n                box-shadow: 0 0 15px rgba(0, 255, 0, 0.4);\n                position: relative;\n                overflow: hidden;\n            }\n            .generate-btn::before {\n                content: ""; position: absolute; top: 0; left: -100%;\n                width: 100%; height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(0,255,0,0.5), transparent);\n                transition: left 0.8s ease;\n            }\n            .generate-btn:hover::before { left: 100%; }\n            .generate-btn:hover {\n                background: rgba(0, 255, 0, 0.4);\n                box-shadow: 0 0 30px #00ff00, 0 0 40px rgba(0, 255, 0, 0.6);\n                transform: translateY(-4px) scale(1.08);\n                text-shadow: 0 0 15px #00ff00, 0 0 25px #00ff00;\n            }\n            .atob('c3Vic2NyaXB0aW9u')-url {\n                background: rgba(0, 0, 0, 0.9);\n                border: 2px solid #00ff00; padding: 15px;\n                word-break: break-all; font-family: "Courier New", monospace;\n                color: #00ff00; margin-top: 20px; display: none;\n                box-shadow: inset 0 0 15px rgba(0, 255, 0, 0.4), 0 0 20px rgba(0, 255, 0, 0.3);\n                border-radius: 5px;\n                position: relative;\n                overflow-wrap: break-word;\n                overflow-x: auto;\n                max-width: 100%;\n                box-sizing: border-box;\n            }\n            @keyframes url-glow {\n                from { box-shadow: inset 0 0 15px rgba(0, 255, 0, 0.4), 0 0 20px rgba(0, 255, 0, 0.3); }\n                to { box-shadow: inset 0 0 20px rgba(0, 255, 0, 0.6), 0 0 30px rgba(0, 255, 0, 0.5); }\n            }\n            .atob('c3Vic2NyaXB0aW9u')-url::before {\n                content: ""; position: absolute; top: 0; left: -100%;\n                width: 100%; height: 100%;\n                background: none;\n            }\n            @keyframes url-scan {\n                0% { left: -100%; }\n                100% { left: 100%; }\n            }\n            .matrix-text {\n                position: fixed; top: 20px; right: 20px;\n                color: #00ff00; font-family: "Courier New", monospace;\n                font-size: 0.8rem; opacity: 0.6;\n            }\n            @keyframes matrix-flicker {\n                0%, 100% { opacity: 0.6; }\n                50% { opacity: 1; }\n            }\n        </style>\n    </head>\n    <body>\n        <div class="matrix-bg"></div>\n        <div class="matrix-rain"></div>\n        <div class="matrix-code-rain" id="matrixCodeRain"></div>\n            <div class="matrix-text">${i.terminal}</div>\n            <div style="position: fixed; top: 20px; left: 20px; z-index: 1000;">\n                <select id="languageSelector" style="background: rgba(0, 20, 0, 0.9); border: 2px solid #00ff00; color: #00ff00; padding: 8px 12px; font-family: 'Courier New', monospace; font-size: 14px; cursor: pointer; text-shadow: 0 0 5px #00ff00; box-shadow: 0 0 15px rgba(0, 255, 0, 0.4);" onchange="changeLanguage(this.value)">\n                    <option value="en" ${r?"":"selected"}>ğŸ‡ºğŸ‡¸ English</option>\n                    <option value="fa" ${r?"selected":""}>ğŸ‡®ğŸ‡· ÙØ§Ø±Ø³ÛŒ</option>\n                </select>\n            </div>\n        <div class="container">\n            <div class="header">\n                    <h1 class="title">${i.title}</h1>\n                    <p class="subtitle">${i.subtitle}</p>\n            </div>\n            <div class="card">\n                    <h2 class="card-title">${i.selectClient}</h2>\n                <div class="client-grid">\n                    <button class="client-btn" onclick="generateClientLink(atob('Y2xhc2g='), 'CLASH')">CLASH</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('Y2xhc2g='), 'STASH')">STASH</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('c3VyZ2U='), 'SURGE')">SURGE</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('c2luZ2JveA=='), 'SING-BOX')">SING-BOX</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('bG9vbg=='), 'LOON')">LOON</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('cXVhbng='), 'QUANTUMULT X')">QUANTUMULT X</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('djJyYXk='), 'V2RAY')">V2RAY</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('djJyYXk='), 'V2RAYNG')">V2RAYNG</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('djJyYXk='), 'NEKORAY')">NEKORAY</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('djJyYXk='), 'Shadowrocket')">Shadowrocket</button>\n                </div>\n                <div class=atob('c3Vic2NyaXB0aW9uLXVybA==') id="clientSubscriptionUrl"></div>\n            </div>\n            <div class="card">\n                    <h2 class="card-title">${i.systemStatus}</h2>\n                <div id="systemStatus" style="margin: 20px 0; padding: 15px; background: rgba(0, 20, 0, 0.8); border: 2px solid #00ff00; box-shadow: 0 0 20px rgba(0, 255, 0, 0.3), inset 0 0 15px rgba(0, 255, 0, 0.1); position: relative; overflow: hidden;">\n                        <div style="color: #00ff00; margin-bottom: 15px; font-weight: bold; text-shadow: 0 0 5px #00ff00;">[ ${i.checking} ]</div>\n                        <div id="regionStatus" style="margin: 8px 0; color: #00ff00; font-family: 'Courier New', monospace; text-shadow: 0 0 3px #00ff00;">${i.workerRegion}${i.checking}</div>\n                        <div id="geoInfo" style="margin: 8px 0; color: #00aa00; font-family: 'Courier New', monospace; font-size: 0.9rem; text-shadow: 0 0 3px #00aa00;">${i.detectionMethod}${i.checking}</div>\n                        <div id="backupStatus" style="margin: 8px 0; color: #00ff00; font-family: 'Courier New', monospace; text-shadow: 0 0 3px #00ff00;">${i.proxyIPStatus}${i.checking}</div>\n                        <div id="currentIP" style="margin: 8px 0; color: #00ff00; font-family: 'Courier New', monospace; text-shadow: 0 0 3px #00ff00;">${i.currentIP}${i.checking}</div>\n                        <div id="echStatus" style="margin: 8px 0; color: #00ff00; font-family: 'Courier New', monospace; text-shadow: 0 0 3px #00ff00; font-size: 0.9rem;">ECHçŠ¶æ€: ${i.checking}</div>\n                        <div id="regionMatch" style="margin: 8px 0; color: #00ff00; font-family: 'Courier New', monospace; text-shadow: 0 0 3px #00ff00;">${i.regionMatch}${i.checking}</div>\n                        <div id="selectionLogic" style="margin: 8px 0; color: #00aa00; font-family: 'Courier New', monospace; font-size: 0.9rem; text-shadow: 0 0 3px #00aa00;">${i.selectionLogic}${i.selectionLogicText}</div>\n                </div>\n            </div>\n            <div class="card" id="configCard" style="display: none;">\n                    <h2 class="card-title">${i.configManagement}</h2>\n                <div id="kvStatus" style="margin-bottom: 20px; padding: 10px; background: rgba(0, 20, 0, 0.8); border: 1px solid #00ff00; color: #00ff00;">\n                        ${i.kvStatusChecking}\n                </div>\n                <div id="configContent" style="display: none;">\n                    <form id="regionForm" style="margin-bottom: 20px;">\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.specifyRegion}</label>\n                            <select id="wkRegion" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                    <option value="">${i.autoDetect}</option>\n                                    <option value="US">${i.regionNames.US}</option>\n                                    <option value="SG">${i.regionNames.SG}</option>\n                                    <option value="JP">${i.regionNames.JP}</option>\n                                    <option value="KR">${i.regionNames.KR}</option>\n                                    <option value="DE">${i.regionNames.DE}</option>\n                                    <option value="SE">${i.regionNames.SE}</option>\n                                    <option value="NL">${i.regionNames.NL}</option>\n                                    <option value="FI">${i.regionNames.FI}</option>\n                                    <option value="GB">${i.regionNames.GB}</option>\n                            </select>\n                                <small id="wkRegionHint" style="color: #00aa00; font-size: 0.85rem; display: none;">âš ï¸ ${i.customIPDisabledHint}</small>\n                        </div>\n                            <button type="submit" style="background: rgba(0, 255, 0, 0.15); border: 2px solid #00ff00; padding: 12px 24px; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; margin-right: 10px; text-shadow: 0 0 8px #00ff00; transition: all 0.4s ease;">${i.saveRegion}</button>\n                    </form>\n                    <form id="otherConfigForm" style="margin-bottom: 20px;">\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.protocolSelection}</label>\n                            <div style="padding: 15px; background: rgba(0, 20, 0, 0.6); border: 1px solid #00ff00; border-radius: 5px;">\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="ev" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1.1rem;">${i.enableVLESS}</span>\n                                    </label>\n                                </div>\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="et" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1.1rem;">${i.enableTrojan}</span>\n                                    </label>\n                                </div>\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="ex" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n\n                            <div class="checkbox-item" style="margin-top: 10px;">\n                                <label style="display: flex; align-items: center;"><input type="checkbox" id="evm" ${b?"checked":""} style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;"> ${i.enableVMess}</label>\n                                <small style="color: #ffaa00; font-size: 0.8rem; display: block; margin-top: 2px; margin-left: 26px;">${i.linkOnlyHint}</small>\n                            </div>\n                            <div class="checkbox-item" style="margin-top: 10px;">\n                                <label style="display: flex; align-items: center;"><input type="checkbox" id="ess" ${y?"checked":""} style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;"> ${i.enableShadowsocks}</label>\n                                <small style="color: #ffaa00; font-size: 0.8rem; display: block; margin-top: 2px; margin-left: 26px;">${i.linkOnlyHint}</small>\n                            </div>\n                            <div class="checkbox-item" style="margin-top: 10px;">\n                                <label style="display: flex; align-items: center;"><input type="checkbox" id="etu" ${C?"checked":""} style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;"> ${i.enableTUIC}</label>\n                                <small style="color: #ffaa00; font-size: 0.8rem; display: block; margin-top: 2px; margin-left: 26px;">${i.linkOnlyHint}</small>\n                            </div>\n                            <div class="checkbox-item" style="margin-top: 10px;">\n                                <label style="display: flex; align-items: center;"><input type="checkbox" id="ehy" ${P?"checked":""} style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;"> ${i.enableHysteria2}</label>\n                                <small style="color: #ffaa00; font-size: 0.8rem; display: block; margin-top: 2px; margin-left: 26px;">${i.linkOnlyHint}</small>\n                            </div>\n                            <div class="checkbox-item" style="margin-top: 10px;">\n                                <label style="display: flex; align-items: center;"><input type="checkbox" id="eg" ${S?"checked":""} style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;"> ${i.enableVLESSgRPC}</label>\n                                <small style="color: #ffaa00; font-size: 0.8rem; display: block; margin-top: 2px; margin-left: 26px;">${i.grpcHint}</small>\n                            </div>\n\n                                            <span style="font-size: 1.1rem;">${i.enableXhttp}</span>\n                                    </label>\n                                </div>\n                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0, 255, 0, 0.3);">\n                                    <div style="margin-bottom: 10px;">\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                            <input type="checkbox" id="ech" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                                <span style="font-size: 1.1rem;">${i.enableECH}</span>\n                                        </label>\n                                        <small style="color: #00aa00; font-size: 0.8rem; display: block; margin-top: 5px; margin-left: 26px;">${i.enableECHHint}</small>\n                                    </div>\n                                    <div style="margin-top: 15px; margin-bottom: 10px;">\n                                        <label style="display: block; margin-bottom: 8px; color: #00ff00; font-size: 0.95rem;">${i.customDNS}</label>\n                                        <input type="text" id="customDNS" placeholder="${i.customDNSPlaceholder}" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                        <small style="color: #00aa00; font-size: 0.8rem; display: block; margin-top: 5px;">${i.customDNSHint}</small>\n                                    </div>\n                                    <div style="margin-bottom: 10px;">\n                                        <label style="display: block; margin-bottom: 8px; color: #00ff00; font-size: 0.95rem;">${i.customECHDomain}</label>\n                                        <input type="text" id="customECHDomain" placeholder="${i.customECHDomainPlaceholder}" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                        <small style="color: #00aa00; font-size: 0.8rem; display: block; margin-top: 5px;">${i.customECHDomainHint}</small>\n                                    </div>\n                                </div>\n                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0, 255, 0, 0.3);">\n                                        <label style="display: block; margin-bottom: 8px; color: #00ff00; font-size: 0.95rem;">${i.trojanPassword}</label>\n                                        <input type="text" id="tp" placeholder="${i.trojanPasswordPlaceholder}" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                        <small style="color: #00aa00; font-size: 0.8rem; display: block; margin-top: 5px;">${i.trojanPasswordHint}</small>\n                                </div>\n                                    <small style="color: #00aa00; font-size: 0.85rem; display: block; margin-top: 10px;">${i.protocolHint}</small>\n                                    <button type="button" id="saveProtocolBtn" style="margin-top: 15px; background: rgba(0, 255, 0, 0.15); border: 2px solid #00ff00; padding: 10px 20px; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; text-shadow: 0 0 8px #00ff00; transition: all 0.4s ease; width: 100%;">${i.saveProtocol}</button>\n                            </div>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.customHomepage}</label>\n                                <input type="text" id="customHomepage" placeholder="${i.customHomepagePlaceholder}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${i.customHomepageHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.customPath}</label>\n                                <input type="text" id="customPath" placeholder="${i.customPathPlaceholder}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${i.customPathHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.customIP}</label>\n                                <input type="text" id="customIP" placeholder="${i.customIPPlaceholder}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${i.customIPHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.preferredIPs}</label>\n                                <input type="text" id="yx" placeholder="${i.preferredIPsPlaceholder}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${i.preferredIPsHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.preferredIPsURL}</label>\n                                <input type="text" id="yxURL" placeholder="${r?"Ù¾ÛŒØ´â€ŒÙØ±Ø¶: https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt":"é»˜è®¤: https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt"}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${r?"URL Ù…Ù†Ø¨Ø¹ Ù„ÛŒØ³Øª IP ØªØ±Ø¬ÛŒØ­ÛŒ Ø³ÙØ§Ø±Ø´ÛŒØŒ Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ Ø§Ø² Ø¢Ø¯Ø±Ø³ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯":"è‡ªå®šä¹‰ä¼˜é€‰IPåˆ—è¡¨æ¥æºURLï¼Œç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤åœ°å€"}</small>\n                        </div>\n\n                        <div style="margin-bottom: 20px; padding: 15px; background: rgba(0, 40, 0, 0.6); border: 2px solid #00aa00; border-radius: 8px;">\n                            <h4 style="color: #00ff00; margin: 0 0 15px 0; font-size: 1.1rem; text-shadow: 0 0 5px #00ff00;">âš¡ ${i.latencyTest}</h4>\n                            <div style="display: flex; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; align-items: center;">\n                                <div style="min-width: 120px;">\n                                    <label style="display: block; margin-bottom: 5px; color: #00ff00; font-size: 0.9rem;">${i.ipSource}</label>\n                                    <select id="ipSourceSelect" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px; cursor: pointer;">\n                                        <option value="manual">${i.manualInput}</option>\n                                        <option value="cfRandom">${i.cfRandomIP}</option>\n                                        <option value="urlFetch">${i.urlFetch}</option>\n                                    </select>\n                                </div>\n                                <div style="width: 100px;">\n                                    <label style="display: block; margin-bottom: 5px; color: #00ff00; font-size: 0.9rem;">${i.latencyTestPort}</label>\n                                    <input type="number" id="latencyTestPort" value="443" min="1" max="65535" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                </div>\n                                <div id="randomCountDiv" style="width: 100px; display: none;">\n                                    <label style="display: block; margin-bottom: 5px; color: #00ff00; font-size: 0.9rem;">${i.randomCount}</label>\n                                    <input type="number" id="randomIPCount" value="20" min="1" max="100" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                </div>\n                                <div style="width: 80px;">\n                                    <label style="display: block; margin-bottom: 5px; color: #00ff00; font-size: 0.9rem;">${r?"Ø±Ø´ØªÙ‡â€ŒÙ‡Ø§":"çº¿ç¨‹"}</label>\n                                    <input type="number" id="testThreads" value="5" min="1" max="50" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                </div>\n                            </div>\n                            <div id="manualInputDiv" style="margin-bottom: 10px;">\n                                <label style="display: block; margin-bottom: 5px; color: #00ff00; font-size: 0.9rem;">${i.latencyTestIP}</label>\n                                <input type="text" id="latencyTestInput" placeholder="${i.latencyTestIPPlaceholder}" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                            </div>\n                            <div id="urlFetchDiv" style="margin-bottom: 10px; display: none;">\n                                <label style="display: block; margin-bottom: 5px; color: #00ff00; font-size: 0.9rem;">${i.fetchURL}</label>\n                                <div style="display: flex; gap: 8px;">\n                                    <input type="text" id="fetchURLInput" placeholder="${i.fetchURLPlaceholder}" style="flex: 1; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                    <button type="button" id="fetchIPBtn" style="background: rgba(0, 200, 255, 0.2); border: 1px solid #00aaff; padding: 8px 16px; color: #00aaff; font-family: 'Courier New', monospace; cursor: pointer; white-space: nowrap;">â¬‡ ${i.fetchIP}</button>\n                                </div>\n                            </div>\n                            <div id="cfRandomDiv" style="margin-bottom: 10px; display: none;">\n                                <button type="button" id="generateCFIPBtn" style="background: rgba(0, 255, 0, 0.15); border: 1px solid #00ff00; padding: 10px 20px; color: #00ff00; font-family: 'Courier New', monospace; cursor: pointer; width: 100%; transition: all 0.3s;">ğŸ² ${i.generateIP}</button>\n                            </div>\n                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">\n                                <button type="button" id="startLatencyTest" style="background: rgba(0, 255, 0, 0.2); border: 1px solid #00ff00; padding: 8px 16px; color: #00ff00; font-family: 'Courier New', monospace; cursor: pointer; transition: all 0.3s;">â–¶ ${i.startTest}</button>\n                                <button type="button" id="stopLatencyTest" style="background: rgba(255, 0, 0, 0.2); border: 1px solid #ff4444; padding: 8px 16px; color: #ff4444; font-family: 'Courier New', monospace; cursor: pointer; display: none; transition: all 0.3s;">â¹ ${i.stopTest}</button>\n                            </div>\n                            <div id="latencyTestStatus" style="color: #00aa00; font-size: 0.9rem; margin-bottom: 10px; display: none;"></div>\n                            <div id="latencyTestResults" style="max-height: 250px; overflow-y: auto; display: none;">\n                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">\n                                    <span style="color: #00ff00; font-weight: bold;">${i.testResult}</span>\n                                    <div style="display: flex; gap: 8px;">\n                                        <button type="button" id="selectAllResults" style="background: transparent; border: 1px solid #00aa00; padding: 4px 10px; color: #00aa00; font-size: 0.8rem; cursor: pointer;">${i.selectAll}</button>\n                                        <button type="button" id="deselectAllResults" style="background: transparent; border: 1px solid #00aa00; padding: 4px 10px; color: #00aa00; font-size: 0.8rem; cursor: pointer;">${i.deselectAll}</button>\n                                    </div>\n                                </div>\n                                <div id="cityFilterContainer" style="margin-bottom: 10px; padding: 10px; background: rgba(0, 20, 0, 0.6); border: 1px solid #00aa00; border-radius: 4px; display: none;">\n                                    <div style="margin-bottom: 8px;">\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00; font-size: 0.9rem;">\n                                            <input type="radio" name="cityFilterMode" value="all" checked style="margin-right: 6px; width: 16px; height: 16px; cursor: pointer;">\n                                            <span>å…¨éƒ¨åŸå¸‚</span>\n                                        </label>\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00; font-size: 0.9rem; margin-left: 15px;">\n                                            <input type="radio" name="cityFilterMode" value="fastest10" style="margin-right: 6px; width: 16px; height: 16px; cursor: pointer;">\n                                            <span>åªé€‰æ‹©æœ€å¿«çš„10ä¸ª</span>\n                                        </label>\n                                    </div>\n                                    <div id="cityCheckboxesContainer" style="display: flex; flex-wrap: wrap; gap: 8px; max-height: 80px; overflow-y: auto; padding: 5px;"></div>\n                                </div>\n                                <div id="latencyResultsList" style="background: rgba(0, 0, 0, 0.5); border: 1px solid #004400; border-radius: 4px; padding: 10px;"></div>\n                                <div style="margin-top: 10px; display: flex; gap: 10px;">\n                                    <button type="button" id="overwriteSelectedToYx" style="flex: 1; background: rgba(0, 200, 0, 0.3); border: 1px solid #00ff00; padding: 10px 20px; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; transition: all 0.3s;">è¦†ç›–æ·»åŠ </button>\n                                    <button type="button" id="appendSelectedToYx" style="flex: 1; background: rgba(0, 150, 0, 0.3); border: 1px solid #00aa00; padding: 10px 20px; color: #00aa00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; transition: all 0.3s;">è¿½åŠ æ·»åŠ </button>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.socks5Config}</label>\n                                <input type="text" id="socksConfig" placeholder="${r?"Ù…Ø«Ø§Ù„: user:pass@host:port ÛŒØ§ host:port":"ä¾‹å¦‚: user:pass@host:port æˆ– host:port"}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${i.socks5ConfigHint}</small>\n                        </div>\n                            <button type="submit" style="background: rgba(0, 255, 0, 0.15); border: 2px solid #00ff00; padding: 12px 24px; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; margin-right: 10px; text-shadow: 0 0 8px #00ff00; transition: all 0.4s ease;">${i.saveConfig}</button>\n                    </form>\n\n                        <h3 style="color: #00ff00; margin: 20px 0 15px 0; font-size: 1.2rem;">${i.advancedControl}</h3>\n                    <form id="advancedConfigForm" style="margin-bottom: 20px;">\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.subscriptionConverter}</label>\n                                <input type="text" id="scu" placeholder="${i.subscriptionConverterPlaceholder}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${i.subscriptionConverterHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.builtinPreferred}</label>\n                            <div style="padding: 15px; background: rgba(0, 20, 0, 0.6); border: 1px solid #00ff00; border-radius: 5px;">\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="epd" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1.1rem;">${i.enablePreferredDomain}</span>\n                                    </label>\n                                </div>\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="epi" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1.1rem;">${i.enablePreferredIP}</span>\n                                    </label>\n                                </div>\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="egi" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1.1rem;">${i.enableGitHubPreferred}</span>\n                                    </label>\n                                </div>\n\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="enableDiverseProxies" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1.1rem;">${i.enableDiverseProxies}</span>\n                                    </label>\n                                    <small style="color: #00aa00; font-size: 0.85rem; display: block; margin-top: 5px;">${i.enableDiverseProxiesHint}</small>\n                                </div>\n\n                                    <small style="color: #00aa00; font-size: 0.85rem; display: block; margin-top: 10px;">${i.builtinPreferredHint}</small>\n                            </div>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">ä¼˜é€‰IPç­›é€‰è®¾ç½®</label>\n                            <div style="padding: 15px; background: rgba(0, 20, 0, 0.6); border: 1px solid #00ff00; border-radius: 5px;">\n                                <div style="margin-bottom: 15px;">\n                                    <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">IPç‰ˆæœ¬é€‰æ‹©</label>\n                                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                            <input type="checkbox" id="ipv4Enabled" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1rem;">IPv4</span>\n                                        </label>\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                            <input type="checkbox" id="ipv6Enabled" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1rem;">IPv6</span>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">è¿è¥å•†é€‰æ‹©</label>\n                                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                            <input type="checkbox" id="ispMobile" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1rem;">ç§»åŠ¨</span>\n                                        </label>\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                            <input type="checkbox" id="ispUnicom" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1rem;">è”é€š</span>\n                                        </label>\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                            <input type="checkbox" id="ispTelecom" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1rem;">ç”µä¿¡</span>\n                                        </label>\n                                    </div>\n                                </div>\n                                    <small style="color: #00aa00; font-size: 0.85rem; display: block; margin-top: 10px;">é€‰æ‹©è¦ä½¿ç”¨çš„IPç‰ˆæœ¬å’Œè¿è¥å•†ï¼Œæœªé€‰ä¸­çš„å°†è¢«è¿‡æ»¤</small>\n                            </div>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.allowAPIManagement}</label>\n                            <select id="apiEnabled" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                    <option value="">${i.apiEnabledDefault}</option>\n                                    <option value="yes">${i.apiEnabledYes}</option>\n                            </select>\n                                <small style="color: #ffaa00; font-size: 0.85rem;">${i.apiEnabledHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.regionMatching}</label>\n                            <select id="regionMatching" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                    <option value="">${i.regionMatchingDefault}</option>\n                                    <option value="no">${i.regionMatchingNo}</option>\n                            </select>\n                                <small style="color: #00aa00; font-size: 0.85rem;">${i.regionMatchingHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.downgradeControl}</label>\n                            <select id="downgradeControl" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                    <option value="">${i.downgradeControlDefault}</option>\n                                    <option value="no">${i.downgradeControlNo}</option>\n                            </select>\n                                <small style="color: #00aa00; font-size: 0.85rem;">${i.downgradeControlHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.tlsControl}</label>\n                            <select id="portControl" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                    <option value="">${i.tlsControlDefault}</option>\n                                    <option value="yes">${i.tlsControlYes}</option>\n                            </select>\n                                <small style="color: #00aa00; font-size: 0.85rem;">${i.tlsControlHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${i.preferredControl}</label>\n                            <select id="preferredControl" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                    <option value="">${i.preferredControlDefault}</option>\n                                    <option value="yes">${i.preferredControlYes}</option>\n                            </select>\n                                <small style="color: #00aa00; font-size: 0.85rem;">${i.preferredControlHint}</small>\n                        </div>\n                            <button type="submit" style="background: rgba(0, 255, 0, 0.15); border: 2px solid #00ff00; padding: 12px 24px; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; margin-right: 10px; text-shadow: 0 0 8px #00ff00; transition: all 0.4s ease;">${i.saveAdvanced}</button>\n                    </form>\n                    <div id="currentConfig" style="background: rgba(0, 0, 0, 0.9); border: 1px solid #00ff00; padding: 15px; margin: 10px 0; font-family: 'Courier New', monospace; color: #00ff00;">\n                            ${i.loading}\n                    </div>\n                    <div id="pathTypeInfo" style="background: rgba(0, 20, 0, 0.7); border: 1px solid #00ff00; padding: 15px; margin: 10px 0; font-family: 'Courier New', monospace; color: #00ff00;">\n                            <div style="font-weight: bold; margin-bottom: 8px; color: #44ff44; text-shadow: 0 0 5px #44ff44;">${i.currentConfig}</div>\n                            <div id="pathTypeStatus">${i.checking}</div>\n                    </div>\n                        <button onclick="loadCurrentConfig()" style="background: rgba(0, 255, 0, 0.15); border: 2px solid #00ff00; padding: 12px 24px; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; margin-right: 10px; text-shadow: 0 0 8px #00ff00; transition: all 0.4s ease;">${i.refreshConfig}</button>\n                        <button onclick="resetAllConfig()" style="background: rgba(255, 0, 0, 0.15); border: 2px solid #ff0000; padding: 12px 24px; color: #ff0000; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; text-shadow: 0 0 8px #ff0000; transition: all 0.4s ease;">${i.resetConfig}</button>\n                </div>\n                <div id="statusMessage" style="display: none; padding: 10px; margin: 10px 0; border: 1px solid #00ff00; background: rgba(0, 20, 0, 0.8); color: #00ff00; text-shadow: 0 0 5px #00ff00;"></div>\n            </div>\n\n            <div class="card">\n                    <h2 class="card-title">${i.relatedLinks}</h2>\n                <div style="text-align: center; margin: 20px 0;">\n                        <a href="https://github.com/byJoey/cfnew" target="_blank" style="color: #00ff00; text-decoration: none; margin: 0 20px; font-size: 1.2rem; text-shadow: 0 0 5px #00ff00;">${i.githubProject}</a>\n                    <a href="https://www.youtube.com/@joeyblog" target="_blank" style="color: #00ff00; text-decoration: none; margin: 0 20px; font-size: 1.2rem; text-shadow: 0 0 5px #00ff00;">YouTube @joeyblog</a>\n                </div>\n            </div>\n        </div>\n        <script>\n            // è®¢é˜…è½¬æ¢åœ°å€ï¼ˆä»æœåŠ¡å™¨é…ç½®æ³¨å…¥ï¼‰\n            var SUB_CONVERTER_URL = "${k}";\n            // Remote config URL (Hardcoded)\n            var REMOTE_CONFIG_URL = "https://raw.githubusercontent.com/byJoey/test/refs/heads/main/tist.ini";\n\n                // ç¿»è¯‘å¯¹è±¡\n                const translations = {\n                    en: {\n                    title: 'Terminal',\n                    terminal: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n                    \n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support â€¢ Smart Optimization â€¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: 'âœ… KV Storage Enabled, Config Management Available',\n                    kvDisabled: 'âš ï¸ KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'ğŸ“ Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>â€¢ VLESS WS: Standard WebSocket protocol<br>â€¢ VMess WS: WebSocket-based VMess (link generation)<br>â€¢ Shadowsocks: WebSocket-based SS (link generation)<br>â€¢ Trojan: Uses SHA224 password auth<br>â€¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: 'âš ï¸ Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'ğŸ‡ºğŸ‡¸ US', SG: 'ğŸ‡¸ğŸ‡¬ Singapore', JP: 'ğŸ‡¯ğŸ‡µ Japan',\n                        KR: 'ğŸ‡°ğŸ‡· South Korea', DE: 'ğŸ‡©ğŸ‡ª Germany', SE: 'ğŸ‡¸ğŸ‡ª Sweden', NL: 'ğŸ‡³ğŸ‡± Netherlands',\n                        FI: 'ğŸ‡«ğŸ‡® Finland', GB: 'ğŸ‡¬ğŸ‡§ UK', FR: 'ğŸ‡«ğŸ‡· France', CA: 'ğŸ‡¨ğŸ‡¦ Canada',\n                        AU: 'ğŸ‡¦ğŸ‡º Australia', HK: 'ğŸ‡­ğŸ‡° Hong Kong', TW: 'ğŸ‡¹ğŸ‡¼ Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                    fa: {\n                        subscriptionCopied: 'Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú© Ú©Ù¾ÛŒ Ø´Ø¯',\n                        autoSubscriptionCopied: 'Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú© ØªØ´Ø®ÛŒØµ Ø®ÙˆØ¯Ú©Ø§Ø± Ú©Ù¾ÛŒ Ø´Ø¯ØŒ Ú©Ù„Ø§ÛŒÙ†Øª Ù‡Ù†Ú¯Ø§Ù… Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ User-Agent Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ùˆ Ù‚Ø§Ù„Ø¨ Ù…Ø±Ø¨ÙˆØ·Ù‡ Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯'\n                    }\n                };\n\n                function getCookie(name) {\n                    const value = '; ' + document.cookie;\n                    const parts = value.split('; ' + name + '=');\n                    if (parts.length === 2) return parts.pop().split(';').shift();\n                    return null;\n                }\n\n                const browserLang = navigator.language || navigator.userLanguage || '';\n                const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                let isFarsi = false;\n\n                if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                    isFarsi = true;\n                } else if (savedLang === 'zh' || savedLang === 'en-US') {\n                    isFarsi = false;\n                } else {\n                    isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                }\n\n                const t = translations[isFarsi ? 'fa' : 'en'];\n\n                function changeLanguage(lang) {\n                    localStorage.setItem('preferredLanguage', lang);\n                    // Set Cookie (valid for 1 year)\n                    const expiryDate = new Date();\n                    expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n                    document.cookie = 'preferredLanguage=' + lang + '; path=/; expires=' + expiryDate.toUTCString() + '; SameSite=Lax';\n                    // Reload page, do not use URL parameters\n                    window.location.reload();\n                }\n\n                // Check localStorage and Cookie on page load, and clean up URL parameters\n                window.addEventListener('DOMContentLoaded', function() {\n                    const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                    const urlParams = new URLSearchParams(window.location.search);\n                    const urlLang = urlParams.get('lang');\n\n                    // If URL has language parameter, remove it and set Cookie\n                    if (urlLang) {\n                        const currentUrl = new URL(window.location.href);\n                        currentUrl.searchParams.delete('lang');\n                        const newUrl = currentUrl.toString();\n\n                        // è®¾ç½®Cookie\n                        const expiryDate = new Date();\n                        expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n                        document.cookie = 'preferredLanguage=' + urlLang + '; path=/; expires=' + expiryDate.toUTCString() + '; SameSite=Lax';\n                        localStorage.setItem('preferredLanguage', urlLang);\n\n                        // Use history API to remove URL parameter, do not reload page\n                        window.history.replaceState({}, '', newUrl);\n                    } else if (savedLang) {\n                        // If present in localStorage but not in Cookie, sync to Cookie\n                        const expiryDate = new Date();\n                        expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n                        document.cookie = 'preferredLanguage=' + savedLang + '; path=/; expires=' + expiryDate.toUTCString() + '; SameSite=Lax';\n                    }\n                });\n\n            function tryOpenApp(schemeUrl, fallbackCallback, timeout) {\n                timeout = timeout || 2500;\n                var appOpened = false;\n                var callbackExecuted = false;\n                var startTime = Date.now();\n\n                var blurHandler = function() {\n                    var elapsed = Date.now() - startTime;\n                    if (elapsed < 3000 && !callbackExecuted) {\n                        appOpened = true;\n                    }\n                };\n\n                window.addEventListener('blur', blurHandler);\n\n                var hiddenHandler = function() {\n                    var elapsed = Date.now() - startTime;\n                    if (elapsed < 3000 && !callbackExecuted) {\n                        appOpened = true;\n                    }\n                };\n\n                document.addEventListener('visibilitychange', hiddenHandler);\n\n                var iframe = document.createElement('iframe');\n                iframe.style.display = 'none';\n                iframe.style.width = '1px';\n                iframe.style.height = '1px';\n                iframe.src = schemeUrl;\n                document.body.appendChild(iframe);\n\n                setTimeout(function() {\n                    iframe.parentNode && iframe.parentNode.removeChild(iframe);\n                    window.removeEventListener('blur', blurHandler);\n                    document.removeEventListener('visibilitychange', hiddenHandler);\n\n                    if (!callbackExecuted) {\n                        callbackExecuted = true;\n                        if (!appOpened && fallbackCallback) {\n                            fallbackCallback();\n                        }\n                    }\n                }, timeout);\n            }\n\n            function generateClientLink(clientType, clientName) {\n                var currentUrl = window.location.href;\n                var subscriptionUrl = currentUrl + "/sub";\n                var schemeUrl = '';\n                var displayName = clientName || '';\n                var finalUrl = subscriptionUrl;\n\n                if (clientType === atob('djJyYXk=')) {\n                    finalUrl = subscriptionUrl;\n                    var urlElement = document.getElementById("clientSubscriptionUrl");\n                    urlElement.textContent = finalUrl;\n                    urlElement.style.display = "block";\n                    urlElement.style.overflowWrap = "break-word";\n                    urlElement.style.wordBreak = "break-all";\n                    urlElement.style.overflowX = "auto";\n                    urlElement.style.maxWidth = "100%";\n                    urlElement.style.boxSizing = "border-box";\n\n                    if (clientName === 'V2RAY') {\n                        navigator.clipboard.writeText(finalUrl).then(function() {\n                                alert(displayName + " " + t.subscriptionCopied);\n                        });\n                    } else if (clientName === 'Shadowrocket') {\n                        schemeUrl = 'shadowrocket://add/' + encodeURIComponent(finalUrl);\n                        tryOpenApp(schemeUrl, function() {\n                            navigator.clipboard.writeText(finalUrl).then(function() {\n                                    alert(displayName + " " + t.subscriptionCopied);\n                            });\n                        });\n                    } else if (clientName === 'V2RAYNG') {\n                        schemeUrl = 'v2rayng://install?url=' + encodeURIComponent(finalUrl);\n                        tryOpenApp(schemeUrl, function() {\n                            navigator.clipboard.writeText(finalUrl).then(function() {\n                                    alert(displayName + " " + t.subscriptionCopied);\n                            });\n                        });\n                    } else if (clientName === 'NEKORAY') {\n                        schemeUrl = 'nekoray://install-config?url=' + encodeURIComponent(finalUrl);\n                        tryOpenApp(schemeUrl, function() {\n                            navigator.clipboard.writeText(finalUrl).then(function() {\n                                    alert(displayName + " " + t.subscriptionCopied);\n                            });\n                        });\n                    }\n                } else {\n                    // æ£€æŸ¥ ECH æ˜¯å¦å¼€å¯\n                    var echEnabled = document.getElementById('ech') && document.getElementById('ech').checked;\n\n                    // å¦‚æœ ECH å¼€å¯ä¸”æ˜¯ Clashï¼Œç›´æ¥ä½¿ç”¨åç«¯æ¥å£\n                    if (echEnabled && clientType === atob('Y2xhc2g=')) {\n                        finalUrl = subscriptionUrl + "?target=" + clientType;\n                        var urlElement = document.getElementById("clientSubscriptionUrl");\n                        urlElement.textContent = finalUrl;\n                        urlElement.style.display = "block";\n                        urlElement.style.overflowWrap = "break-word";\n                        urlElement.style.wordBreak = "break-all";\n                        urlElement.style.overflowX = "auto";\n                        urlElement.style.maxWidth = "100%";\n                        urlElement.style.boxSizing = "border-box";\n\n                        if (clientName === 'STASH') {\n                            schemeUrl = 'stash://install?url=' + encodeURIComponent(finalUrl);\n                            displayName = 'STASH';\n                        } else {\n                            schemeUrl = 'clash://install-config?url=' + encodeURIComponent(finalUrl);\n                            displayName = 'CLASH';\n                        }\n\n                        if (schemeUrl) {\n                            tryOpenApp(schemeUrl, function() {\n                                navigator.clipboard.writeText(finalUrl).then(function() {\n                                        alert(displayName + " " + t.subscriptionCopied);\n                                });\n                            });\n                        } else {\n                            navigator.clipboard.writeText(finalUrl).then(function() {\n                                    alert(displayName + " " + t.subscriptionCopied);\n                            });\n                        }\n                    } else {\n                        // å…¶ä»–æƒ…å†µä½¿ç”¨è®¢é˜…è½¬æ¢æœåŠ¡\n                        var encodedUrl = encodeURIComponent(subscriptionUrl);\n                        finalUrl = SUB_CONVERTER_URL + "?target=" + clientType + "&url=" + encodedUrl + "&insert=false&config=" + encodeURIComponent(REMOTE_CONFIG_URL) + "&emoji=true&list=false&xudp=false&udp=false&tfo=false&expand=true&scv=false&fdn=false&new_name=true";\n                        var urlElement = document.getElementById("clientSubscriptionUrl");\n                        urlElement.textContent = finalUrl;\n                        urlElement.style.display = "block";\n                        urlElement.style.overflowWrap = "break-word";\n                        urlElement.style.wordBreak = "break-all";\n                        urlElement.style.overflowX = "auto";\n                        urlElement.style.maxWidth = "100%";\n                        urlElement.style.boxSizing = "border-box";\n\n                        if (clientType === atob('Y2xhc2g=')) {\n                            if (clientName === 'STASH') {\n                                schemeUrl = 'stash://install?url=' + encodeURIComponent(finalUrl);\n                                displayName = 'STASH';\n                            } else {\n                                schemeUrl = 'clash://install-config?url=' + encodeURIComponent(finalUrl);\n                                displayName = 'CLASH';\n                            }\n                        } else if (clientType === atob('c3VyZ2U=')) {\n                            schemeUrl = 'surge:///install-config?url=' + encodeURIComponent(finalUrl);\n                            displayName = 'SURGE';\n                        } else if (clientType === atob('c2luZ2JveA==')) {\n                            schemeUrl = 'sing-box://install-config?url=' + encodeURIComponent(finalUrl);\n                            displayName = 'SING-BOX';\n                        } else if (clientType === atob('bG9vbg==')) {\n                            schemeUrl = 'loon://install?url=' + encodeURIComponent(finalUrl);\n                            displayName = 'LOON';\n                        } else if (clientType === atob('cXVhbng=')) {\n                            schemeUrl = 'quantumult-x://install-config?url=' + encodeURIComponent(finalUrl);\n                            displayName = 'QUANTUMULT X';\n                        }\n\n                        if (schemeUrl) {\n                            tryOpenApp(schemeUrl, function() {\n                                navigator.clipboard.writeText(finalUrl).then(function() {\n                                        alert(displayName + " " + t.subscriptionCopied);\n                                });\n                            });\n                        } else {\n                            navigator.clipboard.writeText(finalUrl).then(function() {\n                                    alert(displayName + " " + t.subscriptionCopied);\n                            });\n                        }\n                    }\n                }\n            }\n\n            function createMatrixRain() {\n                const matrixContainer = document.getElementById('matrixCodeRain');\n                const matrixChars = '01ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\n                const columns = Math.floor(window.innerWidth / 18);\n\n                for (let i = 0; i < columns; i++) {\n                    const column = document.createElement('div');\n                    column.className = 'matrix-column';\n                    column.style.left = (i * 18) + 'px';\n                    column.style.animationDelay = Math.random() * 15 + 's';\n                    column.style.animationDuration = (Math.random() * 15 + 8) + 's';\n                    column.style.fontSize = (Math.random() * 4 + 12) + 'px';\n                    column.style.opacity = Math.random() * 0.8 + 0.2;\n\n                    let text = '';\n                    const charCount = Math.floor(Math.random() * 30 + 20);\n                    for (let j = 0; j < charCount; j++) {\n                        const char = matrixChars[Math.floor(Math.random() * matrixChars.length)];\n                        const brightness = Math.random() > 0.1 ? '#00ff00' : '#00aa00';\n                        text += '<span style="color: ' + brightness + ';">' + char + '</span><br>';\n                    }\n                    column.innerHTML = text;\n                    matrixContainer.appendChild(column);\n                }\n\n                setInterval(function() {\n                    const columns = matrixContainer.querySelectorAll('.matrix-column');\n                    columns.forEach(function(column) {\n                        if (Math.random() > 0.95) {\n                            const chars = column.querySelectorAll('span');\n                            if (chars.length > 0) {\n                                const randomChar = chars[Math.floor(Math.random() * chars.length)];\n                                randomChar.style.color = '#ffffff';\n                                setTimeout(function() {\n                                    randomChar.style.color = '#00ff00';\n                                }, 200);\n                            }\n                        }\n                    });\n                }, 100);\n            }\n\n            async function checkSystemStatus() {\n                try {\n                    const cfStatus = document.getElementById('cfStatus');\n                    const regionStatus = document.getElementById('regionStatus');\n                    const geoInfo = document.getElementById('geoInfo');\n                    const backupStatus = document.getElementById('backupStatus');\n                    const currentIP = document.getElementById('currentIP');\n                    const regionMatch = document.getElementById('regionMatch');\n\n                        // è·å–å½“å‰è¯­è¨€è®¾ç½®ï¼ˆä¼˜å…ˆä»Cookie/localStorageè¯»å–ï¼‰\n                        function getCookie(name) {\n                            const value = '; ' + document.cookie;\n                            const parts = value.split('; ' + name + '=');\n                            if (parts.length === 2) return parts.pop().split(';').shift();\n                            return null;\n                        }\n\n                        const browserLang = navigator.language || navigator.userLanguage || '';\n                        const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                        let isFarsi = false;\n\n                        if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                            isFarsi = true;\n                        } else if (savedLang === 'zh' || savedLang === 'en-US') {\n                            isFarsi = false;\n                        } else {\n                            isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                        }\n\n                        const translations = {\n                            en: {\n                    title: 'Terminal',\n                    terminal: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n                    \n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support â€¢ Smart Optimization â€¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: 'âœ… KV Storage Enabled, Config Management Available',\n                    kvDisabled: 'âš ï¸ KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'ğŸ“ Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>â€¢ VLESS WS: Standard WebSocket protocol<br>â€¢ VMess WS: WebSocket-based VMess (link generation)<br>â€¢ Shadowsocks: WebSocket-based SS (link generation)<br>â€¢ Trojan: Uses SHA224 password auth<br>â€¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: 'âš ï¸ Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'ğŸ‡ºğŸ‡¸ US', SG: 'ğŸ‡¸ğŸ‡¬ Singapore', JP: 'ğŸ‡¯ğŸ‡µ Japan',\n                        KR: 'ğŸ‡°ğŸ‡· South Korea', DE: 'ğŸ‡©ğŸ‡ª Germany', SE: 'ğŸ‡¸ğŸ‡ª Sweden', NL: 'ğŸ‡³ğŸ‡± Netherlands',\n                        FI: 'ğŸ‡«ğŸ‡® Finland', GB: 'ğŸ‡¬ğŸ‡§ UK', FR: 'ğŸ‡«ğŸ‡· France', CA: 'ğŸ‡¨ğŸ‡¦ Canada',\n                        AU: 'ğŸ‡¦ğŸ‡º Australia', HK: 'ğŸ‡­ğŸ‡° Hong Kong', TW: 'ğŸ‡¹ğŸ‡¼ Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                                customIPMode: 'è‡ªå®šä¹‰ProxyIPæ¨¡å¼ (på˜é‡å¯ç”¨)',\n                                customIPModeDesc: 'è‡ªå®šä¹‰IPæ¨¡å¼ (å·²ç¦ç”¨åœ°åŒºåŒ¹é…)',\n                                usingCustomProxyIP: 'ä½¿ç”¨è‡ªå®šä¹‰ProxyIP: ',\n                                customIPConfig: ' (på˜é‡é…ç½®)',\n                                customIPModeDisabled: 'è‡ªå®šä¹‰IPæ¨¡å¼ï¼Œåœ°åŒºé€‰æ‹©å·²ç¦ç”¨',\n                                manualRegion: 'æ‰‹åŠ¨æŒ‡å®šåœ°åŒº',\n                                manualRegionDesc: ' (æ‰‹åŠ¨æŒ‡å®š)',\n                                proxyIPAvailable: '10/10 å¯ç”¨ (ProxyIPåŸŸåé¢„è®¾å¯ç”¨)',\n                                smartSelection: 'æ™ºèƒ½å°±è¿‘é€‰æ‹©ä¸­',\n                                sameRegionIP: 'åŒåœ°åŒºIPå¯ç”¨ (1ä¸ª)',\n                                cloudflareDetection: 'Cloudflareå†…ç½®æ£€æµ‹',\n                                detectionFailed: 'æ£€æµ‹å¤±è´¥',\n                                unknown: 'Unknown'\n                            },\n                            fa: {\n                                workerRegion: 'Ù…Ù†Ø·Ù‚Ù‡ Worker: ',\n                                detectionMethod: 'Ø±ÙˆØ´ ØªØ´Ø®ÛŒØµ: ',\n                                proxyIPStatus: 'ÙˆØ¶Ø¹ÛŒØª ProxyIP: ',\n                                currentIP: 'IP ÙØ¹Ù„ÛŒ: ',\n                                regionMatch: 'ØªØ·Ø¨ÛŒÙ‚ Ù…Ù†Ø·Ù‚Ù‡: ',\n                                regionNames: {\n                                    'US': 'ğŸ‡ºğŸ‡¸ Ø¢Ù…Ø±ÛŒÚ©Ø§', 'SG': 'ğŸ‡¸ğŸ‡¬ Ø³Ù†Ú¯Ø§Ù¾ÙˆØ±', 'JP': 'ğŸ‡¯ğŸ‡µ Ú˜Ø§Ù¾Ù†',\n                                    'KR': 'ğŸ‡°ğŸ‡· Ú©Ø±Ù‡ Ø¬Ù†ÙˆØ¨ÛŒ', 'DE': 'ğŸ‡©ğŸ‡ª Ø¢Ù„Ù…Ø§Ù†', 'SE': 'ğŸ‡¸ğŸ‡ª Ø³ÙˆØ¦Ø¯', 'NL': 'ğŸ‡³ğŸ‡± Ù‡Ù„Ù†Ø¯',\n                                    'FI': 'ğŸ‡«ğŸ‡® ÙÙ†Ù„Ø§Ù†Ø¯', 'GB': 'ğŸ‡¬ğŸ‡§ Ø¨Ø±ÛŒØªØ§Ù†ÛŒØ§'\n                                },\n                                customIPMode: 'Ø­Ø§Ù„Øª ProxyIP Ø³ÙØ§Ø±Ø´ÛŒ (Ù…ØªØºÛŒØ± p ÙØ¹Ø§Ù„ Ø§Ø³Øª)',\n                                customIPModeDesc: 'Ø­Ø§Ù„Øª IP Ø³ÙØ§Ø±Ø´ÛŒ (ØªØ·Ø¨ÛŒÙ‚ Ù…Ù†Ø·Ù‚Ù‡ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª)',\n                                usingCustomProxyIP: 'Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ProxyIP Ø³ÙØ§Ø±Ø´ÛŒ: ',\n                                customIPConfig: ' (Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù…ØªØºÛŒØ± p)',\n                                customIPModeDisabled: 'Ø­Ø§Ù„Øª IP Ø³ÙØ§Ø±Ø´ÛŒØŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù†Ø·Ù‚Ù‡ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª',\n                                manualRegion: 'ØªØ¹ÛŒÛŒÙ† Ù…Ù†Ø·Ù‚Ù‡ Ø¯Ø³ØªÛŒ',\n                                manualRegionDesc: ' (ØªØ¹ÛŒÛŒÙ† Ø¯Ø³ØªÛŒ)',\n                                proxyIPAvailable: '10/10 Ø¯Ø± Ø¯Ø³ØªØ±Ø³ (Ø¯Ø§Ù…Ù†Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ ProxyIP Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø§Ø³Øª)',\n                                smartSelection: 'Ø§Ù†ØªØ®Ø§Ø¨ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù†Ø²Ø¯ÛŒÚ© Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… Ø§Ø³Øª',\n                                sameRegionIP: 'IP Ù‡Ù…â€ŒÙ…Ù†Ø·Ù‚Ù‡ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø§Ø³Øª (1)',\n                                cloudflareDetection: 'ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø®Ù„ÛŒ Cloudflare',\n                                detectionFailed: 'ØªØ´Ø®ÛŒØµ Ù†Ø§Ù…ÙˆÙÙ‚',\n                                unknown: 'Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡'\n                            }\n                        };\n\n                        const t = translations[isFarsi ? 'fa' : 'en'];\n\n                    let detectedRegion = 'US'; // é»˜è®¤å€¼\n                    let isCustomIPMode = false;\n                    let isManualRegionMode = false;\n                    try {\n                        const response = await fetch(window.location.pathname + '/region');\n                        const data = await response.json();\n\n                        if (data.region === 'CUSTOM') {\n                            isCustomIPMode = true;\n                            detectedRegion = 'CUSTOM';\n\n                            // è·å–è‡ªå®šä¹‰IPçš„è¯¦ç»†ä¿¡æ¯\n                                const customIPInfo = data.ci || t.unknown;\n\n                                geoInfo.innerHTML = t.detectionMethod + '<span style="color: #ffaa00;">âš™ï¸ ' + t.customIPMode + '</span>';\n                                regionStatus.innerHTML = t.workerRegion + '<span style="color: #ffaa00;">ğŸ”§ ' + t.customIPModeDesc + '</span>';\n\n                            // æ˜¾ç¤ºè‡ªå®šä¹‰IPé…ç½®çŠ¶æ€ï¼ŒåŒ…å«å…·ä½“IP\n                                if (backupStatus) backupStatus.innerHTML = t.proxyIPStatus + '<span style="color: #ffaa00;">ğŸ”§ ' + t.usingCustomProxyIP + customIPInfo + '</span>';\n                                if (currentIP) currentIP.innerHTML = t.currentIP + '<span style="color: #ffaa00;">âœ… ' + customIPInfo + t.customIPConfig + '</span>';\n                                if (regionMatch) regionMatch.innerHTML = t.regionMatch + '<span style="color: #ffaa00;">âš ï¸ ' + t.customIPModeDisabled + '</span>';\n\n                            return; // æå‰è¿”å›ï¼Œä¸æ‰§è¡Œåç»­çš„åœ°åŒºåŒ¹é…é€»è¾‘\n                            } else if (data.detectionMethod === 'æ‰‹åŠ¨æŒ‡å®šåœ°åŒº' || data.detectionMethod === 'ØªØ¹ÛŒÛŒÙ† Ù…Ù†Ø·Ù‚Ù‡ Ø¯Ø³ØªÛŒ') {\n                            isManualRegionMode = true;\n                            detectedRegion = data.region;\n\n                                geoInfo.innerHTML = t.detectionMethod + '<span style="color: #44aa44;">' + t.manualRegion + '</span>';\n                                regionStatus.innerHTML = t.workerRegion + '<span style="color: #44ff44;">ğŸ¯ ' + t.regionNames[detectedRegion] + t.manualRegionDesc + '</span>';\n\n                            // æ˜¾ç¤ºé…ç½®çŠ¶æ€è€Œä¸æ˜¯æ£€æµ‹çŠ¶æ€\n                                if (backupStatus) backupStatus.innerHTML = t.proxyIPStatus + '<span style="color: #44ff44;">âœ… ' + t.proxyIPAvailable + '</span>';\n                                if (currentIP) currentIP.innerHTML = t.currentIP + '<span style="color: #44ff44;">âœ… ' + t.smartSelection + '</span>';\n                                if (regionMatch) regionMatch.innerHTML = t.regionMatch + '<span style="color: #44ff44;">âœ… ' + t.sameRegionIP + '</span>';\n\n                            return; // æå‰è¿”å›ï¼Œä¸æ‰§è¡Œåç»­çš„åœ°åŒºåŒ¹é…é€»è¾‘\n                            } else if (data.region && t.regionNames[data.region]) {\n                            detectedRegion = data.region;\n                        }\n\n                            geoInfo.innerHTML = t.detectionMethod + '<span style="color: #44ff44;">' + t.cloudflareDetection + '</span>';\n\n                    } catch (e) {\n                            geoInfo.innerHTML = t.detectionMethod + '<span style="color: #ff4444;">' + t.detectionFailed + '</span>';\n                    }\n\n                        regionStatus.innerHTML = t.workerRegion + '<span style="color: #44ff44;">âœ… ' + t.regionNames[detectedRegion] + '</span>';\n\n                    // ç›´æ¥æ˜¾ç¤ºé…ç½®çŠ¶æ€ï¼Œä¸å†è¿›è¡Œæ£€æµ‹\n                    if (backupStatus) {\n                            backupStatus.innerHTML = t.proxyIPStatus + '<span style="color: #44ff44;">âœ… ' + t.proxyIPAvailable + '</span>';\n                    }\n\n                    if (currentIP) {\n                            currentIP.innerHTML = t.currentIP + '<span style="color: #44ff44;">âœ… ' + t.smartSelection + '</span>';\n                    }\n\n                    if (regionMatch) {\n                            regionMatch.innerHTML = t.regionMatch + '<span style="color: #44ff44;">âœ… ' + t.sameRegionIP + '</span>';\n                    }\n\n                } catch (error) {\n                        function getCookie(name) {\n                            const value = '; ' + document.cookie;\n                            const parts = value.split('; ' + name + '=');\n                            if (parts.length === 2) return parts.pop().split(';').shift();\n                            return null;\n                        }\n\n                        const browserLang = navigator.language || navigator.userLanguage || '';\n                        const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                        let isFarsi = false;\n\n                        if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                            isFarsi = true;\n                        } else {\n                            isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                        }\n\n                        const translations = {\n                            en: {\n                    title: 'Terminal',\n                    terminal: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n                    \n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support â€¢ Smart Optimization â€¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: 'âœ… KV Storage Enabled, Config Management Available',\n                    kvDisabled: 'âš ï¸ KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'ğŸ“ Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>â€¢ VLESS WS: Standard WebSocket protocol<br>â€¢ VMess WS: WebSocket-based VMess (link generation)<br>â€¢ Shadowsocks: WebSocket-based SS (link generation)<br>â€¢ Trojan: Uses SHA224 password auth<br>â€¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: 'âš ï¸ Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'ğŸ‡ºğŸ‡¸ US', SG: 'ğŸ‡¸ğŸ‡¬ Singapore', JP: 'ğŸ‡¯ğŸ‡µ Japan',\n                        KR: 'ğŸ‡°ğŸ‡· South Korea', DE: 'ğŸ‡©ğŸ‡ª Germany', SE: 'ğŸ‡¸ğŸ‡ª Sweden', NL: 'ğŸ‡³ğŸ‡± Netherlands',\n                        FI: 'ğŸ‡«ğŸ‡® Finland', GB: 'ğŸ‡¬ğŸ‡§ UK', FR: 'ğŸ‡«ğŸ‡· France', CA: 'ğŸ‡¨ğŸ‡¦ Canada',\n                        AU: 'ğŸ‡¦ğŸ‡º Australia', HK: 'ğŸ‡­ğŸ‡° Hong Kong', TW: 'ğŸ‡¹ğŸ‡¼ Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                            fa: {\n                                workerRegion: 'Ù…Ù†Ø·Ù‚Ù‡ Worker: ',\n                                detectionMethod: 'Ø±ÙˆØ´ ØªØ´Ø®ÛŒØµ: ',\n                                proxyIPStatus: 'ÙˆØ¶Ø¹ÛŒØª ProxyIP: ',\n                                currentIP: 'IP ÙØ¹Ù„ÛŒ: ',\n                                regionMatch: 'ØªØ·Ø¨ÛŒÙ‚ Ù…Ù†Ø·Ù‚Ù‡: ',\n                                detectionFailed: 'ØªØ´Ø®ÛŒØµ Ù†Ø§Ù…ÙˆÙÙ‚'\n                            }\n                        };\n\n                        const t = translations[isFarsi ? 'fa' : 'en'];\n\n                        document.getElementById('regionStatus').innerHTML = t.workerRegion + '<span style="color: #ff4444;">âŒ ' + t.detectionFailed + '</span>';\n                        document.getElementById('geoInfo').innerHTML = t.detectionMethod + '<span style="color: #ff4444;">âŒ ' + t.detectionFailed + '</span>';\n                        document.getElementById('backupStatus').innerHTML = t.proxyIPStatus + '<span style="color: #ff4444;">âŒ ' + t.detectionFailed + '</span>';\n                        document.getElementById('currentIP').innerHTML = t.currentIP + '<span style="color: #ff4444;">âŒ ' + t.detectionFailed + '</span>';\n                        document.getElementById('regionMatch').innerHTML = t.regionMatch + '<span style="color: #ff4444;">âŒ ' + t.detectionFailed + '</span>';\n                }\n            }\n\n                async function testAPI() {\n                    try {\n                        function getCookie(name) {\n                            const value = '; ' + document.cookie;\n                            const parts = value.split('; ' + name + '=');\n                            if (parts.length === 2) return parts.pop().split(';').shift();\n                            return null;\n                        }\n\n                        const browserLang = navigator.language || navigator.userLanguage || '';\n                        const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                        let isFarsi = false;\n\n                        if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                            isFarsi = true;\n                        } else {\n                            isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                        }\n\n                        const translations = {\n                            en: {\n                    title: 'Terminal',\n                    terminal: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n                    \n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support â€¢ Smart Optimization â€¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: 'âœ… KV Storage Enabled, Config Management Available',\n                    kvDisabled: 'âš ï¸ KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'ğŸ“ Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>â€¢ VLESS WS: Standard WebSocket protocol<br>â€¢ VMess WS: WebSocket-based VMess (link generation)<br>â€¢ Shadowsocks: WebSocket-based SS (link generation)<br>â€¢ Trojan: Uses SHA224 password auth<br>â€¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: 'âš ï¸ Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'ğŸ‡ºğŸ‡¸ US', SG: 'ğŸ‡¸ğŸ‡¬ Singapore', JP: 'ğŸ‡¯ğŸ‡µ Japan',\n                        KR: 'ğŸ‡°ğŸ‡· South Korea', DE: 'ğŸ‡©ğŸ‡ª Germany', SE: 'ğŸ‡¸ğŸ‡ª Sweden', NL: 'ğŸ‡³ğŸ‡± Netherlands',\n                        FI: 'ğŸ‡«ğŸ‡® Finland', GB: 'ğŸ‡¬ğŸ‡§ UK', FR: 'ğŸ‡«ğŸ‡· France', CA: 'ğŸ‡¨ğŸ‡¦ Canada',\n                        AU: 'ğŸ‡¦ğŸ‡º Australia', HK: 'ğŸ‡­ğŸ‡° Hong Kong', TW: 'ğŸ‡¹ğŸ‡¼ Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                            fa: {\n                                apiTestResult: 'Ù†ØªÛŒØ¬Ù‡ ØªØ´Ø®ÛŒØµ API: ',\n                                apiTestTime: 'Ø²Ù…Ø§Ù† ØªØ´Ø®ÛŒØµ: ',\n                                apiTestFailed: 'ØªØ´Ø®ÛŒØµ API Ù†Ø§Ù…ÙˆÙÙ‚: ',\n                                unknownError: 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡',\n                                apiTestError: 'ØªØ³Øª API Ù†Ø§Ù…ÙˆÙÙ‚: '\n                            }\n                        };\n\n                        const t = translations[isFarsi ? 'fa' : 'en'];\n\n                    const response = await fetch(window.location.pathname + '/test-api');\n                    const data = await response.json();\n\n                    if (data.detectedRegion) {\n                            alert(t.apiTestResult + data.detectedRegion + '\\n' + t.apiTestTime + data.timestamp);\n                    } else {\n                            alert(t.apiTestFailed + (data.error || t.unknownError));\n                    }\n                } catch (error) {\n                        function getCookie(name) {\n                            const value = '; ' + document.cookie;\n                            const parts = value.split('; ' + name + '=');\n                            if (parts.length === 2) return parts.pop().split(';').shift();\n                            return null;\n                        }\n\n                        const browserLang = navigator.language || navigator.userLanguage || '';\n                        const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                        let isFarsi = false;\n\n                        if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                            isFarsi = true;\n                        } else {\n                            isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                        }\n\n                        const translations = {\n                            en: {\n                    title: 'Terminal',\n                    terminal: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n                    \n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support â€¢ Smart Optimization â€¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: 'âœ… KV Storage Enabled, Config Management Available',\n                    kvDisabled: 'âš ï¸ KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'ğŸ“ Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>â€¢ VLESS WS: Standard WebSocket protocol<br>â€¢ VMess WS: WebSocket-based VMess (link generation)<br>â€¢ Shadowsocks: WebSocket-based SS (link generation)<br>â€¢ Trojan: Uses SHA224 password auth<br>â€¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: 'âš ï¸ Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'ğŸ‡ºğŸ‡¸ US', SG: 'ğŸ‡¸ğŸ‡¬ Singapore', JP: 'ğŸ‡¯ğŸ‡µ Japan',\n                        KR: 'ğŸ‡°ğŸ‡· South Korea', DE: 'ğŸ‡©ğŸ‡ª Germany', SE: 'ğŸ‡¸ğŸ‡ª Sweden', NL: 'ğŸ‡³ğŸ‡± Netherlands',\n                        FI: 'ğŸ‡«ğŸ‡® Finland', GB: 'ğŸ‡¬ğŸ‡§ UK', FR: 'ğŸ‡«ğŸ‡· France', CA: 'ğŸ‡¨ğŸ‡¦ Canada',\n                        AU: 'ğŸ‡¦ğŸ‡º Australia', HK: 'ğŸ‡­ğŸ‡° Hong Kong', TW: 'ğŸ‡¹ğŸ‡¼ Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                            fa: { apiTestError: 'ØªØ³Øª API Ù†Ø§Ù…ÙˆÙÙ‚: ' }\n                        };\n\n                        const t = translations[isFarsi ? 'fa' : 'en'];\n                        alert(t.apiTestError + error.message);\n                }\n            }\n\n            // é…ç½®ç®¡ç†ç›¸å…³å‡½æ•°\n            async function checkKVStatus() {\n                const apiUrl = window.location.pathname + '/api/config';\n\n                try {\n                    const response = await fetch(apiUrl);\n\n                        function getCookie(name) {\n                            const value = '; ' + document.cookie;\n                            const parts = value.split('; ' + name + '=');\n                            if (parts.length === 2) return parts.pop().split(';').shift();\n                            return null;\n                        }\n\n                        const browserLang = navigator.language || navigator.userLanguage || '';\n                        const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                        let isFarsi = false;\n\n                        if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                            isFarsi = true;\n                        } else {\n                            isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                        }\n\n                        const translations = {\n                            en: {\n                    title: 'Terminal',\n                    terminal: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n                    \n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support â€¢ Smart Optimization â€¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: 'âœ… KV Storage Enabled, Config Management Available',\n                    kvDisabled: 'âš ï¸ KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'ğŸ“ Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>â€¢ VLESS WS: Standard WebSocket protocol<br>â€¢ VMess WS: WebSocket-based VMess (link generation)<br>â€¢ Shadowsocks: WebSocket-based SS (link generation)<br>â€¢ Trojan: Uses SHA224 password auth<br>â€¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: 'âš ï¸ Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'ğŸ‡ºğŸ‡¸ US', SG: 'ğŸ‡¸ğŸ‡¬ Singapore', JP: 'ğŸ‡¯ğŸ‡µ Japan',\n                        KR: 'ğŸ‡°ğŸ‡· South Korea', DE: 'ğŸ‡©ğŸ‡ª Germany', SE: 'ğŸ‡¸ğŸ‡ª Sweden', NL: 'ğŸ‡³ğŸ‡± Netherlands',\n                        FI: 'ğŸ‡«ğŸ‡® Finland', GB: 'ğŸ‡¬ğŸ‡§ UK', FR: 'ğŸ‡«ğŸ‡· France', CA: 'ğŸ‡¨ğŸ‡¦ Canada',\n                        AU: 'ğŸ‡¦ğŸ‡º Australia', HK: 'ğŸ‡­ğŸ‡° Hong Kong', TW: 'ğŸ‡¹ğŸ‡¼ Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                            fa: {\n                                kvDisabled: 'âš ï¸ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª ÛŒØ§ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª',\n                                kvNotConfigured: 'âš ï¸ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù¾Ù†Ù„ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª.\\n\\nğŸ”§ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªØ¹Ù…ÛŒØ±:\\n1. Ø¨Ù‡ Ù¾Ù†Ù„ Cloudflare -> Workers -> KV Ø¨Ø±ÙˆÛŒØ¯.\\n2. ÛŒÚ© Namespace Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø²ÛŒØ¯.\\n3. Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Worker -> Variables -> KV Bindings.\\n4. Ù…ØªØºÛŒØ±ÛŒ Ø¨Ø§ Ù†Ø§Ù… "C" (Ø¨Ø²Ø±Ú¯) Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù‡ Ùˆ Ø¨Ù‡ KV Ù…ØªØµÙ„ Ú©Ù†ÛŒØ¯.\\n5. Ø°Ø®ÛŒØ±Ù‡ Ùˆ Deploy Ú©Ù†ÛŒØ¯.',\n                                kvNotEnabled: 'KV Ù…ØªØµÙ„ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø·Ø¨Ù‚ Ø±Ø§Ù‡Ù†Ù…Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯',\n                                kvEnabled: 'âœ… Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV ÙØ¹Ø§Ù„ Ø§Ø³ØªØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯',\n                                kvCheckFailed: 'âš ï¸ Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV Ù†Ø§Ù…ÙˆÙÙ‚',\n                                kvCheckFailedFormat: 'Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV Ù†Ø§Ù…ÙˆÙÙ‚: Ø®Ø·Ø§ÛŒ ÙØ±Ù…Øª Ù¾Ø§Ø³Ø®',\n                                kvCheckFailedStatus: 'Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV Ù†Ø§Ù…ÙˆÙÙ‚ - Ú©Ø¯ ÙˆØ¶Ø¹ÛŒØª: ',\n                                kvCheckFailedError: 'Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV Ù†Ø§Ù…ÙˆÙÙ‚ - Ø®Ø·Ø§: '\n                            }\n                        };\n\n                        const t = translations[isFarsi ? 'fa' : 'en'];\n\n                        if (response.status === 503) {\n                            // KVæœªé…ç½®\n                            document.getElementById('kvStatus').innerHTML = '<span style="color: #ffaa00;">' + t.kvDisabled + '</span>';\n                            document.getElementById('configCard').style.display = 'block';\n                            document.getElementById('currentConfig').textContent = t.kvNotConfigured;\n                    } else if (response.ok) {\n                        try {\n                        const data = await response.json();\n\n                            // æ£€æŸ¥å“åº”æ˜¯å¦åŒ…å«KVé…ç½®ä¿¡æ¯\n                            if (data && data.kvEnabled === true) {\n                                document.getElementById('kvStatus').innerHTML = '<span style="color: #44ff44;">' + t.kvEnabled + '</span>';\n                                document.getElementById('configContent').style.display = 'block';\n                                document.getElementById('configCard').style.display = 'block';\n                                await loadCurrentConfig();\n                            } else {\n                                document.getElementById('kvStatus').innerHTML = '<span style="color: #ffaa00;">' + t.kvDisabled + '</span>';\n                                document.getElementById('configCard').style.display = 'block';\n                                document.getElementById('currentConfig').textContent = t.kvNotEnabled;\n                                }\n                        } catch (jsonError) {\n                            document.getElementById('kvStatus').innerHTML = '<span style="color: #ffaa00;">' + t.kvCheckFailed + '</span>';\n                            document.getElementById('configCard').style.display = 'block';\n                            document.getElementById('currentConfig').textContent = t.kvCheckFailedFormat;\n                        }\n                    } else {\n                        document.getElementById('kvStatus').innerHTML = '<span style="color: #ffaa00;">' + t.kvDisabled + '</span>';\n                        document.getElementById('configCard').style.display = 'block';\n                        document.getElementById('currentConfig').textContent = t.kvCheckFailedStatus + response.status;\n                    }\n                } catch (error) {\n                    function getCookie(name) {\n                        const value = '; ' + document.cookie;\n                        const parts = value.split('; ' + name + '=');\n                        if (parts.length === 2) return parts.pop().split(';').shift();\n                        return null;\n                    }\n\n                    const browserLang = navigator.language || navigator.userLanguage || '';\n                    const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                    let isFarsi = false;\n\n                    if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                        isFarsi = true;\n                    } else {\n                        isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                    }\n\n                    const translations = {\n                        en: {\n                    title: 'Terminal',\n                    terminal: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n                    \n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support â€¢ Smart Optimization â€¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: 'âœ… KV Storage Enabled, Config Management Available',\n                    kvDisabled: 'âš ï¸ KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'ğŸ“ Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>â€¢ VLESS WS: Standard WebSocket protocol<br>â€¢ VMess WS: WebSocket-based VMess (link generation)<br>â€¢ Shadowsocks: WebSocket-based SS (link generation)<br>â€¢ Trojan: Uses SHA224 password auth<br>â€¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: 'âš ï¸ Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'ğŸ‡ºğŸ‡¸ US', SG: 'ğŸ‡¸ğŸ‡¬ Singapore', JP: 'ğŸ‡¯ğŸ‡µ Japan',\n                        KR: 'ğŸ‡°ğŸ‡· South Korea', DE: 'ğŸ‡©ğŸ‡ª Germany', SE: 'ğŸ‡¸ğŸ‡ª Sweden', NL: 'ğŸ‡³ğŸ‡± Netherlands',\n                        FI: 'ğŸ‡«ğŸ‡® Finland', GB: 'ğŸ‡¬ğŸ‡§ UK', FR: 'ğŸ‡«ğŸ‡· France', CA: 'ğŸ‡¨ğŸ‡¦ Canada',\n                        AU: 'ğŸ‡¦ğŸ‡º Australia', HK: 'ğŸ‡­ğŸ‡° Hong Kong', TW: 'ğŸ‡¹ğŸ‡¼ Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                        fa: {\n                            kvDisabled: 'âš ï¸ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª ÛŒØ§ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª',\n                            kvCheckFailedError: 'Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ KV Ù†Ø§Ù…ÙˆÙÙ‚ - Ø®Ø·Ø§: '\n                        }\n                    };\n\n                    const t = translations[isFarsi ? 'fa' : 'en'];\n\n                    document.getElementById('kvStatus').innerHTML = '<span style="color: #ffaa00;">' + t.kvDisabled + '</span>';\n                    document.getElementById('configCard').style.display = 'block';\n                    document.getElementById('currentConfig').textContent = t.kvCheckFailedError + error.message;\n                }\n            }\n\n            async function loadCurrentConfig() {\n                const apiUrl = window.location.pathname + '/api/config';\n\n                try {\n                    const response = await fetch(apiUrl);\n\n                    if (response.status === 503) {\n                        document.getElementById('currentConfig').textContent = 'KVå­˜å‚¨æœªé…ç½®ï¼Œæ— æ³•åŠ è½½é…ç½®';\n                        return;\n                    }\n                    if (!response.ok) {\n                        const errorText = await response.text();\n                        document.getElementById('currentConfig').textContent = 'åŠ è½½é…ç½®å¤±è´¥: ' + errorText;\n                        return;\n                    }\n                    const config = await response.json();\n\n                    // è¿‡æ»¤æ‰å†…éƒ¨å­—æ®µ kvEnabled\n                    const displayConfig = {};\n                    for (const [key, value] of Object.entries(config)) {\n                        if (key !== 'kvEnabled') {\n                            displayConfig[key] = value;\n                        }\n                    }\n\n                    let configText = 'å½“å‰é…ç½®:\\n';\n                    if (Object.keys(displayConfig).length === 0) {\n                        configText += '(æš‚æ— é…ç½®)';\n                    } else {\n                        for (const [key, value] of Object.entries(displayConfig)) {\n                            configText += key + ': ' + (value || '(æœªè®¾ç½®)') + '\\n';\n                        }\n                    }\n\n                    document.getElementById('currentConfig').textContent = configText;\n\n                    // æ›´æ–°è¡¨å•å€¼\n                    document.getElementById('wkRegion').value = config.wk || '';\n                    document.getElementById('ev').checked = config.ev !== 'no';\n                    document.getElementById('et').checked = config.et === 'yes';\n                    document.getElementById('ex').checked = config.ex === 'yes';\n                    document.getElementById('ech').checked = config.ech === 'yes';\n                    document.getElementById('tp').value = config.tp || '';\n                    if (document.getElementById('customDNS')) {\n                        document.getElementById('customDNS').value = config.customDNS || '';\n                    }\n                    if (document.getElementById('customECHDomain')) {\n                        document.getElementById('customECHDomain').value = config.customECHDomain || '';\n                    }\n                    document.getElementById('scu').value = config.scu || '';\n                    document.getElementById('epd').checked = config.epd !== 'no';\n                    document.getElementById('epi').checked = config.epi !== 'no';\n                    document.getElementById('egi').checked = config.egi !== 'no';\n                    document.getElementById('enableDiverseProxies').checked = config.edp === 'yes' || config.edp === true;\n                    if (document.getElementById('ipv4Enabled')) document.getElementById('ipv4Enabled').checked = config.ipv4 !== 'no';\n                    if (document.getElementById('ipv6Enabled')) document.getElementById('ipv6Enabled').checked = config.ipv6 !== 'no';\n                    if (document.getElementById('ispMobile')) document.getElementById('ispMobile').checked = config.ispMobile !== 'no';\n                    if (document.getElementById('ispUnicom')) document.getElementById('ispUnicom').checked = config.ispUnicom !== 'no';\n                    if (document.getElementById('ispTelecom')) document.getElementById('ispTelecom').checked = config.ispTelecom !== 'no';\n                    document.getElementById('customPath').value = config.d || '';\n                    document.getElementById('customIP').value = config.p || '';\n                    document.getElementById('yx').value = config.yx || '';\n                    document.getElementById('yxURL').value = config.yxURL || '';\n                    document.getElementById('socksConfig').value = config.s || '';\n                    document.getElementById('customHomepage').value = config.homepage || '';\n                    document.getElementById('apiEnabled').value = config.ae || '';\n                    document.getElementById('regionMatching').value = config.rm || '';\n                    document.getElementById('downgradeControl').value = config.qj || '';\n                    document.getElementById('portControl').value = config.dkby || '';\n                    document.getElementById('preferredControl').value = config.yxby || '';\n\n                    // Update path type display\n                    updatePathTypeStatus(config.d);\n\n                    // Check p variable, if it has value, disable wk region selection\n                    updateWkRegionState();\n\n                } catch (error) {\n                    document.getElementById('currentConfig').textContent = 'åŠ è½½é…ç½®å¤±è´¥: ' + error.message;\n                }\n            }\n\n            // Update path type display\n            function updatePathTypeStatus(cp) {\n                const pathTypeStatus = document.getElementById('pathTypeStatus');\n                const currentUrl = window.location.href;\n                const pathParts = window.location.pathname.split('/').filter(p => p);\n                const currentPath = pathParts.length > 0 ? pathParts[0] : '';\n\n                if (cp && cp.trim()) {\n                    // Use custom path (d)\n                    pathTypeStatus.innerHTML = '<div style="color: #44ff44;">ä½¿ç”¨ç±»å‹: <strong>è‡ªå®šä¹‰è·¯å¾„ (d)</strong></div>' +\n                        '<div style="margin-top: 5px; color: #00ff00;">å½“å‰è·¯å¾„: <span style="color: #ffaa00;">' + cp + '</span></div>' +\n                        '<div style="margin-top: 5px; font-size: 0.9rem; color: #00aa00;">è®¿é—®åœ°å€: ' +\n                        (currentUrl.split('/')[0] + '//' + currentUrl.split('/')[2]) + cp + '/sub</div>';\n                } else {\n                    // Use UUID (u)\n                    pathTypeStatus.innerHTML = '<div style="color: #44ff44;">ä½¿ç”¨ç±»å‹: <strong>UUID è·¯å¾„ (u)</strong></div>' +\n                        '<div style="margin-top: 5px; color: #00ff00;">å½“å‰è·¯å¾„: <span style="color: #ffaa00;">' + (currentPath || '(UUID)') + '</span></div>' +\n                        '<div style="margin-top: 5px; font-size: 0.9rem; color: #00aa00;">è®¿é—®åœ°å€: ' + currentUrl.split('/sub')[0] + '/sub</div>';\n                }\n            }\n\n            // Update wk region selection enabled/disabled state\n            function updateWkRegionState() {\n                const customIPInput = document.getElementById('customIP');\n                const wkRegion = document.getElementById('wkRegion');\n                const wkRegionHint = document.getElementById('wkRegionHint');\n\n                if (customIPInput && wkRegion) {\n                    const hasCustomIP = customIPInput.value.trim() !== '';\n                    wkRegion.disabled = hasCustomIP;\n\n                    // Add visual feedback\n                    if (hasCustomIP) {\n                        wkRegion.style.opacity = '0.5';\n                        wkRegion.style.cursor = 'not-allowed';\n                        wkRegion.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\n                        // Show hint message\n                        if (wkRegionHint) {\n                            wkRegionHint.style.display = 'block';\n                            wkRegionHint.style.color = '#ffaa00';\n                        }\n                    } else {\n                        wkRegion.style.opacity = '1';\n                        wkRegion.style.cursor = 'pointer';\n                        wkRegion.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\n                        // Hide hint message\n                        if (wkRegionHint) {\n                            wkRegionHint.style.display = 'none';\n                        }\n                    }\n                }\n            }\n\n            async function saveConfig(configData) {\n                const apiUrl = window.location.pathname + '/api/config';\n\n                try {\n                    const response = await fetch(apiUrl, {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json' },\n                        body: JSON.stringify(configData)\n                    });\n\n\n                    if (response.status === 503) {\n                        showStatus('KV not configured, cannot save. Please configure KV in Cloudflare Workers.', 'error');\n                        return;\n                    }\n\n                    if (!response.ok) {\n                        const errorText = await response.text();\n\n                        // Try parsing JSON error message\n                        try {\n                            const errorData = JSON.parse(errorText);\n                            showStatus(errorData.message || 'Save failed', 'error');\n                        } catch (parseError) {\n                            // If not JSON, display text directly\n                            showStatus('Save failed: ' + errorText, 'error');\n                        }\n                        return;\n                    }\n\n                    const result = await response.json();\n\n                    showStatus(result.message, result.success ? 'success' : 'error');\n\n                    if (result.success) {\n                        await loadCurrentConfig();\n                        // æ›´æ–°wkåœ°åŒºé€‰æ‹©çŠ¶æ€\n                        updateWkRegionState();\n                        // Reload page after successful save to update system status\n                        setTimeout(function() {\n                            window.location.reload();\n                        }, 1500);\n                    } else {\n                    }\n                } catch (error) {\n                    showStatus('Save failed: ' + error.message, 'error');\n                }\n            }\n\n            function showStatus(message, type) {\n                const statusDiv = document.getElementById('statusMessage');\n                statusDiv.textContent = message;\n                statusDiv.style.display = 'block';\n                statusDiv.style.color = type === 'success' ? '#00ff00' : '#ff0000';\n                statusDiv.style.borderColor = type === 'success' ? '#00ff00' : '#ff0000';\n\n                setTimeout(function() {\n                    statusDiv.style.display = 'none';\n                }, 3000);\n            }\n\n            async function resetAllConfig() {\n                if (confirm('Are you sure to reset all config? This will clear KV config and revert to env vars.')) {\n                    try {\n                        const response = await fetch(window.location.pathname + '/api/config', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json' },\n                            body: JSON.stringify({\n                                wk: '',\n                                d: '',\n                                p: '',\n                                yx: '',\n                                yxURL: '',\n                                s: '', ae: '',\n                                rm: '',\n                                qj: '',\n                                dkby: '',\n                                yxby: '', ev: '', et: '', ex: '', tp: '', scu: '', epd: '', epi: '', egi: '',\n                                ipv4: '', ipv6: '', ispMobile: '', ispUnicom: '', ispTelecom: '',\n                                homepage: ''\n                            })\n                        });\n\n                        if (response.status === 503) {\n                            showStatus('KV not configured, cannot reset.', 'error');\n                            return;\n                        }\n\n                        if (!response.ok) {\n                            const errorText = await response.text();\n\n                            // Try parsing JSON error message\n                            try {\n                                const errorData = JSON.parse(errorText);\n                                showStatus(errorData.message || 'Reset failed', 'error');\n                            } catch (parseError) {\n                                // If not JSON, display text directly\n                                showStatus('Reset failed: ' + errorText, 'error');\n                            }\n                            return;\n                        }\n\n                        const result = await response.json();\n                        showStatus(result.message || 'Config reset', result.success ? 'success' : 'error');\n\n                        if (result.success) {\n                            await loadCurrentConfig();\n                            // æ›´æ–°wkåœ°åŒºé€‰æ‹©çŠ¶æ€\n                            updateWkRegionState();\n                            // Reload page to update system status\n                            setTimeout(function() {\n                                window.location.reload();\n                            }, 1500);\n                        }\n                    } catch (error) {\n                        showStatus('Reset failed: ' + error.message, 'error');\n                    }\n                }\n            }\n\n            async function checkECHStatus() {\n                const echStatusEl = document.getElementById('echStatus');\n\n                if (!echStatusEl) return;\n\n                try {\n                    const currentUrl = window.location.href;\n                    const subscriptionUrl = currentUrl + '/sub';\n\n                    echStatusEl.innerHTML = 'ECH Status: <span style="color: #ffaa00;">Checking...</span>';\n\n                    const response = await fetch(subscriptionUrl, {\n                        method: 'GET',\n                        headers: {\n                            'Accept': 'text/plain'\n                        }\n                    });\n\n                    const echStatusHeader = response.headers.get('X-ECH-Status');\n                    const echConfigLength = response.headers.get('X-ECH-Config-Length');\n\n                    if (echStatusHeader === 'ENABLED') {\n                        echStatusEl.innerHTML = 'ECH Status: <span style="color: #44ff44;">âœ… Enabled' + (echConfigLength ? ' (é…ç½®é•¿åº¦: ' + echConfigLength + ')' : '') + '</span>';\n                    } else {\n                        echStatusEl.innerHTML = 'ECH Status: <span style="color: #ffaa00;">âš ï¸ Disabled</span>';\n                    }\n                } catch (error) {\n                    echStatusEl.innerHTML = 'ECH Status: <span style="color: #ff4444;">âŒ Check Failed: ' + error.message + '</span>';\n                }\n            }\n\n            document.addEventListener('DOMContentLoaded', function() {\n                createMatrixRain();\n                checkSystemStatus();\n                checkKVStatus();\n                checkECHStatus();\n\n                // Automatically enable TLS-only when ECH is enabled\n                const echCheckbox = document.getElementById('ech');\n                const portControl = document.getElementById('portControl');\n                if (echCheckbox && portControl) {\n                    echCheckbox.addEventListener('change', function() {\n                        if (this.checked) {\n                            // When ECH is enabled, automatically set TLS-only to yes\n                            portControl.value = 'yes';\n                        }\n                    });\n\n                    // On page load, if ECH is checked, also automatically set TLS-only\n                    if (echCheckbox.checked) {\n                        portControl.value = 'yes';\n                    }\n                }\n\n                // Listen for customIP input changes, update wk region selection state in real-time\n                const customIPInput = document.getElementById('customIP');\n                if (customIPInput) {\n                    customIPInput.addEventListener('input', function() {\n                        updateWkRegionState();\n                    });\n                }\n\n                // Bind form events\n                const regionForm = document.getElementById('regionForm');\n                if (regionForm) {\n                    regionForm.addEventListener('submit', async function(e) {\n                        e.preventDefault();\n                        const wkRegion = document.getElementById('wkRegion').value;\n                        await saveConfig({ wk: wkRegion });\n                    });\n                }\n\n                const saveProtocolBtn = document.getElementById('saveProtocolBtn');\n                if (saveProtocolBtn) {\n                    saveProtocolBtn.addEventListener('click', async function(e) {\n                        e.preventDefault();\n                        const configData = {\n                            ev: document.getElementById('ev').checked ? 'yes' : 'no',\n                            evm: document.getElementById('evm').checked ? 'yes' : 'no',\n                            ess: document.getElementById('ess').checked ? 'yes' : 'no',\n                            etu: document.getElementById('etu').checked ? 'yes' : 'no',\n                            ehy: document.getElementById('ehy').checked ? 'yes' : 'no',\n                            eg: document.getElementById('eg').checked ? 'yes' : 'no',\n                            et: document.getElementById('et').checked ? 'yes' : 'no',\n                            ex: document.getElementById('ex').checked ? 'yes' : 'no',\n                            ech: document.getElementById('ech').checked ? 'yes' : 'no',\n                            tp: document.getElementById('tp').value,\n                            customDNS: document.getElementById('customDNS').value,\n                            customECHDomain: document.getElementById('customECHDomain').value\n                        };\n\n                        if (!document.getElementById('ev').checked &&\n                            !document.getElementById('evm').checked &&\n                            !document.getElementById('ess').checked &&\n                            !document.getElementById('et').checked &&\n                            !document.getElementById('ex').checked) {\n                            alert('At least one protocol must be enabled!');\n                            return;\n                        }\n\n                        await saveConfig(configData);\n                    });\n                }\n\n                const otherConfigForm = document.getElementById('otherConfigForm');\n                if (otherConfigForm) {\n                    otherConfigForm.addEventListener('submit', async function(e) {\n                        e.preventDefault();\n                        const configData = {\n                            ev: document.getElementById('ev').checked ? 'yes' : 'no',\n                            evm: document.getElementById('evm').checked ? 'yes' : 'no',\n                            ess: document.getElementById('ess').checked ? 'yes' : 'no',\n                            etu: document.getElementById('etu').checked ? 'yes' : 'no',\n                            ehy: document.getElementById('ehy').checked ? 'yes' : 'no',\n                            eg: document.getElementById('eg').checked ? 'yes' : 'no',\n                            et: document.getElementById('et').checked ? 'yes' : 'no',\n                            ex: document.getElementById('ex').checked ? 'yes' : 'no',\n                            ech: document.getElementById('ech').checked ? 'yes' : 'no',\n                            tp: document.getElementById('tp').value,\n                            d: document.getElementById('customPath').value,\n                            p: document.getElementById('customIP').value,\n                            yx: document.getElementById('yx').value,\n                            yxURL: document.getElementById('yxURL').value,\n                            s: document.getElementById('socksConfig').value,\n                            homepage: document.getElementById('customHomepage').value,\n                            customDNS: document.getElementById('customDNS').value,\n                            customECHDomain: document.getElementById('customECHDomain').value\n                        };\n\n                        // Ensure at least one protocol is selected\n                        if (!document.getElementById('ev').checked &&\n                            !document.getElementById('evm').checked &&\n                            !document.getElementById('ess').checked &&\n                            !document.getElementById('et').checked &&\n                            !document.getElementById('ex').checked) {\n                            alert('At least one protocol must be enabled!');\n                            return;\n                        }\n\n                        await saveConfig(configData);\n                    });\n                }\n\n                const advancedConfigForm = document.getElementById('advancedConfigForm');\n                if (advancedConfigForm) {\n                    advancedConfigForm.addEventListener('submit', async function(e) {\n                        e.preventDefault();\n                        const configData = { scu: document.getElementById('scu').value, epd: document.getElementById('epd').checked ? 'yes' : 'no', epi: document.getElementById('epi').checked ? 'yes' : 'no', egi: document.getElementById('egi').checked ? 'yes' : 'no', edp: document.getElementById('enableDiverseProxies').checked ? 'yes' : 'no', ae: document.getElementById('apiEnabled').value,\n                            rm: document.getElementById('regionMatching').value,\n                            qj: document.getElementById('downgradeControl').value,\n                            dkby: document.getElementById('portControl').value,\n                            yxby: document.getElementById('preferredControl').value,\n                            ipv4: document.getElementById('ipv4Enabled').checked ? 'yes' : 'no',\n                            ipv6: document.getElementById('ipv6Enabled').checked ? 'yes' : 'no',\n                            ispMobile: document.getElementById('ispMobile').checked ? 'yes' : 'no',\n                            ispUnicom: document.getElementById('ispUnicom').checked ? 'yes' : 'no',\n                            ispTelecom: document.getElementById('ispTelecom').checked ? 'yes' : 'no'\n                        };\n                        await saveConfig(configData);\n                    });\n                }\n\n                let testAbortController = null;\n                let testResults = [];\n\n                const startTestBtn = document.getElementById('startLatencyTest');\n                const stopTestBtn = document.getElementById('stopLatencyTest');\n                const testStatus = document.getElementById('latencyTestStatus');\n                const testResultsDiv = document.getElementById('latencyTestResults');\n                const resultsList = document.getElementById('latencyResultsList');\n                const overwriteSelectedBtn = document.getElementById('overwriteSelectedToYx');\n                const appendSelectedBtn = document.getElementById('appendSelectedToYx');\n                const selectAllBtn = document.getElementById('selectAllResults');\n                const deselectAllBtn = document.getElementById('deselectAllResults');\n                const ipSourceSelect = document.getElementById('ipSourceSelect');\n                const manualInputDiv = document.getElementById('manualInputDiv');\n                const urlFetchDiv = document.getElementById('urlFetchDiv');\n                const latencyTestInput = document.getElementById('latencyTestInput');\n                const fetchURLInput = document.getElementById('fetchURLInput');\n                const latencyTestPort = document.getElementById('latencyTestPort');\n                const randomIPCount = document.getElementById('randomIPCount');\n                const cfRandomDiv = document.getElementById('cfRandomDiv');\n                const randomCountDiv = document.getElementById('randomCountDiv');\n                const generateCFIPBtn = document.getElementById('generateCFIPBtn');\n                const fetchIPBtn = document.getElementById('fetchIPBtn');\n\n                if (latencyTestInput) {\n                    const savedTestInput = localStorage.getItem('latencyTestInput');\n                    if (savedTestInput) latencyTestInput.value = savedTestInput;\n                    latencyTestInput.addEventListener('input', function() {\n                        localStorage.setItem('latencyTestInput', this.value);\n                    });\n                }\n                if (fetchURLInput) {\n                    const savedFetchURL = localStorage.getItem('fetchURLInput');\n                    if (savedFetchURL) fetchURLInput.value = savedFetchURL;\n                    fetchURLInput.addEventListener('input', function() {\n                        localStorage.setItem('fetchURLInput', this.value);\n                    });\n                }\n                if (latencyTestPort) {\n                    const savedPort = localStorage.getItem('latencyTestPort');\n                    if (savedPort) latencyTestPort.value = savedPort;\n                    latencyTestPort.addEventListener('input', function() {\n                        localStorage.setItem('latencyTestPort', this.value);\n                    });\n                }\n                if (randomIPCount) {\n                    const savedCount = localStorage.getItem('randomIPCount');\n                    if (savedCount) randomIPCount.value = savedCount;\n                    randomIPCount.addEventListener('input', function() {\n                        localStorage.setItem('randomIPCount', this.value);\n                    });\n                    // On init, if hidden by default, disable input box\n                    if (randomCountDiv && randomCountDiv.style.display === 'none') {\n                        randomIPCount.disabled = true;\n                    }\n                }\n                const testThreadsInput = document.getElementById('testThreads');\n                if (testThreadsInput) {\n                    const savedThreads = localStorage.getItem('testThreads');\n                    if (savedThreads) testThreadsInput.value = savedThreads;\n                    testThreadsInput.addEventListener('input', function() {\n                        localStorage.setItem('testThreads', this.value);\n                    });\n                }\n                if (ipSourceSelect) {\n                    const savedSource = localStorage.getItem('ipSourceSelect');\n                    const currentSource = savedSource || ipSourceSelect.value || 'manual';\n                    if (savedSource) {\n                        ipSourceSelect.value = savedSource;\n                    }\n                    manualInputDiv.style.display = currentSource === 'manual' ? 'block' : 'none';\n                    urlFetchDiv.style.display = currentSource === 'urlFetch' ? 'block' : 'none';\n                    cfRandomDiv.style.display = currentSource === 'cfRandom' ? 'block' : 'none';\n                    randomCountDiv.style.display = currentSource === 'cfRandom' ? 'block' : 'none';\n                    // When hidden, disable input box to avoid form validation errors\n                    if (randomIPCount) {\n                        randomIPCount.disabled = currentSource !== 'cfRandom';\n                    }\n                }\n\n                const CF_CIDR_LIST = [\n                    '173.245.48.0/20', '103.21.244.0/22', '103.22.200.0/22', '103.31.4.0/22',\n                    '141.101.64.0/18', '108.162.192.0/18', '190.93.240.0/20', '188.114.96.0/20',\n                    '197.234.240.0/22', '198.41.128.0/17', '162.158.0.0/15', '104.16.0.0/13',\n                    '104.24.0.0/14', '172.64.0.0/13', '131.0.72.0/22'\n                ];\n\n                function generateRandomIPFromCIDR(cidr) {\n                    const [baseIP, prefixLength] = cidr.split('/');\n                    const prefix = parseInt(prefixLength);\n                    const hostBits = 32 - prefix;\n                    const ipParts = baseIP.split('.').map(p => parseInt(p));\n                    const ipInt = (ipParts[0] << 24) | (ipParts[1] << 16) | (ipParts[2] << 8) | ipParts[3];\n                    const randomOffset = Math.floor(Math.random() * Math.pow(2, hostBits));\n                    const mask = (0xFFFFFFFF << hostBits) >>> 0;\n                    const randomIP = (((ipInt & mask) >>> 0) + randomOffset) >>> 0;\n                    return [(randomIP >>> 24) & 0xFF, (randomIP >>> 16) & 0xFF, (randomIP >>> 8) & 0xFF, randomIP & 0xFF].join('.');\n                }\n\n                function generateCFRandomIPs(count, port) {\n                    const ips = [];\n                    for (let i = 0; i < count; i++) {\n                        const cidr = CF_CIDR_LIST[Math.floor(Math.random() * CF_CIDR_LIST.length)];\n                        const ip = generateRandomIPFromCIDR(cidr);\n                        ips.push(ip + ':' + port);\n                    }\n                    return ips;\n                }\n\n                if (ipSourceSelect) {\n                    ipSourceSelect.addEventListener('change', function() {\n                        const value = this.value;\n                        localStorage.setItem('ipSourceSelect', value);\n                        manualInputDiv.style.display = value === 'manual' ? 'block' : 'none';\n                        urlFetchDiv.style.display = value === 'urlFetch' ? 'block' : 'none';\n                        cfRandomDiv.style.display = value === 'cfRandom' ? 'block' : 'none';\n                        randomCountDiv.style.display = value === 'cfRandom' ? 'block' : 'none';\n                        // When hidden, disable input box to avoid form validation errors\n                        if (randomIPCount) {\n                            randomIPCount.disabled = value !== 'cfRandom';\n                        }\n                    });\n                }\n\n                if (generateCFIPBtn) {\n                    generateCFIPBtn.addEventListener('click', function() {\n                        const count = parseInt(document.getElementById('randomIPCount').value) || 20;\n                        const port = document.getElementById('latencyTestPort').value || '443';\n                        const ips = generateCFRandomIPs(count, port);\n                        document.getElementById('latencyTestInput').value = ips.join(',');\n                        manualInputDiv.style.display = 'block';\n                        showStatus('${r?"ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯":"Generated"} ' + count + ' ${r?"IP ØªØµØ§Ø¯ÙÛŒ CF":" CF Random IPs"}', 'success');\n                    });\n                }\n\n                if (fetchIPBtn) {\n                    fetchIPBtn.addEventListener('click', async function() {\n                        const urlInput = document.getElementById('fetchURLInput');\n                        const fetchUrl = urlInput.value.trim();\n                        if (!fetchUrl) {\n                            alert('${r?"Ù„Ø·ÙØ§ URL Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯":"Please enter URL"}');\n                            return;\n                        }\n\n                        fetchIPBtn.disabled = true;\n                        fetchIPBtn.textContent = '${r?"Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...":"Fetching..."}';\n\n                        try {\n                            // Support multiple URLs (comma separated) and multiple IPs/nodes (comma separated) in response\n                            const urlList = Array.from(new Set(\n                                fetchUrl.split(',').map(u => u.trim()).filter(u => u)\n                            ));\n\n                            const allItems = [];\n\n                            for (const u of urlList) {\n                                const response = await fetch(u);\n                                if (!response.ok) {\n                                    throw new Error('HTTP ' + response.status + ' @ ' + u);\n                                }\n                                const text = await response.text();\n\n                                // Split by line first, then by comma in each line, compatible with both 'multi-line' and 'comma-separated' formats\n                                const perUrlItems = text\n                                    .split(/\\r?\\n/)\n                                    .map(l => l.trim())\n                                    .filter(l => l && !l.startsWith('#'))\n                                    .flatMap(l => l.split(',').map(p => p.trim()).filter(p => p));\n\n                                allItems.push(...perUrlItems);\n                            }\n\n                            if (allItems.length > 0) {\n                                document.getElementById('latencyTestInput').value = allItems.join(',');\n                                manualInputDiv.style.display = 'block';\n                                showStatus('${r?"Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯":"Fetched"} ' + allItems.length + ' ${r?"IP":" IPs"}', 'success');\n                            } else {\n                                showStatus('${r?"Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯":"No data found"}', 'error');\n                            }\n                        } catch (err) {\n                            showStatus('${r?"Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª":"Fetch failed"}: ' + err.message, 'error');\n                        } finally {\n                            fetchIPBtn.disabled = false;\n                            fetchIPBtn.textContent = 'â¬‡ ${r?"Ø¯Ø±ÛŒØ§ÙØª IP":"Fetch IP"}';\n                        }\n                    });\n                }\n\n                if (startTestBtn) {\n                    startTestBtn.addEventListener('click', async function() {\n                        const inputField = document.getElementById('latencyTestInput');\n                        const portField = document.getElementById('latencyTestPort');\n                        const threadsField = document.getElementById('testThreads');\n                        const inputValue = inputField.value.trim();\n                        const defaultPort = portField.value || '443';\n                        const threads = parseInt(threadsField.value) || 5;\n\n                        if (!inputValue) {\n                            showStatus('${r?"Ù„Ø·ÙØ§ IP ÛŒØ§ Ø¯Ø§Ù…Ù†Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯":"Please enter IP or Domain"}', 'error');\n                            return;\n                        }\n\n                        const targets = inputValue.split(',').map(t => t.trim()).filter(t => t);\n                        if (targets.length === 0) return;\n\n                        startTestBtn.style.display = 'none';\n                        stopTestBtn.style.display = 'inline-block';\n                        testStatus.style.display = 'block';\n                        testResultsDiv.style.display = 'block';\n                        resultsList.innerHTML = '';\n                        testResults = [];\n                        if (cityFilterContainer) {\n                            cityFilterContainer.style.display = 'none';\n                        }\n\n                        testAbortController = new AbortController();\n\n                        let completed = 0;\n                        const total = targets.length;\n\n                        function parseTarget(target) {\n                            let host = target;\n                            let port = defaultPort;\n                            let nodeName = '';\n\n                            if (target.includes('#')) {\n                                const parts = target.split('#');\n                                nodeName = parts[1] || '';\n                                host = parts[0];\n                            }\n\n                            if (host.includes(':') && !host.startsWith('[')) {\n                                const lastColon = host.lastIndexOf(':');\n                                const possiblePort = host.substring(lastColon + 1);\n                                if (/^[0-9]+$/.test(possiblePort)) {\n                                    port = possiblePort;\n                                    host = host.substring(0, lastColon);\n                                }\n                            } else if (host.includes(']:')) {\n                                const parts = host.split(']:');\n                                host = parts[0] + ']';\n                                port = parts[1];\n                            }\n                            return { host, port, nodeName };\n                        }\n\n                        function renderResult(result, index, shouldShow = true) {\n                            // Only show successful online optimization results, failed/timed out ones are not shown\n                            if (!result.success) {\n                                return null;\n                            }\n\n                            const resultItem = document.createElement('div');\n                            resultItem.style.cssText = 'display: flex; align-items: center; padding: 8px; border-bottom: 1px solid #003300; gap: 10px;';\n                            resultItem.dataset.index = index;\n                            resultItem.dataset.colo = result.colo || '';\n                            if (!shouldShow) {\n                                resultItem.style.display = 'none';\n                            }\n\n                            const checkbox = document.createElement('input');\n                            checkbox.type = 'checkbox';\n                            checkbox.checked = true;\n                            checkbox.disabled = false;\n                            checkbox.dataset.index = index;\n                            checkbox.style.cssText = 'width: 18px; height: 18px; cursor: pointer;';\n\n                            const info = document.createElement('div');\n                            info.style.cssText = 'flex: 1; font-family: monospace; font-size: 13px;';\n\n                            const coloName = result.colo ? getColoName(result.colo) : '';\n                            const coloDisplay = coloName ? ' <span style="color: #00aaff;">[' + coloName + ']</span>' : '';\n                            info.innerHTML = '<span style="color: #00ff00;">' + result.host + ':' + result.port + '</span>' + coloDisplay + ' <span style="color: #ffff00;">' + result.latency + 'ms</span>';\n\n                            resultItem.appendChild(checkbox);\n                            resultItem.appendChild(info);\n                            resultsList.appendChild(resultItem);\n                            return resultItem;\n                        }\n\n                        async function testOne(target) {\n                            if (testAbortController.signal.aborted) return null;\n                            const { host, port, nodeName } = parseTarget(target);\n                            const result = await testLatency(host, port, testAbortController.signal);\n                            result.host = host;\n                            result.port = port;\n                            result.nodeName = (result.success && result.colo) ? (nodeName || ('CF-' + result.colo)) : (nodeName || host);\n                            return result;\n                        }\n\n                        for (let i = 0; i < total; i += threads) {\n                            if (testAbortController.signal.aborted) break;\n\n                            const batch = targets.slice(i, Math.min(i + threads, total));\n                            testStatus.textContent = '${r?"Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª":"Testing"}: ' + (i + 1) + '-' + Math.min(i + threads, total) + '/' + total + ' (${r?"Ø±Ø´ØªÙ‡â€ŒÙ‡Ø§":"çº¿ç¨‹"}: ' + threads + ')';\n\n                            const results = await Promise.all(batch.map(t => testOne(t)));\n\n                            for (const result of results) {\n                                if (result) {\n                                    const idx = testResults.length;\n                                    testResults.push(result);\n                                    renderResult(result, idx);\n                                    completed++;\n                                }\n                            }\n                        }\n\n                        testStatus.textContent = '${r?"ØªØ³Øª Ú©Ø§Ù…Ù„ Ø´Ø¯":"Test Complete"}: ' + completed + '/' + total;\n                        startTestBtn.style.display = 'inline-block';\n                        stopTestBtn.style.display = 'none';\n\n                        // Update city filter\n                        updateCityFilter();\n                    });\n                }\n\n                if (stopTestBtn) {\n                    stopTestBtn.addEventListener('click', function() {\n                        if (testAbortController) {\n                            testAbortController.abort();\n                        }\n                        startTestBtn.style.display = 'inline-block';\n                        stopTestBtn.style.display = 'none';\n                        testStatus.textContent = '${r?"ØªØ³Øª Ù…ØªÙˆÙ‚Ù Ø´Ø¯":"Test Stopped"}';\n                    });\n                }\n\n                if (selectAllBtn) {\n                    selectAllBtn.addEventListener('click', function() {\n                        const checkboxes = resultsList.querySelectorAll('input[type="checkbox"]:not(:disabled)');\n                        checkboxes.forEach(cb => cb.checked = true);\n                    });\n                }\n\n                if (deselectAllBtn) {\n                    deselectAllBtn.addEventListener('click', function() {\n                        const checkboxes = resultsList.querySelectorAll('input[type="checkbox"]');\n                        checkboxes.forEach(cb => cb.checked = false);\n                    });\n                }\n\n                // Generic function to get selected items\n                function getSelectedItems() {\n                    const checkboxes = resultsList.querySelectorAll('input[type="checkbox"]:checked');\n                    if (checkboxes.length === 0) {\n                        showStatus('${r?"Ù„Ø·ÙØ§ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯":"Please select at least one item"}', 'error');\n                        return null;\n                    }\n\n                    const selectedItems = [];\n                    checkboxes.forEach(cb => {\n                        const idx = parseInt(cb.dataset.index);\n                        const result = testResults[idx];\n                        if (result && result.success) {\n                            const coloName = result.colo ? getColoName(result.colo) : result.nodeName;\n                            const itemStr = result.host + ':' + result.port + '#' + coloName;\n                            selectedItems.push(itemStr);\n                        }\n                    });\n\n                    return selectedItems;\n                }\n\n                // Overwrite add\n                if (overwriteSelectedBtn) {\n                    overwriteSelectedBtn.addEventListener('click', async function() {\n                        const selectedItems = getSelectedItems();\n                        if (!selectedItems || selectedItems.length === 0) return;\n\n                        const yxInput = document.getElementById('yx');\n                        const newValue = selectedItems.join(',');\n                        yxInput.value = newValue;\n\n                        overwriteSelectedBtn.disabled = true;\n                        appendSelectedBtn.disabled = true;\n                        overwriteSelectedBtn.textContent = '${r?"Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...":"Saving..."}';\n\n                        try {\n                            const configData = {\n                                p: document.getElementById('customIP').value,\n                                yx: newValue,\n                                yxURL: document.getElementById('yxURL').value,\n                                s: document.getElementById('socksConfig').value\n                            };\n                            await saveConfig(configData);\n                            showStatus('${r?"Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯":"Overwritten"} ' + selectedItems.length + ' ${r?"Ù…ÙˆØ±Ø¯ Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯":" items saved"}', 'success');\n                        } catch (err) {\n                            showStatus('${r?"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡":"Save failed"}: ' + err.message, 'error');\n                        } finally {\n                            overwriteSelectedBtn.disabled = false;\n                            appendSelectedBtn.disabled = false;\n                            overwriteSelectedBtn.textContent = '${r?"è¦†ç›–æ·»åŠ ":"Overwrite Add"}';\n                        }\n                    });\n                }\n\n                // Append add\n                if (appendSelectedBtn) {\n                    appendSelectedBtn.addEventListener('click', async function() {\n                        const selectedItems = getSelectedItems();\n                        if (!selectedItems || selectedItems.length === 0) return;\n\n                        const yxInput = document.getElementById('yx');\n                        const currentValue = yxInput.value.trim();\n                        const newItems = selectedItems.join(',');\n                        const newValue = currentValue ? (currentValue + ',' + newItems) : newItems;\n                        yxInput.value = newValue;\n\n                        overwriteSelectedBtn.disabled = true;\n                        appendSelectedBtn.disabled = true;\n                        appendSelectedBtn.textContent = '${r?"Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...":"Saving..."}';\n\n                        try {\n                            const configData = {\n                                p: document.getElementById('customIP').value,\n                                yx: newValue,\n                                yxURL: document.getElementById('yxURL').value,\n                                s: document.getElementById('socksConfig').value\n                            };\n                            await saveConfig(configData);\n                            showStatus('${r?"Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯":"Appended"} ' + selectedItems.length + ' ${r?"Ù…ÙˆØ±Ø¯ Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯":" items saved"}', 'success');\n                        } catch (err) {\n                            showStatus('${r?"Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡":"Save failed"}: ' + err.message, 'error');\n                        } finally {\n                            overwriteSelectedBtn.disabled = false;\n                            appendSelectedBtn.disabled = false;\n                            appendSelectedBtn.textContent = '${r?"è¿½åŠ æ·»åŠ ":"Append Add"}';\n                        }\n                    });\n                }\n\n                function ipToHex(ip) {\n                    const parts = ip.split('.');\n                    if (parts.length !== 4) return null;\n                    let hex = '';\n                    for (let i = 0; i < 4; i++) {\n                        const num = parseInt(parts[i]);\n                        if (isNaN(num) || num < 0 || num > 255) return null;\n                        hex += num.toString(16).padStart(2, '0');\n                    }\n                    return hex;\n                }\n\n                const coloMap = {\n                    'SJC': 'ğŸ‡ºğŸ‡¸ åœ£ä½•å¡', 'LAX': 'ğŸ‡ºğŸ‡¸ æ´›æ‰çŸ¶', 'SEA': 'ğŸ‡ºğŸ‡¸ è¥¿é›…å›¾', 'SFO': 'ğŸ‡ºğŸ‡¸ æ—§é‡‘å±±', 'DFW': 'ğŸ‡ºğŸ‡¸ è¾¾æ‹‰æ–¯',\n                    'ORD': 'ğŸ‡ºğŸ‡¸ èŠåŠ å“¥', 'IAD': 'ğŸ‡ºğŸ‡¸ åç››é¡¿', 'ATL': 'ğŸ‡ºğŸ‡¸ äºšç‰¹å…°å¤§', 'MIA': 'ğŸ‡ºğŸ‡¸ è¿ˆé˜¿å¯†', 'DEN': 'ğŸ‡ºğŸ‡¸ ä¸¹ä½›',\n                    'PHX': 'ğŸ‡ºğŸ‡¸ å‡¤å‡°åŸ', 'BOS': 'ğŸ‡ºğŸ‡¸ æ³¢å£«é¡¿', 'EWR': 'ğŸ‡ºğŸ‡¸ çº½ç“¦å…‹', 'JFK': 'ğŸ‡ºğŸ‡¸ çº½çº¦', 'LAS': 'ğŸ‡ºğŸ‡¸ æ‹‰æ–¯ç»´åŠ æ–¯',\n                    'MSP': 'ğŸ‡ºğŸ‡¸ æ˜å°¼é˜¿æ³¢åˆ©æ–¯', 'DTW': 'ğŸ‡ºğŸ‡¸ åº•ç‰¹å¾‹', 'PHL': 'ğŸ‡ºğŸ‡¸ è´¹åŸ', 'CLT': 'ğŸ‡ºğŸ‡¸ å¤æ´›ç‰¹', 'SLC': 'ğŸ‡ºğŸ‡¸ ç›æ¹–åŸ',\n                    'PDX': 'ğŸ‡ºğŸ‡¸ æ³¢ç‰¹å…°', 'SAN': 'ğŸ‡ºğŸ‡¸ åœ£åœ°äºšå“¥', 'TPA': 'ğŸ‡ºğŸ‡¸ å¦å¸•', 'IAH': 'ğŸ‡ºğŸ‡¸ ä¼‘æ–¯é¡¿', 'MCO': 'ğŸ‡ºğŸ‡¸ å¥¥å…°å¤š',\n                    'AUS': 'ğŸ‡ºğŸ‡¸ å¥¥æ–¯æ±€', 'BNA': 'ğŸ‡ºğŸ‡¸ çº³ä»€ç»´å°”', 'RDU': 'ğŸ‡ºğŸ‡¸ ç½—åˆ©', 'IND': 'ğŸ‡ºğŸ‡¸ å°ç¬¬å®‰çº³æ³¢åˆ©æ–¯', 'CMH': 'ğŸ‡ºğŸ‡¸ å“¥ä¼¦å¸ƒ',\n                    'MCI': 'ğŸ‡ºğŸ‡¸ å ªè¨æ–¯åŸ', 'OMA': 'ğŸ‡ºğŸ‡¸ å¥¥é©¬å“ˆ', 'ABQ': 'ğŸ‡ºğŸ‡¸ é˜¿å°”ä¼¯å…‹åŸº', 'OKC': 'ğŸ‡ºğŸ‡¸ ä¿„å…‹æ‹‰è·é©¬åŸ', 'MEM': 'ğŸ‡ºğŸ‡¸ å­Ÿè²æ–¯',\n                    'JAX': 'ğŸ‡ºğŸ‡¸ æ°å…‹é€Šç»´å°”', 'RIC': 'ğŸ‡ºğŸ‡¸ é‡Œå£«æ»¡', 'BUF': 'ğŸ‡ºğŸ‡¸ å¸ƒæ³•ç½—', 'PIT': 'ğŸ‡ºğŸ‡¸ åŒ¹å…¹å ¡', 'CLE': 'ğŸ‡ºğŸ‡¸ å…‹åˆ©å¤«å…°',\n                    'CVG': 'ğŸ‡ºğŸ‡¸ è¾›è¾›é‚£æ', 'MKE': 'ğŸ‡ºğŸ‡¸ å¯†å°”æ²ƒåŸº', 'STL': 'ğŸ‡ºğŸ‡¸ åœ£è·¯æ˜“æ–¯', 'SAT': 'ğŸ‡ºğŸ‡¸ åœ£å®‰ä¸œå°¼å¥¥', 'HNL': 'ğŸ‡ºğŸ‡¸ æª€é¦™å±±',\n                    'ANC': 'ğŸ‡ºğŸ‡¸ å®‰å…‹é›·å¥‡', 'SMF': 'ğŸ‡ºğŸ‡¸ è¨å…‹æ‹‰é—¨æ‰˜', 'ONT': 'ğŸ‡ºğŸ‡¸ å®‰å¤§ç•¥', 'OAK': 'ğŸ‡ºğŸ‡¸ å¥¥å…‹å…°',\n                    'HKG': 'ğŸ‡­ğŸ‡° é¦™æ¸¯', 'TPE': 'ğŸ‡¹ğŸ‡¼ å°åŒ—', 'TSA': 'ğŸ‡¹ğŸ‡¼ å°åŒ—æ¾å±±', 'KHH': 'ğŸ‡¹ğŸ‡¼ é«˜é›„',\n                    'NRT': 'ğŸ‡¯ğŸ‡µ ä¸œäº¬æˆç”°', 'HND': 'ğŸ‡¯ğŸ‡µ ä¸œäº¬ç¾½ç”°', 'KIX': 'ğŸ‡¯ğŸ‡µ å¤§é˜ªå…³è¥¿', 'ITM': 'ğŸ‡¯ğŸ‡µ å¤§é˜ªä¼Šä¸¹', 'NGO': 'ğŸ‡¯ğŸ‡µ åå¤å±‹',\n                    'FUK': 'ğŸ‡¯ğŸ‡µ ç¦å†ˆ', 'CTS': 'ğŸ‡¯ğŸ‡µ æœ­å¹Œ', 'OKA': 'ğŸ‡¯ğŸ‡µ å†²ç»³',\n                    'ICN': 'ğŸ‡°ğŸ‡· é¦–å°”ä»å·', 'GMP': 'ğŸ‡°ğŸ‡· é¦–å°”é‡‘æµ¦', 'PUS': 'ğŸ‡°ğŸ‡· é‡œå±±',\n                    'SIN': 'ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡', 'BKK': 'ğŸ‡¹ğŸ‡­ æ›¼è°·', 'DMK': 'ğŸ‡¹ğŸ‡­ æ›¼è°·å»Šæ›¼', 'KUL': 'ğŸ‡²ğŸ‡¾ å‰éš†å¡', 'CGK': 'ğŸ‡®ğŸ‡© é›…åŠ è¾¾',\n                    'MNL': 'ğŸ‡µğŸ‡­ é©¬å°¼æ‹‰', 'CEB': 'ğŸ‡µğŸ‡­ å®¿åŠ¡', 'HAN': 'ğŸ‡»ğŸ‡³ æ²³å†…', 'SGN': 'ğŸ‡»ğŸ‡³ èƒ¡å¿—æ˜', 'DAD': 'ğŸ‡»ğŸ‡³ å²˜æ¸¯',\n                    'RGN': 'ğŸ‡²ğŸ‡² ä»°å…‰', 'PNH': 'ğŸ‡°ğŸ‡­ é‡‘è¾¹', 'REP': 'ğŸ‡°ğŸ‡­ æš¹ç²’', 'VTE': 'ğŸ‡±ğŸ‡¦ ä¸‡è±¡',\n                    'BOM': 'ğŸ‡®ğŸ‡³ å­Ÿä¹°', 'DEL': 'ğŸ‡®ğŸ‡³ æ–°å¾·é‡Œ', 'MAA': 'ğŸ‡®ğŸ‡³ é‡‘å¥ˆ', 'BLR': 'ğŸ‡®ğŸ‡³ ç­åŠ ç½—å°”', 'CCU': 'ğŸ‡®ğŸ‡³ åŠ å°”å„ç­”',\n                    'HYD': 'ğŸ‡®ğŸ‡³ æµ·å¾—æ‹‰å·´', 'AMD': 'ğŸ‡®ğŸ‡³ è‰¾å“ˆè¿ˆè¾¾å·´å¾·', 'COK': 'ğŸ‡®ğŸ‡³ ç§‘é’¦', 'PNQ': 'ğŸ‡®ğŸ‡³ æµ¦é‚£', 'GOI': 'ğŸ‡®ğŸ‡³ æœé˜¿',\n                    'CMB': 'ğŸ‡±ğŸ‡° ç§‘ä¼¦å¡', 'DAC': 'ğŸ‡§ğŸ‡© è¾¾å¡', 'KTM': 'ğŸ‡³ğŸ‡µ åŠ å¾·æ»¡éƒ½', 'ISB': 'ğŸ‡µğŸ‡° ä¼Šæ–¯å…°å ¡', 'KHI': 'ğŸ‡µğŸ‡° å¡æ‹‰å¥‡', 'LHE': 'ğŸ‡µğŸ‡° æ‹‰åˆå°”',\n                    'LHR': 'ğŸ‡¬ğŸ‡§ ä¼¦æ•¦å¸Œæ€ç½—', 'LGW': 'ğŸ‡¬ğŸ‡§ ä¼¦æ•¦ç›–ç‰¹å¨å…‹', 'STN': 'ğŸ‡¬ğŸ‡§ ä¼¦æ•¦æ–¯å¦æ–¯ç‰¹å¾·', 'LTN': 'ğŸ‡¬ğŸ‡§ ä¼¦æ•¦å¢é¡¿', 'MAN': 'ğŸ‡¬ğŸ‡§ æ›¼å½»æ–¯ç‰¹', 'EDI': 'ğŸ‡¬ğŸ‡§ çˆ±ä¸å ¡', 'BHX': 'ğŸ‡¬ğŸ‡§ ä¼¯æ˜ç¿°',\n                    'CDG': 'ğŸ‡«ğŸ‡· å·´é»æˆ´é«˜ä¹', 'ORY': 'ğŸ‡«ğŸ‡· å·´é»å¥¥åˆ©', 'MRS': 'ğŸ‡«ğŸ‡· é©¬èµ›', 'LYS': 'ğŸ‡«ğŸ‡· é‡Œæ˜‚', 'NCE': 'ğŸ‡«ğŸ‡· å°¼æ–¯',\n                    'FRA': 'ğŸ‡©ğŸ‡ª æ³•å…°å…‹ç¦', 'MUC': 'ğŸ‡©ğŸ‡ª æ…•å°¼é»‘', 'TXL': 'ğŸ‡©ğŸ‡ª æŸæ—', 'BER': 'ğŸ‡©ğŸ‡ª æŸæ—å‹ƒå…°ç™»å ¡', 'HAM': 'ğŸ‡©ğŸ‡ª æ±‰å ¡', 'DUS': 'ğŸ‡©ğŸ‡ª æœå¡å°”å¤šå¤«', 'CGN': 'ğŸ‡©ğŸ‡ª ç§‘éš†', 'STR': 'ğŸ‡©ğŸ‡ª æ–¯å›¾åŠ ç‰¹',\n                    'AMS': 'ğŸ‡³ğŸ‡± é˜¿å§†æ–¯ç‰¹ä¸¹', 'BRU': 'ğŸ‡§ğŸ‡ª å¸ƒé²å¡å°”', 'LUX': 'ğŸ‡±ğŸ‡º å¢æ£®å ¡',\n                    'ZRH': 'ğŸ‡¨ğŸ‡­ è‹é»ä¸–', 'GVA': 'ğŸ‡¨ğŸ‡­ æ—¥å†…ç“¦', 'BSL': 'ğŸ‡¨ğŸ‡­ å·´å¡å°”',\n                    'VIE': 'ğŸ‡¦ğŸ‡¹ ç»´ä¹Ÿçº³', 'PRG': 'ğŸ‡¨ğŸ‡¿ å¸ƒæ‹‰æ ¼', 'BUD': 'ğŸ‡­ğŸ‡º å¸ƒè¾¾ä½©æ–¯', 'WAW': 'ğŸ‡µğŸ‡± åæ²™', 'KRK': 'ğŸ‡µğŸ‡± å…‹æ‹‰ç§‘å¤«',\n                    'MXP': 'ğŸ‡®ğŸ‡¹ ç±³å…°é©¬å°”å½­è¨', 'LIN': 'ğŸ‡®ğŸ‡¹ ç±³å…°åˆ©çº³ç‰¹', 'FCO': 'ğŸ‡®ğŸ‡¹ ç½—é©¬', 'VCE': 'ğŸ‡®ğŸ‡¹ å¨å°¼æ–¯', 'NAP': 'ğŸ‡®ğŸ‡¹ é‚£ä¸å‹’æ–¯', 'FLR': 'ğŸ‡®ğŸ‡¹ ä½›ç½—ä¼¦è¨', 'BGY': 'ğŸ‡®ğŸ‡¹ è´åŠ è«',\n                    'MAD': 'ğŸ‡ªğŸ‡¸ é©¬å¾·é‡Œ', 'BCN': 'ğŸ‡ªğŸ‡¸ å·´å¡ç½—é‚£', 'PMI': 'ğŸ‡ªğŸ‡¸ å¸•å°”é©¬', 'AGP': 'ğŸ‡ªğŸ‡¸ é©¬æ‹‰åŠ ', 'VLC': 'ğŸ‡ªğŸ‡¸ ç“¦ä¼¦è¥¿äºš', 'SVQ': 'ğŸ‡ªğŸ‡¸ å¡ç»´åˆ©äºš', 'BIO': 'ğŸ‡ªğŸ‡¸ æ¯•å°”å·´é„‚',\n                    'LIS': 'ğŸ‡µğŸ‡¹ é‡Œæ–¯æœ¬', 'OPO': 'ğŸ‡µğŸ‡¹ æ³¢å°”å›¾', 'FAO': 'ğŸ‡µğŸ‡¹ æ³•é²',\n                    'DUB': 'ğŸ‡®ğŸ‡ª éƒ½æŸæ—', 'CPH': 'ğŸ‡©ğŸ‡° å“¥æœ¬å“ˆæ ¹', 'ARN': 'ğŸ‡¸ğŸ‡ª æ–¯å¾·å“¥å°”æ‘©', 'GOT': 'ğŸ‡¸ğŸ‡ª å“¥å¾·å ¡',\n                    'OSL': 'ğŸ‡³ğŸ‡´ å¥¥æ–¯é™†', 'BGO': 'ğŸ‡³ğŸ‡´ å‘å°”æ ¹', 'HEL': 'ğŸ‡«ğŸ‡® èµ«å°”è¾›åŸº', 'RIX': 'ğŸ‡±ğŸ‡» é‡ŒåŠ ', 'TLL': 'ğŸ‡ªğŸ‡ª å¡”æ—', 'VNO': 'ğŸ‡±ğŸ‡¹ ç»´å°”çº½æ–¯',\n                    'ATH': 'ğŸ‡¬ğŸ‡· é›…å…¸', 'SKG': 'ğŸ‡¬ğŸ‡· å¡è¨æ´›å°¼åŸº', 'SOF': 'ğŸ‡§ğŸ‡¬ ç´¢éäºš', 'OTP': 'ğŸ‡·ğŸ‡´ å¸ƒåŠ å‹’æ–¯ç‰¹', 'BEG': 'ğŸ‡·ğŸ‡¸ è´å°”æ ¼è±å¾·', 'ZAG': 'ğŸ‡­ğŸ‡· è¨æ ¼å‹’å¸ƒ', 'LJU': 'ğŸ‡¸ğŸ‡® å¢å¸ƒå°”é›…é‚£',\n                    'KBP': 'ğŸ‡ºğŸ‡¦ åŸºè¾…', 'IEV': 'ğŸ‡ºğŸ‡¦ åŸºè¾…èŒ¹è‰¯å°¼', 'ODS': 'ğŸ‡ºğŸ‡¦ æ•–å¾·è¨',\n                    'SVO': 'ğŸ‡·ğŸ‡º è«æ–¯ç§‘è°¢åˆ—æ¢…æ·æ²ƒ', 'DME': 'ğŸ‡·ğŸ‡º è«æ–¯ç§‘å¤šè«æ°å¤šæ²ƒ', 'VKO': 'ğŸ‡·ğŸ‡º è«æ–¯ç§‘ä¼åŠªç§‘æ²ƒ', 'LED': 'ğŸ‡·ğŸ‡º åœ£å½¼å¾—å ¡',\n                    'IST': 'ğŸ‡¹ğŸ‡· ä¼Šæ–¯å¦å¸ƒå°”', 'SAW': 'ğŸ‡¹ğŸ‡· ä¼Šæ–¯å¦å¸ƒå°”è¨æ¯”å“ˆ', 'ESB': 'ğŸ‡¹ğŸ‡· å®‰å¡æ‹‰', 'AYT': 'ğŸ‡¹ğŸ‡· å®‰å¡”åˆ©äºš', 'ADB': 'ğŸ‡¹ğŸ‡· ä¼Šå…¹å¯†å°”',\n                    'TLV': 'ğŸ‡®ğŸ‡± ç‰¹æ‹‰ç»´å¤«', 'AMM': 'ğŸ‡¯ğŸ‡´ å®‰æ›¼', 'BEY': 'ğŸ‡±ğŸ‡§ è´é²ç‰¹', 'BAH': 'ğŸ‡§ğŸ‡­ å·´æ—', 'KWI': 'ğŸ‡°ğŸ‡¼ ç§‘å¨ç‰¹',\n                    'DXB': 'ğŸ‡¦ğŸ‡ª è¿ªæ‹œ', 'AUH': 'ğŸ‡¦ğŸ‡ª é˜¿å¸ƒæ‰æ¯”', 'SHJ': 'ğŸ‡¦ğŸ‡ª æ²™è¿¦', 'DOH': 'ğŸ‡¶ğŸ‡¦ å¤šå“ˆ', 'MCT': 'ğŸ‡´ğŸ‡² é©¬æ–¯å–€ç‰¹',\n                    'RUH': 'ğŸ‡¸ğŸ‡¦ åˆ©é›…å¾—', 'JED': 'ğŸ‡¸ğŸ‡¦ å‰è¾¾', 'DMM': 'ğŸ‡¸ğŸ‡¦ è¾¾æ›¼',\n                    'CAI': 'ğŸ‡ªğŸ‡¬ å¼€ç½—', 'HBE': 'ğŸ‡ªğŸ‡¬ äºšå†å±±å¤§', 'SSH': 'ğŸ‡ªğŸ‡¬ æ²™å§†æ²™ä¼Šèµ«',\n                    'CMN': 'ğŸ‡²ğŸ‡¦ å¡è¨å¸ƒå…°å¡', 'RAK': 'ğŸ‡²ğŸ‡¦ é©¬æ‹‰å–€ä»€', 'TUN': 'ğŸ‡¹ğŸ‡³ çªå°¼æ–¯', 'ALG': 'ğŸ‡©ğŸ‡¿ é˜¿å°”åŠå°”',\n                    'LOS': 'ğŸ‡³ğŸ‡¬ æ‹‰å„æ–¯', 'ABV': 'ğŸ‡³ğŸ‡¬ é˜¿å¸ƒè´¾', 'ACC': 'ğŸ‡¬ğŸ‡­ é˜¿å…‹æ‹‰', 'NBO': 'ğŸ‡°ğŸ‡ª å†…ç½—æ¯•', 'MBA': 'ğŸ‡°ğŸ‡ª è’™å·´è¨', 'ADD': 'ğŸ‡ªğŸ‡¹ äºšçš„æ–¯äºšè´å·´', 'DAR': 'ğŸ‡¹ğŸ‡¿ è¾¾ç´¯æ–¯è¨æ‹‰å§†',\n                    'JNB': 'ğŸ‡¿ğŸ‡¦ çº¦ç¿°å†…æ–¯å ¡', 'CPT': 'ğŸ‡¿ğŸ‡¦ å¼€æ™®æ•¦', 'DUR': 'ğŸ‡¿ğŸ‡¦ å¾·ç­', 'HRE': 'ğŸ‡¿ğŸ‡¼ å“ˆæ‹‰é›·', 'LUN': 'ğŸ‡¿ğŸ‡² å¢è¨å¡',\n                    'MRU': 'ğŸ‡²ğŸ‡º æ¯›é‡Œæ±‚æ–¯', 'SEZ': 'ğŸ‡¸ğŸ‡¨ å¡èˆŒå°”',\n                    'SYD': 'ğŸ‡¦ğŸ‡º æ‚‰å°¼', 'MEL': 'ğŸ‡¦ğŸ‡º å¢¨å°”æœ¬', 'BNE': 'ğŸ‡¦ğŸ‡º å¸ƒé‡Œæ–¯ç­', 'PER': 'ğŸ‡¦ğŸ‡º ç€æ–¯', 'ADL': 'ğŸ‡¦ğŸ‡º é˜¿å¾·è±å¾·', 'CBR': 'ğŸ‡¦ğŸ‡º å ªåŸ¹æ‹‰', 'OOL': 'ğŸ‡¦ğŸ‡º é»„é‡‘æµ·å²¸', 'CNS': 'ğŸ‡¦ğŸ‡º å‡¯æ©æ–¯',\n                    'AKL': 'ğŸ‡³ğŸ‡¿ å¥¥å…‹å…°', 'WLG': 'ğŸ‡³ğŸ‡¿ æƒ çµé¡¿', 'CHC': 'ğŸ‡³ğŸ‡¿ åŸºç£åŸ', 'ZQN': 'ğŸ‡³ğŸ‡¿ çš‡åé•‡',\n                    'NAN': 'ğŸ‡«ğŸ‡¯ æ¥ è¿ª', 'PPT': 'ğŸ‡µğŸ‡« å¸•çš®æ', 'GUM': 'ğŸ‡¬ğŸ‡º å…³å²›',\n                    'GRU': 'ğŸ‡§ğŸ‡· åœ£ä¿ç½—ç“œé²æŸ³æ–¯', 'CGH': 'ğŸ‡§ğŸ‡· åœ£ä¿ç½—å­”æˆˆå°¼äºšæ–¯', 'GIG': 'ğŸ‡§ğŸ‡· é‡Œçº¦çƒ­å†…å¢', 'BSB': 'ğŸ‡§ğŸ‡· å·´è¥¿åˆ©äºš', 'CNF': 'ğŸ‡§ğŸ‡· è´æ´›å¥¥é‡Œè—ç‰¹', 'POA': 'ğŸ‡§ğŸ‡· é˜¿é›·æ ¼é‡Œæ¸¯', 'CWB': 'ğŸ‡§ğŸ‡· åº“é‡Œè’‚å·´', 'FOR': 'ğŸ‡§ğŸ‡· ç¦å¡”è±è¨', 'REC': 'ğŸ‡§ğŸ‡· ç´¯è¥¿è…“', 'SSA': 'ğŸ‡§ğŸ‡· è¨å°”ç“¦å¤š',\n                    'EZE': 'ğŸ‡¦ğŸ‡· å¸ƒå®œè¯ºæ–¯è‰¾åˆ©æ–¯', 'AEP': 'ğŸ‡¦ğŸ‡· å¸ƒå®œè¯ºæ–¯è‰¾åˆ©æ–¯åŸ', 'COR': 'ğŸ‡¦ğŸ‡· ç§‘å°”å¤šç“¦', 'MDZ': 'ğŸ‡¦ğŸ‡· é—¨å¤šè¨',\n                    'SCL': 'ğŸ‡¨ğŸ‡± åœ£åœ°äºšå“¥', 'LIM': 'ğŸ‡µğŸ‡ª åˆ©é©¬', 'BOG': 'ğŸ‡¨ğŸ‡´ æ³¢å“¥å¤§', 'MDE': 'ğŸ‡¨ğŸ‡´ éº¦å¾·æ—', 'CLO': 'ğŸ‡¨ğŸ‡´ å¡åˆ©',\n                    'UIO': 'ğŸ‡ªğŸ‡¨ åŸºå¤š', 'GYE': 'ğŸ‡ªğŸ‡¨ ç“œäºšåŸºå°”', 'CCS': 'ğŸ‡»ğŸ‡ª åŠ æ‹‰åŠ æ–¯', 'MVD': 'ğŸ‡ºğŸ‡¾ è’™å¾—ç»´çš„äºš', 'ASU': 'ğŸ‡µğŸ‡¾ äºšæ¾æ£®',\n                    'PTY': 'ğŸ‡µğŸ‡¦ å·´æ‹¿é©¬åŸ', 'SJO': 'ğŸ‡¨ğŸ‡· åœ£ä½•å¡', 'GUA': 'ğŸ‡¬ğŸ‡¹ å±åœ°é©¬æ‹‰åŸ', 'SAL': 'ğŸ‡¸ğŸ‡» åœ£è¨å°”ç“¦å¤š', 'TGU': 'ğŸ‡­ğŸ‡³ ç‰¹å¤è¥¿åŠ å°”å·´', 'MGA': 'ğŸ‡³ğŸ‡® é©¬é‚£ç“œ', 'BZE': 'ğŸ‡§ğŸ‡¿ ä¼¯åˆ©å…¹åŸ',\n                    'MEX': 'ğŸ‡²ğŸ‡½ å¢¨è¥¿å“¥åŸ', 'GDL': 'ğŸ‡²ğŸ‡½ ç“œè¾¾æ‹‰å“ˆæ‹‰', 'MTY': 'ğŸ‡²ğŸ‡½ è’™ç‰¹é›·', 'CUN': 'ğŸ‡²ğŸ‡½ åæ˜†', 'TIJ': 'ğŸ‡²ğŸ‡½ è’‚åçº³', 'SJD': 'ğŸ‡²ğŸ‡½ åœ£ä½•å¡å¾·å°”å¡æ²ƒ',\n                    'YYZ': 'ğŸ‡¨ğŸ‡¦ å¤šä¼¦å¤š', 'YVR': 'ğŸ‡¨ğŸ‡¦ æ¸©å“¥å', 'YUL': 'ğŸ‡¨ğŸ‡¦ è’™ç‰¹åˆ©å°”', 'YYC': 'ğŸ‡¨ğŸ‡¦ å¡å°”åŠ é‡Œ', 'YEG': 'ğŸ‡¨ğŸ‡¦ åŸƒå¾·è’™é¡¿', 'YOW': 'ğŸ‡¨ğŸ‡¦ æ¸¥å¤ªå', 'YWG': 'ğŸ‡¨ğŸ‡¦ æ¸©å°¼ä¼¯', 'YHZ': 'ğŸ‡¨ğŸ‡¦ å“ˆåˆ©æ³•å…‹æ–¯',\n                    'HAV': 'ğŸ‡¨ğŸ‡º å“ˆç“¦é‚£', 'SJU': 'ğŸ‡µğŸ‡· åœ£èƒ¡å®‰', 'SDQ': 'ğŸ‡©ğŸ‡´ åœ£å¤šæ˜å„', 'PAP': 'ğŸ‡­ğŸ‡¹ å¤ªå­æ¸¯', 'KIN': 'ğŸ‡¯ğŸ‡² é‡‘æ–¯é¡¿', 'NAS': 'ğŸ‡§ğŸ‡¸ æ‹¿éªš', 'MBJ': 'ğŸ‡¯ğŸ‡² è’™ç‰¹å“¥è´'\n                };\n\n                function getColoName(colo) {\n                    return coloMap[colo] || colo;\n                }\n\n                // City filtering related functions\n                const cityFilterContainer = document.getElementById('cityFilterContainer');\n                const cityCheckboxesContainer = document.getElementById('cityCheckboxesContainer');\n\n                function updateCityFilter() {\n                    if (!cityFilterContainer || !cityCheckboxesContainer) return;\n\n                    // Extract all available cities from test results\n                    const cityMap = new Map();\n                    testResults.forEach((result, index) => {\n                        if (result.success && result.colo) {\n                            const colo = result.colo;\n                            if (!cityMap.has(colo)) {\n                                cityMap.set(colo, {\n                                    colo: colo,\n                                    name: getColoName(colo),\n                                    count: 0\n                                });\n                            }\n                            cityMap.get(colo).count++;\n                        }\n                    });\n\n                    if (cityMap.size === 0) {\n                        cityFilterContainer.style.display = 'none';\n                        return;\n                    }\n\n                    cityFilterContainer.style.display = 'block';\n                    cityCheckboxesContainer.innerHTML = '';\n\n                    // Sort by city name\n                    const cities = Array.from(cityMap.values()).sort((a, b) => a.name.localeCompare(b.name));\n\n                    cities.forEach(city => {\n                        const label = document.createElement('label');\n                        label.style.cssText = 'display: inline-flex; align-items: center; cursor: pointer; color: #00ff00; font-size: 0.85rem; padding: 4px 8px; background: rgba(0, 40, 0, 0.4); border: 1px solid #00aa00; border-radius: 4px;';\n\n                        const checkbox = document.createElement('input');\n                        checkbox.type = 'checkbox';\n                        checkbox.value = city.colo;\n                        checkbox.checked = true;\n                        checkbox.dataset.colo = city.colo;\n                        checkbox.style.cssText = 'margin-right: 6px; width: 16px; height: 16px; cursor: pointer;';\n\n                        const span = document.createElement('span');\n                        span.textContent = city.name + ' (' + city.count + ')';\n\n                        label.appendChild(checkbox);\n                        label.appendChild(span);\n                        cityCheckboxesContainer.appendChild(label);\n\n                        checkbox.addEventListener('change', filterResultsByCity);\n                    });\n\n                    // Listen for filter mode changes\n                    const filterModeRadios = document.querySelectorAll('input[name="cityFilterMode"]');\n                    filterModeRadios.forEach(radio => {\n                        radio.addEventListener('change', function() {\n                            if (this.value === 'all') {\n                                // When switching to 'All Cities' mode, automatically check all city checkboxes\n                                const cityCheckboxes = cityCheckboxesContainer.querySelectorAll('input[type="checkbox"]');\n                                cityCheckboxes.forEach(cb => {\n                                    cb.checked = true;\n                                    cb.disabled = false;\n                                });\n                            }\n                            filterResultsByCity();\n                        });\n                    });\n                }\n\n                function filterResultsByCity() {\n                    if (!resultsList || !cityCheckboxesContainer) return;\n\n                    const filterMode = document.querySelector('input[name="cityFilterMode"]:checked')?.value || 'all';\n                    const resultItems = resultsList.querySelectorAll('[data-index]');\n                    const cityCheckboxes = cityCheckboxesContainer.querySelectorAll('input[type="checkbox"]');\n\n                    if (filterMode === 'fastest10') {\n                        // Select only the fastest 10\n                        const sortedResults = testResults\n                            .map((result, index) => ({ result, index }))\n                            .filter(item => item.result.success)\n                            .sort((a, b) => a.result.latency - b.result.latency)\n                            .slice(0, 10);\n\n                        const fastestIndices = new Set(sortedResults.map(item => item.index));\n\n                        resultItems.forEach(item => {\n                            const index = parseInt(item.dataset.index);\n                            const checkbox = item.querySelector('input[type="checkbox"]');\n                            if (fastestIndices.has(index)) {\n                                item.style.display = 'flex';\n                                if (checkbox) checkbox.checked = true;\n                            } else {\n                                item.style.display = 'none';\n                                if (checkbox) checkbox.checked = false;\n                            }\n                        });\n\n                        // Disable city checkboxes\n                        cityCheckboxes.forEach(cb => cb.disabled = true);\n                    } else {\n                        // Filter by selected cities\n                        const selectedCities = new Set();\n                        cityCheckboxes.forEach(cb => {\n                            if (cb.checked) {\n                                selectedCities.add(cb.value);\n                            }\n                        });\n\n                        // If all cities are selected (or none), show all results\n                        const allChecked = cityCheckboxes.length > 0 && selectedCities.size === cityCheckboxes.length;\n                        const noneChecked = selectedCities.size === 0;\n\n                        resultItems.forEach(item => {\n                            const colo = item.dataset.colo || '';\n                            const checkbox = item.querySelector('input[type="checkbox"]');\n                            if (allChecked || noneChecked || selectedCities.has(colo)) {\n                                item.style.display = 'flex';\n                                // Sync update result item checkbox state\n                                if (checkbox) {\n                                    if (allChecked) {\n                                        // When all cities are selected, all result item checkboxes are checked\n                                        checkbox.checked = true;\n                                    } else if (noneChecked) {\n                                        // When no city is selected, all result item checkboxes are unchecked\n                                        checkbox.checked = false;\n                                    } else {\n                                        // Sync checkboxes based on city selection state\n                                        checkbox.checked = selectedCities.has(colo);\n                                    }\n                                }\n                            } else {\n                                item.style.display = 'none';\n                                // Uncheck hidden result item checkboxes\n                                if (checkbox) {\n                                    checkbox.checked = false;\n                                }\n                            }\n                        });\n\n                        // Enable city checkboxes\n                        cityCheckboxes.forEach(cb => cb.disabled = false);\n                    }\n                }\n\n                async function testLatency(host, port, signal) {\n                    const timeout = 8000;\n                    let colo = '';\n                    let testUrl = '';\n\n                    try {\n                        const controller = new AbortController();\n                        const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n                        if (signal) {\n                            signal.addEventListener('abort', () => controller.abort());\n                        }\n\n                        const cleanHost = host.replace(/^\\[|\\]$/g, '');\n                        const hexIP = ipToHex(cleanHost);\n                        const testDomain = hexIP ? (hexIP + '.nip.lfree.org') : (cleanHost + '.nip.lfree.org');\n                        testUrl = 'https://' + testDomain + ':' + port + '/';\n\n                        console.log('[LatencyTest] Testing:', testUrl, 'Original:', host + ':' + port, 'HexIP:', hexIP);\n\n                        const firstStart = Date.now();\n                        const response1 = await fetch(testUrl, {\n                            signal: controller.signal\n                        });\n                        const firstTime = Date.now() - firstStart;\n\n                        if (!response1.ok) {\n                            clearTimeout(timeoutId);\n                            return { success: false, latency: firstTime, error: 'HTTP ' + response1.status + ' ' + response1.statusText, colo: '', testUrl: testUrl };\n                        }\n\n                        try {\n                            const text = await response1.text();\n                            console.log('[LatencyTest] Response body:', text.substring(0, 200));\n                            const data = JSON.parse(text);\n                            if (data.colo) {\n                                colo = data.colo;\n                            }\n                        } catch (e) {\n                            console.log('[LatencyTest] Parse error:', e.message);\n                        }\n\n                        const secondStart = Date.now();\n                        const response2 = await fetch(testUrl, {\n                            signal: controller.signal\n                        });\n                        await response2.text();\n                        const latency = Date.now() - secondStart;\n\n                        clearTimeout(timeoutId);\n\n                        console.log('[LatencyTest] First:', firstTime + 'ms (DNS+TLS+RTT)', 'Second:', latency + 'ms (RTT only)');\n\n                        return { success: true, latency: latency, colo: colo, testUrl: testUrl };\n                    } catch (error) {\n                        const errorMsg = error.name === 'AbortError' ? '${r?"Ø²Ù…Ø§Ù† ØªÙ…Ø§Ù… Ø´Ø¯":"Timeout"}' : error.message;\n                        console.log('[LatencyTest] Error:', errorMsg, 'URL:', testUrl);\n                        return { success: false, latency: -1, error: errorMsg, colo: '', testUrl: testUrl };\n                    }\n                }\n            });\n        <\/script>\n    </body>\n    </html>`;return new Response(s,{status:200,headers:{"Content-Type":"text/html; charset=utf-8"}})}function pe(e,n){return e>>>n|e<<32-n}let me=0;const ge=131072,fe=5e3,he=45e3,be=2,ye=32;function Ce(e){return new Promise(n=>setTimeout(n,e))}class Pe{#e;constructor(){this.#e=0}get(){return this.#e}add(e){this.#e+=e}}function Se(e,...n){let t=e.length;for(let e of n)t+=e.length;const o=new e.constructor(t);o.set(e,0),t=e.length;for(let e of n)o.set(e,t),t+=e.length;return o}function Ie(e){return new Uint8Array(new ArrayBuffer(e||ge))}function xe(e,n){const t=new Pe,o=n.getWriter(),a=(async()=>{try{await async function(e,n,t){async function o(t){if(t&&0!==t.length){e.add(t.length);try{await n.write(t)}catch(e){throw e}}}try{await o(t.data);let e=0;for(;!t.done;){const n=await t.reader.read(Ie());if(n.done)break;await o(n.value),t.done=n.done,e++,e%10==0&&await Ce(0),n.value&&0!==n.value.length||await Ce(2)}}catch(e){throw e}}(t,o,e)}catch(e){throw e}finally{try{await o.close()}catch(e){}}})();return{counter:t,done:a,abort:()=>{try{o.abort()}catch(e){}}}}function ve(e,n){const t=new Pe;let o;const a=new Promise((a,r)=>{o=new TransformStream({start(n){t.add(e.length),n.enqueue(e)},transform(e,n){t.add(e.length),n.enqueue(e)},cancel(e){r(`download cancelled: ${e}`)}},null,new ByteLengthQueuingStrategy({highWaterMark:ge}));let i=Date.now();const s=setInterval(()=>{if(Date.now()-i>he){try{o.writable.abort?.("idle timeout")}catch(e){}clearInterval(s),r("idle timeout")}},5e3),l=n.getReader(),c=o.writable.getWriter();(async()=>{try{let e=0;for(;;){const n=await l.read();if(n.done)break;i=Date.now(),await c.write(n.value),e++,e%5==0&&await Ce(0)}await c.close(),a()}catch(e){r(e)}finally{try{l.releaseLock()}catch(e){}try{c.releaseLock()}catch(e){}clearInterval(s)}})()});return{readable:o.readable,counter:t,done:a,abort:()=>{try{o.readable.cancel()}catch(e){}try{o.writable.abort()}catch(e){}}}}function we(e){try{1!==e.readyState&&2!==e.readyState||e.close()}catch(e){}}const ke=Array.from({length:256},(e,n)=>(n+256).toString(16).slice(1));function Ee(){const e=ee("yx","");if(e)try{const n=e.split(",").map(e=>e.trim()).filter(e=>e);a=[],r=[],n.forEach(e=>{let n="",t=e;if(e.includes("#")){const o=e.split("#");t=o[0].trim(),n=o[1].trim()}const{address:o,port:i}=ae(t);n||(n="CustomPreferred-"+o+(i?":"+i:"")),Z(o)?a.push({ip:o,port:i,isp:n}):r.push({domain:o,port:i,name:n})})}catch(e){a=[],r=[]}else a=[],r=[]}function De(e){if(!e||!e.trim())return[];const n=e.split(",").map(e=>e.trim()).filter(e=>e),t=[];for(const e of n){let n="",o=e;if(e.includes("#")){const t=e.split("#");o=t[0].trim(),n=t[1].trim()}const{address:a,port:r}=ae(o);n||(n=a+(r?":"+r:"")),t.push({ip:a,port:r||443,name:n,addedAt:(new Date).toISOString()})}return t}function Re(e){return e&&0!==e.length?e.map(e=>{const n=e.port||443;return`${e.ip}:${n}#${e.name}`}).join(","):""}function Le(e){return/^(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/.test(e)}const Te=[{name:"Cloudflare",url:"https://cloudflare-dns.com/dns-query",weight:20},{name:"Google",url:"https://dns.google/dns-query",weight:15},{name:"Quad9",url:"https://dns.quad9.net/dns-query",weight:15},{name:"OpenDNS",url:"https://doh.opendns.com/dns-query",weight:10},{name:"AdGuard",url:"https://dns.adguard.com/dns-query",weight:10},{name:"ControlD",url:"https://freedns.controld.com/p2",weight:10},{name:"Mullvad",url:"https://adblock.dns.mullvad.net/dns-query",weight:10},{name:"NextDNS",url:"https://dns.nextdns.io/dns-query",weight:10}],Ue=300;