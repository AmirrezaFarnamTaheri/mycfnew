// CFnew - Ultimate Terminal v2.9.3
import{connect}from"cloudflare:sockets";let at="uuid",fallbackAddress="",socks5Config="",customPreferredIPs=[],customPreferredDomains=[],enableSocksDowngrade=!1,disableNonTLS=!1,disablePreferred=!1,enableRegionMatching=!0,currentWorkerRegion="",manualWorkerRegion="",piu="",cp="",ev=!0,et=!1,ex=!1,evm=!1,ess=!1,etu=!1,ehy=!1,eg=!1,tp="",enableECH=!1,customDNS="https://dns.joeyblog.eu.org/joeyblog",customECHDomain="cloudflare-ech.com",scu="https://url.v1.mk/sub";const remoteConfigUrl="https://raw.githubusercontent.com/byJoey/test/refs/heads/main/tist.ini";let epd=!1,epi=!0,egi=!0,enableDiverseProxies=!1,kvStore=null,kvConfig={};const regionMapping={US:["üá∫üá∏ US","US","United States"],SG:["üá∏üá¨ SG","SG","Singapore"],JP:["üáØüáµ JP","JP","Japan"],KR:["üá∞üá∑ KR","KR","South Korea"],DE:["üá©üá™ DE","DE","Germany"],SE:["üá∏üá™ SE","SE","Sweden"],NL:["üá≥üá± NL","NL","Netherlands"],FI:["üá´üáÆ FI","FI","Finland"],GB:["üá¨üáß GB","GB","United Kingdom"],FR:["üá´üá∑ FR","FR","France"],CA:["üá®üá¶ CA","CA","Canada"],AU:["üá¶üá∫ AU","AU","Australia"],HK:["üá≠üá∞ HK","HK","Hong Kong"],TW:["üáπüáº TW","TW","Taiwan"],IN:["üáÆüá≥ IN","IN","India"],BR:["üáßüá∑ BR","BR","Brazil"],PL:["üáµüá± PL","PL","Poland"],RU:["üá∑üá∫ RU","RU","Russia"],LV:["üá±üáª LV","LV","Latvia"],IR:["üáÆüá∑ IR","IR","Iran"],Oracle:["Oracle","Oracle"],DigitalOcean:["DigitalOcean","DigitalOcean"],Vultr:["Vultr","Vultr"],Multacom:["Multacom","Multacom"]};let backupIPs=[{domain:"ProxyIP.US.CMLiussss.net",region:"US",regionCode:"US",port:443},{domain:"ProxyIP.SG.CMLiussss.net",region:"SG",regionCode:"SG",port:443},{domain:"ProxyIP.JP.CMLiussss.net",region:"JP",regionCode:"JP",port:443},{domain:"ProxyIP.KR.CMLiussss.net",region:"KR",regionCode:"KR",port:443},{domain:"ProxyIP.DE.CMLiussss.net",region:"DE",regionCode:"DE",port:443},{domain:"ProxyIP.SE.CMLiussss.net",region:"SE",regionCode:"SE",port:443},{domain:"ProxyIP.NL.CMLiussss.net",region:"NL",regionCode:"NL",port:443},{domain:"ProxyIP.FI.CMLiussss.net",region:"FI",regionCode:"FI",port:443},{domain:"ProxyIP.GB.CMLiussss.net",region:"GB",regionCode:"GB",port:443},{domain:"ProxyIP.FR.CMLiussss.net",region:"FR",regionCode:"FR",port:443},{domain:"ProxyIP.CA.CMLiussss.net",region:"CA",regionCode:"CA",port:443},{domain:"ProxyIP.AU.CMLiussss.net",region:"AU",regionCode:"AU",port:443},{domain:"ProxyIP.HK.CMLiussss.net",region:"HK",regionCode:"HK",port:443},{domain:"ProxyIP.TW.CMLiussss.net",region:"TW",regionCode:"TW",port:443},{domain:"ProxyIP.IN.CMLiussss.net",region:"IN",regionCode:"IN",port:443},{domain:"ProxyIP.BR.CMLiussss.net",region:"BR",regionCode:"BR",port:443},{domain:"ProxyIP.PL.CMLiussss.net",region:"PL",regionCode:"PL",port:443},{domain:"ProxyIP.RU.CMLiussss.net",region:"RU",regionCode:"RU",port:443},{domain:"ProxyIP.LV.CMLiussss.net",region:"LV",regionCode:"LV",port:443},{domain:"ProxyIP.IR.CMLiussss.net",region:"IR",regionCode:"IR",port:443},{domain:"ProxyIP.Oracle.cmliussss.net",region:"Oracle",regionCode:"Oracle",port:443},{domain:"ProxyIP.DigitalOcean.CMLiussss.net",region:"DigitalOcean",regionCode:"DigitalOcean",port:443},{domain:"ProxyIP.Vultr.CMLiussss.net",region:"Vultr",regionCode:"Vultr",port:443},{domain:"ProxyIP.Multacom.CMLiussss.net",region:"Multacom",regionCode:"Multacom",port:443}];const directDomains=[{name:"cloudflare.182682.xyz",domain:"cloudflare.182682.xyz"},{name:"speed.marisalnc.com",domain:"speed.marisalnc.com"},{domain:"freeyx.cloudflare88.eu.org"},{domain:"bestcf.top"},{domain:"cdn.2020111.xyz"},{domain:"cfip.cfcdn.vip"},{domain:"cf.0sm.com"},{domain:"cf.090227.xyz"},{domain:"cf.zhetengsha.eu.org"},{domain:"cloudflare.9jy.cc"},{domain:"cf.zerone-cdn.pp.ua"},{domain:"cfip.1323123.xyz"},{domain:"cnamefuckxxs.yuchen.icu"},{domain:"cloudflare-ip.mofashi.ltd"},{domain:"115155.xyz"},{domain:"cname.xirancdn.us"},{domain:"f3058171cad.002404.xyz"},{domain:"8.889288.xyz"},{domain:"cdn.tzpro.xyz"},{domain:"cf.877771.xyz"},{domain:"xn--b6gac.eu.org"}],E_INVALID_DATA=atob("aW52YWxpZCBkYXRh"),E_INVALID_USER=atob("aW52YWxpZCB1c2Vy"),E_UNSUPPORTED_CMD=atob("Y29tbWFuZCBpcyBub3Qgc3VwcG9ydGVk"),E_UDP_DNS_ONLY=atob("VURQIHByb3h5IG9ubHkgZW5hYmxlIGZvciBETlMgd2hpY2ggaXMgcG9ydCA1Mw=="),E_INVALID_ADDR_TYPE=atob("aW52YWxpZCBhZGRyZXNzVHlwZQ=="),E_EMPTY_ADDR=atob("YWRkcmVzc1ZhbHVlIGlzIGVtcHR5"),E_WS_NOT_OPEN=atob("d2ViU29ja2V0LmVhZHlTdGF0ZSBpcyBub3Qgb3Blbg=="),E_INVALID_ID_STR=atob("U3RyaW5naWZpZWQgaWRlbnRpZmllciBpcyBpbnZhbGlk"),E_INVALID_SOCKS_ADDR=atob("SW52YWxpZCBTT0NLUyBhZGRyZXNzIGZvcm1hdA=="),E_SOCKS_NO_METHOD=atob("bm8gYWNjZXB0YWJsZSBtZXRob2Rz"),E_SOCKS_AUTH_NEEDED=atob("c29ja3Mgc2VydmVyIG5lZWRzIGF1dGg="),E_SOCKS_AUTH_FAIL=atob("ZmFpbCB0byBhdXRoIHNvY2tzIHNlcnZlcg=="),E_SOCKS_CONN_FAIL=atob("ZmFpbCB0byBvcGVuIHNvY2tzIGNvbm5lY3Rpb24=");let parsedSocks5Config={},isSocksEnabled=!1;const ADDRESS_TYPE_IPV4=1,ADDRESS_TYPE_URL=2,ADDRESS_TYPE_IPV6=3;function isValidFormat(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}function isValidIP(e){if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e))return!0;if(/^(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(e))return!0;return!!/^::1$|^::$|^(?:[0-9a-fA-F]{1,4}:)*::(?:[0-9a-fA-F]{1,4}:)*[0-9a-fA-F]{1,4}$/.test(e)}async function initKVStore(e){if(e.C)try{kvStore=e.C,await loadKVConfig()}catch(e){kvStore=null}}async function loadKVConfig(){if(kvStore)try{const e=await kvStore.get("c");e&&(kvConfig=JSON.parse(e))}catch(e){kvConfig={}}}async function saveKVConfig(){if(kvStore)try{const e=JSON.stringify(kvConfig);await kvStore.put("c",e)}catch(e){throw e}}function getConfigValue(e,n=""){return void 0!==kvConfig[e]?kvConfig[e]:n}async function setConfigValue(e,n){kvConfig[e]=n,await saveKVConfig()}async function detectWorkerRegion(e){try{const n=e.cf?.country;if(n){const e={US:"US",SG:"SG",JP:"JP",KR:"KR",DE:"DE",SE:"SE",NL:"NL",FI:"FI",GB:"GB",FR:"FR",CA:"CA",AU:"AU",HK:"HK",TW:"TW",IN:"IN",BR:"BR",PL:"PL",RU:"RU",CN:"SG",IT:"DE",ES:"DE",CH:"DE",AT:"DE",BE:"NL",DK:"SE",NO:"SE",IE:"GB",NZ:"AU",MY:"SG",ID:"SG",TH:"SG",VN:"SG",PH:"SG",BD:"IN",LK:"IN",NP:"IN",PK:"IN",AR:"BR",CL:"BR",CO:"BR",PE:"BR",CZ:"PL",SK:"PL",HU:"PL",UA:"PL",BY:"PL",KZ:"RU",UZ:"RU"};if(e[n])return e[n]}return"SG"}catch(e){return"SG"}}async function checkIPAvailability(e,n=443,t=2e3){try{const n=new AbortController,o=setTimeout(()=>n.abort(),t),a=await fetch(`https://${e}`,{method:"HEAD",signal:n.signal,headers:{"User-Agent":"Mozilla/5.0 (compatible; CF-IP-Checker/1.0)"}});return clearTimeout(o),a.status<500}catch(e){return!0}}async function getBestBackupIP(e=""){if(0===backupIPs.length)return null;const n=backupIPs.map(e=>({...e,available:!0}));if(enableRegionMatching&&e){const t=getSmartRegionSelection(e,n);if(t.length>0){return t[0]}}return n[0]}function getNearbyRegions(e){return{US:["SG","JP","KR","BR"],SG:["JP","KR","US","IN"],JP:["SG","KR","US"],KR:["JP","SG","US"],DE:["NL","GB","SE","FI","PL","RU"],SE:["DE","NL","FI","GB","PL","RU"],NL:["DE","GB","SE","FI","PL"],FI:["SE","DE","NL","GB","RU"],GB:["DE","NL","SE","FI"],IN:["SG"],BR:["US"],PL:["DE","SE","FI","NL","RU"],RU:["FI","SE","DE","PL"],LV:["FI","SE","PL","RU"],IR:["LV","SG","JP","KR","DE","SE","NL","FI","GB","FR","PL","RU","US","CA","BR","IN","AU","HK","TW"]}[e]||[]}function getAllRegionsByPriority(e){const n=getNearbyRegions(e);return[e,...n,...["US","SG","JP","KR","DE","SE","NL","FI","GB","IN","BR","PL","RU","LV","IR","AU","HK","TW"].filter(t=>t!==e&&!n.includes(t))]}function getSmartRegionSelection(e,n){if(!enableRegionMatching||!e)return n;const t=getAllRegionsByPriority(e),o=[];for(const e of t){const t=n.filter(n=>n.regionCode===e);o.push(...t)}return o}function parseAddressAndPort(e){if(e.includes("[")&&e.includes("]")){const n=e.match(/^\[([^\]]+)\](?::(\d+))?$/);if(n)return{address:n[1],port:n[2]?parseInt(n[2],10):null}}const n=e.lastIndexOf(":");if(n>0){const t=e.substring(0,n),o=e.substring(n+1),a=parseInt(o,10);if(!isNaN(a)&&a>0&&a<=65535)return{address:t,port:a}}return{address:e,port:null}}export default{async fetch(e,n,t){try{await initKVStore(n),at=(n.u||n.U||at).toLowerCase();const o=(n.d||n.D||at).toLowerCase(),a=getConfigValue("p",n.p||n.P);let r=!1;const s=getConfigValue("wk",n.wk||n.WK);s&&s.trim()?(manualWorkerRegion=s.trim().toUpperCase(),currentWorkerRegion=manualWorkerRegion):a&&a.trim()?(r=!0,currentWorkerRegion="CUSTOM"):currentWorkerRegion=await detectWorkerRegion(e);const i=n.rm||n.RM;i&&"no"===i.toLowerCase()&&(enableRegionMatching=!1);const l=getConfigValue("p",n.p||n.P);if(l&&(fallbackAddress=l.trim()),socks5Config=getConfigValue("s",n.s||n.S)||socks5Config,socks5Config)try{parsedSocks5Config=parseSocksConfig(socks5Config),isSocksEnabled=!0}catch(e){isSocksEnabled=!1}const c=getConfigValue("yx",n.yx||n.YX);if(c)try{const e=c.split(",").map(e=>e.trim()).filter(e=>e);customPreferredIPs=[],customPreferredDomains=[],e.forEach(e=>{let n="",t=e;if(e.includes("#")){const o=e.split("#");t=o[0].trim(),n=o[1].trim()}const{address:o,port:a}=parseAddressAndPort(t);n||(n="CustomPreferred-"+o+(a?":"+a:"")),isValidIP(o)?customPreferredIPs.push({ip:o,port:a,isp:n}):customPreferredDomains.push({domain:o,port:a,name:n})})}catch(e){customPreferredIPs=[],customPreferredDomains=[]}const d=getConfigValue("qj",n.qj||n.QJ);d&&"no"===d.toLowerCase()&&(enableSocksDowngrade=!0);const u=getConfigValue("dkby",n.dkby||n.DKBY);u&&"yes"===u.toLowerCase()&&(disableNonTLS=!0);const p=n.yxby||n.YXBY;p&&"yes"===p.toLowerCase()&&(disablePreferred=!0);const g=getConfigValue("ev",n.ev);void 0!==g&&""!==g&&(ev="yes"===g||!0===g||"true"===g);const m=getConfigValue("et",n.et);void 0!==m&&""!==m&&(et="yes"===m||!0===m||"true"===m),tp=getConfigValue("tp",n.tp)||"";const f=getConfigValue("ex",n.ex);void 0!==f&&""!==f&&(ex="yes"===f||!0===f||"true"===f);const h=getConfigValue("evm",n.evm);void 0!==h&&""!==h&&(evm="yes"===h||!0===h||"true"===h);const b=getConfigValue("ess",n.ess);void 0!==b&&""!==b&&(ess="yes"===b||!0===b||"true"===b);const y=getConfigValue("etu",n.etu);void 0!==y&&""!==y&&(etu="yes"===y||!0===y||"true"===y);const C=getConfigValue("ehy",n.ehy);void 0!==C&&""!==C&&(ehy="yes"===C||!0===C||"true"===C);const P=getConfigValue("eg",n.eg);void 0!==P&&""!==P&&(eg="yes"===P||!0===P||"true"===P),scu=getConfigValue("scu",n.scu)||"https://url.v1.mk/sub";const S=getConfigValue("epd",n.epd||"no");void 0!==S&&""!==S&&(epd="no"!==S&&!1!==S&&"false"!==S);const I=getConfigValue("epi",n.epi);void 0!==I&&""!==I&&(epi="no"!==I&&!1!==I&&"false"!==I);const x=getConfigValue("egi",n.egi);void 0!==x&&""!==x&&(egi="no"!==x&&!1!==x&&"false"!==x);const v=getConfigValue("edp",n.edp);void 0!==v&&""!==v&&(enableDiverseProxies="yes"===v||!0===v||"true"===v);const w=getConfigValue("ech",n.ech);void 0!==w&&""!==w&&(enableECH="yes"===w||!0===w||"true"===w);const k=getConfigValue("customDNS","");k&&k.trim()&&(customDNS=k.trim());const E=getConfigValue("customECHDomain","");if(E&&E.trim()&&(customECHDomain=E.trim()),enableECH){disableNonTLS=!0;"yes"!==getConfigValue("dkby","")&&await setConfigValue("dkby","yes")}ev||et||ex||evm||ess||(ev=!0),piu=getConfigValue("yxURL",n.yxURL||n.YXURL)||"https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt",cp=getConfigValue("d",n.d||n.D)||"";piu!=="https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt"&&(directDomains.length=0,customPreferredIPs=[],customPreferredDomains=[]);const D=new URL(e.url);if("/dns-query"===D.pathname)return await handleDoHRequest(e,n,t);if("/dns-encoding"===D.pathname)return serveDNSEncodingExplanation();if(D.pathname.includes("/api/config")){const n=D.pathname.split("/").filter(e=>e),t=n.indexOf("api");if(t>0){const o=n.slice(0,t).join("/");let a=!1;if(cp&&cp.trim()){a=o===(cp.trim().startsWith("/")?cp.trim().substring(1):cp.trim())}else a=isValidFormat(o)&&o===at;return a?await handleConfigAPI(e):new Response(JSON.stringify({error:"Ë∑ØÂæÑÈ™åËØÅÂ§±Ë¥•"}),{status:403,headers:{"Content-Type":"application/json"}})}return new Response(JSON.stringify({error:"Invalid API Path"}),{status:404,headers:{"Content-Type":"application/json"}})}if(D.pathname.includes("/api/preferred-ips")){const n=D.pathname.split("/").filter(e=>e),t=n.indexOf("api");if(t>0){const o=n.slice(0,t).join("/");let a=!1;if(cp&&cp.trim()){a=o===(cp.trim().startsWith("/")?cp.trim().substring(1):cp.trim())}else a=isValidFormat(o)&&o===at;return a?await handlePreferredIPsAPI(e):new Response(JSON.stringify({error:"Ë∑ØÂæÑÈ™åËØÅÂ§±Ë¥•"}),{status:403,headers:{"Content-Type":"application/json"}})}return new Response(JSON.stringify({error:"Invalid API Path"}),{status:404,headers:{"Content-Type":"application/json"}})}if("POST"===e.method&&"application/grpc"===e.headers.get("content-type")&&eg)return await handleGrpcRequest(e);if("POST"===e.method&&ex){const n=await handleXhttpPost(e);return n?(t.waitUntil(n.closed),new Response(n.readable,{headers:{"X-Accel-Buffering":"no","Cache-Control":"no-store",Connection:"keep-alive","User-Agent":"Go-http-client/2.0","Content-Type":"application/grpc"}})):new Response("Internal Server Error",{status:500})}if(e.headers.get("Upgrade")===atob("d2Vic29ja2V0"))return await handleWsRequest(e);if("GET"===e.method){if(D.pathname.endsWith("/region")){const t=D.pathname.split("/").filter(e=>e);if(2===t.length&&"region"===t[1]){const o=t[0];let a=!1;if(cp&&cp.trim()){a=o===(cp.trim().startsWith("/")?cp.trim().substring(1):cp.trim())}else a=isValidFormat(o)&&o===at;if(a){const t=getConfigValue("p",n.p||n.P),o=getConfigValue("wk",n.wk||n.WK);if(o&&o.trim())return new Response(JSON.stringify({region:o.trim().toUpperCase(),detectionMethod:"Manual Region",manualRegion:o.trim().toUpperCase(),timestamp:(new Date).toISOString()}),{headers:{"Content-Type":"application/json"}});if(t&&t.trim())return new Response(JSON.stringify({region:"CUSTOM",detectionMethod:"Custom ProxyIP Mode",ci:t,timestamp:(new Date).toISOString()}),{headers:{"Content-Type":"application/json"}});{const n=await detectWorkerRegion(e);return new Response(JSON.stringify({region:n,detectionMethod:"API Detection",timestamp:(new Date).toISOString()}),{headers:{"Content-Type":"application/json"}})}}return new Response(JSON.stringify({error:"Access Denied",message:"Path Validation Failed"}),{status:403,headers:{"Content-Type":"application/json"}})}}if(D.pathname.endsWith("/test-api")){const n=D.pathname.split("/").filter(e=>e);if(2===n.length&&"test-api"===n[1]){const t=n[0];let o=!1;if(cp&&cp.trim()){o=t===(cp.trim().startsWith("/")?cp.trim().substring(1):cp.trim())}else o=isValidFormat(t)&&t===at;if(!o)return new Response(JSON.stringify({error:"Access Denied",message:"Path Validation Failed"}),{status:403,headers:{"Content-Type":"application/json"}});try{const n=await detectWorkerRegion(e);return new Response(JSON.stringify({detectedRegion:n,message:"API Test Completed",timestamp:(new Date).toISOString()}),{headers:{"Content-Type":"application/json"}})}catch(e){return new Response(JSON.stringify({error:e.message,message:"API Test Failed"}),{status:500,headers:{"Content-Type":"application/json"}})}}}if("/"===D.pathname){const t=getConfigValue("homepage",n.homepage||n.HOMEPAGE);if(t&&t.trim())try{const n=new URL(t.trim());if("https:"!==n.protocol)throw new Error("Invalid homepage URL protocol");if(n.hostname===D.hostname)throw new Error("Homepage loop detected");const o=await fetch(n.toString(),{method:"GET",headers:{"User-Agent":e.headers.get("User-Agent")||"Mozilla/5.0",Accept:e.headers.get("Accept")||"*/*","Accept-Language":e.headers.get("Accept-Language")||"en-US,en;q=0.9"},redirect:"follow"});if(o.ok){const e=o.headers.get("Content-Type")||"text/html; charset=utf-8",n=await o.text();return new Response(n,{status:o.status,headers:{"Content-Type":e,"Cache-Control":"no-cache, no-store, must-revalidate"}})}}catch(e){console.error("Failed to fetch custom homepage:",e)}const o=e.headers.get("Cookie")||"";let a=null;if(o){const e=o.split(";").map(e=>e.trim());for(const n of e)if(n.startsWith("preferredLanguage=")){a=n.split("=")[1];break}}let r=!1;if("fa"===a||"fa-IR"===a)r=!0;else if("en"===a||"en-US"===a)r=!1;else{const n=e.headers.get("Accept-Language")||"";r="fa"===n.split(",")[0].split("-")[0].toLowerCase()||n.includes("fa-IR")||n.includes("fa")}const s={en:{title:"Terminal",congratulations:"Congratulations, you made it!",enterU:"Please enter the value of your U variable",enterD:"Please enter the value of your D variable",command:"Command: connect [",uuid:"UUID",path:"PATH",inputU:"Enter content of U variable and press Enter...",inputD:"Enter content of D variable and press Enter...",connecting:"Connecting...",invading:"Invading...",success:"Connection successful! Returning result...",error:"Error: Invalid UUID format",reenter:"Please re-enter a valid UUID",subtitle:"Multi-client Support ‚Ä¢ Smart Optimization ‚Ä¢ One-Click Generation",selectClient:"[ Select Client ]",systemStatus:"[ System Status ]",configManagement:"[ Config Management ]",relatedLinks:"[ Related Links ]",checking:"Checking...",workerRegion:"Worker Region: ",detectionMethod:"Detection Method: ",proxyIPStatus:"ProxyIP Status: ",currentIP:"Current IP: ",regionMatch:"Region Match: ",selectionLogic:"Selection Logic: ",kvStatusChecking:"Checking KV Status...",kvEnabled:"‚úÖ KV Storage Enabled, Config Management Available",kvDisabled:"‚ö†Ô∏è KV Storage Disabled or Not Configured",specifyRegion:"Specify Region (wk):",autoDetect:"Auto Detect",saveRegion:"Save Region Config",protocolSelection:"Protocol Selection:",enableVLESS:"Enable VLESS Protocol",enableVMess:"Enable VMess Protocol",enableShadowsocks:"Enable Shadowsocks Protocol",enableTrojan:"Enable Trojan Protocol",enableXhttp:"Enable xhttp Protocol",enableTUIC:"Enable TUIC Protocol",enableHysteria2:"Enable Hysteria 2 Protocol",enableVLESSgRPC:"Enable VLESS gRPC Protocol",linkOnlyHint:"Requires External Backend (Link-Only)",grpcHint:"Requires Custom Domain (gRPC)",trojanPassword:"Trojan Password (Optional):",customPath:"Custom Path (d):",customPathPlaceholder:"e.g., /secret-path",customIP:"Custom ProxyIP (p):",customIPPlaceholder:"e.g., 1.2.3.4 or proxy.example.com",preferredIPs:"Preferred IP List (yx):",preferredIPsPlaceholder:"e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA",preferredIPsURL:"Preferred IP Source URL (yxURL):",latencyTest:"Latency Test",latencyTestIP:"Test IP/Domain:",latencyTestIPPlaceholder:"Enter IP or Domain, comma separated",latencyTestPort:"Port:",startTest:"Start Test",stopTest:"Stop Test",testResult:"Test Result:",addToYx:"Add to Preferred List",addSelectedToYx:"Add Selected to Preferred List",selectAll:"Select All",deselectAll:"Deselect All",testingInProgress:"Testing...",testComplete:"Test Complete",latencyMs:"Latency (HTTP Handshake)",timeout:"Timeout",ipSource:"IP Source:",manualInput:"Manual Input",cfRandomIP:"CF Random IP",urlFetch:"URL Fetch",randomCount:"Generate Count:",fetchURL:"Fetch URL:",fetchURLPlaceholder:"Enter URL of IP list",generateIP:"Generate IP",fetchIP:"Fetch IP",socks5Config:"SOCKS5 Config (s):",customHomepage:"Custom Homepage URL (homepage):",customHomepagePlaceholder:"e.g., https://example.com",customHomepageHint:"Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.",customPathHint:"Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.",customIPHint:"Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.",preferredIPsHint:"Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.",socks5ConfigHint:"Format: user:pass@host:port. Worker will connect to target via this proxy.",saveConfig:"Save Config",advancedControl:"Advanced Control",subscriptionConverter:"Sub Converter URL:",builtinPreferred:"Built-in Preferred Type:",enablePreferredDomain:"Enable Preferred Domain",enablePreferredIP:"Enable Preferred IP",enableGitHubPreferred:"Enable GitHub Default Preferred",enableDiverseProxies:"Enable Diverse Proxies (Generate all ports)",enableDiverseProxiesHint:"Generate nodes for all supported ports (80, 443, 2053, etc.) for each IP. Increases subscription size significantly.",allowAPIManagement:"Allow API Management (ae):",regionMatching:"Region Matching (rm):",downgradeControl:"Downgrade Control (qj):",tlsControl:"TLS Control (dkby):",preferredControl:"Preferred Control (yxby):",saveAdvanced:"Save Advanced Config",loading:"Loading...",currentConfig:"üìç Current Path Config",refreshConfig:"Refresh Config",resetConfig:"Reset Config",subscriptionCopied:"Subscription Link Copied",autoSubscriptionCopied:"Auto-detected subscription link copied. Client will be recognized by User-Agent.",trojanPasswordPlaceholder:"Leave empty to use UUID",trojanPasswordHint:"Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.",protocolHint:"Multiple protocols can be enabled.<br>‚Ä¢ VLESS WS: Standard WebSocket protocol<br>‚Ä¢ VMess WS: WebSocket-based VMess (link generation)<br>‚Ä¢ Shadowsocks: WebSocket-based SS (link generation)<br>‚Ä¢ Trojan: Uses SHA224 password auth<br>‚Ä¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)",enableECH:"Enable ECH (Encrypted Client Hello)",enableECHHint:"When enabled, ECH config is fetched from DoH and added to links on every sub refresh",customDNS:"Custom DNS Server",customDNSPlaceholder:"e.g., https://dns.joeyblog.eu.org/joeyblog",customDNSHint:"DNS server for ECH config query (DoH format)",customECHDomain:"Custom ECH Domain",customECHDomainPlaceholder:"e.g., cloudflare-ech.com",customECHDomainHint:"Domain used in ECH config, leave empty for default",saveProtocol:"Save Protocol Config",subscriptionConverterPlaceholder:"Default: https://url.v1.mk/sub",subscriptionConverterHint:"Custom subscription converter API, leave empty for default",builtinPreferredHint:"Control which built-in preferred nodes are included. Default all enabled.",apiEnabledDefault:"Default (API Disabled)",apiEnabledYes:"Enable API Management",apiEnabledHint:"‚ö†Ô∏è Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.",regionMatchingDefault:"Default (Enable Region Match)",regionMatchingNo:"Disable Region Match",regionMatchingHint:'Smart region matching disabled when set to "Disable"',downgradeControlDefault:"Default (Disable Downgrade)",downgradeControlNo:"Enable Downgrade Mode",downgradeControlHint:"When enabled: CF Direct Fail -> SOCKS5 -> Fallback",tlsControlDefault:"Default (Keep All Nodes)",tlsControlYes:"TLS Nodes Only",tlsControlHint:'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',preferredControlDefault:"Default (Enable Preferred)",preferredControlYes:"Disable Preferred",preferredControlHint:'When set to "Disable Preferred", only native address is used',regionNames:{US:"üá∫üá∏ US",SG:"üá∏üá¨ Singapore",JP:"üáØüáµ Japan",KR:"üá∞üá∑ South Korea",DE:"üá©üá™ Germany",SE:"üá∏üá™ Sweden",NL:"üá≥üá± Netherlands",FI:"üá´üáÆ Finland",GB:"üá¨üáß UK",FR:"üá´üá∑ France",CA:"üá®üá¶ Canada",AU:"üá¶üá∫ Australia",HK:"üá≠üá∞ Hong Kong",TW:"üáπüáº Taiwan"},terminal:"Terminal v2.9.3",githubProject:"GitHub Project",autoDetectClient:"Auto Detect",selectionLogicText:"Same Region -> Nearby Region -> Other Regions",customIPDisabledHint:"Region selection disabled when using Custom ProxyIP",customIPMode:"Custom ProxyIP Mode (p variable enabled)",customIPModeDesc:"Custom IP Mode (Region match disabled)",usingCustomProxyIP:"Using Custom ProxyIP: ",customIPConfig:" (p variable config)",customIPModeDisabled:"Custom IP Mode, region selection disabled",manualRegion:"Manual Region",manualRegionDesc:" (Manual)",proxyIPAvailable:"10/10 Available (ProxyIP Domain Pre-set)",smartSelection:"Smart Nearby Selection",sameRegionIP:"Same Region IP Available (1)",cloudflareDetection:"Cloudflare Built-in Detection",detectionFailed:"Detection Failed",apiTestResult:"API Detection Result: ",apiTestTime:"Detection Time: ",apiTestFailed:"API Detection Failed: ",unknownError:"Unknown Error",apiTestError:"API Test Failed: ",kvNotConfigured:"KV Storage not configured. Config management unavailable.\\n\\nPlease in Cloudflare Workers:\\n1. Create KV Namespace\\n2. Bind variable C\\n3. Redeploy",kvNotEnabled:"KV Storage Not Configured",kvCheckFailed:"KV Check Failed: Invalid Response",kvCheckFailedStatus:"KV Check Failed - Status: ",kvCheckFailedError:"KV Check Failed - Error: "},fa:{title:"ÿ™ÿ±ŸÖ€åŸÜÿßŸÑ",terminal:"ÿ™ÿ±ŸÖ€åŸÜÿßŸÑ",congratulations:"ÿ™ÿ®ÿ±€å⁄© ŸÖ€å‚Äå⁄ØŸà€å€åŸÖ ÿ®Ÿá ÿ¥ŸÖÿß",enterU:"ŸÑÿ∑ŸÅÿß ŸÖŸÇÿØÿßÿ± ŸÖÿ™ÿ∫€åÿ± U ÿÆŸàÿØ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ",enterD:"ŸÑÿ∑ŸÅÿß ŸÖŸÇÿØÿßÿ± ŸÖÿ™ÿ∫€åÿ± D ÿÆŸàÿØ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ",command:"ÿØÿ≥ÿ™Ÿàÿ±: connect [",uuid:"UUID",path:"PATH",inputU:"ŸÖÿ≠ÿ™Ÿà€åÿßÿ™ ŸÖÿ™ÿ∫€åÿ± U ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ÿ±ÿØŸá Ÿà Enter ÿ±ÿß ÿ®ÿ≤ŸÜ€åÿØ...",inputD:"ŸÖÿ≠ÿ™Ÿà€åÿßÿ™ ŸÖÿ™ÿ∫€åÿ± D ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ÿ±ÿØŸá Ÿà Enter ÿ±ÿß ÿ®ÿ≤ŸÜ€åÿØ...",connecting:"ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ™ÿµÿßŸÑ...",invading:"ÿØÿ± ÿ≠ÿßŸÑ ŸÜŸÅŸàÿ∞...",success:"ÿßÿ™ÿµÿßŸÑ ŸÖŸàŸÅŸÇ! ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ≤⁄Øÿ¥ÿ™ ŸÜÿ™€åÿ¨Ÿá...",error:"ÿÆÿ∑ÿß: ŸÅÿ±ŸÖÿ™ UUID ŸÜÿßŸÖÿπÿ™ÿ®ÿ±",reenter:"ŸÑÿ∑ŸÅÿß UUID ŸÖÿπÿ™ÿ®ÿ± ÿ±ÿß ÿØŸàÿ®ÿßÿ±Ÿá Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ"}}[r?"fa":"en"],i=`<!DOCTYPE html>\n        <html lang="${r?"fa-IR":"en-US"}" dir="${r?"rtl":"ltr"}">\n    <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n            <title>${s.title}</title>\n        <style>\n            * { margin: 0; padding: 0; box-sizing: border-box; }\n            body {\n                font-family: "Courier New", monospace;\n                background: #000; color: #00ff00; min-height: 100vh;\n                overflow-x: hidden; position: relative;\n                display: flex; justify-content: center; align-items: center;\n            }\n            .matrix-bg {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                background: #000;\n                z-index: -1;\n            }\n            @keyframes bg-pulse {\n                0%, 100% { background: linear-gradient(45deg, #000 0%, #001100 50%, #000 100%); }\n                50% { background: linear-gradient(45deg, #000 0%, #002200 50%, #000 100%); }\n            }\n            .matrix-rain {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                background: transparent;\n                z-index: -1;\n                display: none;\n            }\n            @keyframes matrix-fall {\n                0% { transform: translateY(-100%); }\n                100% { transform: translateY(100vh); }\n            }\n            .matrix-code-rain {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                pointer-events: none; z-index: -1;\n                overflow: hidden;\n                display: none;\n            }\n            .matrix-column {\n                position: absolute; top: -100%; left: 0;\n                color: #00ff00; font-family: "Courier New", monospace;\n                font-size: 14px; line-height: 1.2;\n                text-shadow: 0 0 5px #00ff00;\n            }\n            @keyframes matrix-drop {\n                0% { top: -100%; opacity: 1; }\n                10% { opacity: 1; }\n                90% { opacity: 0.3; }\n                100% { top: 100vh; opacity: 0; }\n            }\n            .matrix-column:nth-child(odd) {\n                animation-duration: 12s;\n                animation-delay: -2s;\n            }\n            .matrix-column:nth-child(even) {\n                animation-duration: 18s;\n                animation-delay: -5s;\n            }\n            .matrix-column:nth-child(3n) {\n                animation-duration: 20s;\n                animation-delay: -8s;\n            }\n            .terminal {\n                width: 90%; max-width: 800px; height: 500px;\n                background: rgba(0, 0, 0, 0.9);\n                border: 2px solid #00ff00;\n                border-radius: 8px;\n                box-shadow: 0 0 30px rgba(0, 255, 0, 0.5), inset 0 0 20px rgba(0, 255, 0, 0.1);\n                backdrop-filter: blur(10px);\n                position: relative; z-index: 1;\n                overflow: hidden;\n            }\n            .terminal-header {\n                background: rgba(0, 20, 0, 0.8);\n                padding: 10px 15px;\n                border-bottom: 1px solid #00ff00;\n                display: flex; align-items: center;\n            }\n            .terminal-buttons {\n                display: flex; gap: 8px;\n            }\n            .terminal-button {\n                width: 12px; height: 12px; border-radius: 50%;\n                background: #ff5f57; border: none;\n            }\n            .terminal-button:nth-child(2) { background: #ffbd2e; }\n            .terminal-button:nth-child(3) { background: #28ca42; }\n            .terminal-title {\n                margin-left: 15px; color: #00ff00;\n                font-size: 14px; font-weight: bold;\n            }\n            .terminal-body {\n                padding: 20px; height: calc(100% - 50px);\n                overflow-y: auto; font-size: 14px;\n                line-height: 1.4;\n            }\n            .terminal-line {\n                margin-bottom: 8px; display: flex; align-items: center;\n            }\n            .terminal-prompt {\n                color: #00ff00; margin-right: 10px;\n                font-weight: bold;\n            }\n            .terminal-input {\n                background: transparent; border: none; outline: none;\n                color: #00ff00; font-family: "Courier New", monospace;\n                font-size: 14px; flex: 1;\n                caret-color: #00ff00;\n            }\n            .terminal-input::placeholder {\n                color: #00aa00; opacity: 0.7;\n            }\n            .terminal-cursor {\n                display: inline-block; width: 8px; height: 16px;\n                background: #00ff00;\n                margin-left: 2px;\n            }\n            @keyframes blink {\n                0%, 50% { opacity: 1; }\n                51%, 100% { opacity: 0; }\n            }\n            .terminal-output {\n                color: #00aa00; margin: 5px 0;\n            }\n            .terminal-error {\n                color: #ff4444; margin: 5px 0;\n            }\n            .terminal-success {\n                color: #44ff44; margin: 5px 0;\n            }\n            .matrix-text {\n                position: fixed; top: 20px; right: 20px;\n                color: #00ff00; font-family: "Courier New", monospace;\n                font-size: 0.8rem; opacity: 0.6;\n            }\n            @keyframes matrix-flicker {\n                0%, 100% { opacity: 0.6; }\n                50% { opacity: 1; }\n            }\n        </style>\n    </head>\n    <body>\n        <div class="matrix-bg"></div>\n        <div class="matrix-rain"></div>\n        <div class="matrix-code-rain" id="matrixCodeRain"></div>\n            <div class="matrix-text">${s.terminal}</div>\n            <div style="position: fixed; top: 20px; left: 20px; z-index: 1000;">\n                <select id="languageSelector" style="background: rgba(0, 20, 0, 0.9); border: 2px solid #00ff00; color: #00ff00; padding: 8px 12px; font-family: 'Courier New', monospace; font-size: 14px; cursor: pointer; text-shadow: 0 0 5px #00ff00; box-shadow: 0 0 15px rgba(0, 255, 0, 0.4);" onchange="changeLanguage(this.value)">\n                    <option value="en" ${r?"":"selected"}>üá∫üá∏ English</option>\n                    <option value="fa" ${r?"selected":""}>üáÆüá∑ ŸÅÿßÿ±ÿ≥€å</option>\n                </select>\n            </div>\n        <div class="terminal">\n            <div class="terminal-header">\n                <div class="terminal-buttons">\n                    <div class="terminal-button"></div>\n                    <div class="terminal-button"></div>\n                    <div class="terminal-button"></div>\n                </div>\n                    <div class="terminal-title">${s.terminal}</div>\n            </div>\n            <div class="terminal-body" id="terminalBody">\n                <div class="terminal-line">\n                    <span class="terminal-prompt">root:~$</span>\n                        <span class="terminal-output">${s.congratulations}</span>\n                </div>\n                <div class="terminal-line">\n                    <span class="terminal-prompt">root:~$</span>\n                        <span class="terminal-output">${cp&&cp.trim()?s.enterD:s.enterU}</span>\n                </div>\n                <div class="terminal-line">\n                    <span class="terminal-prompt">root:~$</span>\n                        <span class="terminal-output">${s.command}${cp&&cp.trim()?s.path:s.uuid}]</span>\n                </div>\n                <div class="terminal-line">\n                    <span class="terminal-prompt">root:~$</span>\n                        <input type="text" class="terminal-input" id="uuidInput" placeholder="${cp&&cp.trim()?s.inputD:s.inputU}" autofocus>\n                    <span class="terminal-cursor"></span>\n                </div>\n            </div>\n        </div>\n        <script>\n            function createMatrixRain() {\n                const matrixContainer = document.getElementById('matrixCodeRain');\n                const matrixChars = '01ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\n                const columns = Math.floor(window.innerWidth / 18);\n\n                for (let i = 0; i < columns; i++) {\n                    const column = document.createElement('div');\n                    column.className = 'matrix-column';\n                    column.style.left = (i * 18) + 'px';\n                    column.style.animationDelay = Math.random() * 15 + 's';\n                    column.style.animationDuration = (Math.random() * 15 + 8) + 's';\n                    column.style.fontSize = (Math.random() * 4 + 12) + 'px';\n                    column.style.opacity = Math.random() * 0.8 + 0.2;\n\n                    let text = '';\n                    const charCount = Math.floor(Math.random() * 30 + 20);\n                    for (let j = 0; j < charCount; j++) {\n                        const char = matrixChars[Math.floor(Math.random() * matrixChars.length)];\n                        const brightness = Math.random() > 0.1 ? '#00ff00' : '#00aa00';\n                        text += '<span style="color: ' + brightness + ';">' + char + '</span><br>';\n                    }\n                    column.innerHTML = text;\n                    matrixContainer.appendChild(column);\n                }\n\n                setInterval(function() {\n                    const columns = matrixContainer.querySelectorAll('.matrix-column');\n                    columns.forEach(function(column) {\n                        if (Math.random() > 0.95) {\n                            const chars = column.querySelectorAll('span');\n                            if (chars.length > 0) {\n                                const randomChar = chars[Math.floor(Math.random() * chars.length)];\n                                randomChar.style.color = '#ffffff';\n                                setTimeout(function() {\n                                    randomChar.style.color = '#00ff00';\n                                }, 200);\n                            }\n                        }\n                    });\n                }, 100);\n            }\n\n            function isValidUUID(uuid) {\n                const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n                return uuidRegex.test(uuid);\n            }\n\n            function addTerminalLine(content, type = 'output') {\n                const terminalBody = document.getElementById('terminalBody');\n                const line = document.createElement('div');\n                line.className = 'terminal-line';\n\n                const prompt = document.createElement('span');\n                prompt.className = 'terminal-prompt';\n                prompt.textContent = 'root:~$';\n\n                const output = document.createElement('span');\n                output.className = 'terminal-' + type;\n                output.textContent = content;\n\n                line.appendChild(prompt);\n                line.appendChild(output);\n                terminalBody.appendChild(line);\n\n                terminalBody.scrollTop = terminalBody.scrollHeight;\n            }\n\n            function handleUUIDInput() {\n                const input = document.getElementById('uuidInput');\n                const inputValue = input.value.trim();\n                const cp = '${cp}';\n\n                if (inputValue) {\n                    addTerminalLine(atob('Y29ubmVjdCA=') + inputValue, 'output');\n\n                        const translations = {\n                            en: {\n                    title: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n\n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support ‚Ä¢ Smart Optimization ‚Ä¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: '‚úÖ KV Storage Enabled, Config Management Available',\n                    kvDisabled: '‚ö†Ô∏è KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'üìç Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>‚Ä¢ VLESS WS: Standard WebSocket protocol<br>‚Ä¢ VMess WS: WebSocket-based VMess (link generation)<br>‚Ä¢ Shadowsocks: WebSocket-based SS (link generation)<br>‚Ä¢ Trojan: Uses SHA224 password auth<br>‚Ä¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: '‚ö†Ô∏è Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'üá∫üá∏ US', SG: 'üá∏üá¨ Singapore', JP: 'üáØüáµ Japan',\n                        KR: 'üá∞üá∑ South Korea', DE: 'üá©üá™ Germany', SE: 'üá∏üá™ Sweden', NL: 'üá≥üá± Netherlands',\n                        FI: 'üá´üáÆ Finland', GB: 'üá¨üáß UK', FR: 'üá´üá∑ France', CA: 'üá®üá¶ Canada',\n                        AU: 'üá¶üá∫ Australia', HK: 'üá≠üá∞ Hong Kong', TW: 'üáπüáº Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                            fa: {\n                                connecting: 'ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ™ÿµÿßŸÑ...',\n                                invading: 'ÿØÿ± ÿ≠ÿßŸÑ ŸÜŸÅŸàÿ∞...',\n                                success: 'ÿßÿ™ÿµÿßŸÑ ŸÖŸàŸÅŸÇ! ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ≤⁄Øÿ¥ÿ™ ŸÜÿ™€åÿ¨Ÿá...',\n                                error: 'ÿÆÿ∑ÿß: ŸÅÿ±ŸÖÿ™ UUID ŸÜÿßŸÖÿπÿ™ÿ®ÿ±',\n                                reenter: 'ŸÑÿ∑ŸÅÿß UUID ŸÖÿπÿ™ÿ®ÿ± ÿ±ÿß ÿØŸàÿ®ÿßÿ±Ÿá Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ'\n                            }\n                        };\n                        const browserLang = navigator.language || navigator.userLanguage || '';\n                        const isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                        const t = translations[isFarsi ? 'fa' : 'en'];\n\n                    if (cp) {\n                        const cleanInput = inputValue.startsWith('/') ? inputValue : '/' + inputValue;\n                            addTerminalLine(t.connecting, 'output');\n                        setTimeout(() => {\n                                addTerminalLine(t.success, 'success');\n                            setTimeout(() => {\n                                window.location.href = cleanInput;\n                            }, 1000);\n                        }, 500);\n                    } else {\n                        if (isValidUUID(inputValue)) {\n                            addTerminalLine(t.invading, 'output');\n                        setTimeout(() => {\n                                addTerminalLine(t.success, 'success');\n                            setTimeout(() => {\n                                    window.location.href = '/' + inputValue;\n                            }, 1000);\n                        }, 500);\n                    } else {\n                            addTerminalLine(t.error, 'error');\n                            addTerminalLine(t.reenter, 'output');\n                        }\n                    }\n\n                    input.value = '';\n                }\n            }\n\n                function changeLanguage(lang) {\n                    localStorage.setItem('preferredLanguage', lang);\n                    // Set Cookie (valid for 1 year)\n                    const expiryDate = new Date();\n                    expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n                    document.cookie = 'preferredLanguage=' + lang + '; path=/; expires=' + expiryDate.toUTCString() + '; SameSite=Lax';\n                    // Reload page, do not use URL parameters\n                    window.location.reload();\n                }\n\n                // Check localStorage and Cookie on page load, and clean up URL parameters\n                window.addEventListener('DOMContentLoaded', function() {\n                    function getCookie(name) {\n                        const value = '; ' + document.cookie;\n                        const parts = value.split('; ' + name + '=');\n                        if (parts.length === 2) return parts.pop().split(';').shift();\n                        return null;\n                    }\n\n                    const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                    const urlParams = new URLSearchParams(window.location.search);\n                    const urlLang = urlParams.get('lang');\n\n                    // If URL has language parameter, remove it and set Cookie\n                    if (urlLang) {\n                        const currentUrl = new URL(window.location.href);\n                        currentUrl.searchParams.delete('lang');\n                        const newUrl = currentUrl.toString();\n\n                        // ËÆæÁΩÆCookie\n                        const expiryDate = new Date();\n                        expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n                        document.cookie = 'preferredLanguage=' + urlLang + '; path=/; expires=' + expiryDate.toUTCString() + '; SameSite=Lax';\n                        localStorage.setItem('preferredLanguage', urlLang);\n\n                        // Use history API to remove URL parameter, do not reload page\n                        window.history.replaceState({}, '', newUrl);\n                    } else if (savedLang) {\n                        // If present in localStorage but not in Cookie, sync to Cookie\n                        const expiryDate = new Date();\n                        expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n                        document.cookie = 'preferredLanguage=' + savedLang + '; path=/; expires=' + expiryDate.toUTCString() + '; SameSite=Lax';\n                    }\n                });\n\n            document.addEventListener('DOMContentLoaded', function() {\n                const input = document.getElementById('uuidInput');\n                input.focus();\n                input.addEventListener('keydown', function(e) {\n                    if (e.key === 'Enter') {\n                        handleUUIDInput();\n                    }\n                });\n            });\n        <\/script>\n    </body>\n    </html>`;return new Response(i,{status:200,headers:{"Content-Type":"text/html; charset=utf-8"}})}if(cp&&cp.trim()){const n=cp.trim().startsWith("/")?cp.trim():"/"+cp.trim(),t=n.endsWith("/")&&n.length>1?n.slice(0,-1):n,o=D.pathname.endsWith("/")&&D.pathname.length>1?D.pathname.slice(0,-1):D.pathname;if(o===t)return await handleSubscriptionPage(e,at);if(o===t+"/sub")return await handleSubscriptionRequest(e,at,D);if(D.pathname.length>1&&"/"!==D.pathname){if(isValidFormat(D.pathname.replace(/\/$/,"").replace("/sub","").substring(1)))return new Response(JSON.stringify({error:"Access Denied",message:"Custom path mode enabled, UUID access disabled"}),{status:403,headers:{"Content-Type":"application/json"}})}}else{if(D.pathname.length>1&&"/"!==D.pathname&&!D.pathname.includes("/sub")){const n=D.pathname.replace(/\/$/,"").substring(1);if(isValidFormat(n))return n===at?await handleSubscriptionPage(e,n):new Response(JSON.stringify({error:"UUID Error: Please note the variable name is u, not uuid"}),{status:403,headers:{"Content-Type":"application/json"}})}if(D.pathname.includes("/sub")){const n=D.pathname.split("/");if(2===n.length&&"sub"===n[1]){const t=n[0].substring(1);if(isValidFormat(t))return t===at?await handleSubscriptionRequest(e,t,D):new Response(JSON.stringify({error:"UUID Error"}),{status:403,headers:{"Content-Type":"application/json"}})}}}const t=D.pathname.replace(/\/+$/,"").toLowerCase();if(t===`/${o}`.toLowerCase())return await handleSubscriptionRequest(e,at)}return new Response(JSON.stringify({error:"Not Found"}),{status:404,headers:{"Content-Type":"application/json"}})}catch(e){return new Response(e.toString(),{status:500})}}};function generateQuantumultConfig(e){return btoa(e.join("\n"))}function parseLinkToClashNode(e){try{if(e.startsWith("vless://")){const n=new URL(e),t=decodeURIComponent(n.hash.substring(1)),o=n.username,a=n.hostname,r=parseInt(n.port)||443,s=new URLSearchParams(n.search),i="tls"===s.get("security")||"true"===s.get("tls"),l=s.get("type")||"ws",c=s.get("path")||"/?ed=2048",d=s.get("host")||a,u=s.get("sni")||d,p=s.get("alpn")||"h3,h2,http/1.1",g=s.get("fp")||s.get("client-fingerprint")||"chrome",m=s.get("ech"),f={name:t,type:"vless",server:a,port:r,uuid:o,tls:i,network:l,"client-fingerprint":g};if(i&&(f.servername=u,f.alpn=p.split(",").map(e=>e.trim()),f["skip-cert-verify"]=!1),"ws"===l&&(f["ws-opts"]={path:c,headers:{Host:d}}),m){const e=customECHDomain||"cloudflare-ech.com";f["ech-opts"]={enable:!0,"query-server-name":e}}return f}if(e.startsWith("trojan://")){const n=new URL(e),t=decodeURIComponent(n.hash.substring(1)),o=n.username,a=n.hostname,r=parseInt(n.port)||443,s=new URLSearchParams(n.search),i=s.get("type")||"ws",l=s.get("path")||"/?ed=2048",c=s.get("host")||a,d=s.get("sni")||c,u=s.get("alpn")||"h3,h2,http/1.1",p=s.get("ech"),g={name:t,type:"trojan",server:a,port:r,password:o,network:i,sni:d,alpn:u.split(",").map(e=>e.trim()),"skip-cert-verify":!1};if("ws"===i&&(g["ws-opts"]={path:l,headers:{Host:c}}),p){const e=customECHDomain||"cloudflare-ech.com";g["ech-opts"]={enable:!0,"query-server-name":e}}return g}}catch(e){return null}return null}async function generateClashConfig(e,n,t){const o=new URL(n.url);o.pathname=o.pathname.replace(/\/sub$/,"")+"/sub",o.searchParams.set("target","base64");const a=encodeURIComponent(o.toString()),r=`${scu}?target=clash&url=${a}&insert=false&emoji=true&list=false&xudp=false&udp=false&tfo=false&expand=true&scv=false&fdn=false&new_name=true`;try{const e=await fetch(r);if(!e.ok)throw new Error("ËÆ¢ÈòÖËΩ¨Êç¢ÊúçÂä°Â§±Ë¥•");let n=await e.text();return enableECH&&(n=n.split("\n").map(e=>{if(/^\s*-\s*\{/.test(e)&&e.includes("name:")&&e.includes("server:")){if(e.includes("ech-opts"))return e;const n=e.lastIndexOf("}");if(n>0){const t=e.substring(0,n).trim();if(t.length>0){const o=customECHDomain||"cloudflare-ech.com",a=!t.endsWith(",")&&!t.endsWith("{");return e.substring(0,n)+(a?", ":" ")+`ech-opts: {enable: true, query-server-name: ${o}}`+e.substring(n)}}}return e}).join("\n")),n=n.replace(/^(\s*nameserver:\s*\n)((?:\s*-\s*[^\n]+\n)*)/m,(e,n,t)=>n+`    - ${customDNS||"https://dns.joeyblog.eu.org/joeyblog"}\n`),n}catch(e){throw new Error("Êó†Ê≥ïËé∑Âèñ Clash ÈÖçÁΩÆ: "+e.message)}}function generateBase64Config(e){const n=e.join("\n"),t=encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,n)=>String.fromCharCode(parseInt(n,16)));return btoa(t)}const generateSurgeConfig=generateBase64Config,generateSSConfig=generateBase64Config,generateV2RayConfig=generateBase64Config,generateLoonConfig=generateBase64Config;let echDebugInfo="";async function fetchECHConfig(e){if(!enableECH)return echDebugInfo="ECHÂäüËÉΩÂ∑≤Á¶ÅÁî®",null;echDebugInfo="";const n=[];try{n.push("Â∞ùËØï‰ΩøÁî® Google DNS Êü•ËØ¢ cloudflare-ech.com...");const t="https://v.recipes/dns/dns.google/dns-query?name=cloudflare-ech.com&type=65",o=await fetch(t,{headers:{Accept:"application/json"}});if(n.push(`Google DNS ÂìçÂ∫îÁä∂ÊÄÅ: ${o.status}`),o.ok){const e=await o.json();if(n.push(`Google DNS ËøîÂõûÊï∞ÊçÆ: ${JSON.stringify(e).substring(0,200)}...`),e.Answer&&e.Answer.length>0){n.push(`ÊâæÂà∞ ${e.Answer.length} Êù°Á≠îÊ°àËÆ∞ÂΩï`);for(const t of e.Answer)if(t.data){n.push(`Ëß£ÊûêÁ≠îÊ°àÊï∞ÊçÆ: ${typeof t.data}, ÈïøÂ∫¶: ${String(t.data).length}`);const e="string"==typeof t.data?t.data:JSON.stringify(t.data),o=e.match(/ech=([^\s"']+)/);if(o&&o[1])return echDebugInfo=n.join("\\n")+"\\n‚úÖ ÊàêÂäü‰ªé Google DNS Ëé∑Âèñ ECH ÈÖçÁΩÆ",o[1];if(t.data&&!e.includes("ech="))try{const e=atob(t.data);n.push(`Â∞ùËØï base64 Ëß£Á†ÅÔºåËß£Á†ÅÂêéÈïøÂ∫¶: ${e.length}`);const o=e.match(/ech=([^\s"']+)/);if(o&&o[1])return echDebugInfo=n.join("\\n")+"\\n‚úÖ ÊàêÂäü‰ªé Google DNS (base64Ëß£Á†Å) Ëé∑Âèñ ECH ÈÖçÁΩÆ",o[1]}catch(e){n.push(`base64 Ëß£Á†ÅÂ§±Ë¥•: ${e.message}`)}}}else n.push("Google DNS Êú™ËøîÂõûÁ≠îÊ°àËÆ∞ÂΩï")}else n.push(`Google DNS ËØ∑Ê±ÇÂ§±Ë¥•: ${o.status}`);n.push(`Â∞ùËØï‰ΩøÁî® Google DNS Êü•ËØ¢ÁõÆÊ†áÂüüÂêç ${e}...`);const a=`https://v.recipes/dns/dns.google/dns-query?name=${encodeURIComponent(e)}&type=65`,r=await fetch(a,{headers:{Accept:"application/json"}});if(n.push(`Google DNS (ÁõÆÊ†áÂüüÂêç) ÂìçÂ∫îÁä∂ÊÄÅ: ${r.status}`),r.ok){const e=await r.json();if(n.push(`Google DNS (ÁõÆÊ†áÂüüÂêç) ËøîÂõûÊï∞ÊçÆ: ${JSON.stringify(e).substring(0,200)}...`),e.Answer&&e.Answer.length>0){n.push(`ÊâæÂà∞ ${e.Answer.length} Êù°Á≠îÊ°àËÆ∞ÂΩï`);for(const t of e.Answer)if(t.data){const e=("string"==typeof t.data?t.data:JSON.stringify(t.data)).match(/ech=([^\s"']+)/);if(e&&e[1])return echDebugInfo=n.join("\\n")+"\\n‚úÖ ÊàêÂäü‰ªé Google DNS (ÁõÆÊ†áÂüüÂêç) Ëé∑Âèñ ECH ÈÖçÁΩÆ",e[1];try{const e=atob(t.data).match(/ech=([^\s"']+)/);if(e&&e[1])return echDebugInfo=n.join("\\n")+"\\n‚úÖ ÊàêÂäü‰ªé Google DNS (ÁõÆÊ†áÂüüÂêç, base64Ëß£Á†Å) Ëé∑Âèñ ECH ÈÖçÁΩÆ",e[1]}catch(e){n.push(`base64 Ëß£Á†ÅÂ§±Ë¥•: ${e.message}`)}}}else n.push("Google DNS (ÁõÆÊ†áÂüüÂêç) Êú™ËøîÂõûÁ≠îÊ°àËÆ∞ÂΩï")}else n.push(`Google DNS (ÁõÆÊ†áÂüüÂêç) ËØ∑Ê±ÇÂ§±Ë¥•: ${r.status}`);n.push("Â∞ùËØï‰ΩøÁî® Cloudflare DNS ‰Ωú‰∏∫Â§áÈÄâ...");const s="https://cloudflare-dns.com/dns-query?name=cloudflare-ech.com&type=65",i=await fetch(s,{headers:{Accept:"application/dns-json"}});if(n.push(`Cloudflare DNS ÂìçÂ∫îÁä∂ÊÄÅ: ${i.status}`),i.ok){const e=await i.json();if(n.push(`Cloudflare DNS ËøîÂõûÊï∞ÊçÆ: ${JSON.stringify(e).substring(0,200)}...`),e.Answer&&e.Answer.length>0){n.push(`ÊâæÂà∞ ${e.Answer.length} Êù°Á≠îÊ°àËÆ∞ÂΩï`);for(const t of e.Answer)if(t.data){const e=t.data.match(/ech=([^\s"']+)/);if(e&&e[1])return echDebugInfo=n.join("\\n")+"\\n‚úÖ ÊàêÂäü‰ªé Cloudflare DNS Ëé∑Âèñ ECH ÈÖçÁΩÆ",e[1]}}else n.push("Cloudflare DNS Êú™ËøîÂõûÁ≠îÊ°àËÆ∞ÂΩï")}else n.push(`Cloudflare DNS ËØ∑Ê±ÇÂ§±Ë¥•: ${i.status}`);return echDebugInfo=n.join("\\n")+"\\n‚ùå ÊâÄÊúâDNSÊü•ËØ¢ÂùáÂ§±Ë¥•ÔºåÊú™Ëé∑ÂèñÂà∞ECHÈÖçÁΩÆ",null}catch(e){return echDebugInfo=n.join("\\n")+"\\n‚ùå Ëé∑ÂèñECHÈÖçÁΩÆÊó∂ÂèëÁîüÈîôËØØ: "+e.message,null}}async function handleSubscriptionRequest(e,n,t=null){t||(t=new URL(e.url));const o=[],a=t.hostname,r=t.searchParams.get("target")||"base64";let s=null;if(enableECH){s=`${customECHDomain||"cloudflare-ech.com"}+${customDNS||"https://dns.joeyblog.eu.org/joeyblog"}`}async function i(e){ev&&o.push(...generateLinksFromSource(e,n,a,s)),et&&o.push(...await generateTrojanLinksFromSource(e,n,a,s)),ex&&o.push(...generateXhttpLinksFromSource(e,n,a,s)),evm&&o.push(...generateVMessLinksFromSource(e,n,a)),ess&&o.push(...generateShadowsocksLinksFromSource(e,n,a)),etu&&o.push(...generateTuicLinksFromSource(e,n,a)),ehy&&o.push(...generateHysteria2LinksFromSource(e,n,a)),eg&&o.push(...generateVlessGrpcLinksFromSource(e,n,a))}if("CUSTOM"===currentWorkerRegion){const e=[{ip:a,isp:"Native Address"}];await i(e)}else try{const e=[{ip:a,isp:"Native Address"}];await i(e)}catch(n){currentWorkerRegion||(currentWorkerRegion=await detectWorkerRegion(e));const t=await getBestBackupIP(currentWorkerRegion);if(t){fallbackAddress=t.domain+":"+t.port;const e=[{ip:t.domain,isp:"ProxyIP-"+currentWorkerRegion}];await i(e)}else{const e=[{ip:a,isp:"Native Address"}];await i(e)}}const l=customPreferredIPs.length>0||customPreferredDomains.length>0;if(disablePreferred);else if(l){if(customPreferredIPs.length>0&&epi&&await i(customPreferredIPs),customPreferredDomains.length>0&&epd){const e=customPreferredDomains.map(e=>({ip:e.domain,isp:e.name||e.domain}));await i(e)}}else{if(epd){const e=directDomains.map(e=>({ip:e.domain,isp:e.name||e.domain}));await i(e)}if(epi){if(piu==="https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt")try{const e=await fetchDynamicIPs();e.length>0&&await i(e)}catch(n){currentWorkerRegion||(currentWorkerRegion=await detectWorkerRegion(e));const t=await getBestBackupIP(currentWorkerRegion);if(t){fallbackAddress=t.domain+":"+t.port;const e=[{ip:t.domain,isp:"ProxyIP-"+currentWorkerRegion}];await i(e)}}}if(egi)try{const e=await fetchAndParseNewIPs();e.length>0&&(ev&&o.push(...generateLinksFromNewIPs(e,n,a,s)),et&&o.push(...await generateTrojanLinksFromNewIPs(e,n,a,s)),evm&&o.push(...generateVMessLinksFromNewIPs(e,n,a)),ess&&o.push(...generateShadowsocksLinksFromNewIPs(e,n,a)),etu&&o.push(...generateTuicLinksFromNewIPs(e,n,a)),ehy&&o.push(...generateHysteria2LinksFromNewIPs(e,n,a)),eg&&o.push(...generateVlessGrpcLinksFromNewIPs(e,n,a)))}catch(n){currentWorkerRegion||(currentWorkerRegion=await detectWorkerRegion(e));const t=await getBestBackupIP(currentWorkerRegion);if(t){fallbackAddress=t.domain+":"+t.port;const e=[{ip:t.domain,isp:"ProxyIP-"+currentWorkerRegion}];await i(e)}}}if(0===o.length){const e="ÊâÄÊúâËäÇÁÇπËé∑ÂèñÂ§±Ë¥•",n=`${atob("dmxlc3M=")}://00000000-0000-0000-0000-000000000000@127.0.0.1:80?encryption=none&security=none&type=ws&host=error.com&path=%2F#${encodeURIComponent(e)}`;o.push(n)}let c,d="text/plain; charset=utf-8";switch(r.toLowerCase()){case atob("Y2xhc2g="):case atob("Y2xhc2hy"):c=await generateClashConfig(o,e,n),d="text/yaml; charset=utf-8";break;case atob("c3VyZ2U="):case atob("c3VyZ2Uy"):case atob("c3VyZ2Uz"):case atob("c3VyZ2U0"):c=generateSurgeConfig(o);break;case atob("cXVhbnR1bXVsdA=="):case atob("cXVhbng="):case"quanx":c=generateQuantumultConfig(o);break;case atob("c3M="):case atob("c3Ny"):c=generateSSConfig(o);break;case atob("djJyYXk="):c=generateV2RayConfig(o);break;case atob("bG9vbg=="):c=generateLoonConfig(o);break;default:c=btoa(o.join("\n"))}const u={"Content-Type":d,"Cache-Control":"no-store, no-cache, must-revalidate, max-age=0"};return enableECH&&(u["X-ECH-Status"]="ENABLED",s&&(u["X-ECH-Config-Length"]=String(s.length))),new Response(c,{headers:u})}function generateLinksFromSource(e,n,t,o=null){const a=[80,8080,8880,2052,2082,2086,2095],r=[443,2053,2083,2087,2096,8443],s=[443],i=disableNonTLS?[]:[80],l=[],c="/?ed=2048",d=atob("dmxlc3M=");return e.forEach(e=>{let o=e.isp.replace(/\s/g,"_");e.colo&&e.colo.trim()&&(o=`${o}-${e.colo.trim()}`);const u=e.ip.includes(":")?`[${e.ip}]`:e.ip;let p=[];if(enableDiverseProxies)r.forEach(e=>{p.push({port:e,tls:!0})}),disableNonTLS||a.forEach(e=>{p.push({port:e,tls:!1})});else if(e.port){const n=e.port;r.includes(n)?p.push({port:n,tls:!0}):a.includes(n)?disableNonTLS||p.push({port:n,tls:!1}):p.push({port:n,tls:!0})}else s.forEach(e=>{p.push({port:e,tls:!0})}),i.forEach(e=>{p.push({port:e,tls:!1})});p.forEach(({port:e,tls:a})=>{if(a){const a=`${o}-${e}-WS-TLS`,r=new URLSearchParams({encryption:"none",security:"tls",sni:t,fp:enableECH?"chrome":"randomized",type:"ws",host:t,path:c});if(enableECH){const e=customDNS||"https://dns.joeyblog.eu.org/joeyblog",n=customECHDomain||"cloudflare-ech.com";r.set("alpn","h3,h2,http/1.1"),r.set("ech",`${n}+${e}`)}l.push(`${d}://${n}@${u}:${e}?${r.toString()}#${encodeURIComponent(a)}`)}else{const a=`${o}-${e}-WS`,r=new URLSearchParams({encryption:"none",security:"none",type:"ws",host:t,path:c});l.push(`${d}://${n}@${u}:${e}?${r.toString()}#${encodeURIComponent(a)}`)}})}),l}function generateTuicLinksFromSource(e,n,t){const o=[];return e.forEach(e=>{const a=e.isp.replace(/\s/g,"_")+(e.colo?`-${e.colo}`:""),r=e.port||443;o.push(`tuic://${n}:${n}@${e.ip}:${r}?congestion_control=bbr&alpn=h3&sni=${t}&udp_relay_mode=native&allow_insecure=1#${encodeURIComponent(a)}`)}),o}function generateTuicLinksFromNewIPs(e,n,t){const o=[];return e.forEach(e=>{const a=e.name.replace(/\s/g,"_"),r=e.port||443;o.push(`tuic://${n}:${n}@${e.ip}:${r}?congestion_control=bbr&alpn=h3&sni=${t}&udp_relay_mode=native&allow_insecure=1#${encodeURIComponent(a)}`)}),o}function generateHysteria2LinksFromSource(e,n,t){const o=[];return e.forEach(e=>{const a=e.isp.replace(/\s/g,"_")+(e.colo?`-${e.colo}`:""),r=e.port||443;o.push(`hy2://${n}@${e.ip}:${r}?insecure=1&sni=${t}#${encodeURIComponent(a)}`)}),o}function generateHysteria2LinksFromNewIPs(e,n,t){const o=[];return e.forEach(e=>{const a=e.name.replace(/\s/g,"_"),r=e.port||443;o.push(`hy2://${n}@${e.ip}:${r}?insecure=1&sni=${t}#${encodeURIComponent(a)}`)}),o}function generateVlessGrpcLinksFromSource(e,n,t){const o=[],a=[443,2053,2083,2087,2096,8443];return e.forEach(e=>{let r=e.isp.replace(/\s/g,"_");e.colo&&e.colo.trim()&&(r+=`-${e.colo.trim()}`);const s=parseInt(e.port||443);if(a.includes(s)){const a=`vless://${n}@${e.ip}:${s}?encryption=none&security=tls&type=grpc&serviceName=grpc&sni=${t}&fp=chrome#${encodeURIComponent(r+"-gRPC")}`;o.push(a)}}),o}function generateVlessGrpcLinksFromNewIPs(e,n,t){const o=[],a=[443,2053,2083,2087,2096,8443];return e.forEach(e=>{const r=e.name.replace(/\s/g,"_"),s=parseInt(e.port);if(a.includes(s)){const a=`vless://${n}@${e.ip}:${s}?encryption=none&security=tls&type=grpc&serviceName=grpc&sni=${t}&fp=chrome#${encodeURIComponent(r+"-gRPC")}`;o.push(a)}}),o}async function handleGrpcRequest(e){if(!fallbackAddress)return new Response("No backend for gRPC",{status:503});const n=new URL(e.url),{address:t,port:o}=parseAddressAndPort(fallbackAddress),a=`https://${t}:${o||443}${n.pathname}${n.search}`;try{const n=new Request(a,{method:e.method,headers:e.headers,body:e.body,redirect:"follow"});return await fetch(n)}catch(e){return new Response("gRPC Proxy Error: "+e.message,{status:502})}}async function generateTrojanLinksFromSource(e,n,t,o=null){const a=[80,8080,8880,2052,2082,2086,2095],r=[443,2053,2083,2087,2096,8443],s=[443],i=disableNonTLS?[]:[80],l=[],c="/?ed=2048",d=tp||n;return e.forEach(e=>{let n=e.isp.replace(/\s/g,"_");e.colo&&e.colo.trim()&&(n=`${n}-${e.colo.trim()}`);const o=e.ip.includes(":")?`[${e.ip}]`:e.ip;let u=[];if(e.port){const n=e.port;r.includes(n)?u.push({port:n,tls:!0}):a.includes(n)?disableNonTLS||u.push({port:n,tls:!1}):u.push({port:n,tls:!0})}else s.forEach(e=>{u.push({port:e,tls:!0})}),i.forEach(e=>{u.push({port:e,tls:!1})});u.forEach(({port:e,tls:a})=>{if(a){const a=`${n}-${e}-${atob("VHJvamFu")}-WS-TLS`,r=new URLSearchParams({security:"tls",sni:t,fp:"chrome",type:"ws",host:t,path:c});if(enableECH){const e=customDNS||"https://dns.joeyblog.eu.org/joeyblog",n=customECHDomain||"cloudflare-ech.com";r.set("alpn","h3,h2,http/1.1"),r.set("ech",`${n}+${e}`)}l.push(`${atob("dHJvamFuOi8v")}${d}@${o}:${e}?${r.toString()}#${encodeURIComponent(a)}`)}else{const a=`${n}-${e}-${atob("VHJvamFu")}-WS`,r=new URLSearchParams({security:"none",type:"ws",host:t,path:c});l.push(`${atob("dHJvamFuOi8v")}${d}@${o}:${e}?${r.toString()}#${encodeURIComponent(a)}`)}})}),l}async function fetchDynamicIPs(){let e=[];const n=""===getConfigValue("ipv4","")||"no"!==getConfigValue("ipv4","yes"),t=""===getConfigValue("ipv6","")||"no"!==getConfigValue("ipv6","yes"),o=""===getConfigValue("ispMobile","")||"no"!==getConfigValue("ispMobile","yes"),a=""===getConfigValue("ispUnicom","")||"no"!==getConfigValue("ispUnicom","yes"),r=""===getConfigValue("ispTelecom","")||"no"!==getConfigValue("ispTelecom","yes");try{const s=[];n?s.push(fetchAndParseWetest("https://www.wetest.vip/page/cloudflare/address_v4.html")):s.push(Promise.resolve([])),t?s.push(fetchAndParseWetest("https://www.wetest.vip/page/cloudflare/address_v6.html")):s.push(Promise.resolve([]));const[i,l]=await Promise.all(s);if(e=[...i,...l],e.length>0&&(e=e.filter(e=>{const n=e.isp||"";return!(n.includes("ÁßªÂä®")&&!o)&&(!(n.includes("ËÅîÈÄö")&&!a)&&!(n.includes("Áîµ‰ø°")&&!r))})),e.length>0)return e}catch(e){}return[]}async function fetchAndParseWetest(e){try{const n=await fetch(e,{headers:{"User-Agent":"Mozilla/5.0"}});if(!n.ok)return[];const t=await n.text(),o=[],a=/<tr[\s\S]*?<\/tr>/g,r=/<td data-label="Á∫øË∑ØÂêçÁß∞">(.+?)<\/td>[\s\S]*?<td data-label="‰ºòÈÄâÂú∞ÂùÄ">([\d.:a-fA-F]+)<\/td>[\s\S]*?<td data-label="Êï∞ÊçÆ‰∏≠ÂøÉ">(.+?)<\/td>/;let s;for(;null!==(s=a.exec(t));){const e=s[0].match(r);if(e&&e[1]&&e[2]){const n=e[3]?e[3].trim().replace(/<.*?>/g,""):"";let t=e[1].trim().replace(/<.*?>/g,"");"ÁßªÂä®"===t&&(t="Mobile"),"ËÅîÈÄö"===t&&(t="Unicom"),"Áîµ‰ø°"===t&&(t="Telecom"),o.push({isp:t,ip:e[2].trim(),colo:n})}}return o.length,o}catch(e){return[]}}async function handleWsRequest(e){currentWorkerRegion&&""!==currentWorkerRegion||(currentWorkerRegion=manualWorkerRegion&&manualWorkerRegion.trim()?manualWorkerRegion.trim().toUpperCase():await detectWorkerRegion(e));const n=new WebSocketPair,[t,o]=Object.values(n);o.accept();let a={socket:null},r=!1,s=null;const i=e.headers.get(atob("c2VjLXdlYnNvY2tldC1wcm90b2NvbA=="))||"",l=makeReadableStream(o,i),c=new URL(e.url);return l.pipeTo(new WritableStream({async write(e){if(r)return await forwardUDP(e,o,null);if(a.socket){const n=a.socket.writable.getWriter();return await n.write(e),void n.releaseLock()}if(!s){const n=evm&&c.pathname.startsWith("/vm"),t=ess&&c.pathname.startsWith("/ss");if(n||t){s=n?"vmess":"shadowsocks";let t=fallbackAddress;if(!t&&currentWorkerRegion){const e=await getBestBackupIP(currentWorkerRegion);e&&(t=e.domain+":"+e.port)}if(t){const{address:n,port:r}=parseAddressAndPort(t);return void await forwardTCP(2,n,r||80,e,o,null,a)}throw new Error("No backend configured for VMess/SS relay")}if(ev&&e.byteLength>=24){const n=parseWsPacketHeader(e,at);if(!n.hasError){s="vless";const{addressType:t,port:i,hostname:l,rawIndex:c,version:d,isUDP:u}=n;if(u){if(53!==i)throw new Error(E_UDP_DNS_ONLY);r=!0}const p=new Uint8Array([d[0],0]),g=e.slice(c);return r?forwardUDP(g,o,p):void await forwardTCP(t,l,i,g,o,p,a)}}if(et&&e.byteLength>=56){const n=await parseTrojanHeader(e,at);if(!n.hasError){s=atob("dHJvamFu");const{addressType:e,port:t,hostname:r,rawClientData:i}=n;return void await forwardTCP(e,r,t,i,o,null,a)}}throw new Error("Invalid protocol or authentication failed")}}})).catch(e=>{}),new Response(null,{status:101,webSocket:t})}async function forwardTCP(e,n,t,o,a,r,s){async function i(n,t,a=!1){const r=a?await establishSocksConnection(e,n,t):connect({hostname:n,port:t}),s=r.writable.getWriter();return await s.write(o),s.releaseLock(),r}async function l(){if(enableSocksDowngrade&&isSocksEnabled)try{const e=await i(n,t,!0);return s.socket=e,e.closed.catch(()=>{}).finally(()=>closeSocketQuietly(a)),void connectStreams(e,a,r,null)}catch(e){let o,l;if(fallbackAddress&&fallbackAddress.trim()){const e=parseAddressAndPort(fallbackAddress);o=e.address,l=e.port||t}else{const e=await getBestBackupIP(currentWorkerRegion);o=e?e.domain:n,l=e?e.port:t}try{const e=await i(o,l,!1);s.socket=e,e.closed.catch(()=>{}).finally(()=>closeSocketQuietly(a)),connectStreams(e,a,r,null)}catch(e){closeSocketQuietly(a)}}else{let e,o;if(fallbackAddress&&fallbackAddress.trim()){const n=parseAddressAndPort(fallbackAddress);e=n.address,o=n.port||t}else{const a=await getBestBackupIP(currentWorkerRegion);e=a?a.domain:n,o=a?a.port:t}try{const n=await i(e,o,isSocksEnabled);s.socket=n,n.closed.catch(()=>{}).finally(()=>closeSocketQuietly(a)),connectStreams(n,a,r,null)}catch(e){closeSocketQuietly(a)}}}try{const e=await i(n,t,!enableSocksDowngrade&&isSocksEnabled);s.socket=e,connectStreams(e,a,r,l)}catch(e){l()}}function parseWsPacketHeader(e,n){if(e.byteLength<24)return{hasError:!0,message:E_INVALID_DATA};const t=new Uint8Array(e.slice(0,1));if(formatIdentifier(new Uint8Array(e.slice(1,17)))!==n)return{hasError:!0,message:E_INVALID_USER};const o=new Uint8Array(e.slice(17,18))[0],a=new Uint8Array(e.slice(18+o,19+o))[0];let r=!1;if(1===a);else{if(2!==a)return{hasError:!0,message:E_UNSUPPORTED_CMD};r=!0}const s=19+o,i=new DataView(e.slice(s,s+2)).getUint16(0);let l=s+2,c=0,d=l+1,u="";const p=new Uint8Array(e.slice(l,d))[0];switch(p){case 1:c=4,u=new Uint8Array(e.slice(d,d+c)).join(".");break;case 2:c=new Uint8Array(e.slice(d,d+1))[0],d+=1,u=(new TextDecoder).decode(e.slice(d,d+c));break;case 3:c=16;const n=[],t=new DataView(e.slice(d,d+c));for(let e=0;e<8;e++)n.push(t.getUint16(2*e).toString(16));u=n.join(":");break;default:return{hasError:!0,message:`${E_INVALID_ADDR_TYPE}: ${p}`}}return u?{hasError:!1,addressType:p,port:i,hostname:u,isUDP:r,rawIndex:d+c,version:t}:{hasError:!0,message:`${E_EMPTY_ADDR}: ${p}`}}function makeReadableStream(e,n){let t=!1;return new ReadableStream({start(o){e.addEventListener("message",e=>{t||o.enqueue(e.data)}),e.addEventListener("close",()=>{t||(closeSocketQuietly(e),o.close())}),e.addEventListener("error",e=>o.error(e));const{earlyData:a,error:r}=base64ToArray(n);r?o.error(r):a&&o.enqueue(a)},cancel(){t=!0,closeSocketQuietly(e)}})}async function connectStreams(e,n,t,o){let a=t,r=!1;await e.readable.pipeTo(new WritableStream({async write(e,t){r=!0,1!==n.readyState&&t.error(E_WS_NOT_OPEN),a?(n.send(await new Blob([a,e]).arrayBuffer()),a=null):n.send(e)},abort(e){}})).catch(e=>{closeSocketQuietly(n)}),!r&&o&&o()}async function forwardUDP(e,n,t){try{const o=connect({hostname:"8.8.4.4",port:53});let a=t;const r=o.writable.getWriter();await r.write(e),r.releaseLock(),await o.readable.pipeTo(new WritableStream({async write(e){1===n.readyState&&(a?(n.send(await new Blob([a,e]).arrayBuffer()),a=null):n.send(e))}}))}catch(e){}}async function establishSocksConnection(e,n,t){const{username:o,password:a,hostname:r,socksPort:s}=parsedSocks5Config,i=connect({hostname:r,port:s}),l=i.writable.getWriter();await l.write(new Uint8Array(o?[5,2,0,2]:[5,1,0]));const c=i.readable.getReader();let d=(await c.read()).value;if(5!==d[0]||255===d[1])throw new Error(E_SOCKS_NO_METHOD);if(2===d[1]){if(!o||!a)throw new Error(E_SOCKS_AUTH_NEEDED);const e=new TextEncoder,n=new Uint8Array([1,o.length,...e.encode(o),a.length,...e.encode(a)]);if(await l.write(n),d=(await c.read()).value,1!==d[0]||0!==d[1])throw new Error(E_SOCKS_AUTH_FAIL)}const u=new TextEncoder;let p;switch(e){case 1:p=new Uint8Array([1,...n.split(".").map(Number)]);break;case 2:p=new Uint8Array([3,n.length,...u.encode(n)]);break;case 3:p=new Uint8Array([4,...n.split(":").flatMap(e=>[parseInt(e.slice(0,2),16),parseInt(e.slice(2),16)])]);break;default:throw new Error(E_INVALID_ADDR_TYPE)}if(await l.write(new Uint8Array([5,1,0,...p,t>>8,255&t])),d=(await c.read()).value,0!==d[1])throw new Error(E_SOCKS_CONN_FAIL);return l.releaseLock(),c.releaseLock(),i}function parseSocksConfig(e){let n,t,o,a,[r,s]=e.split("@").reverse();if(s){const e=s.split(":");if(2!==e.length)throw new Error(E_INVALID_SOCKS_ADDR);[n,t]=e}const i=r.split(":");if(a=Number(i.pop()),isNaN(a))throw new Error(E_INVALID_SOCKS_ADDR);if(o=i.join(":"),o.includes(":")&&!/^\[.*\]$/.test(o))throw new Error(E_INVALID_SOCKS_ADDR);return{username:n,password:t,hostname:o,socksPort:a}}async function handleSubscriptionPage(e,n=null){n||(n=at);new URL(e.url);const t=e.headers.get("Cookie")||"";let o=null;if(t){const e=t.split(";").map(e=>e.trim());for(const n of e)if(n.startsWith("preferredLanguage=")){o=n.split("=")[1];break}}let a=!1;if("fa"===o||"fa-IR"===o)a=!0;else if("en"===o||"en-US"===o)a=!1;else{const n=e.headers.get("Accept-Language")||"";a="fa"===n.split(",")[0].split("-")[0].toLowerCase()||n.includes("fa-IR")||n.includes("fa")}const r={en:{title:"Terminal",congratulations:"Congratulations, you made it!",enterU:"Please enter the value of your U variable",enterD:"Please enter the value of your D variable",command:"Command: connect [",uuid:"UUID",path:"PATH",inputU:"Enter content of U variable and press Enter...",inputD:"Enter content of D variable and press Enter...",connecting:"Connecting...",invading:"Invading...",success:"Connection successful! Returning result...",error:"Error: Invalid UUID format",reenter:"Please re-enter a valid UUID",subtitle:"Multi-client Support ‚Ä¢ Smart Optimization ‚Ä¢ One-Click Generation",selectClient:"[ Select Client ]",systemStatus:"[ System Status ]",configManagement:"[ Config Management ]",relatedLinks:"[ Related Links ]",checking:"Checking...",workerRegion:"Worker Region: ",detectionMethod:"Detection Method: ",proxyIPStatus:"ProxyIP Status: ",currentIP:"Current IP: ",regionMatch:"Region Match: ",selectionLogic:"Selection Logic: ",kvStatusChecking:"Checking KV Status...",kvEnabled:"‚úÖ KV Storage Enabled, Config Management Available",kvDisabled:"‚ö†Ô∏è KV Storage Disabled or Not Configured",specifyRegion:"Specify Region (wk):",autoDetect:"Auto Detect",saveRegion:"Save Region Config",protocolSelection:"Protocol Selection:",enableVLESS:"Enable VLESS Protocol",enableVMess:"Enable VMess Protocol",enableShadowsocks:"Enable Shadowsocks Protocol",enableTrojan:"Enable Trojan Protocol",enableXhttp:"Enable xhttp Protocol",enableTUIC:"Enable TUIC Protocol",enableHysteria2:"Enable Hysteria 2 Protocol",enableVLESSgRPC:"Enable VLESS gRPC Protocol",linkOnlyHint:"Requires External Backend (Link-Only)",grpcHint:"Requires Custom Domain (gRPC)",trojanPassword:"Trojan Password (Optional):",customPath:"Custom Path (d):",customPathPlaceholder:"e.g., /secret-path",customIP:"Custom ProxyIP (p):",customIPPlaceholder:"e.g., 1.2.3.4 or proxy.example.com",preferredIPs:"Preferred IP List (yx):",preferredIPsPlaceholder:"e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA",preferredIPsURL:"Preferred IP Source URL (yxURL):",latencyTest:"Latency Test",latencyTestIP:"Test IP/Domain:",latencyTestIPPlaceholder:"Enter IP or Domain, comma separated",latencyTestPort:"Port:",startTest:"Start Test",stopTest:"Stop Test",testResult:"Test Result:",addToYx:"Add to Preferred List",addSelectedToYx:"Add Selected to Preferred List",selectAll:"Select All",deselectAll:"Deselect All",testingInProgress:"Testing...",testComplete:"Test Complete",latencyMs:"Latency (HTTP Handshake)",timeout:"Timeout",ipSource:"IP Source:",manualInput:"Manual Input",cfRandomIP:"CF Random IP",urlFetch:"URL Fetch",randomCount:"Generate Count:",fetchURL:"Fetch URL:",fetchURLPlaceholder:"Enter URL of IP list",generateIP:"Generate IP",fetchIP:"Fetch IP",socks5Config:"SOCKS5 Config (s):",customHomepage:"Custom Homepage URL (homepage):",customHomepagePlaceholder:"e.g., https://example.com",customHomepageHint:"Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.",customPathHint:"Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.",customIPHint:"Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.",preferredIPsHint:"Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.",socks5ConfigHint:"Format: user:pass@host:port. Worker will connect to target via this proxy.",saveConfig:"Save Config",advancedControl:"Advanced Control",subscriptionConverter:"Sub Converter URL:",builtinPreferred:"Built-in Preferred Type:",enablePreferredDomain:"Enable Preferred Domain",enablePreferredIP:"Enable Preferred IP",enableGitHubPreferred:"Enable GitHub Default Preferred",allowAPIManagement:"Allow API Management (ae):",regionMatching:"Region Matching (rm):",downgradeControl:"Downgrade Control (qj):",tlsControl:"TLS Control (dkby):",preferredControl:"Preferred Control (yxby):",saveAdvanced:"Save Advanced Config",loading:"Loading...",currentConfig:"üìç Current Path Config",refreshConfig:"Refresh Config",resetConfig:"Reset Config",subscriptionCopied:"Subscription Link Copied",autoSubscriptionCopied:"Auto-detected subscription link copied. Client will be recognized by User-Agent.",trojanPasswordPlaceholder:"Leave empty to use UUID",trojanPasswordHint:"Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.",protocolHint:"Multiple protocols can be enabled.<br>‚Ä¢ VLESS WS: Standard WebSocket protocol<br>‚Ä¢ VMess WS: WebSocket-based VMess (link generation)<br>‚Ä¢ Shadowsocks: WebSocket-based SS (link generation)<br>‚Ä¢ Trojan: Uses SHA224 password auth<br>‚Ä¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)",enableECH:"Enable ECH (Encrypted Client Hello)",enableECHHint:"When enabled, ECH config is fetched from DoH and added to links on every sub refresh",customDNS:"Custom DNS Server",customDNSPlaceholder:"e.g., https://dns.joeyblog.eu.org/joeyblog",customDNSHint:"DNS server for ECH config query (DoH format)",customECHDomain:"Custom ECH Domain",customECHDomainPlaceholder:"e.g., cloudflare-ech.com",customECHDomainHint:"Domain used in ECH config, leave empty for default",saveProtocol:"Save Protocol Config",subscriptionConverterPlaceholder:"Default: https://url.v1.mk/sub",subscriptionConverterHint:"Custom subscription converter API, leave empty for default",builtinPreferredHint:"Control which built-in preferred nodes are included. Default all enabled.",apiEnabledDefault:"Default (API Disabled)",apiEnabledYes:"Enable API Management",apiEnabledHint:"‚ö†Ô∏è Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.",regionMatchingDefault:"Default (Enable Region Match)",regionMatchingNo:"Disable Region Match",regionMatchingHint:'Smart region matching disabled when set to "Disable"',downgradeControlDefault:"Default (Disable Downgrade)",downgradeControlNo:"Enable Downgrade Mode",downgradeControlHint:"When enabled: CF Direct Fail -> SOCKS5 -> Fallback",tlsControlDefault:"Default (Keep All Nodes)",tlsControlYes:"TLS Nodes Only",tlsControlHint:'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',preferredControlDefault:"Default (Enable Preferred)",preferredControlYes:"Disable Preferred",preferredControlHint:'When set to "Disable Preferred", only native address is used',regionNames:{US:"üá∫üá∏ US",SG:"üá∏üá¨ Singapore",JP:"üáØüáµ Japan",KR:"üá∞üá∑ South Korea",DE:"üá©üá™ Germany",SE:"üá∏üá™ Sweden",NL:"üá≥üá± Netherlands",FI:"üá´üáÆ Finland",GB:"üá¨üáß UK",FR:"üá´üá∑ France",CA:"üá®üá¶ Canada",AU:"üá¶üá∫ Australia",HK:"üá≠üá∞ Hong Kong",TW:"üáπüáº Taiwan"},terminal:"Terminal v2.9.3",githubProject:"GitHub Project",autoDetectClient:"Auto Detect",selectionLogicText:"Same Region -> Nearby Region -> Other Regions",customIPDisabledHint:"Region selection disabled when using Custom ProxyIP",customIPMode:"Custom ProxyIP Mode (p variable enabled)",customIPModeDesc:"Custom IP Mode (Region match disabled)",usingCustomProxyIP:"Using Custom ProxyIP: ",customIPConfig:" (p variable config)",customIPModeDisabled:"Custom IP Mode, region selection disabled",manualRegion:"Manual Region",manualRegionDesc:" (Manual)",proxyIPAvailable:"10/10 Available (ProxyIP Domain Pre-set)",smartSelection:"Smart Nearby Selection",sameRegionIP:"Same Region IP Available (1)",cloudflareDetection:"Cloudflare Built-in Detection",detectionFailed:"Detection Failed",apiTestResult:"API Detection Result: ",apiTestTime:"Detection Time: ",apiTestFailed:"API Detection Failed: ",unknownError:"Unknown Error",apiTestError:"API Test Failed: ",kvNotConfigured:"KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy",kvNotEnabled:"KV Storage Not Configured",kvCheckFailed:"KV Check Failed: Invalid Response",kvCheckFailedStatus:"KV Check Failed - Status: ",kvCheckFailedError:"KV Check Failed - Error: "},fa:{title:"ŸÖÿ±⁄©ÿ≤ ÿßÿ¥ÿ™ÿ±ÿß⁄©",subtitle:"Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ⁄ÜŸÜÿØ ⁄©ŸÑÿß€åŸÜÿ™ ‚Ä¢ ÿßŸÜÿ™ÿÆÿßÿ® ŸáŸàÿ¥ŸÖŸÜÿØ ‚Ä¢ ÿ™ŸàŸÑ€åÿØ €å⁄© ⁄©ŸÑ€å⁄©€å",selectClient:"[ ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÑÿß€åŸÜÿ™ ]",systemStatus:"[ Ÿàÿ∂ÿπ€åÿ™ ÿ≥€åÿ≥ÿ™ŸÖ ]",configManagement:"[ ŸÖÿØ€åÿ±€åÿ™ ÿ™ŸÜÿ∏€åŸÖÿßÿ™ ]",relatedLinks:"[ ŸÑ€åŸÜ⁄©‚ÄåŸáÿß€å ŸÖÿ±ÿ™ÿ®ÿ∑ ]",checking:"ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿ±ÿ±ÿ≥€å...",workerRegion:"ŸÖŸÜÿ∑ŸÇŸá Worker: ",detectionMethod:"ÿ±Ÿàÿ¥ ÿ™ÿ¥ÿÆ€åÿµ: ",proxyIPStatus:"Ÿàÿ∂ÿπ€åÿ™ ProxyIP: ",currentIP:"IP ŸÅÿπŸÑ€å: ",regionMatch:"ÿ™ÿ∑ÿ®€åŸÇ ŸÖŸÜÿ∑ŸÇŸá: ",selectionLogic:"ŸÖŸÜÿ∑ŸÇ ÿßŸÜÿ™ÿÆÿßÿ®: ",kvStatusChecking:"ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿ±ÿ±ÿ≥€å Ÿàÿ∂ÿπ€åÿ™ KV...",kvEnabled:"‚úÖ ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÅÿπÿßŸÑ ÿßÿ≥ÿ™ÿå ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿßÿ≤ ŸÖÿØ€åÿ±€åÿ™ ÿ™ŸÜÿ∏€åŸÖÿßÿ™ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ",kvDisabled:"‚ö†Ô∏è ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÅÿπÿßŸÑ ŸÜ€åÿ≥ÿ™ €åÿß Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ŸÜÿ¥ÿØŸá ÿßÿ≥ÿ™",specifyRegion:"ÿ™ÿπ€å€åŸÜ ŸÖŸÜÿ∑ŸÇŸá (wk):",autoDetect:"ÿ™ÿ¥ÿÆ€åÿµ ÿÆŸàÿØ⁄©ÿßÿ±",saveRegion:"ÿ∞ÿÆ€åÿ±Ÿá ÿ™ŸÜÿ∏€åŸÖÿßÿ™ ŸÖŸÜÿ∑ŸÇŸá",protocolSelection:"ÿßŸÜÿ™ÿÆÿßÿ® Ÿæÿ±Ÿàÿ™⁄©ŸÑ:",enableVLESS:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å Ÿæÿ±Ÿàÿ™⁄©ŸÑ VLESS",enableVMess:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å Ÿæÿ±Ÿàÿ™⁄©ŸÑ VMess",enableShadowsocks:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å Ÿæÿ±Ÿàÿ™⁄©ŸÑ Shadowsocks",enableTrojan:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å Ÿæÿ±Ÿàÿ™⁄©ŸÑ Trojan",enableXhttp:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å Ÿæÿ±Ÿàÿ™⁄©ŸÑ xhttp",enableTUIC:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å Ÿæÿ±Ÿàÿ™⁄©ŸÑ TUIC",enableHysteria2:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å Ÿæÿ±Ÿàÿ™⁄©ŸÑ Hysteria 2",enableVLESSgRPC:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å Ÿæÿ±Ÿàÿ™⁄©ŸÑ VLESS gRPC",linkOnlyHint:"ŸÜ€åÿßÿ≤ ÿ®Ÿá ÿ≥ÿ±Ÿàÿ± ÿ®⁄©‚ÄåÿßŸÜÿØ (Link-Only)",grpcHint:"ŸÜ€åÿßÿ≤ŸÖŸÜÿØ ÿØÿßŸÖŸÜŸá ÿ¥ÿÆÿµ€å (gRPC)",enableECH:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å ECH (Encrypted Client Hello)",enableECHHint:"Ÿæÿ≥ ÿßÿ≤ ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€åÿå ÿØÿ± Ÿáÿ± ÿ®ÿßÿ± ÿ™ÿßÿ≤Ÿá‚Äåÿ≥ÿßÿ≤€å ÿßÿ¥ÿ™ÿ±ÿß⁄©ÿå Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ECH ÿ®Ÿá‚Äåÿ±Ÿàÿ≤ ÿ®Ÿá‚Äåÿ∑Ÿàÿ± ÿÆŸàÿØ⁄©ÿßÿ± ÿßÿ≤ DoH ÿØÿ±€åÿßŸÅÿ™ ÿ¥ÿØŸá Ÿà ÿ®Ÿá ŸÑ€åŸÜ⁄©‚ÄåŸáÿß ÿßÿ∂ÿßŸÅŸá ŸÖ€å‚Äåÿ¥ŸàÿØ",customDNS:"ÿ≥ÿ±Ÿàÿ± DNS ÿ≥ŸÅÿßÿ±ÿ¥€å",customDNSPlaceholder:"ŸÖÿ´ÿßŸÑ: https://dns.joeyblog.eu.org/joeyblog",customDNSHint:"ÿ¢ÿØÿ±ÿ≥ ÿ≥ÿ±Ÿàÿ± DNS ÿ®ÿ±ÿß€å ÿ¨ÿ≥ÿ™ÿ¨Ÿà€å Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ECH (ŸÅÿ±ŸÖÿ™ DoH)",customECHDomain:"ÿØÿßŸÖŸÜŸá ECH ÿ≥ŸÅÿßÿ±ÿ¥€å",customECHDomainPlaceholder:"ŸÖÿ´ÿßŸÑ: cloudflare-ech.com",customECHDomainHint:"ÿØÿßŸÖŸÜŸá ŸÖŸàÿ±ÿØ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿØÿ± Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ECHÿå ÿß⁄Øÿ± ÿÆÿßŸÑ€å ÿ®ÿßÿ¥ÿØ ÿßÿ≤ Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äåÿ¥ŸàÿØ",trojanPassword:"ÿ±ŸÖÿ≤ ÿπÿ®Ÿàÿ± Trojan (ÿßÿÆÿ™€åÿßÿ±€å):",customPath:"ŸÖÿ≥€åÿ± ÿ≥ŸÅÿßÿ±ÿ¥€å (d):",customPathPlaceholder:"ŸÖÿ´ÿßŸÑ: /secret-path",customIP:"ProxyIP ÿ≥ŸÅÿßÿ±ÿ¥€å (p):",customIPPlaceholder:"ŸÖÿ´ÿßŸÑ: 1.2.3.4 €åÿß proxy.example.com",preferredIPs:"ŸÑ€åÿ≥ÿ™ IP ÿ™ÿ±ÿ¨€åÿ≠€å (yx):",preferredIPsPlaceholder:"ŸÖÿ´ÿßŸÑ: 1.1.1.1:443#HongKong, 8.8.8.8:443#USA",preferredIPsURL:"URL ŸÖŸÜÿ®ÿπ IP ÿ™ÿ±ÿ¨€åÿ≠€å (yxURL):",latencyTest:"ÿ™ÿ≥ÿ™ ÿ™ÿßÿÆ€åÿ±",latencyTestIP:"IP/ÿØÿßŸÖŸÜŸá ÿ™ÿ≥ÿ™:",latencyTestIPPlaceholder:"IP €åÿß ÿØÿßŸÖŸÜŸá Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØÿå ⁄ÜŸÜÿØ ŸÖŸàÿ±ÿØ ÿ®ÿß ⁄©ÿßŸÖÿß ÿ¨ÿØÿß ÿ¥ŸàŸÜÿØ",latencyTestPort:"ŸæŸàÿ±ÿ™:",startTest:"ÿ¥ÿ±Ÿàÿπ ÿ™ÿ≥ÿ™",stopTest:"ÿ™ŸàŸÇŸÅ ÿ™ÿ≥ÿ™",testResult:"ŸÜÿ™€åÿ¨Ÿá ÿ™ÿ≥ÿ™:",addToYx:"ÿßŸÅÿ≤ŸàÿØŸÜ ÿ®Ÿá ŸÑ€åÿ≥ÿ™ ÿ™ÿ±ÿ¨€åÿ≠€å",addSelectedToYx:"ÿßŸÅÿ≤ŸàÿØŸÜ ŸÖŸàÿßÿ±ÿØ ÿßŸÜÿ™ÿÆÿßÿ® ÿ¥ÿØŸá",selectAll:"ÿßŸÜÿ™ÿÆÿßÿ® ŸáŸÖŸá",deselectAll:"ŸÑÿ∫Ÿà ÿßŸÜÿ™ÿÆÿßÿ®",testingInProgress:"ÿØÿ± ÿ≠ÿßŸÑ ÿ™ÿ≥ÿ™...",testComplete:"ÿ™ÿ≥ÿ™ ⁄©ÿßŸÖŸÑ ÿ¥ÿØ",latencyMs:"ÿ™ÿßÿÆ€åÿ± (ŸáŸÜÿØÿ¥€å⁄©)",timeout:"ÿ≤ŸÖÿßŸÜ ÿ™ŸÖÿßŸÖ ÿ¥ÿØ",ipSource:"ŸÖŸÜÿ®ÿπ IP:",manualInput:"Ÿàÿ±ŸàÿØ€å ÿØÿ≥ÿ™€å",cfRandomIP:"IP ÿ™ÿµÿßÿØŸÅ€å CF",urlFetch:"ÿØÿ±€åÿßŸÅÿ™ ÿßÿ≤ URL",randomCount:"ÿ™ÿπÿØÿßÿØ ÿ™ŸàŸÑ€åÿØ:",fetchURL:"URL ÿØÿ±€åÿßŸÅÿ™:",fetchURLPlaceholder:"ÿ¢ÿØÿ±ÿ≥ URL ŸÑ€åÿ≥ÿ™ IP ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ",generateIP:"ÿ™ŸàŸÑ€åÿØ IP",fetchIP:"ÿØÿ±€åÿßŸÅÿ™ IP",socks5Config:"ÿ™ŸÜÿ∏€åŸÖÿßÿ™ SOCKS5 (s):",customHomepage:"URL ÿµŸÅÿ≠Ÿá ÿßÿµŸÑ€å ÿ≥ŸÅÿßÿ±ÿ¥€å (homepage):",customHomepagePlaceholder:"ŸÖÿ´ÿßŸÑ: https://example.com",customHomepageHint:"ÿ™ŸÜÿ∏€åŸÖ URL ÿ≥ŸÅÿßÿ±ÿ¥€å ÿ®Ÿá ÿπŸÜŸàÿßŸÜ ÿßÿ≥ÿ™ÿ™ÿßÿ± ÿµŸÅÿ≠Ÿá ÿßÿµŸÑ€å. ŸáŸÜ⁄ØÿßŸÖ ÿØÿ≥ÿ™ÿ±ÿ≥€å ÿ®Ÿá ŸÖÿ≥€åÿ± ÿßÿµŸÑ€å / ŸÖÿ≠ÿ™Ÿàÿß€å ÿß€åŸÜ URL ŸÜŸÖÿß€åÿ¥ ÿØÿßÿØŸá ŸÖ€å‚Äåÿ¥ŸàÿØ. ÿß⁄Øÿ± ÿÆÿßŸÑ€å ÿ®⁄Øÿ∞ÿßÿ±€åÿØ ÿµŸÅÿ≠Ÿá ÿ™ÿ±ŸÖ€åŸÜÿßŸÑ Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ ŸÜŸÖÿß€åÿ¥ ÿØÿßÿØŸá ŸÖ€å‚Äåÿ¥ŸàÿØ.",customPathHint:"Ÿæÿ≥ ÿßÿ≤ ÿ™ŸÜÿ∏€åŸÖÿå ŸÅŸÇÿ∑ ÿßÿ≤ ÿ∑ÿ±€åŸÇ ÿß€åŸÜ ŸÖÿ≥€åÿ± ŸÇÿßÿ®ŸÑ ÿØÿ≥ÿ™ÿ±ÿ≥€å ÿÆŸàÿßŸáÿØ ÿ®ŸàÿØ. Ÿæ€åÿ¥ŸÜŸáÿßÿØ ŸÖ€å‚Äåÿ¥ŸàÿØ ÿ®ÿ±ÿß€å ÿßŸÖŸÜ€åÿ™ ÿ®€åÿ¥ÿ™ÿ± ÿßÿ≤ ŸÖÿ≥€åÿ± Ÿæ€å⁄Ü€åÿØŸá ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ.",customIPHint:"ŸÖÿÆŸÅ€å ⁄©ÿ±ÿØŸÜ IP ÿßÿµŸÑ€å Worker €åÿß ÿ≠ŸÑ ŸÖÿ¥⁄©ŸÑ Cloudflare Loop. ŸÅÿ±ŸÖÿ™: IP:Port €åÿß Domain:Port.",preferredIPsHint:"ÿ™ÿπ€å€åŸÜ ÿØÿ≥ÿ™€å ŸÜŸàÿØŸáÿß€å ÿ™ÿ±ÿ¨€åÿ≠€å. ÿ®ÿßŸÑÿßÿ™ÿ±€åŸÜ ÿßŸàŸÑŸà€åÿ™. ŸÅÿ±ŸÖÿ™: IP:Port#ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™.",socks5ConfigHint:"ŸÅÿ±ŸÖÿ™: user:pass@host:port. Worker ÿßÿ≤ ÿ∑ÿ±€åŸÇ ÿß€åŸÜ Ÿæÿ±Ÿà⁄©ÿ≥€å ÿ®Ÿá ŸáÿØŸÅ ŸÖÿ™ÿµŸÑ ŸÖ€å‚Äåÿ¥ŸàÿØ.",saveConfig:"ÿ∞ÿÆ€åÿ±Ÿá ÿ™ŸÜÿ∏€åŸÖÿßÿ™",advancedControl:"⁄©ŸÜÿ™ÿ±ŸÑ Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá",subscriptionConverter:"ÿ¢ÿØÿ±ÿ≥ ÿ™ÿ®ÿØ€åŸÑ ÿßÿ¥ÿ™ÿ±ÿß⁄©:",builtinPreferred:"ŸÜŸàÿπ ÿ™ÿ±ÿ¨€åÿ≠€å ÿØÿßÿÆŸÑ€å:",enablePreferredDomain:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å ÿØÿßŸÖŸÜŸá ÿ™ÿ±ÿ¨€åÿ≠€å",enablePreferredIP:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å IP ÿ™ÿ±ÿ¨€åÿ≠€å",enableGitHubPreferred:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å ÿ™ÿ±ÿ¨€åÿ≠ Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ GitHub",enableDiverseProxies:"Enable Diverse Proxies (Generate all ports)",enableDiverseProxiesHint:"Generate nodes for all supported ports (80, 443, 2053, etc.) for each IP.",allowAPIManagement:"ÿßÿ¨ÿßÿ≤Ÿá ŸÖÿØ€åÿ±€åÿ™ API (ae):",regionMatching:"ÿ™ÿ∑ÿ®€åŸÇ ŸÖŸÜÿ∑ŸÇŸá (rm):",downgradeControl:"⁄©ŸÜÿ™ÿ±ŸÑ ⁄©ÿßŸáÿ¥ ÿ≥ÿ∑ÿ≠ (qj):",tlsControl:"⁄©ŸÜÿ™ÿ±ŸÑ TLS (dkby):",preferredControl:"⁄©ŸÜÿ™ÿ±ŸÑ ÿ™ÿ±ÿ¨€åÿ≠€å (yxby):",saveAdvanced:"ÿ∞ÿÆ€åÿ±Ÿá ÿ™ŸÜÿ∏€åŸÖÿßÿ™ Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá",loading:"ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å...",currentConfig:"üìç Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ŸÖÿ≥€åÿ± ŸÅÿπŸÑ€å",refreshConfig:"ÿ™ÿßÿ≤Ÿá‚Äåÿ≥ÿßÿ≤€å ÿ™ŸÜÿ∏€åŸÖÿßÿ™",resetConfig:"ÿ®ÿßÿ≤ŸÜÿ¥ÿßŸÜ€å ÿ™ŸÜÿ∏€åŸÖÿßÿ™",subscriptionCopied:"ŸÑ€åŸÜ⁄© ÿßÿ¥ÿ™ÿ±ÿß⁄© ⁄©Ÿæ€å ÿ¥ÿØ",autoSubscriptionCopied:"ŸÑ€åŸÜ⁄© ÿßÿ¥ÿ™ÿ±ÿß⁄© ÿ™ÿ¥ÿÆ€åÿµ ÿÆŸàÿØ⁄©ÿßÿ± ⁄©Ÿæ€å ÿ¥ÿØÿå ⁄©ŸÑÿß€åŸÜÿ™ ŸáŸÜ⁄ØÿßŸÖ ÿØÿ≥ÿ™ÿ±ÿ≥€å ÿ®ÿ± ÿßÿ≥ÿßÿ≥ User-Agent ÿ®Ÿá ÿ∑Ÿàÿ± ÿÆŸàÿØ⁄©ÿßÿ± ÿ™ÿ¥ÿÆ€åÿµ ÿØÿßÿØŸá Ÿà ŸÇÿßŸÑÿ® ŸÖÿ±ÿ®Ÿàÿ∑Ÿá ÿ±ÿß ÿ®ÿ±ŸÖ€å‚Äå⁄Øÿ±ÿØÿßŸÜÿØ",trojanPasswordPlaceholder:"ÿÆÿßŸÑ€å ÿ®⁄Øÿ∞ÿßÿ±€åÿØ ÿ™ÿß ÿßÿ≤ UUID ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿ¥ŸàÿØ",trojanPasswordHint:"ÿ±ŸÖÿ≤ ÿπÿ®Ÿàÿ± Trojan ÿ≥ŸÅÿßÿ±ÿ¥€å ÿ±ÿß ÿ™ŸÜÿ∏€åŸÖ ⁄©ŸÜ€åÿØ. ÿß⁄Øÿ± ÿÆÿßŸÑ€å ÿ®⁄Øÿ∞ÿßÿ±€åÿØ ÿßÿ≤ UUID ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äåÿ¥ŸàÿØ. ⁄©ŸÑÿß€åŸÜÿ™ ÿ®Ÿá ÿ∑Ÿàÿ± ÿÆŸàÿØ⁄©ÿßÿ± ÿ±ŸÖÿ≤ ÿπÿ®Ÿàÿ± ÿ±ÿß ÿ®ÿß SHA224 Ÿáÿ¥ ŸÖ€å‚Äå⁄©ŸÜÿØ.",protocolHint:"ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ⁄ÜŸÜÿØ€åŸÜ Ÿæÿ±Ÿàÿ™⁄©ŸÑ ÿ±ÿß ŸáŸÖÿ≤ŸÖÿßŸÜ ŸÅÿπÿßŸÑ ⁄©ŸÜ€åÿØ. ÿßÿ¥ÿ™ÿ±ÿß⁄© ⁄Øÿ±Ÿá‚ÄåŸáÿß€å Ÿæÿ±Ÿàÿ™⁄©ŸÑ‚ÄåŸáÿß€å ÿßŸÜÿ™ÿÆÿßÿ® ÿ¥ÿØŸá ÿ±ÿß ÿ™ŸàŸÑ€åÿØ ŸÖ€å‚Äå⁄©ŸÜÿØ.<br>‚Ä¢ VLESS WS: Ÿæÿ±Ÿàÿ™⁄©ŸÑ ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ ŸÖÿ®ÿ™ŸÜ€å ÿ®ÿ± WebSocket<br>‚Ä¢ VMess WS: Ÿæÿ±Ÿàÿ™⁄©ŸÑ VMess ŸÖÿ®ÿ™ŸÜ€å ÿ®ÿ± WebSocket (ÿ™ŸàŸÑ€åÿØ ŸÑ€åŸÜ⁄©)<br>‚Ä¢ Shadowsocks: Ÿæÿ±Ÿàÿ™⁄©ŸÑ SS ŸÖÿ®ÿ™ŸÜ€å ÿ®ÿ± WebSocket (ÿ™ŸàŸÑ€åÿØ ŸÑ€åŸÜ⁄©)<br>‚Ä¢ Trojan: ÿßÿ≠ÿ±ÿßÿ≤ ŸáŸà€åÿ™ ÿ®ÿß ÿ±ŸÖÿ≤ ÿπÿ®Ÿàÿ± SHA224<br>‚Ä¢ xhttp: Ÿæÿ±Ÿàÿ™⁄©ŸÑ ÿßÿ≥ÿ™ÿ™ÿßÿ± ŸÖÿ®ÿ™ŸÜ€å ÿ®ÿ± HTTP POST (ŸÜ€åÿßÿ≤ ÿ®Ÿá ÿßÿ™ÿµÿßŸÑ ÿØÿßŸÖŸÜŸá ÿ≥ŸÅÿßÿ±ÿ¥€å Ÿà ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å gRPC ÿØÿßÿ±ÿØ)",saveProtocol:"ÿ∞ÿÆ€åÿ±Ÿá ÿ™ŸÜÿ∏€åŸÖÿßÿ™ Ÿæÿ±Ÿàÿ™⁄©ŸÑ",subscriptionConverterPlaceholder:"Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂: https://url.v1.mk/sub",subscriptionConverterHint:"ÿ¢ÿØÿ±ÿ≥ API ÿ™ÿ®ÿØ€åŸÑ ÿßÿ¥ÿ™ÿ±ÿß⁄© ÿ≥ŸÅÿßÿ±ÿ¥€åÿå ÿß⁄Øÿ± ÿÆÿßŸÑ€å ÿ®⁄Øÿ∞ÿßÿ±€åÿØ ÿßÿ≤ ÿ¢ÿØÿ±ÿ≥ Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äåÿ¥ŸàÿØ",builtinPreferredHint:"⁄©ŸÜÿ™ÿ±ŸÑ ÿß€åŸÜ⁄©Ÿá ⁄©ÿØÿßŸÖ ⁄Øÿ±Ÿá‚ÄåŸáÿß€å ÿ™ÿ±ÿ¨€åÿ≠€å ÿØÿßÿÆŸÑ€å ÿØÿ± ÿßÿ¥ÿ™ÿ±ÿß⁄© ⁄ØŸÜÿ¨ÿßŸÜÿØŸá ÿ¥ŸàŸÜÿØ. ÿ®Ÿá ÿ∑Ÿàÿ± Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ ŸáŸÖŸá ŸÅÿπÿßŸÑ Ÿáÿ≥ÿ™ŸÜÿØ.",apiEnabledDefault:"Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ (ÿ®ÿ≥ÿ™ŸÜ API)",apiEnabledYes:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å ŸÖÿØ€åÿ±€åÿ™ API",apiEnabledHint:"‚ö†Ô∏è Ÿáÿ¥ÿØÿßÿ± ÿßŸÖŸÜ€åÿ™€å: ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å ÿß€åŸÜ ⁄Øÿ≤€åŸÜŸá ÿßÿ¨ÿßÿ≤Ÿá ŸÖ€å‚ÄåÿØŸáÿØ IP Ÿáÿß€å ÿ™ÿ±ÿ¨€åÿ≠€å ÿßÿ≤ ÿ∑ÿ±€åŸÇ API ÿ®Ÿá ÿ∑Ÿàÿ± ŸæŸà€åÿß ÿßÿ∂ÿßŸÅŸá ÿ¥ŸàŸÜÿØ. ÿ™Ÿàÿµ€åŸá ŸÖ€å‚Äåÿ¥ŸàÿØ ŸÅŸÇÿ∑ ÿØÿ± ÿµŸàÿ±ÿ™ ŸÜ€åÿßÿ≤ ŸÅÿπÿßŸÑ ⁄©ŸÜ€åÿØ.",regionMatchingDefault:"Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ (ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å ÿ™ÿ∑ÿ®€åŸÇ ŸÖŸÜÿ∑ŸÇŸá)",regionMatchingNo:"ÿ®ÿ≥ÿ™ŸÜ ÿ™ÿ∑ÿ®€åŸÇ ŸÖŸÜÿ∑ŸÇŸá",regionMatchingHint:'ŸàŸÇÿ™€å "ÿ®ÿ≥ÿ™ŸÜ" ÿ™ŸÜÿ∏€åŸÖ ÿ¥ŸàÿØÿå ÿ™ÿ∑ÿ®€åŸÇ ŸáŸàÿ¥ŸÖŸÜÿØ ŸÖŸÜÿ∑ŸÇŸá ÿßŸÜÿ¨ÿßŸÖ ŸÜŸÖ€å‚Äåÿ¥ŸàÿØ',downgradeControlDefault:"Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ (ÿπÿØŸÖ ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å ⁄©ÿßŸáÿ¥ ÿ≥ÿ∑ÿ≠)",downgradeControlNo:"ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å ÿ≠ÿßŸÑÿ™ ⁄©ÿßŸáÿ¥ ÿ≥ÿ∑ÿ≠",downgradeControlHint:'ŸàŸÇÿ™€å "ŸÅÿπÿßŸÑ" ÿ™ŸÜÿ∏€åŸÖ ÿ¥ŸàÿØ: ÿßÿ™ÿµÿßŸÑ ŸÖÿ≥ÿ™ŸÇ€åŸÖ CF ŸÜÿßŸÖŸàŸÅŸÇ ‚Üí ÿßÿ™ÿµÿßŸÑ SOCKS5 ‚Üí ÿ¢ÿØÿ±ÿ≥ fallback',tlsControlDefault:"Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ (ÿ≠ŸÅÿ∏ ŸáŸÖŸá ⁄Øÿ±Ÿá‚ÄåŸáÿß)",tlsControlYes:"ŸÅŸÇÿ∑ ⁄Øÿ±Ÿá‚ÄåŸáÿß€å TLS",tlsControlHint:'ŸàŸÇÿ™€å "ŸÅŸÇÿ∑ ⁄Øÿ±Ÿá‚ÄåŸáÿß€å TLS" ÿ™ŸÜÿ∏€åŸÖ ÿ¥ŸàÿØÿå ŸÅŸÇÿ∑ ⁄Øÿ±Ÿá‚ÄåŸáÿß€å ÿ®ÿß TLS ÿ™ŸàŸÑ€åÿØ ŸÖ€å‚Äåÿ¥ŸàŸÜÿØÿå ⁄Øÿ±Ÿá‚ÄåŸáÿß€å ÿ∫€åÿ± TLS (ŸÖÿßŸÜŸÜÿØ ŸæŸàÿ±ÿ™ 80) ÿ™ŸàŸÑ€åÿØ ŸÜŸÖ€å‚Äåÿ¥ŸàŸÜÿØ',preferredControlDefault:"Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ (ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å ÿ™ÿ±ÿ¨€åÿ≠)",preferredControlYes:"ÿ®ÿ≥ÿ™ŸÜ ÿ™ÿ±ÿ¨€åÿ≠",preferredControlHint:'ŸàŸÇÿ™€å "ÿ®ÿ≥ÿ™ŸÜ ÿ™ÿ±ÿ¨€åÿ≠" ÿ™ŸÜÿ∏€åŸÖ ÿ¥ŸàÿØÿå ŸÅŸÇÿ∑ ÿßÿ≤ ÿ¢ÿØÿ±ÿ≥ ÿßÿµŸÑ€å ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äåÿ¥ŸàÿØÿå ⁄Øÿ±Ÿá‚ÄåŸáÿß€å IP Ÿà ÿØÿßŸÖŸÜŸá ÿ™ÿ±ÿ¨€åÿ≠€å ÿ™ŸàŸÑ€åÿØ ŸÜŸÖ€å‚Äåÿ¥ŸàŸÜÿØ',regionNames:{US:"üá∫üá∏ ÿ¢ŸÖÿ±€å⁄©ÿß",SG:"üá∏üá¨ ÿ≥ŸÜ⁄ØÿßŸæŸàÿ±",JP:"üáØüáµ ⁄òÿßŸæŸÜ",KR:"üá∞üá∑ ⁄©ÿ±Ÿá ÿ¨ŸÜŸàÿ®€å",DE:"üá©üá™ ÿ¢ŸÑŸÖÿßŸÜ",SE:"üá∏üá™ ÿ≥Ÿàÿ¶ÿØ",NL:"üá≥üá± ŸáŸÑŸÜÿØ",FI:"üá´üáÆ ŸÅŸÜŸÑÿßŸÜÿØ",GB:"üá¨üáß ÿ®ÿ±€åÿ™ÿßŸÜ€åÿß",FR:"üá´üá∑ ŸÅÿ±ÿßŸÜÿ≥Ÿá",CA:"üá®üá¶ ⁄©ÿßŸÜÿßÿØÿß",AU:"üá¶üá∫ ÿßÿ≥ÿ™ÿ±ÿßŸÑ€åÿß",HK:"üá≠üá∞ ŸáŸÜ⁄Ø ⁄©ŸÜ⁄Ø",TW:"üáπüáº ÿ™ÿß€åŸàÿßŸÜ"},terminal:"ÿ™ÿ±ŸÖ€åŸÜÿßŸÑ v2.9.3",githubProject:"Ÿæÿ±Ÿà⁄òŸá GitHub",autoDetectClient:"ÿ™ÿ¥ÿÆ€åÿµ ÿÆŸàÿØ⁄©ÿßÿ±",selectionLogicText:"ŸáŸÖ‚ÄåŸÖŸÜÿ∑ŸÇŸá ‚Üí ŸÖŸÜÿ∑ŸÇŸá ŸÖÿ¨ÿßŸàÿ± ‚Üí ÿ≥ÿß€åÿ± ŸÖŸÜÿßÿ∑ŸÇ",customIPDisabledHint:"ŸáŸÜ⁄ØÿßŸÖ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ProxyIP ÿ≥ŸÅÿßÿ±ÿ¥€åÿå ÿßŸÜÿ™ÿÆÿßÿ® ŸÖŸÜÿ∑ŸÇŸá ÿ∫€åÿ±ŸÅÿπÿßŸÑ ÿßÿ≥ÿ™",customIPMode:"ÿ≠ÿßŸÑÿ™ ProxyIP ÿ≥ŸÅÿßÿ±ÿ¥€å (ŸÖÿ™ÿ∫€åÿ± p ŸÅÿπÿßŸÑ ÿßÿ≥ÿ™)",customIPModeDesc:"ÿ≠ÿßŸÑÿ™ IP ÿ≥ŸÅÿßÿ±ÿ¥€å (ÿ™ÿ∑ÿ®€åŸÇ ŸÖŸÜÿ∑ŸÇŸá ÿ∫€åÿ±ŸÅÿπÿßŸÑ ÿßÿ≥ÿ™)",usingCustomProxyIP:"ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ProxyIP ÿ≥ŸÅÿßÿ±ÿ¥€å: ",customIPConfig:" (Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ŸÖÿ™ÿ∫€åÿ± p)",customIPModeDisabled:"ÿ≠ÿßŸÑÿ™ IP ÿ≥ŸÅÿßÿ±ÿ¥€åÿå ÿßŸÜÿ™ÿÆÿßÿ® ŸÖŸÜÿ∑ŸÇŸá ÿ∫€åÿ±ŸÅÿπÿßŸÑ ÿßÿ≥ÿ™",manualRegion:"ÿ™ÿπ€å€åŸÜ ŸÖŸÜÿ∑ŸÇŸá ÿØÿ≥ÿ™€å",manualRegionDesc:" (ÿ™ÿπ€å€åŸÜ ÿØÿ≥ÿ™€å)",proxyIPAvailable:"10/10 ÿØÿ± ÿØÿ≥ÿ™ÿ±ÿ≥ (ÿØÿßŸÖŸÜŸá Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ ProxyIP ÿØÿ± ÿØÿ≥ÿ™ÿ±ÿ≥ ÿßÿ≥ÿ™)",smartSelection:"ÿßŸÜÿ™ÿÆÿßÿ® ŸáŸàÿ¥ŸÖŸÜÿØ ŸÜÿ≤ÿØ€å⁄© ÿØÿ± ÿ≠ÿßŸÑ ÿßŸÜÿ¨ÿßŸÖ ÿßÿ≥ÿ™",sameRegionIP:"IP ŸáŸÖ‚ÄåŸÖŸÜÿ∑ŸÇŸá ÿØÿ± ÿØÿ≥ÿ™ÿ±ÿ≥ ÿßÿ≥ÿ™ (1)",cloudflareDetection:"ÿ™ÿ¥ÿÆ€åÿµ ÿØÿßÿÆŸÑ€å Cloudflare",detectionFailed:"ÿ™ÿ¥ÿÆ€åÿµ ŸÜÿßŸÖŸàŸÅŸÇ",apiTestResult:"ŸÜÿ™€åÿ¨Ÿá ÿ™ÿ¥ÿÆ€åÿµ API: ",apiTestTime:"ÿ≤ŸÖÿßŸÜ ÿ™ÿ¥ÿÆ€åÿµ: ",apiTestFailed:"ÿ™ÿ¥ÿÆ€åÿµ API ŸÜÿßŸÖŸàŸÅŸÇ: ",unknownError:"ÿÆÿ∑ÿß€å ŸÜÿßÿ¥ŸÜÿßÿÆÿ™Ÿá",apiTestError:"ÿ™ÿ≥ÿ™ API ŸÜÿßŸÖŸàŸÅŸÇ: ",kvNotConfigured:"ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ŸÜÿ¥ÿØŸá ÿßÿ≥ÿ™ÿå ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿßÿ≤ ÿπŸÖŸÑ⁄©ÿ±ÿØ ŸÖÿØ€åÿ±€åÿ™ ÿ™ŸÜÿ∏€åŸÖÿßÿ™ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ.\\n\\nŸÑÿ∑ŸÅÿß ÿØÿ± Cloudflare Workers:\\n1. ŸÅÿ∂ÿß€å ŸÜÿßŸÖ KV ÿß€åÿ¨ÿßÿØ ⁄©ŸÜ€åÿØ\\n2. ŸÖÿ™ÿ∫€åÿ± ŸÖÿ≠€åÿ∑€å C ÿ±ÿß Ÿæ€åŸàŸÜÿØ ÿØŸá€åÿØ\\n3. ⁄©ÿØ ÿ±ÿß ÿØŸàÿ®ÿßÿ±Ÿá ŸÖÿ≥ÿ™ŸÇÿ± ⁄©ŸÜ€åÿØ",kvNotEnabled:"ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ŸÜÿ¥ÿØŸá ÿßÿ≥ÿ™",kvCheckFailed:"ÿ®ÿ±ÿ±ÿ≥€å ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÜÿßŸÖŸàŸÅŸÇ: ÿÆÿ∑ÿß€å ŸÅÿ±ŸÖÿ™ Ÿæÿßÿ≥ÿÆ",kvCheckFailedStatus:"ÿ®ÿ±ÿ±ÿ≥€å ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÜÿßŸÖŸàŸÅŸÇ - ⁄©ÿØ Ÿàÿ∂ÿπ€åÿ™: ",kvCheckFailedError:"ÿ®ÿ±ÿ±ÿ≥€å ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÜÿßŸÖŸàŸÅŸÇ - ÿÆÿ∑ÿß: "}}[a?"fa":"en"],s=`<!DOCTYPE html>\n        <html lang="${a?"fa-IR":"en-US"}" dir="${a?"rtl":"ltr"}">\n    <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n            <title>${r.title}</title>\n        <style>\n            * { margin: 0; padding: 0; box-sizing: border-box; }\n            body {\n                font-family: "Courier New", monospace;\n                background: #000; color: #00ff00; min-height: 100vh;\n                overflow-x: hidden; position: relative;\n            }\n            .matrix-bg {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                background: #000;\n                z-index: -1;\n            }\n            @keyframes bg-pulse {\n                0%, 100% { background: linear-gradient(45deg, #000 0%, #001100 50%, #000 100%); }\n                50% { background: linear-gradient(45deg, #000 0%, #002200 50%, #000 100%); }\n            }\n            .matrix-rain {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                background: transparent;\n                z-index: -1;\n                display: none;\n            }\n            @keyframes matrix-fall {\n                0% { transform: translateY(-100%); }\n                100% { transform: translateY(100vh); }\n            }\n            .matrix-code-rain {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                pointer-events: none; z-index: -1;\n                overflow: hidden;\n                display: none;\n            }\n            .matrix-column {\n                position: absolute; top: -100%; left: 0;\n                color: #00ff00; font-family: "Courier New", monospace;\n                font-size: 14px; line-height: 1.2;\n                text-shadow: 0 0 5px #00ff00;\n            }\n            @keyframes matrix-drop {\n                0% { top: -100%; opacity: 1; }\n                10% { opacity: 1; }\n                90% { opacity: 0.3; }\n                100% { top: 100vh; opacity: 0; }\n            }\n            .matrix-column:nth-child(odd) {\n                animation-duration: 12s;\n                animation-delay: -2s;\n            }\n            .matrix-column:nth-child(even) {\n                animation-duration: 18s;\n                animation-delay: -5s;\n            }\n            .matrix-column:nth-child(3n) {\n                animation-duration: 20s;\n                animation-delay: -8s;\n            }\n            .container { max-width: 900px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }\n            .header { text-align: center; margin-bottom: 40px; }\n            .title {\n                font-size: 3.5rem; font-weight: bold;\n                text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00, 0 0 40px #00ff00;\n                margin-bottom: 10px;\n                position: relative;\n                color: #00ff00;\n            }\n            @keyframes matrix-glow {\n                from { text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00, 0 0 40px #00ff00; }\n                to { text-shadow: 0 0 20px #00ff00, 0 0 30px #00ff00, 0 0 40px #00ff00, 0 0 50px #00ff00; }\n            }\n            @keyframes matrix-pulse {\n                0%, 100% { background-position: 0% 50%; }\n                50% { background-position: 100% 50%; }\n            }\n            .subtitle { color: #00aa00; margin-bottom: 30px; font-size: 1.2rem; }\n            .card {\n                background: rgba(0, 20, 0, 0.9);\n                border: 2px solid #00ff00;\n                border-radius: 0; padding: 30px; margin-bottom: 20px;\n                box-shadow: 0 0 30px rgba(0, 255, 0, 0.5), inset 0 0 20px rgba(0, 255, 0, 0.1);\n                position: relative;\n                backdrop-filter: blur(10px);\n                box-sizing: border-box;\n                width: 100%;\n                max-width: 100%;\n            }\n            @keyframes card-glow {\n                0%, 100% { box-shadow: 0 0 30px rgba(0, 255, 0, 0.5), inset 0 0 20px rgba(0, 255, 0, 0.1); }\n                50% { box-shadow: 0 0 40px rgba(0, 255, 0, 0.7), inset 0 0 30px rgba(0, 255, 0, 0.2); }\n            }\n            .card::before {\n                content: ""; position: absolute; top: 0; left: 0;\n                width: 100%; height: 100%;\n                background: none;\n                opacity: 0; pointer-events: none;\n            }\n            @keyframes scan-line {\n                0% { transform: translateX(-100%); }\n                100% { transform: translateX(100%); }\n            }\n            .card-title {\n                font-size: 1.8rem; margin-bottom: 20px;\n                color: #00ff00; text-shadow: 0 0 5px #00ff00;\n            }\n            .client-grid {\n                display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n                gap: 15px; margin: 20px 0;\n            }\n            .client-btn {\n                background: rgba(0, 20, 0, 0.8);\n                border: 2px solid #00ff00;\n                padding: 15px 20px; color: #00ff00;\n                font-family: "Courier New", monospace; font-weight: bold;\n                cursor: pointer; transition: all 0.4s ease;\n                text-align: center; position: relative;\n                overflow: hidden;\n                text-shadow: 0 0 5px #00ff00;\n                box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);\n            }\n            .client-btn::before {\n                content: ""; position: absolute; top: 0; left: -100%;\n                width: 100%; height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(0,255,0,0.4), transparent);\n                transition: left 0.6s ease;\n            }\n            .client-btn::after {\n                content: ""; position: absolute; top: 0; left: 0;\n                width: 100%; height: 100%;\n                background: linear-gradient(45deg, transparent 30%, rgba(0,255,0,0.1) 50%, transparent 70%);\n                opacity: 0;\n                transition: opacity 0.3s ease;\n            }\n            .client-btn:hover::before { left: 100%; }\n            .client-btn:hover::after { opacity: 1; }\n            .client-btn:hover {\n                background: rgba(0, 255, 0, 0.3);\n                box-shadow: 0 0 25px #00ff00, 0 0 35px rgba(0, 255, 0, 0.5);\n                transform: translateY(-3px) scale(1.05);\n                text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;\n            }\n            .generate-btn {\n                background: rgba(0, 255, 0, 0.15);\n                border: 2px solid #00ff00; padding: 15px 30px;\n                color: #00ff00; font-family: "Courier New", monospace;\n                font-weight: bold; cursor: pointer;\n                transition: all 0.4s ease; margin-right: 15px;\n                text-shadow: 0 0 8px #00ff00;\n                box-shadow: 0 0 15px rgba(0, 255, 0, 0.4);\n                position: relative;\n                overflow: hidden;\n            }\n            .generate-btn::before {\n                content: ""; position: absolute; top: 0; left: -100%;\n                width: 100%; height: 100%;\n                background: linear-gradient(90deg, transparent, rgba(0,255,0,0.5), transparent);\n                transition: left 0.8s ease;\n            }\n            .generate-btn:hover::before { left: 100%; }\n            .generate-btn:hover {\n                background: rgba(0, 255, 0, 0.4);\n                box-shadow: 0 0 30px #00ff00, 0 0 40px rgba(0, 255, 0, 0.6);\n                transform: translateY(-4px) scale(1.08);\n                text-shadow: 0 0 15px #00ff00, 0 0 25px #00ff00;\n            }\n            .atob('c3Vic2NyaXB0aW9u')-url {\n                background: rgba(0, 0, 0, 0.9);\n                border: 2px solid #00ff00; padding: 15px;\n                word-break: break-all; font-family: "Courier New", monospace;\n                color: #00ff00; margin-top: 20px; display: none;\n                box-shadow: inset 0 0 15px rgba(0, 255, 0, 0.4), 0 0 20px rgba(0, 255, 0, 0.3);\n                border-radius: 5px;\n                position: relative;\n                overflow-wrap: break-word;\n                overflow-x: auto;\n                max-width: 100%;\n                box-sizing: border-box;\n            }\n            @keyframes url-glow {\n                from { box-shadow: inset 0 0 15px rgba(0, 255, 0, 0.4), 0 0 20px rgba(0, 255, 0, 0.3); }\n                to { box-shadow: inset 0 0 20px rgba(0, 255, 0, 0.6), 0 0 30px rgba(0, 255, 0, 0.5); }\n            }\n            .atob('c3Vic2NyaXB0aW9u')-url::before {\n                content: ""; position: absolute; top: 0; left: -100%;\n                width: 100%; height: 100%;\n                background: none;\n            }\n            @keyframes url-scan {\n                0% { left: -100%; }\n                100% { left: 100%; }\n            }\n            .matrix-text {\n                position: fixed; top: 20px; right: 20px;\n                color: #00ff00; font-family: "Courier New", monospace;\n                font-size: 0.8rem; opacity: 0.6;\n            }\n            @keyframes matrix-flicker {\n                0%, 100% { opacity: 0.6; }\n                50% { opacity: 1; }\n            }\n        </style>\n    </head>\n    <body>\n        <div class="matrix-bg"></div>\n        <div class="matrix-rain"></div>\n        <div class="matrix-code-rain" id="matrixCodeRain"></div>\n            <div class="matrix-text">${r.terminal}</div>\n            <div style="position: fixed; top: 20px; left: 20px; z-index: 1000;">\n                <select id="languageSelector" style="background: rgba(0, 20, 0, 0.9); border: 2px solid #00ff00; color: #00ff00; padding: 8px 12px; font-family: 'Courier New', monospace; font-size: 14px; cursor: pointer; text-shadow: 0 0 5px #00ff00; box-shadow: 0 0 15px rgba(0, 255, 0, 0.4);" onchange="changeLanguage(this.value)">\n                    <option value="en" ${a?"":"selected"}>üá∫üá∏ English</option>\n                    <option value="fa" ${a?"selected":""}>üáÆüá∑ ŸÅÿßÿ±ÿ≥€å</option>\n                </select>\n            </div>\n        <div class="container">\n            <div class="header">\n                    <h1 class="title">${r.title}</h1>\n                    <p class="subtitle">${r.subtitle}</p>\n            </div>\n            <div class="card">\n                    <h2 class="card-title">${r.selectClient}</h2>\n                <div class="client-grid">\n                    <button class="client-btn" onclick="generateClientLink(atob('Y2xhc2g='), 'CLASH')">CLASH</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('Y2xhc2g='), 'STASH')">STASH</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('c3VyZ2U='), 'SURGE')">SURGE</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('c2luZ2JveA=='), 'SING-BOX')">SING-BOX</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('bG9vbg=='), 'LOON')">LOON</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('cXVhbng='), 'QUANTUMULT X')">QUANTUMULT X</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('djJyYXk='), 'V2RAY')">V2RAY</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('djJyYXk='), 'V2RAYNG')">V2RAYNG</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('djJyYXk='), 'NEKORAY')">NEKORAY</button>\n                    <button class="client-btn" onclick="generateClientLink(atob('djJyYXk='), 'Shadowrocket')">Shadowrocket</button>\n                </div>\n                <div class=atob('c3Vic2NyaXB0aW9uLXVybA==') id="clientSubscriptionUrl"></div>\n            </div>\n            <div class="card">\n                    <h2 class="card-title">${r.systemStatus}</h2>\n                <div id="systemStatus" style="margin: 20px 0; padding: 15px; background: rgba(0, 20, 0, 0.8); border: 2px solid #00ff00; box-shadow: 0 0 20px rgba(0, 255, 0, 0.3), inset 0 0 15px rgba(0, 255, 0, 0.1); position: relative; overflow: hidden;">\n                        <div style="color: #00ff00; margin-bottom: 15px; font-weight: bold; text-shadow: 0 0 5px #00ff00;">[ ${r.checking} ]</div>\n                        <div id="regionStatus" style="margin: 8px 0; color: #00ff00; font-family: 'Courier New', monospace; text-shadow: 0 0 3px #00ff00;">${r.workerRegion}${r.checking}</div>\n                        <div id="geoInfo" style="margin: 8px 0; color: #00aa00; font-family: 'Courier New', monospace; font-size: 0.9rem; text-shadow: 0 0 3px #00aa00;">${r.detectionMethod}${r.checking}</div>\n                        <div id="backupStatus" style="margin: 8px 0; color: #00ff00; font-family: 'Courier New', monospace; text-shadow: 0 0 3px #00ff00;">${r.proxyIPStatus}${r.checking}</div>\n                        <div id="currentIP" style="margin: 8px 0; color: #00ff00; font-family: 'Courier New', monospace; text-shadow: 0 0 3px #00ff00;">${r.currentIP}${r.checking}</div>\n                        <div id="echStatus" style="margin: 8px 0; color: #00ff00; font-family: 'Courier New', monospace; text-shadow: 0 0 3px #00ff00; font-size: 0.9rem;">ECHÁä∂ÊÄÅ: ${r.checking}</div>\n                        <div id="regionMatch" style="margin: 8px 0; color: #00ff00; font-family: 'Courier New', monospace; text-shadow: 0 0 3px #00ff00;">${r.regionMatch}${r.checking}</div>\n                        <div id="selectionLogic" style="margin: 8px 0; color: #00aa00; font-family: 'Courier New', monospace; font-size: 0.9rem; text-shadow: 0 0 3px #00aa00;">${r.selectionLogic}${r.selectionLogicText}</div>\n                </div>\n            </div>\n            <div class="card" id="configCard" style="display: none;">\n                    <h2 class="card-title">${r.configManagement}</h2>\n                <div id="kvStatus" style="margin-bottom: 20px; padding: 10px; background: rgba(0, 20, 0, 0.8); border: 1px solid #00ff00; color: #00ff00;">\n                        ${r.kvStatusChecking}\n                </div>\n                <div id="configContent" style="display: none;">\n                    <form id="regionForm" style="margin-bottom: 20px;">\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.specifyRegion}</label>\n                            <select id="wkRegion" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                    <option value="">${r.autoDetect}</option>\n                                    <option value="US">${r.regionNames.US}</option>\n                                    <option value="SG">${r.regionNames.SG}</option>\n                                    <option value="JP">${r.regionNames.JP}</option>\n                                    <option value="KR">${r.regionNames.KR}</option>\n                                    <option value="DE">${r.regionNames.DE}</option>\n                                    <option value="SE">${r.regionNames.SE}</option>\n                                    <option value="NL">${r.regionNames.NL}</option>\n                                    <option value="FI">${r.regionNames.FI}</option>\n                                    <option value="GB">${r.regionNames.GB}</option>\n                            </select>\n                                <small id="wkRegionHint" style="color: #00aa00; font-size: 0.85rem; display: none;">‚ö†Ô∏è ${r.customIPDisabledHint}</small>\n                        </div>\n                            <button type="submit" style="background: rgba(0, 255, 0, 0.15); border: 2px solid #00ff00; padding: 12px 24px; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; margin-right: 10px; text-shadow: 0 0 8px #00ff00; transition: all 0.4s ease;">${r.saveRegion}</button>\n                    </form>\n                    <form id="otherConfigForm" style="margin-bottom: 20px;">\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.protocolSelection}</label>\n                            <div style="padding: 15px; background: rgba(0, 20, 0, 0.6); border: 1px solid #00ff00; border-radius: 5px;">\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="ev" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1.1rem;">${r.enableVLESS}</span>\n                                    </label>\n                                </div>\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="et" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1.1rem;">${r.enableTrojan}</span>\n                                    </label>\n                                </div>\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="ex" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n\n                            <div class="checkbox-item" style="margin-top: 10px;">\n                                <label style="display: flex; align-items: center;"><input type="checkbox" id="evm" ${evm?"checked":""} style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;"> ${r.enableVMess}</label>\n                                <small style="color: #ffaa00; font-size: 0.8rem; display: block; margin-top: 2px; margin-left: 26px;">${r.linkOnlyHint}</small>\n                            </div>\n                            <div class="checkbox-item" style="margin-top: 10px;">\n                                <label style="display: flex; align-items: center;"><input type="checkbox" id="ess" ${ess?"checked":""} style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;"> ${r.enableShadowsocks}</label>\n                                <small style="color: #ffaa00; font-size: 0.8rem; display: block; margin-top: 2px; margin-left: 26px;">${r.linkOnlyHint}</small>\n                            </div>\n                            <div class="checkbox-item" style="margin-top: 10px;">\n                                <label style="display: flex; align-items: center;"><input type="checkbox" id="etu" ${etu?"checked":""} style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;"> ${r.enableTUIC}</label>\n                                <small style="color: #ffaa00; font-size: 0.8rem; display: block; margin-top: 2px; margin-left: 26px;">${r.linkOnlyHint}</small>\n                            </div>\n                            <div class="checkbox-item" style="margin-top: 10px;">\n                                <label style="display: flex; align-items: center;"><input type="checkbox" id="ehy" ${ehy?"checked":""} style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;"> ${r.enableHysteria2}</label>\n                                <small style="color: #ffaa00; font-size: 0.8rem; display: block; margin-top: 2px; margin-left: 26px;">${r.linkOnlyHint}</small>\n                            </div>\n                            <div class="checkbox-item" style="margin-top: 10px;">\n                                <label style="display: flex; align-items: center;"><input type="checkbox" id="eg" ${eg?"checked":""} style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;"> ${r.enableVLESSgRPC}</label>\n                                <small style="color: #ffaa00; font-size: 0.8rem; display: block; margin-top: 2px; margin-left: 26px;">${r.grpcHint}</small>\n                            </div>\n\n                                            <span style="font-size: 1.1rem;">${r.enableXhttp}</span>\n                                    </label>\n                                </div>\n                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0, 255, 0, 0.3);">\n                                    <div style="margin-bottom: 10px;">\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                            <input type="checkbox" id="ech" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                                <span style="font-size: 1.1rem;">${r.enableECH}</span>\n                                        </label>\n                                        <small style="color: #00aa00; font-size: 0.8rem; display: block; margin-top: 5px; margin-left: 26px;">${r.enableECHHint}</small>\n                                    </div>\n                                    <div style="margin-top: 15px; margin-bottom: 10px;">\n                                        <label style="display: block; margin-bottom: 8px; color: #00ff00; font-size: 0.95rem;">${r.customDNS}</label>\n                                        <input type="text" id="customDNS" placeholder="${r.customDNSPlaceholder}" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                        <small style="color: #00aa00; font-size: 0.8rem; display: block; margin-top: 5px;">${r.customDNSHint}</small>\n                                    </div>\n                                    <div style="margin-bottom: 10px;">\n                                        <label style="display: block; margin-bottom: 8px; color: #00ff00; font-size: 0.95rem;">${r.customECHDomain}</label>\n                                        <input type="text" id="customECHDomain" placeholder="${r.customECHDomainPlaceholder}" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                        <small style="color: #00aa00; font-size: 0.8rem; display: block; margin-top: 5px;">${r.customECHDomainHint}</small>\n                                    </div>\n                                </div>\n                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0, 255, 0, 0.3);">\n                                        <label style="display: block; margin-bottom: 8px; color: #00ff00; font-size: 0.95rem;">${r.trojanPassword}</label>\n                                        <input type="text" id="tp" placeholder="${r.trojanPasswordPlaceholder}" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                        <small style="color: #00aa00; font-size: 0.8rem; display: block; margin-top: 5px;">${r.trojanPasswordHint}</small>\n                                </div>\n                                    <small style="color: #00aa00; font-size: 0.85rem; display: block; margin-top: 10px;">${r.protocolHint}</small>\n                                    <button type="button" id="saveProtocolBtn" style="margin-top: 15px; background: rgba(0, 255, 0, 0.15); border: 2px solid #00ff00; padding: 10px 20px; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; text-shadow: 0 0 8px #00ff00; transition: all 0.4s ease; width: 100%;">${r.saveProtocol}</button>\n                            </div>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.customHomepage}</label>\n                                <input type="text" id="customHomepage" placeholder="${r.customHomepagePlaceholder}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${r.customHomepageHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.customPath}</label>\n                                <input type="text" id="customPath" placeholder="${r.customPathPlaceholder}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${r.customPathHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.customIP}</label>\n                                <input type="text" id="customIP" placeholder="${r.customIPPlaceholder}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${r.customIPHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.preferredIPs}</label>\n                                <input type="text" id="yx" placeholder="${r.preferredIPsPlaceholder}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${r.preferredIPsHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.preferredIPsURL}</label>\n                                <input type="text" id="yxURL" placeholder="${a?"Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂: https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt":"ÈªòËÆ§: https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt"}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${a?"URL ŸÖŸÜÿ®ÿπ ŸÑ€åÿ≥ÿ™ IP ÿ™ÿ±ÿ¨€åÿ≠€å ÿ≥ŸÅÿßÿ±ÿ¥€åÿå ÿß⁄Øÿ± ÿÆÿßŸÑ€å ÿ®⁄Øÿ∞ÿßÿ±€åÿØ ÿßÿ≤ ÿ¢ÿØÿ±ÿ≥ Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äåÿ¥ŸàÿØ":"Ëá™ÂÆö‰πâ‰ºòÈÄâIPÂàóË°®Êù•Ê∫êURLÔºåÁïôÁ©∫Âàô‰ΩøÁî®ÈªòËÆ§Âú∞ÂùÄ"}</small>\n                        </div>\n\n                        <div style="margin-bottom: 20px; padding: 15px; background: rgba(0, 40, 0, 0.6); border: 2px solid #00aa00; border-radius: 8px;">\n                            <h4 style="color: #00ff00; margin: 0 0 15px 0; font-size: 1.1rem; text-shadow: 0 0 5px #00ff00;">‚ö° ${r.latencyTest}</h4>\n                            <div style="display: flex; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; align-items: center;">\n                                <div style="min-width: 120px;">\n                                    <label style="display: block; margin-bottom: 5px; color: #00ff00; font-size: 0.9rem;">${r.ipSource}</label>\n                                    <select id="ipSourceSelect" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px; cursor: pointer;">\n                                        <option value="manual">${r.manualInput}</option>\n                                        <option value="cfRandom">${r.cfRandomIP}</option>\n                                        <option value="urlFetch">${r.urlFetch}</option>\n                                    </select>\n                                </div>\n                                <div style="width: 100px;">\n                                    <label style="display: block; margin-bottom: 5px; color: #00ff00; font-size: 0.9rem;">${r.latencyTestPort}</label>\n                                    <input type="number" id="latencyTestPort" value="443" min="1" max="65535" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                </div>\n                                <div id="randomCountDiv" style="width: 100px; display: none;">\n                                    <label style="display: block; margin-bottom: 5px; color: #00ff00; font-size: 0.9rem;">${r.randomCount}</label>\n                                    <input type="number" id="randomIPCount" value="20" min="1" max="100" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                </div>\n                                <div style="width: 80px;">\n                                    <label style="display: block; margin-bottom: 5px; color: #00ff00; font-size: 0.9rem;">${a?"ÿ±ÿ¥ÿ™Ÿá‚ÄåŸáÿß":"Á∫øÁ®ã"}</label>\n                                    <input type="number" id="testThreads" value="5" min="1" max="50" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                </div>\n                            </div>\n                            <div id="manualInputDiv" style="margin-bottom: 10px;">\n                                <label style="display: block; margin-bottom: 5px; color: #00ff00; font-size: 0.9rem;">${r.latencyTestIP}</label>\n                                <input type="text" id="latencyTestInput" placeholder="${r.latencyTestIPPlaceholder}" style="width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                            </div>\n                            <div id="urlFetchDiv" style="margin-bottom: 10px; display: none;">\n                                <label style="display: block; margin-bottom: 5px; color: #00ff00; font-size: 0.9rem;">${r.fetchURL}</label>\n                                <div style="display: flex; gap: 8px;">\n                                    <input type="text" id="fetchURLInput" placeholder="${r.fetchURLPlaceholder}" style="flex: 1; padding: 10px; background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 13px;">\n                                    <button type="button" id="fetchIPBtn" style="background: rgba(0, 200, 255, 0.2); border: 1px solid #00aaff; padding: 8px 16px; color: #00aaff; font-family: 'Courier New', monospace; cursor: pointer; white-space: nowrap;">‚¨á ${r.fetchIP}</button>\n                                </div>\n                            </div>\n                            <div id="cfRandomDiv" style="margin-bottom: 10px; display: none;">\n                                <button type="button" id="generateCFIPBtn" style="background: rgba(0, 255, 0, 0.15); border: 1px solid #00ff00; padding: 10px 20px; color: #00ff00; font-family: 'Courier New', monospace; cursor: pointer; width: 100%; transition: all 0.3s;">üé≤ ${r.generateIP}</button>\n                            </div>\n                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">\n                                <button type="button" id="startLatencyTest" style="background: rgba(0, 255, 0, 0.2); border: 1px solid #00ff00; padding: 8px 16px; color: #00ff00; font-family: 'Courier New', monospace; cursor: pointer; transition: all 0.3s;">‚ñ∂ ${r.startTest}</button>\n                                <button type="button" id="stopLatencyTest" style="background: rgba(255, 0, 0, 0.2); border: 1px solid #ff4444; padding: 8px 16px; color: #ff4444; font-family: 'Courier New', monospace; cursor: pointer; display: none; transition: all 0.3s;">‚èπ ${r.stopTest}</button>\n                            </div>\n                            <div id="latencyTestStatus" style="color: #00aa00; font-size: 0.9rem; margin-bottom: 10px; display: none;"></div>\n                            <div id="latencyTestResults" style="max-height: 250px; overflow-y: auto; display: none;">\n                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">\n                                    <span style="color: #00ff00; font-weight: bold;">${r.testResult}</span>\n                                    <div style="display: flex; gap: 8px;">\n                                        <button type="button" id="selectAllResults" style="background: transparent; border: 1px solid #00aa00; padding: 4px 10px; color: #00aa00; font-size: 0.8rem; cursor: pointer;">${r.selectAll}</button>\n                                        <button type="button" id="deselectAllResults" style="background: transparent; border: 1px solid #00aa00; padding: 4px 10px; color: #00aa00; font-size: 0.8rem; cursor: pointer;">${r.deselectAll}</button>\n                                    </div>\n                                </div>\n                                <div id="cityFilterContainer" style="margin-bottom: 10px; padding: 10px; background: rgba(0, 20, 0, 0.6); border: 1px solid #00aa00; border-radius: 4px; display: none;">\n                                    <div style="margin-bottom: 8px;">\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00; font-size: 0.9rem;">\n                                            <input type="radio" name="cityFilterMode" value="all" checked style="margin-right: 6px; width: 16px; height: 16px; cursor: pointer;">\n                                            <span>ÂÖ®ÈÉ®ÂüéÂ∏Ç</span>\n                                        </label>\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00; font-size: 0.9rem; margin-left: 15px;">\n                                            <input type="radio" name="cityFilterMode" value="fastest10" style="margin-right: 6px; width: 16px; height: 16px; cursor: pointer;">\n                                            <span>Âè™ÈÄâÊã©ÊúÄÂø´ÁöÑ10‰∏™</span>\n                                        </label>\n                                    </div>\n                                    <div id="cityCheckboxesContainer" style="display: flex; flex-wrap: wrap; gap: 8px; max-height: 80px; overflow-y: auto; padding: 5px;"></div>\n                                </div>\n                                <div id="latencyResultsList" style="background: rgba(0, 0, 0, 0.5); border: 1px solid #004400; border-radius: 4px; padding: 10px;"></div>\n                                <div style="margin-top: 10px; display: flex; gap: 10px;">\n                                    <button type="button" id="overwriteSelectedToYx" style="flex: 1; background: rgba(0, 200, 0, 0.3); border: 1px solid #00ff00; padding: 10px 20px; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; transition: all 0.3s;">Ë¶ÜÁõñÊ∑ªÂä†</button>\n                                    <button type="button" id="appendSelectedToYx" style="flex: 1; background: rgba(0, 150, 0, 0.3); border: 1px solid #00aa00; padding: 10px 20px; color: #00aa00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; transition: all 0.3s;">ËøΩÂä†Ê∑ªÂä†</button>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.socks5Config}</label>\n                                <input type="text" id="socksConfig" placeholder="${a?"ŸÖÿ´ÿßŸÑ: user:pass@host:port €åÿß host:port":"‰æãÂ¶Ç: user:pass@host:port Êàñ host:port"}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${r.socks5ConfigHint}</small>\n                        </div>\n                            <button type="submit" style="background: rgba(0, 255, 0, 0.15); border: 2px solid #00ff00; padding: 12px 24px; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; margin-right: 10px; text-shadow: 0 0 8px #00ff00; transition: all 0.4s ease;">${r.saveConfig}</button>\n                    </form>\n\n                        <h3 style="color: #00ff00; margin: 20px 0 15px 0; font-size: 1.2rem;">${r.advancedControl}</h3>\n                    <form id="advancedConfigForm" style="margin-bottom: 20px;">\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.subscriptionConverter}</label>\n                                <input type="text" id="scu" placeholder="${r.subscriptionConverterPlaceholder}" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                <small style="color: #00aa00; font-size: 0.85rem;">${r.subscriptionConverterHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.builtinPreferred}</label>\n                            <div style="padding: 15px; background: rgba(0, 20, 0, 0.6); border: 1px solid #00ff00; border-radius: 5px;">\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="epd" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1.1rem;">${r.enablePreferredDomain}</span>\n                                    </label>\n                                </div>\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="epi" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1.1rem;">${r.enablePreferredIP}</span>\n                                    </label>\n                                </div>\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="egi" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1.1rem;">${r.enableGitHubPreferred}</span>\n                                    </label>\n                                </div>\n\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                        <input type="checkbox" id="enableDiverseProxies" style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1.1rem;">${r.enableDiverseProxies}</span>\n                                    </label>\n                                    <small style="color: #00aa00; font-size: 0.85rem; display: block; margin-top: 5px;">${r.enableDiverseProxiesHint}</small>\n                                </div>\n\n                                    <small style="color: #00aa00; font-size: 0.85rem; display: block; margin-top: 10px;">${r.builtinPreferredHint}</small>\n                            </div>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">‰ºòÈÄâIPÁ≠õÈÄâËÆæÁΩÆ</label>\n                            <div style="padding: 15px; background: rgba(0, 20, 0, 0.6); border: 1px solid #00ff00; border-radius: 5px;">\n                                <div style="margin-bottom: 15px;">\n                                    <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">IPÁâàÊú¨ÈÄâÊã©</label>\n                                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                            <input type="checkbox" id="ipv4Enabled" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1rem;">IPv4</span>\n                                        </label>\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                            <input type="checkbox" id="ipv6Enabled" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1rem;">IPv6</span>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div style="margin-bottom: 10px;">\n                                    <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">ËøêËê•ÂïÜÈÄâÊã©</label>\n                                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                            <input type="checkbox" id="ispMobile" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1rem;">ÁßªÂä®</span>\n                                        </label>\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                            <input type="checkbox" id="ispUnicom" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1rem;">ËÅîÈÄö</span>\n                                        </label>\n                                        <label style="display: inline-flex; align-items: center; cursor: pointer; color: #00ff00;">\n                                            <input type="checkbox" id="ispTelecom" checked style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;">\n                                            <span style="font-size: 1rem;">Áîµ‰ø°</span>\n                                        </label>\n                                    </div>\n                                </div>\n                                    <small style="color: #00aa00; font-size: 0.85rem; display: block; margin-top: 10px;">ÈÄâÊã©Ë¶Å‰ΩøÁî®ÁöÑIPÁâàÊú¨ÂíåËøêËê•ÂïÜÔºåÊú™ÈÄâ‰∏≠ÁöÑÂ∞ÜË¢´ËøáÊª§</small>\n                            </div>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.allowAPIManagement}</label>\n                            <select id="apiEnabled" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                    <option value="">${r.apiEnabledDefault}</option>\n                                    <option value="yes">${r.apiEnabledYes}</option>\n                            </select>\n                                <small style="color: #ffaa00; font-size: 0.85rem;">${r.apiEnabledHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.regionMatching}</label>\n                            <select id="regionMatching" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                    <option value="">${r.regionMatchingDefault}</option>\n                                    <option value="no">${r.regionMatchingNo}</option>\n                            </select>\n                                <small style="color: #00aa00; font-size: 0.85rem;">${r.regionMatchingHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.downgradeControl}</label>\n                            <select id="downgradeControl" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                    <option value="">${r.downgradeControlDefault}</option>\n                                    <option value="no">${r.downgradeControlNo}</option>\n                            </select>\n                                <small style="color: #00aa00; font-size: 0.85rem;">${r.downgradeControlHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.tlsControl}</label>\n                            <select id="portControl" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                    <option value="">${r.tlsControlDefault}</option>\n                                    <option value="yes">${r.tlsControlYes}</option>\n                            </select>\n                                <small style="color: #00aa00; font-size: 0.85rem;">${r.tlsControlHint}</small>\n                        </div>\n                        <div style="margin-bottom: 15px;">\n                                <label style="display: block; margin-bottom: 8px; color: #00ff00; font-weight: bold; text-shadow: 0 0 3px #00ff00;">${r.preferredControl}</label>\n                            <select id="preferredControl" style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 2px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px;">\n                                    <option value="">${r.preferredControlDefault}</option>\n                                    <option value="yes">${r.preferredControlYes}</option>\n                            </select>\n                                <small style="color: #00aa00; font-size: 0.85rem;">${r.preferredControlHint}</small>\n                        </div>\n                            <button type="submit" style="background: rgba(0, 255, 0, 0.15); border: 2px solid #00ff00; padding: 12px 24px; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; margin-right: 10px; text-shadow: 0 0 8px #00ff00; transition: all 0.4s ease;">${r.saveAdvanced}</button>\n                    </form>\n                    <div id="currentConfig" style="background: rgba(0, 0, 0, 0.9); border: 1px solid #00ff00; padding: 15px; margin: 10px 0; font-family: 'Courier New', monospace; color: #00ff00;">\n                            ${r.loading}\n                    </div>\n                    <div id="pathTypeInfo" style="background: rgba(0, 20, 0, 0.7); border: 1px solid #00ff00; padding: 15px; margin: 10px 0; font-family: 'Courier New', monospace; color: #00ff00;">\n                            <div style="font-weight: bold; margin-bottom: 8px; color: #44ff44; text-shadow: 0 0 5px #44ff44;">${r.currentConfig}</div>\n                            <div id="pathTypeStatus">${r.checking}</div>\n                    </div>\n                        <button onclick="loadCurrentConfig()" style="background: rgba(0, 255, 0, 0.15); border: 2px solid #00ff00; padding: 12px 24px; color: #00ff00; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; margin-right: 10px; text-shadow: 0 0 8px #00ff00; transition: all 0.4s ease;">${r.refreshConfig}</button>\n                        <button onclick="resetAllConfig()" style="background: rgba(255, 0, 0, 0.15); border: 2px solid #ff0000; padding: 12px 24px; color: #ff0000; font-family: 'Courier New', monospace; font-weight: bold; cursor: pointer; text-shadow: 0 0 8px #ff0000; transition: all 0.4s ease;">${r.resetConfig}</button>\n                </div>\n                <div id="statusMessage" style="display: none; padding: 10px; margin: 10px 0; border: 1px solid #00ff00; background: rgba(0, 20, 0, 0.8); color: #00ff00; text-shadow: 0 0 5px #00ff00;"></div>\n            </div>\n\n            <div class="card">\n                    <h2 class="card-title">${r.relatedLinks}</h2>\n                <div style="text-align: center; margin: 20px 0;">\n                        <a href="https://github.com/byJoey/cfnew" target="_blank" style="color: #00ff00; text-decoration: none; margin: 0 20px; font-size: 1.2rem; text-shadow: 0 0 5px #00ff00;">${r.githubProject}</a>\n                    <a href="https://www.youtube.com/@joeyblog" target="_blank" style="color: #00ff00; text-decoration: none; margin: 0 20px; font-size: 1.2rem; text-shadow: 0 0 5px #00ff00;">YouTube @joeyblog</a>\n                </div>\n            </div>\n        </div>\n        <script>\n            // ËÆ¢ÈòÖËΩ¨Êç¢Âú∞ÂùÄÔºà‰ªéÊúçÂä°Âô®ÈÖçÁΩÆÊ≥®ÂÖ•Ôºâ\n            var SUB_CONVERTER_URL = "${scu}";\n            // Remote config URL (Hardcoded)\n            var REMOTE_CONFIG_URL = "${remoteConfigUrl}";\n\n                // ÁøªËØëÂØπË±°\n                const translations = {\n                    en: {\n                    title: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n\n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support ‚Ä¢ Smart Optimization ‚Ä¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: '‚úÖ KV Storage Enabled, Config Management Available',\n                    kvDisabled: '‚ö†Ô∏è KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'üìç Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>‚Ä¢ VLESS WS: Standard WebSocket protocol<br>‚Ä¢ VMess WS: WebSocket-based VMess (link generation)<br>‚Ä¢ Shadowsocks: WebSocket-based SS (link generation)<br>‚Ä¢ Trojan: Uses SHA224 password auth<br>‚Ä¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: '‚ö†Ô∏è Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'üá∫üá∏ US', SG: 'üá∏üá¨ Singapore', JP: 'üáØüáµ Japan',\n                        KR: 'üá∞üá∑ South Korea', DE: 'üá©üá™ Germany', SE: 'üá∏üá™ Sweden', NL: 'üá≥üá± Netherlands',\n                        FI: 'üá´üáÆ Finland', GB: 'üá¨üáß UK', FR: 'üá´üá∑ France', CA: 'üá®üá¶ Canada',\n                        AU: 'üá¶üá∫ Australia', HK: 'üá≠üá∞ Hong Kong', TW: 'üáπüáº Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                    fa: {\n                        subscriptionCopied: 'ŸÑ€åŸÜ⁄© ÿßÿ¥ÿ™ÿ±ÿß⁄© ⁄©Ÿæ€å ÿ¥ÿØ',\n                        autoSubscriptionCopied: 'ŸÑ€åŸÜ⁄© ÿßÿ¥ÿ™ÿ±ÿß⁄© ÿ™ÿ¥ÿÆ€åÿµ ÿÆŸàÿØ⁄©ÿßÿ± ⁄©Ÿæ€å ÿ¥ÿØÿå ⁄©ŸÑÿß€åŸÜÿ™ ŸáŸÜ⁄ØÿßŸÖ ÿØÿ≥ÿ™ÿ±ÿ≥€å ÿ®ÿ± ÿßÿ≥ÿßÿ≥ User-Agent ÿ®Ÿá ÿ∑Ÿàÿ± ÿÆŸàÿØ⁄©ÿßÿ± ÿ™ÿ¥ÿÆ€åÿµ ÿØÿßÿØŸá Ÿà ŸÇÿßŸÑÿ® ŸÖÿ±ÿ®Ÿàÿ∑Ÿá ÿ±ÿß ÿ®ÿ±ŸÖ€å‚Äå⁄Øÿ±ÿØÿßŸÜÿØ'\n                    }\n                };\n\n                function getCookie(name) {\n                    const value = '; ' + document.cookie;\n                    const parts = value.split('; ' + name + '=');\n                    if (parts.length === 2) return parts.pop().split(';').shift();\n                    return null;\n                }\n\n                const browserLang = navigator.language || navigator.userLanguage || '';\n                const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                let isFarsi = false;\n\n                if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                    isFarsi = true;\n                } else if (savedLang === 'zh' || savedLang === 'en-US') {\n                    isFarsi = false;\n                } else {\n                    isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                }\n\n                const t = translations[isFarsi ? 'fa' : 'en'];\n\n                function changeLanguage(lang) {\n                    localStorage.setItem('preferredLanguage', lang);\n                    // Set Cookie (valid for 1 year)\n                    const expiryDate = new Date();\n                    expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n                    document.cookie = 'preferredLanguage=' + lang + '; path=/; expires=' + expiryDate.toUTCString() + '; SameSite=Lax';\n                    // Reload page, do not use URL parameters\n                    window.location.reload();\n                }\n\n                // Check localStorage and Cookie on page load, and clean up URL parameters\n                window.addEventListener('DOMContentLoaded', function() {\n                    const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                    const urlParams = new URLSearchParams(window.location.search);\n                    const urlLang = urlParams.get('lang');\n\n                    // If URL has language parameter, remove it and set Cookie\n                    if (urlLang) {\n                        const currentUrl = new URL(window.location.href);\n                        currentUrl.searchParams.delete('lang');\n                        const newUrl = currentUrl.toString();\n\n                        // ËÆæÁΩÆCookie\n                        const expiryDate = new Date();\n                        expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n                        document.cookie = 'preferredLanguage=' + urlLang + '; path=/; expires=' + expiryDate.toUTCString() + '; SameSite=Lax';\n                        localStorage.setItem('preferredLanguage', urlLang);\n\n                        // Use history API to remove URL parameter, do not reload page\n                        window.history.replaceState({}, '', newUrl);\n                    } else if (savedLang) {\n                        // If present in localStorage but not in Cookie, sync to Cookie\n                        const expiryDate = new Date();\n                        expiryDate.setFullYear(expiryDate.getFullYear() + 1);\n                        document.cookie = 'preferredLanguage=' + savedLang + '; path=/; expires=' + expiryDate.toUTCString() + '; SameSite=Lax';\n                    }\n                });\n\n            function tryOpenApp(schemeUrl, fallbackCallback, timeout) {\n                timeout = timeout || 2500;\n                var appOpened = false;\n                var callbackExecuted = false;\n                var startTime = Date.now();\n\n                var blurHandler = function() {\n                    var elapsed = Date.now() - startTime;\n                    if (elapsed < 3000 && !callbackExecuted) {\n                        appOpened = true;\n                    }\n                };\n\n                window.addEventListener('blur', blurHandler);\n\n                var hiddenHandler = function() {\n                    var elapsed = Date.now() - startTime;\n                    if (elapsed < 3000 && !callbackExecuted) {\n                        appOpened = true;\n                    }\n                };\n\n                document.addEventListener('visibilitychange', hiddenHandler);\n\n                var iframe = document.createElement('iframe');\n                iframe.style.display = 'none';\n                iframe.style.width = '1px';\n                iframe.style.height = '1px';\n                iframe.src = schemeUrl;\n                document.body.appendChild(iframe);\n\n                setTimeout(function() {\n                    iframe.parentNode && iframe.parentNode.removeChild(iframe);\n                    window.removeEventListener('blur', blurHandler);\n                    document.removeEventListener('visibilitychange', hiddenHandler);\n\n                    if (!callbackExecuted) {\n                        callbackExecuted = true;\n                        if (!appOpened && fallbackCallback) {\n                            fallbackCallback();\n                        }\n                    }\n                }, timeout);\n            }\n\n            function generateClientLink(clientType, clientName) {\n                var currentUrl = window.location.href;\n                var subscriptionUrl = currentUrl + "/sub";\n                var schemeUrl = '';\n                var displayName = clientName || '';\n                var finalUrl = subscriptionUrl;\n\n                if (clientType === atob('djJyYXk=')) {\n                    finalUrl = subscriptionUrl;\n                    var urlElement = document.getElementById("clientSubscriptionUrl");\n                    urlElement.textContent = finalUrl;\n                    urlElement.style.display = "block";\n                    urlElement.style.overflowWrap = "break-word";\n                    urlElement.style.wordBreak = "break-all";\n                    urlElement.style.overflowX = "auto";\n                    urlElement.style.maxWidth = "100%";\n                    urlElement.style.boxSizing = "border-box";\n\n                    if (clientName === 'V2RAY') {\n                        navigator.clipboard.writeText(finalUrl).then(function() {\n                                alert(displayName + " " + t.subscriptionCopied);\n                        });\n                    } else if (clientName === 'Shadowrocket') {\n                        schemeUrl = 'shadowrocket://add/' + encodeURIComponent(finalUrl);\n                        tryOpenApp(schemeUrl, function() {\n                            navigator.clipboard.writeText(finalUrl).then(function() {\n                                    alert(displayName + " " + t.subscriptionCopied);\n                            });\n                        });\n                    } else if (clientName === 'V2RAYNG') {\n                        schemeUrl = 'v2rayng://install?url=' + encodeURIComponent(finalUrl);\n                        tryOpenApp(schemeUrl, function() {\n                            navigator.clipboard.writeText(finalUrl).then(function() {\n                                    alert(displayName + " " + t.subscriptionCopied);\n                            });\n                        });\n                    } else if (clientName === 'NEKORAY') {\n                        schemeUrl = 'nekoray://install-config?url=' + encodeURIComponent(finalUrl);\n                        tryOpenApp(schemeUrl, function() {\n                            navigator.clipboard.writeText(finalUrl).then(function() {\n                                    alert(displayName + " " + t.subscriptionCopied);\n                            });\n                        });\n                    }\n                } else {\n                    // Ê£ÄÊü• ECH ÊòØÂê¶ÂºÄÂêØ\n                    var echEnabled = document.getElementById('ech') && document.getElementById('ech').checked;\n\n                    // Â¶ÇÊûú ECH ÂºÄÂêØ‰∏îÊòØ ClashÔºåÁõ¥Êé•‰ΩøÁî®ÂêéÁ´ØÊé•Âè£\n                    if (echEnabled && clientType === atob('Y2xhc2g=')) {\n                        finalUrl = subscriptionUrl + "?target=" + clientType;\n                        var urlElement = document.getElementById("clientSubscriptionUrl");\n                        urlElement.textContent = finalUrl;\n                        urlElement.style.display = "block";\n                        urlElement.style.overflowWrap = "break-word";\n                        urlElement.style.wordBreak = "break-all";\n                        urlElement.style.overflowX = "auto";\n                        urlElement.style.maxWidth = "100%";\n                        urlElement.style.boxSizing = "border-box";\n\n                        if (clientName === 'STASH') {\n                            schemeUrl = 'stash://install?url=' + encodeURIComponent(finalUrl);\n                            displayName = 'STASH';\n                        } else {\n                            schemeUrl = 'clash://install-config?url=' + encodeURIComponent(finalUrl);\n                            displayName = 'CLASH';\n                        }\n\n                        if (schemeUrl) {\n                            tryOpenApp(schemeUrl, function() {\n                                navigator.clipboard.writeText(finalUrl).then(function() {\n                                        alert(displayName + " " + t.subscriptionCopied);\n                                });\n                            });\n                        } else {\n                            navigator.clipboard.writeText(finalUrl).then(function() {\n                                    alert(displayName + " " + t.subscriptionCopied);\n                            });\n                        }\n                    } else {\n                        // ÂÖ∂‰ªñÊÉÖÂÜµ‰ΩøÁî®ËÆ¢ÈòÖËΩ¨Êç¢ÊúçÂä°\n                        var encodedUrl = encodeURIComponent(subscriptionUrl);\n                        finalUrl = SUB_CONVERTER_URL + "?target=" + clientType + "&url=" + encodedUrl + "&insert=false&config=" + encodeURIComponent(REMOTE_CONFIG_URL) + "&emoji=true&list=false&xudp=false&udp=false&tfo=false&expand=true&scv=false&fdn=false&new_name=true";\n                        var urlElement = document.getElementById("clientSubscriptionUrl");\n                        urlElement.textContent = finalUrl;\n                        urlElement.style.display = "block";\n                        urlElement.style.overflowWrap = "break-word";\n                        urlElement.style.wordBreak = "break-all";\n                        urlElement.style.overflowX = "auto";\n                        urlElement.style.maxWidth = "100%";\n                        urlElement.style.boxSizing = "border-box";\n\n                        if (clientType === atob('Y2xhc2g=')) {\n                            if (clientName === 'STASH') {\n                                schemeUrl = 'stash://install?url=' + encodeURIComponent(finalUrl);\n                                displayName = 'STASH';\n                            } else {\n                                schemeUrl = 'clash://install-config?url=' + encodeURIComponent(finalUrl);\n                                displayName = 'CLASH';\n                            }\n                        } else if (clientType === atob('c3VyZ2U=')) {\n                            schemeUrl = 'surge:///install-config?url=' + encodeURIComponent(finalUrl);\n                            displayName = 'SURGE';\n                        } else if (clientType === atob('c2luZ2JveA==')) {\n                            schemeUrl = 'sing-box://install-config?url=' + encodeURIComponent(finalUrl);\n                            displayName = 'SING-BOX';\n                        } else if (clientType === atob('bG9vbg==')) {\n                            schemeUrl = 'loon://install?url=' + encodeURIComponent(finalUrl);\n                            displayName = 'LOON';\n                        } else if (clientType === atob('cXVhbng=')) {\n                            schemeUrl = 'quantumult-x://install-config?url=' + encodeURIComponent(finalUrl);\n                            displayName = 'QUANTUMULT X';\n                        }\n\n                        if (schemeUrl) {\n                            tryOpenApp(schemeUrl, function() {\n                                navigator.clipboard.writeText(finalUrl).then(function() {\n                                        alert(displayName + " " + t.subscriptionCopied);\n                                });\n                            });\n                        } else {\n                            navigator.clipboard.writeText(finalUrl).then(function() {\n                                    alert(displayName + " " + t.subscriptionCopied);\n                            });\n                        }\n                    }\n                }\n            }\n\n            function createMatrixRain() {\n                const matrixContainer = document.getElementById('matrixCodeRain');\n                const matrixChars = '01ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\n                const columns = Math.floor(window.innerWidth / 18);\n\n                for (let i = 0; i < columns; i++) {\n                    const column = document.createElement('div');\n                    column.className = 'matrix-column';\n                    column.style.left = (i * 18) + 'px';\n                    column.style.animationDelay = Math.random() * 15 + 's';\n                    column.style.animationDuration = (Math.random() * 15 + 8) + 's';\n                    column.style.fontSize = (Math.random() * 4 + 12) + 'px';\n                    column.style.opacity = Math.random() * 0.8 + 0.2;\n\n                    let text = '';\n                    const charCount = Math.floor(Math.random() * 30 + 20);\n                    for (let j = 0; j < charCount; j++) {\n                        const char = matrixChars[Math.floor(Math.random() * matrixChars.length)];\n                        const brightness = Math.random() > 0.1 ? '#00ff00' : '#00aa00';\n                        text += '<span style="color: ' + brightness + ';">' + char + '</span><br>';\n                    }\n                    column.innerHTML = text;\n                    matrixContainer.appendChild(column);\n                }\n\n                setInterval(function() {\n                    const columns = matrixContainer.querySelectorAll('.matrix-column');\n                    columns.forEach(function(column) {\n                        if (Math.random() > 0.95) {\n                            const chars = column.querySelectorAll('span');\n                            if (chars.length > 0) {\n                                const randomChar = chars[Math.floor(Math.random() * chars.length)];\n                                randomChar.style.color = '#ffffff';\n                                setTimeout(function() {\n                                    randomChar.style.color = '#00ff00';\n                                }, 200);\n                            }\n                        }\n                    });\n                }, 100);\n            }\n\n            async function checkSystemStatus() {\n                try {\n                    const cfStatus = document.getElementById('cfStatus');\n                    const regionStatus = document.getElementById('regionStatus');\n                    const geoInfo = document.getElementById('geoInfo');\n                    const backupStatus = document.getElementById('backupStatus');\n                    const currentIP = document.getElementById('currentIP');\n                    const regionMatch = document.getElementById('regionMatch');\n\n                        // Ëé∑ÂèñÂΩìÂâçËØ≠Ë®ÄËÆæÁΩÆÔºà‰ºòÂÖà‰ªéCookie/localStorageËØªÂèñÔºâ\n                        function getCookie(name) {\n                            const value = '; ' + document.cookie;\n                            const parts = value.split('; ' + name + '=');\n                            if (parts.length === 2) return parts.pop().split(';').shift();\n                            return null;\n                        }\n\n                        const browserLang = navigator.language || navigator.userLanguage || '';\n                        const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                        let isFarsi = false;\n\n                        if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                            isFarsi = true;\n                        } else if (savedLang === 'zh' || savedLang === 'en-US') {\n                            isFarsi = false;\n                        } else {\n                            isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                        }\n\n                        const translations = {\n                            en: {\n                    title: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n\n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support ‚Ä¢ Smart Optimization ‚Ä¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: '‚úÖ KV Storage Enabled, Config Management Available',\n                    kvDisabled: '‚ö†Ô∏è KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'üìç Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>‚Ä¢ VLESS WS: Standard WebSocket protocol<br>‚Ä¢ VMess WS: WebSocket-based VMess (link generation)<br>‚Ä¢ Shadowsocks: WebSocket-based SS (link generation)<br>‚Ä¢ Trojan: Uses SHA224 password auth<br>‚Ä¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: '‚ö†Ô∏è Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'üá∫üá∏ US', SG: 'üá∏üá¨ Singapore', JP: 'üáØüáµ Japan',\n                        KR: 'üá∞üá∑ South Korea', DE: 'üá©üá™ Germany', SE: 'üá∏üá™ Sweden', NL: 'üá≥üá± Netherlands',\n                        FI: 'üá´üáÆ Finland', GB: 'üá¨üáß UK', FR: 'üá´üá∑ France', CA: 'üá®üá¶ Canada',\n                        AU: 'üá¶üá∫ Australia', HK: 'üá≠üá∞ Hong Kong', TW: 'üáπüáº Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                                customIPMode: 'Ëá™ÂÆö‰πâProxyIPÊ®°Âºè (pÂèòÈáèÂêØÁî®)',\n                                customIPModeDesc: 'Ëá™ÂÆö‰πâIPÊ®°Âºè (Â∑≤Á¶ÅÁî®Âú∞Âå∫ÂåπÈÖç)',\n                                usingCustomProxyIP: '‰ΩøÁî®Ëá™ÂÆö‰πâProxyIP: ',\n                                customIPConfig: ' (pÂèòÈáèÈÖçÁΩÆ)',\n                                customIPModeDisabled: 'Ëá™ÂÆö‰πâIPÊ®°ÂºèÔºåÂú∞Âå∫ÈÄâÊã©Â∑≤Á¶ÅÁî®',\n                                manualRegion: 'ÊâãÂä®ÊåáÂÆöÂú∞Âå∫',\n                                manualRegionDesc: ' (ÊâãÂä®ÊåáÂÆö)',\n                                proxyIPAvailable: '10/10 ÂèØÁî® (ProxyIPÂüüÂêçÈ¢ÑËÆæÂèØÁî®)',\n                                smartSelection: 'Êô∫ËÉΩÂ∞±ËøëÈÄâÊã©‰∏≠',\n                                sameRegionIP: 'ÂêåÂú∞Âå∫IPÂèØÁî® (1‰∏™)',\n                                cloudflareDetection: 'CloudflareÂÜÖÁΩÆÊ£ÄÊµã',\n                                detectionFailed: 'Ê£ÄÊµãÂ§±Ë¥•',\n                                unknown: 'Unknown'\n                            },\n                            fa: {\n                                workerRegion: 'ŸÖŸÜÿ∑ŸÇŸá Worker: ',\n                                detectionMethod: 'ÿ±Ÿàÿ¥ ÿ™ÿ¥ÿÆ€åÿµ: ',\n                                proxyIPStatus: 'Ÿàÿ∂ÿπ€åÿ™ ProxyIP: ',\n                                currentIP: 'IP ŸÅÿπŸÑ€å: ',\n                                regionMatch: 'ÿ™ÿ∑ÿ®€åŸÇ ŸÖŸÜÿ∑ŸÇŸá: ',\n                                regionNames: {\n                                    'US': 'üá∫üá∏ ÿ¢ŸÖÿ±€å⁄©ÿß', 'SG': 'üá∏üá¨ ÿ≥ŸÜ⁄ØÿßŸæŸàÿ±', 'JP': 'üáØüáµ ⁄òÿßŸæŸÜ',\n                                    'KR': 'üá∞üá∑ ⁄©ÿ±Ÿá ÿ¨ŸÜŸàÿ®€å', 'DE': 'üá©üá™ ÿ¢ŸÑŸÖÿßŸÜ', 'SE': 'üá∏üá™ ÿ≥Ÿàÿ¶ÿØ', 'NL': 'üá≥üá± ŸáŸÑŸÜÿØ',\n                                    'FI': 'üá´üáÆ ŸÅŸÜŸÑÿßŸÜÿØ', 'GB': 'üá¨üáß ÿ®ÿ±€åÿ™ÿßŸÜ€åÿß'\n                                },\n                                customIPMode: 'ÿ≠ÿßŸÑÿ™ ProxyIP ÿ≥ŸÅÿßÿ±ÿ¥€å (ŸÖÿ™ÿ∫€åÿ± p ŸÅÿπÿßŸÑ ÿßÿ≥ÿ™)',\n                                customIPModeDesc: 'ÿ≠ÿßŸÑÿ™ IP ÿ≥ŸÅÿßÿ±ÿ¥€å (ÿ™ÿ∑ÿ®€åŸÇ ŸÖŸÜÿ∑ŸÇŸá ÿ∫€åÿ±ŸÅÿπÿßŸÑ ÿßÿ≥ÿ™)',\n                                usingCustomProxyIP: 'ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ProxyIP ÿ≥ŸÅÿßÿ±ÿ¥€å: ',\n                                customIPConfig: ' (Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ŸÖÿ™ÿ∫€åÿ± p)',\n                                customIPModeDisabled: 'ÿ≠ÿßŸÑÿ™ IP ÿ≥ŸÅÿßÿ±ÿ¥€åÿå ÿßŸÜÿ™ÿÆÿßÿ® ŸÖŸÜÿ∑ŸÇŸá ÿ∫€åÿ±ŸÅÿπÿßŸÑ ÿßÿ≥ÿ™',\n                                manualRegion: 'ÿ™ÿπ€å€åŸÜ ŸÖŸÜÿ∑ŸÇŸá ÿØÿ≥ÿ™€å',\n                                manualRegionDesc: ' (ÿ™ÿπ€å€åŸÜ ÿØÿ≥ÿ™€å)',\n                                proxyIPAvailable: '10/10 ÿØÿ± ÿØÿ≥ÿ™ÿ±ÿ≥ (ÿØÿßŸÖŸÜŸá Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂ ProxyIP ÿØÿ± ÿØÿ≥ÿ™ÿ±ÿ≥ ÿßÿ≥ÿ™)',\n                                smartSelection: 'ÿßŸÜÿ™ÿÆÿßÿ® ŸáŸàÿ¥ŸÖŸÜÿØ ŸÜÿ≤ÿØ€å⁄© ÿØÿ± ÿ≠ÿßŸÑ ÿßŸÜÿ¨ÿßŸÖ ÿßÿ≥ÿ™',\n                                sameRegionIP: 'IP ŸáŸÖ‚ÄåŸÖŸÜÿ∑ŸÇŸá ÿØÿ± ÿØÿ≥ÿ™ÿ±ÿ≥ ÿßÿ≥ÿ™ (1)',\n                                cloudflareDetection: 'ÿ™ÿ¥ÿÆ€åÿµ ÿØÿßÿÆŸÑ€å Cloudflare',\n                                detectionFailed: 'ÿ™ÿ¥ÿÆ€åÿµ ŸÜÿßŸÖŸàŸÅŸÇ',\n                                unknown: 'ŸÜÿßÿ¥ŸÜÿßÿÆÿ™Ÿá'\n                            }\n                        };\n\n                        const t = translations[isFarsi ? 'fa' : 'en'];\n\n                    let detectedRegion = 'US'; // ÈªòËÆ§ÂÄº\n                    let isCustomIPMode = false;\n                    let isManualRegionMode = false;\n                    try {\n                        const response = await fetch(window.location.pathname + '/region');\n                        const data = await response.json();\n\n                        if (data.region === 'CUSTOM') {\n                            isCustomIPMode = true;\n                            detectedRegion = 'CUSTOM';\n\n                            // Ëé∑ÂèñËá™ÂÆö‰πâIPÁöÑËØ¶ÁªÜ‰ø°ÊÅØ\n                                const customIPInfo = data.ci || t.unknown;\n\n                                geoInfo.innerHTML = t.detectionMethod + '<span style="color: #ffaa00;">‚öôÔ∏è ' + t.customIPMode + '</span>';\n                                regionStatus.innerHTML = t.workerRegion + '<span style="color: #ffaa00;">üîß ' + t.customIPModeDesc + '</span>';\n\n                            // ÊòæÁ§∫Ëá™ÂÆö‰πâIPÈÖçÁΩÆÁä∂ÊÄÅÔºåÂåÖÂê´ÂÖ∑‰ΩìIP\n                                if (backupStatus) backupStatus.innerHTML = t.proxyIPStatus + '<span style="color: #ffaa00;">üîß ' + t.usingCustomProxyIP + customIPInfo + '</span>';\n                                if (currentIP) currentIP.innerHTML = t.currentIP + '<span style="color: #ffaa00;">‚úÖ ' + customIPInfo + t.customIPConfig + '</span>';\n                                if (regionMatch) regionMatch.innerHTML = t.regionMatch + '<span style="color: #ffaa00;">‚ö†Ô∏è ' + t.customIPModeDisabled + '</span>';\n\n                            return; // ÊèêÂâçËøîÂõûÔºå‰∏çÊâßË°åÂêéÁª≠ÁöÑÂú∞Âå∫ÂåπÈÖçÈÄªËæë\n                            } else if (data.detectionMethod === 'ÊâãÂä®ÊåáÂÆöÂú∞Âå∫' || data.detectionMethod === 'ÿ™ÿπ€å€åŸÜ ŸÖŸÜÿ∑ŸÇŸá ÿØÿ≥ÿ™€å') {\n                            isManualRegionMode = true;\n                            detectedRegion = data.region;\n\n                                geoInfo.innerHTML = t.detectionMethod + '<span style="color: #44aa44;">' + t.manualRegion + '</span>';\n                                regionStatus.innerHTML = t.workerRegion + '<span style="color: #44ff44;">üéØ ' + t.regionNames[detectedRegion] + t.manualRegionDesc + '</span>';\n\n                            // ÊòæÁ§∫ÈÖçÁΩÆÁä∂ÊÄÅËÄå‰∏çÊòØÊ£ÄÊµãÁä∂ÊÄÅ\n                                if (backupStatus) backupStatus.innerHTML = t.proxyIPStatus + '<span style="color: #44ff44;">‚úÖ ' + t.proxyIPAvailable + '</span>';\n                                if (currentIP) currentIP.innerHTML = t.currentIP + '<span style="color: #44ff44;">‚úÖ ' + t.smartSelection + '</span>';\n                                if (regionMatch) regionMatch.innerHTML = t.regionMatch + '<span style="color: #44ff44;">‚úÖ ' + t.sameRegionIP + '</span>';\n\n                            return; // ÊèêÂâçËøîÂõûÔºå‰∏çÊâßË°åÂêéÁª≠ÁöÑÂú∞Âå∫ÂåπÈÖçÈÄªËæë\n                            } else if (data.region && t.regionNames[data.region]) {\n                            detectedRegion = data.region;\n                        }\n\n                            geoInfo.innerHTML = t.detectionMethod + '<span style="color: #44ff44;">' + t.cloudflareDetection + '</span>';\n\n                    } catch (e) {\n                            geoInfo.innerHTML = t.detectionMethod + '<span style="color: #ff4444;">' + t.detectionFailed + '</span>';\n                    }\n\n                        regionStatus.innerHTML = t.workerRegion + '<span style="color: #44ff44;">‚úÖ ' + t.regionNames[detectedRegion] + '</span>';\n\n                    // Áõ¥Êé•ÊòæÁ§∫ÈÖçÁΩÆÁä∂ÊÄÅÔºå‰∏çÂÜçËøõË°åÊ£ÄÊµã\n                    if (backupStatus) {\n                            backupStatus.innerHTML = t.proxyIPStatus + '<span style="color: #44ff44;">‚úÖ ' + t.proxyIPAvailable + '</span>';\n                    }\n\n                    if (currentIP) {\n                            currentIP.innerHTML = t.currentIP + '<span style="color: #44ff44;">‚úÖ ' + t.smartSelection + '</span>';\n                    }\n\n                    if (regionMatch) {\n                            regionMatch.innerHTML = t.regionMatch + '<span style="color: #44ff44;">‚úÖ ' + t.sameRegionIP + '</span>';\n                    }\n\n                } catch (error) {\n                        function getCookie(name) {\n                            const value = '; ' + document.cookie;\n                            const parts = value.split('; ' + name + '=');\n                            if (parts.length === 2) return parts.pop().split(';').shift();\n                            return null;\n                        }\n\n                        const browserLang = navigator.language || navigator.userLanguage || '';\n                        const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                        let isFarsi = false;\n\n                        if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                            isFarsi = true;\n                        } else {\n                            isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                        }\n\n                        const translations = {\n                            en: {\n                    title: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n\n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support ‚Ä¢ Smart Optimization ‚Ä¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: '‚úÖ KV Storage Enabled, Config Management Available',\n                    kvDisabled: '‚ö†Ô∏è KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'üìç Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>‚Ä¢ VLESS WS: Standard WebSocket protocol<br>‚Ä¢ VMess WS: WebSocket-based VMess (link generation)<br>‚Ä¢ Shadowsocks: WebSocket-based SS (link generation)<br>‚Ä¢ Trojan: Uses SHA224 password auth<br>‚Ä¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: '‚ö†Ô∏è Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'üá∫üá∏ US', SG: 'üá∏üá¨ Singapore', JP: 'üáØüáµ Japan',\n                        KR: 'üá∞üá∑ South Korea', DE: 'üá©üá™ Germany', SE: 'üá∏üá™ Sweden', NL: 'üá≥üá± Netherlands',\n                        FI: 'üá´üáÆ Finland', GB: 'üá¨üáß UK', FR: 'üá´üá∑ France', CA: 'üá®üá¶ Canada',\n                        AU: 'üá¶üá∫ Australia', HK: 'üá≠üá∞ Hong Kong', TW: 'üáπüáº Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                            fa: {\n                                workerRegion: 'ŸÖŸÜÿ∑ŸÇŸá Worker: ',\n                                detectionMethod: 'ÿ±Ÿàÿ¥ ÿ™ÿ¥ÿÆ€åÿµ: ',\n                                proxyIPStatus: 'Ÿàÿ∂ÿπ€åÿ™ ProxyIP: ',\n                                currentIP: 'IP ŸÅÿπŸÑ€å: ',\n                                regionMatch: 'ÿ™ÿ∑ÿ®€åŸÇ ŸÖŸÜÿ∑ŸÇŸá: ',\n                                detectionFailed: 'ÿ™ÿ¥ÿÆ€åÿµ ŸÜÿßŸÖŸàŸÅŸÇ'\n                            }\n                        };\n\n                        const t = translations[isFarsi ? 'fa' : 'en'];\n\n                        document.getElementById('regionStatus').innerHTML = t.workerRegion + '<span style="color: #ff4444;">‚ùå ' + t.detectionFailed + '</span>';\n                        document.getElementById('geoInfo').innerHTML = t.detectionMethod + '<span style="color: #ff4444;">‚ùå ' + t.detectionFailed + '</span>';\n                        document.getElementById('backupStatus').innerHTML = t.proxyIPStatus + '<span style="color: #ff4444;">‚ùå ' + t.detectionFailed + '</span>';\n                        document.getElementById('currentIP').innerHTML = t.currentIP + '<span style="color: #ff4444;">‚ùå ' + t.detectionFailed + '</span>';\n                        document.getElementById('regionMatch').innerHTML = t.regionMatch + '<span style="color: #ff4444;">‚ùå ' + t.detectionFailed + '</span>';\n                }\n            }\n\n                async function testAPI() {\n                    try {\n                        function getCookie(name) {\n                            const value = '; ' + document.cookie;\n                            const parts = value.split('; ' + name + '=');\n                            if (parts.length === 2) return parts.pop().split(';').shift();\n                            return null;\n                        }\n\n                        const browserLang = navigator.language || navigator.userLanguage || '';\n                        const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                        let isFarsi = false;\n\n                        if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                            isFarsi = true;\n                        } else {\n                            isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                        }\n\n                        const translations = {\n                            en: {\n                    title: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n\n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support ‚Ä¢ Smart Optimization ‚Ä¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: '‚úÖ KV Storage Enabled, Config Management Available',\n                    kvDisabled: '‚ö†Ô∏è KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'üìç Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>‚Ä¢ VLESS WS: Standard WebSocket protocol<br>‚Ä¢ VMess WS: WebSocket-based VMess (link generation)<br>‚Ä¢ Shadowsocks: WebSocket-based SS (link generation)<br>‚Ä¢ Trojan: Uses SHA224 password auth<br>‚Ä¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: '‚ö†Ô∏è Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'üá∫üá∏ US', SG: 'üá∏üá¨ Singapore', JP: 'üáØüáµ Japan',\n                        KR: 'üá∞üá∑ South Korea', DE: 'üá©üá™ Germany', SE: 'üá∏üá™ Sweden', NL: 'üá≥üá± Netherlands',\n                        FI: 'üá´üáÆ Finland', GB: 'üá¨üáß UK', FR: 'üá´üá∑ France', CA: 'üá®üá¶ Canada',\n                        AU: 'üá¶üá∫ Australia', HK: 'üá≠üá∞ Hong Kong', TW: 'üáπüáº Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                            fa: {\n                                apiTestResult: 'ŸÜÿ™€åÿ¨Ÿá ÿ™ÿ¥ÿÆ€åÿµ API: ',\n                                apiTestTime: 'ÿ≤ŸÖÿßŸÜ ÿ™ÿ¥ÿÆ€åÿµ: ',\n                                apiTestFailed: 'ÿ™ÿ¥ÿÆ€åÿµ API ŸÜÿßŸÖŸàŸÅŸÇ: ',\n                                unknownError: 'ÿÆÿ∑ÿß€å ŸÜÿßÿ¥ŸÜÿßÿÆÿ™Ÿá',\n                                apiTestError: 'ÿ™ÿ≥ÿ™ API ŸÜÿßŸÖŸàŸÅŸÇ: '\n                            }\n                        };\n\n                        const t = translations[isFarsi ? 'fa' : 'en'];\n\n                    const response = await fetch(window.location.pathname + '/test-api');\n                    const data = await response.json();\n\n                    if (data.detectedRegion) {\n                            alert(t.apiTestResult + data.detectedRegion + '\\n' + t.apiTestTime + data.timestamp);\n                    } else {\n                            alert(t.apiTestFailed + (data.error || t.unknownError));\n                    }\n                } catch (error) {\n                        function getCookie(name) {\n                            const value = '; ' + document.cookie;\n                            const parts = value.split('; ' + name + '=');\n                            if (parts.length === 2) return parts.pop().split(';').shift();\n                            return null;\n                        }\n\n                        const browserLang = navigator.language || navigator.userLanguage || '';\n                        const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                        let isFarsi = false;\n\n                        if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                            isFarsi = true;\n                        } else {\n                            isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                        }\n\n                        const translations = {\n                            en: {\n                    title: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n\n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support ‚Ä¢ Smart Optimization ‚Ä¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: '‚úÖ KV Storage Enabled, Config Management Available',\n                    kvDisabled: '‚ö†Ô∏è KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'üìç Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>‚Ä¢ VLESS WS: Standard WebSocket protocol<br>‚Ä¢ VMess WS: WebSocket-based VMess (link generation)<br>‚Ä¢ Shadowsocks: WebSocket-based SS (link generation)<br>‚Ä¢ Trojan: Uses SHA224 password auth<br>‚Ä¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: '‚ö†Ô∏è Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'üá∫üá∏ US', SG: 'üá∏üá¨ Singapore', JP: 'üáØüáµ Japan',\n                        KR: 'üá∞üá∑ South Korea', DE: 'üá©üá™ Germany', SE: 'üá∏üá™ Sweden', NL: 'üá≥üá± Netherlands',\n                        FI: 'üá´üáÆ Finland', GB: 'üá¨üáß UK', FR: 'üá´üá∑ France', CA: 'üá®üá¶ Canada',\n                        AU: 'üá¶üá∫ Australia', HK: 'üá≠üá∞ Hong Kong', TW: 'üáπüáº Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                            fa: { apiTestError: 'ÿ™ÿ≥ÿ™ API ŸÜÿßŸÖŸàŸÅŸÇ: ' }\n                        };\n\n                        const t = translations[isFarsi ? 'fa' : 'en'];\n                        alert(t.apiTestError + error.message);\n                }\n            }\n\n            // ÈÖçÁΩÆÁÆ°ÁêÜÁõ∏ÂÖ≥ÂáΩÊï∞\n            async function checkKVStatus() {\n                const apiUrl = window.location.pathname + '/api/config';\n\n                try {\n                    const response = await fetch(apiUrl);\n\n                        function getCookie(name) {\n                            const value = '; ' + document.cookie;\n                            const parts = value.split('; ' + name + '=');\n                            if (parts.length === 2) return parts.pop().split(';').shift();\n                            return null;\n                        }\n\n                        const browserLang = navigator.language || navigator.userLanguage || '';\n                        const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                        let isFarsi = false;\n\n                        if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                            isFarsi = true;\n                        } else {\n                            isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                        }\n\n                        const translations = {\n                            en: {\n                    title: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n\n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support ‚Ä¢ Smart Optimization ‚Ä¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: '‚úÖ KV Storage Enabled, Config Management Available',\n                    kvDisabled: '‚ö†Ô∏è KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'üìç Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>‚Ä¢ VLESS WS: Standard WebSocket protocol<br>‚Ä¢ VMess WS: WebSocket-based VMess (link generation)<br>‚Ä¢ Shadowsocks: WebSocket-based SS (link generation)<br>‚Ä¢ Trojan: Uses SHA224 password auth<br>‚Ä¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: '‚ö†Ô∏è Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'üá∫üá∏ US', SG: 'üá∏üá¨ Singapore', JP: 'üáØüáµ Japan',\n                        KR: 'üá∞üá∑ South Korea', DE: 'üá©üá™ Germany', SE: 'üá∏üá™ Sweden', NL: 'üá≥üá± Netherlands',\n                        FI: 'üá´üáÆ Finland', GB: 'üá¨üáß UK', FR: 'üá´üá∑ France', CA: 'üá®üá¶ Canada',\n                        AU: 'üá¶üá∫ Australia', HK: 'üá≠üá∞ Hong Kong', TW: 'üáπüáº Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                            fa: {\n                                kvDisabled: '‚ö†Ô∏è ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÅÿπÿßŸÑ ŸÜ€åÿ≥ÿ™ €åÿß Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ŸÜÿ¥ÿØŸá ÿßÿ≥ÿ™',\n                                kvNotConfigured: '‚ö†Ô∏è ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ŸÜÿ¥ÿØŸá ÿßÿ≥ÿ™. ŸæŸÜŸÑ ⁄Øÿ±ÿßŸÅ€å⁄©€å ÿ∫€åÿ±ŸÅÿπÿßŸÑ ÿßÿ≥ÿ™.\\n\\nüîß ÿ±ÿßŸáŸÜŸÖÿß€å ÿ™ÿπŸÖ€åÿ±:\\n1. ÿ®Ÿá ŸæŸÜŸÑ Cloudflare -> Workers -> KV ÿ®ÿ±Ÿà€åÿØ.\\n2. €å⁄© Namespace ÿ¨ÿØ€åÿØ ÿ®ÿ≥ÿßÿ≤€åÿØ.\\n3. ÿØÿ± ÿ™ŸÜÿ∏€åŸÖÿßÿ™ Worker -> Variables -> KV Bindings.\\n4. ŸÖÿ™ÿ∫€åÿ±€å ÿ®ÿß ŸÜÿßŸÖ "C" (ÿ®ÿ≤ÿ±⁄Ø) ÿßÿ∂ÿßŸÅŸá ⁄©ÿ±ÿØŸá Ÿà ÿ®Ÿá KV ŸÖÿ™ÿµŸÑ ⁄©ŸÜ€åÿØ.\\n5. ÿ∞ÿÆ€åÿ±Ÿá Ÿà Deploy ⁄©ŸÜ€åÿØ.',\n                                kvNotEnabled: 'KV ŸÖÿ™ÿµŸÑ ŸÜ€åÿ≥ÿ™. ŸÑÿ∑ŸÅÿßŸã ÿ∑ÿ®ŸÇ ÿ±ÿßŸáŸÜŸÖÿß ÿ™ŸÜÿ∏€åŸÖ ⁄©ŸÜ€åÿØ',\n                                kvEnabled: '‚úÖ ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÅÿπÿßŸÑ ÿßÿ≥ÿ™ÿå ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿßÿ≤ ŸÖÿØ€åÿ±€åÿ™ ÿ™ŸÜÿ∏€åŸÖÿßÿ™ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ',\n                                kvCheckFailed: '‚ö†Ô∏è ÿ®ÿ±ÿ±ÿ≥€å ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÜÿßŸÖŸàŸÅŸÇ',\n                                kvCheckFailedFormat: 'ÿ®ÿ±ÿ±ÿ≥€å ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÜÿßŸÖŸàŸÅŸÇ: ÿÆÿ∑ÿß€å ŸÅÿ±ŸÖÿ™ Ÿæÿßÿ≥ÿÆ',\n                                kvCheckFailedStatus: 'ÿ®ÿ±ÿ±ÿ≥€å ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÜÿßŸÖŸàŸÅŸÇ - ⁄©ÿØ Ÿàÿ∂ÿπ€åÿ™: ',\n                                kvCheckFailedError: 'ÿ®ÿ±ÿ±ÿ≥€å ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÜÿßŸÖŸàŸÅŸÇ - ÿÆÿ∑ÿß: '\n                            }\n                        };\n\n                        const t = translations[isFarsi ? 'fa' : 'en'];\n\n                        if (response.status === 503) {\n                            // KVÊú™ÈÖçÁΩÆ\n                            document.getElementById('kvStatus').innerHTML = '<span style="color: #ffaa00;">' + t.kvDisabled + '</span>';\n                            document.getElementById('configCard').style.display = 'block';\n                            document.getElementById('currentConfig').textContent = t.kvNotConfigured;\n                    } else if (response.ok) {\n                        try {\n                        const data = await response.json();\n\n                            // Ê£ÄÊü•ÂìçÂ∫îÊòØÂê¶ÂåÖÂê´KVÈÖçÁΩÆ‰ø°ÊÅØ\n                            if (data && data.kvEnabled === true) {\n                                document.getElementById('kvStatus').innerHTML = '<span style="color: #44ff44;">' + t.kvEnabled + '</span>';\n                                document.getElementById('configContent').style.display = 'block';\n                                document.getElementById('configCard').style.display = 'block';\n                                await loadCurrentConfig();\n                            } else {\n                                document.getElementById('kvStatus').innerHTML = '<span style="color: #ffaa00;">' + t.kvDisabled + '</span>';\n                                document.getElementById('configCard').style.display = 'block';\n                                document.getElementById('currentConfig').textContent = t.kvNotEnabled;\n                                }\n                        } catch (jsonError) {\n                            document.getElementById('kvStatus').innerHTML = '<span style="color: #ffaa00;">' + t.kvCheckFailed + '</span>';\n                            document.getElementById('configCard').style.display = 'block';\n                            document.getElementById('currentConfig').textContent = t.kvCheckFailedFormat;\n                        }\n                    } else {\n                        document.getElementById('kvStatus').innerHTML = '<span style="color: #ffaa00;">' + t.kvDisabled + '</span>';\n                        document.getElementById('configCard').style.display = 'block';\n                        document.getElementById('currentConfig').textContent = t.kvCheckFailedStatus + response.status;\n                    }\n                } catch (error) {\n                    function getCookie(name) {\n                        const value = '; ' + document.cookie;\n                        const parts = value.split('; ' + name + '=');\n                        if (parts.length === 2) return parts.pop().split(';').shift();\n                        return null;\n                    }\n\n                    const browserLang = navigator.language || navigator.userLanguage || '';\n                    const savedLang = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');\n                    let isFarsi = false;\n\n                    if (savedLang === 'fa' || savedLang === 'fa-IR') {\n                        isFarsi = true;\n                    } else {\n                        isFarsi = browserLang.includes('fa') || browserLang.includes('fa-IR');\n                    }\n\n                    const translations = {\n                        en: {\n                    title: 'Terminal',\n                    congratulations: 'Congratulations, you made it!',\n                    enterU: 'Please enter the value of your U variable',\n                    enterD: 'Please enter the value of your D variable',\n                    command: 'Command: connect [',\n                    uuid: 'UUID',\n                    path: 'PATH',\n                    inputU: 'Enter content of U variable and press Enter...',\n                    inputD: 'Enter content of D variable and press Enter...',\n                    connecting: 'Connecting...',\n                    invading: 'Invading...',\n                    success: 'Connection successful! Returning result...',\n                    error: 'Error: Invalid UUID format',\n                    reenter: 'Please re-enter a valid UUID',\n\n                    // Subscription Page Translations\n                    subtitle: 'Multi-client Support ‚Ä¢ Smart Optimization ‚Ä¢ One-Click Generation',\n                    selectClient: '[ Select Client ]',\n                    systemStatus: '[ System Status ]',\n                    configManagement: '[ Config Management ]',\n                    relatedLinks: '[ Related Links ]',\n                    checking: 'Checking...',\n                    workerRegion: 'Worker Region: ',\n                    detectionMethod: 'Detection Method: ',\n                    proxyIPStatus: 'ProxyIP Status: ',\n                    currentIP: 'Current IP: ',\n                    regionMatch: 'Region Match: ',\n                    selectionLogic: 'Selection Logic: ',\n                    kvStatusChecking: 'Checking KV Status...',\n                    kvEnabled: '‚úÖ KV Storage Enabled, Config Management Available',\n                    kvDisabled: '‚ö†Ô∏è KV Storage Disabled or Not Configured',\n                    specifyRegion: 'Specify Region (wk):',\n                    autoDetect: 'Auto Detect',\n                    saveRegion: 'Save Region Config',\n                    protocolSelection: 'Protocol Selection:',\n                    enableVLESS: 'Enable VLESS Protocol',\n                    enableVMess: 'Enable VMess Protocol',\n                    enableShadowsocks: 'Enable Shadowsocks Protocol',\n                    enableTrojan: 'Enable Trojan Protocol',\n                    enableXhttp: 'Enable xhttp Protocol',\n                    enableTUIC: 'Enable TUIC Protocol',\n                    enableHysteria2: 'Enable Hysteria 2 Protocol',\n                    enableVLESSgRPC: 'Enable VLESS gRPC Protocol',\n                    linkOnlyHint: 'Requires External Backend (Link-Only)',\n                    grpcHint: 'Requires Custom Domain (gRPC)',\n                    trojanPassword: 'Trojan Password (Optional):',\n                    customPath: 'Custom Path (d):',\n                    customPathPlaceholder: 'e.g., /secret-path',\n                    customIP: 'Custom ProxyIP (p):',\n                    customIPPlaceholder: 'e.g., 1.2.3.4 or proxy.example.com',\n                    preferredIPs: 'Preferred IP List (yx):',\n                    preferredIPsPlaceholder: 'e.g., 1.1.1.1:443#HongKong, 8.8.8.8:443#USA',\n                    preferredIPsURL: 'Preferred IP Source URL (yxURL):',\n                    latencyTest: 'Latency Test',\n                    latencyTestIP: 'Test IP/Domain:',\n                    latencyTestIPPlaceholder: 'Enter IP or Domain, comma separated',\n                    latencyTestPort: 'Port:',\n                    startTest: 'Start Test',\n                    stopTest: 'Stop Test',\n                    testResult: 'Test Result:',\n                    addToYx: 'Add to Preferred List',\n                    addSelectedToYx: 'Add Selected to Preferred List',\n                    selectAll: 'Select All',\n                    deselectAll: 'Deselect All',\n                    testingInProgress: 'Testing...',\n                    testComplete: 'Test Complete',\n                    latencyMs: 'Latency (HTTP Handshake)',\n                    timeout: 'Timeout',\n                    ipSource: 'IP Source:',\n                    manualInput: 'Manual Input',\n                    cfRandomIP: 'CF Random IP',\n                    urlFetch: 'URL Fetch',\n                    randomCount: 'Generate Count:',\n                    fetchURL: 'Fetch URL:',\n                    fetchURLPlaceholder: 'Enter URL of IP list',\n                    generateIP: 'Generate IP',\n                    fetchIP: 'Fetch IP',\n                    socks5Config: 'SOCKS5 Config (s):',\n                    customHomepage: 'Custom Homepage URL (homepage):',\n                    customHomepagePlaceholder: 'e.g., https://example.com',\n                    customHomepageHint: 'Set custom URL as homepage camouflage. Content of this URL will be shown when accessing root path /. Leave empty to show default terminal page.',\n                    customPathHint: 'Only accessible via this path if set. UUID access will be disabled. Suggest using complex path to prevent scanning.',\n                    customIPHint: 'Hide Worker real IP, or solve Cloudflare Loop issue. Supports IP:Port or Domain:Port.',\n                    preferredIPsHint: 'Manually specify preferred nodes. Highest priority. Format: IP:Port#Remark.',\n                    socks5ConfigHint: 'Format: user:pass@host:port. Worker will connect to target via this proxy.',\n                    saveConfig: 'Save Config',\n                    advancedControl: 'Advanced Control',\n                    subscriptionConverter: 'Sub Converter URL:',\n                    builtinPreferred: 'Built-in Preferred Type:',\n                    enablePreferredDomain: 'Enable Preferred Domain',\n                    enablePreferredIP: 'Enable Preferred IP',\n                    enableGitHubPreferred: 'Enable GitHub Default Preferred',\n                    allowAPIManagement: 'Allow API Management (ae):',\n                    regionMatching: 'Region Matching (rm):',\n                    downgradeControl: 'Downgrade Control (qj):',\n                    tlsControl: 'TLS Control (dkby):',\n                    preferredControl: 'Preferred Control (yxby):',\n                    saveAdvanced: 'Save Advanced Config',\n                    loading: 'Loading...',\n                    currentConfig: 'üìç Current Path Config',\n                    refreshConfig: 'Refresh Config',\n                    resetConfig: 'Reset Config',\n                    subscriptionCopied: 'Subscription Link Copied',\n                    autoSubscriptionCopied: 'Auto-detected subscription link copied. Client will be recognized by User-Agent.',\n                    trojanPasswordPlaceholder: 'Leave empty to use UUID',\n                    trojanPasswordHint: 'Set custom Trojan password. Leave empty to use UUID. Client will auto-hash password with SHA224.',\n                    protocolHint: 'Multiple protocols can be enabled.<br>‚Ä¢ VLESS WS: Standard WebSocket protocol<br>‚Ä¢ VMess WS: WebSocket-based VMess (link generation)<br>‚Ä¢ Shadowsocks: WebSocket-based SS (link generation)<br>‚Ä¢ Trojan: Uses SHA224 password auth<br>‚Ä¢ xhttp: HTTP POST camouflage (requires custom domain & gRPC)',\n                    enableECH: 'Enable ECH (Encrypted Client Hello)',\n                    enableECHHint: 'When enabled, ECH config is fetched from DoH and added to links on every sub refresh',\n                    customDNS: 'Custom DNS Server',\n                    customDNSPlaceholder: 'e.g., https://dns.joeyblog.eu.org/joeyblog',\n                    customDNSHint: 'DNS server for ECH config query (DoH format)',\n                    customECHDomain: 'Custom ECH Domain',\n                    customECHDomainPlaceholder: 'e.g., cloudflare-ech.com',\n                    customECHDomainHint: 'Domain used in ECH config, leave empty for default',\n                    saveProtocol: 'Save Protocol Config',\n                    subscriptionConverterPlaceholder: 'Default: https://url.v1.mk/sub',\n                    subscriptionConverterHint: 'Custom subscription converter API, leave empty for default',\n                    builtinPreferredHint: 'Control which built-in preferred nodes are included. Default all enabled.',\n                    apiEnabledDefault: 'Default (API Disabled)',\n                    apiEnabledYes: 'Enable API Management',\n                    apiEnabledHint: '‚ö†Ô∏è Security Warning: Enabling API allows dynamic preferred IP addition. Use only if needed.',\n                    regionMatchingDefault: 'Default (Enable Region Match)',\n                    regionMatchingNo: 'Disable Region Match',\n                    regionMatchingHint: 'Smart region matching disabled when set to "Disable"',\n                    downgradeControlDefault: 'Default (Disable Downgrade)',\n                    downgradeControlNo: 'Enable Downgrade Mode',\n                    downgradeControlHint: 'When enabled: CF Direct Fail -> SOCKS5 -> Fallback',\n                    tlsControlDefault: 'Default (Keep All Nodes)',\n                    tlsControlYes: 'TLS Nodes Only',\n                    tlsControlHint: 'When set to "TLS Nodes Only", non-TLS nodes (e.g., port 80) are not generated',\n                    preferredControlDefault: 'Default (Enable Preferred)',\n                    preferredControlYes: 'Disable Preferred',\n                    preferredControlHint: 'When set to "Disable Preferred", only native address is used',\n                    regionNames: {\n                        US: 'üá∫üá∏ US', SG: 'üá∏üá¨ Singapore', JP: 'üáØüáµ Japan',\n                        KR: 'üá∞üá∑ South Korea', DE: 'üá©üá™ Germany', SE: 'üá∏üá™ Sweden', NL: 'üá≥üá± Netherlands',\n                        FI: 'üá´üáÆ Finland', GB: 'üá¨üáß UK', FR: 'üá´üá∑ France', CA: 'üá®üá¶ Canada',\n                        AU: 'üá¶üá∫ Australia', HK: 'üá≠üá∞ Hong Kong', TW: 'üáπüáº Taiwan'\n                    },\n                    terminal: 'Terminal v2.9.3',\n                    githubProject: 'GitHub Project',\n                    autoDetectClient: 'Auto Detect',\n                    selectionLogicText: 'Same Region -> Nearby Region -> Other Regions',\n                    customIPDisabledHint: 'Region selection disabled when using Custom ProxyIP',\n                    customIPMode: 'Custom ProxyIP Mode (p variable enabled)',\n                    customIPModeDesc: 'Custom IP Mode (Region match disabled)',\n                    usingCustomProxyIP: 'Using Custom ProxyIP: ',\n                    customIPConfig: ' (p variable config)',\n                    customIPModeDisabled: 'Custom IP Mode, region selection disabled',\n                    manualRegion: 'Manual Region',\n                    manualRegionDesc: ' (Manual)',\n                    proxyIPAvailable: '10/10 Available (ProxyIP Domain Pre-set)',\n                    smartSelection: 'Smart Nearby Selection',\n                    sameRegionIP: 'Same Region IP Available (1)',\n                    cloudflareDetection: 'Cloudflare Built-in Detection',\n                    detectionFailed: 'Detection Failed',\n                    apiTestResult: 'API Detection Result: ',\n                    apiTestTime: 'Detection Time: ',\n                    apiTestFailed: 'API Detection Failed: ',\n                    unknownError: 'Unknown Error',\n                    apiTestError: 'API Test Failed: ',\n                    kvNotConfigured: 'KV Storage not configured. Config management unavailable.\n\nPlease in Cloudflare Workers:\n1. Create KV Namespace\n2. Bind variable C\n3. Redeploy',\n                    kvNotEnabled: 'KV Storage Not Configured',\n                    kvCheckFailed: 'KV Check Failed: Invalid Response',\n                    kvCheckFailedStatus: 'KV Check Failed - Status: ',\n                    kvCheckFailedError: 'KV Check Failed - Error: '\n                },\n                        fa: {\n                            kvDisabled: '‚ö†Ô∏è ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÅÿπÿßŸÑ ŸÜ€åÿ≥ÿ™ €åÿß Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ŸÜÿ¥ÿØŸá ÿßÿ≥ÿ™',\n                            kvCheckFailedError: 'ÿ®ÿ±ÿ±ÿ≥€å ÿ∞ÿÆ€åÿ±Ÿá‚Äåÿ≥ÿßÿ≤€å KV ŸÜÿßŸÖŸàŸÅŸÇ - ÿÆÿ∑ÿß: '\n                        }\n                    };\n\n                    const t = translations[isFarsi ? 'fa' : 'en'];\n\n                    document.getElementById('kvStatus').innerHTML = '<span style="color: #ffaa00;">' + t.kvDisabled + '</span>';\n                    document.getElementById('configCard').style.display = 'block';\n                    document.getElementById('currentConfig').textContent = t.kvCheckFailedError + error.message;\n                }\n            }\n\n            async function loadCurrentConfig() {\n                const apiUrl = window.location.pathname + '/api/config';\n\n                try {\n                    const response = await fetch(apiUrl);\n\n                    if (response.status === 503) {\n                        document.getElementById('currentConfig').textContent = 'KVÂ≠òÂÇ®Êú™ÈÖçÁΩÆÔºåÊó†Ê≥ïÂä†ËΩΩÈÖçÁΩÆ';\n                        return;\n                    }\n                    if (!response.ok) {\n                        const errorText = await response.text();\n                        document.getElementById('currentConfig').textContent = 'Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•: ' + errorText;\n                        return;\n                    }\n                    const config = await response.json();\n\n                    // ËøáÊª§ÊéâÂÜÖÈÉ®Â≠óÊÆµ kvEnabled\n                    const displayConfig = {};\n                    for (const [key, value] of Object.entries(config)) {\n                        if (key !== 'kvEnabled') {\n                            displayConfig[key] = value;\n                        }\n                    }\n\n                    let configText = 'ÂΩìÂâçÈÖçÁΩÆ:\\n';\n                    if (Object.keys(displayConfig).length === 0) {\n                        configText += '(ÊöÇÊó†ÈÖçÁΩÆ)';\n                    } else {\n                        for (const [key, value] of Object.entries(displayConfig)) {\n                            configText += key + ': ' + (value || '(Êú™ËÆæÁΩÆ)') + '\\n';\n                        }\n                    }\n\n                    document.getElementById('currentConfig').textContent = configText;\n\n                    // Êõ¥Êñ∞Ë°®ÂçïÂÄº\n                    document.getElementById('wkRegion').value = config.wk || '';\n                    document.getElementById('ev').checked = config.ev !== 'no';\n                    document.getElementById('et').checked = config.et === 'yes';\n                    document.getElementById('ex').checked = config.ex === 'yes';\n                    document.getElementById('ech').checked = config.ech === 'yes';\n                    document.getElementById('tp').value = config.tp || '';\n                    if (document.getElementById('customDNS')) {\n                        document.getElementById('customDNS').value = config.customDNS || '';\n                    }\n                    if (document.getElementById('customECHDomain')) {\n                        document.getElementById('customECHDomain').value = config.customECHDomain || '';\n                    }\n                    document.getElementById('scu').value = config.scu || '';\n                    document.getElementById('epd').checked = config.epd !== 'no';\n                    document.getElementById('epi').checked = config.epi !== 'no';\n                    document.getElementById('egi').checked = config.egi !== 'no';\n                    document.getElementById('enableDiverseProxies').checked = config.edp === 'yes' || config.edp === true;\n                    if (document.getElementById('ipv4Enabled')) document.getElementById('ipv4Enabled').checked = config.ipv4 !== 'no';\n                    if (document.getElementById('ipv6Enabled')) document.getElementById('ipv6Enabled').checked = config.ipv6 !== 'no';\n                    if (document.getElementById('ispMobile')) document.getElementById('ispMobile').checked = config.ispMobile !== 'no';\n                    if (document.getElementById('ispUnicom')) document.getElementById('ispUnicom').checked = config.ispUnicom !== 'no';\n                    if (document.getElementById('ispTelecom')) document.getElementById('ispTelecom').checked = config.ispTelecom !== 'no';\n                    document.getElementById('customPath').value = config.d || '';\n                    document.getElementById('customIP').value = config.p || '';\n                    document.getElementById('yx').value = config.yx || '';\n                    document.getElementById('yxURL').value = config.yxURL || '';\n                    document.getElementById('socksConfig').value = config.s || '';\n                    document.getElementById('customHomepage').value = config.homepage || '';\n                    document.getElementById('apiEnabled').value = config.ae || '';\n                    document.getElementById('regionMatching').value = config.rm || '';\n                    document.getElementById('downgradeControl').value = config.qj || '';\n                    document.getElementById('portControl').value = config.dkby || '';\n                    document.getElementById('preferredControl').value = config.yxby || '';\n\n                    // Update path type display\n                    updatePathTypeStatus(config.d);\n\n                    // Check p variable, if it has value, disable wk region selection\n                    updateWkRegionState();\n\n                } catch (error) {\n                    document.getElementById('currentConfig').textContent = 'Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•: ' + error.message;\n                }\n            }\n\n            // Update path type display\n            function updatePathTypeStatus(cp) {\n                const pathTypeStatus = document.getElementById('pathTypeStatus');\n                const currentUrl = window.location.href;\n                const pathParts = window.location.pathname.split('/').filter(p => p);\n                const currentPath = pathParts.length > 0 ? pathParts[0] : '';\n\n                if (cp && cp.trim()) {\n                    // Use custom path (d)\n                    pathTypeStatus.innerHTML = '<div style="color: #44ff44;">‰ΩøÁî®Á±ªÂûã: <strong>Ëá™ÂÆö‰πâË∑ØÂæÑ (d)</strong></div>' +\n                        '<div style="margin-top: 5px; color: #00ff00;">ÂΩìÂâçË∑ØÂæÑ: <span style="color: #ffaa00;">' + cp + '</span></div>' +\n                        '<div style="margin-top: 5px; font-size: 0.9rem; color: #00aa00;">ËÆøÈóÆÂú∞ÂùÄ: ' +\n                        (currentUrl.split('/')[0] + '//' + currentUrl.split('/')[2]) + cp + '/sub</div>';\n                } else {\n                    // Use UUID (u)\n                    pathTypeStatus.innerHTML = '<div style="color: #44ff44;">‰ΩøÁî®Á±ªÂûã: <strong>UUID Ë∑ØÂæÑ (u)</strong></div>' +\n                        '<div style="margin-top: 5px; color: #00ff00;">ÂΩìÂâçË∑ØÂæÑ: <span style="color: #ffaa00;">' + (currentPath || '(UUID)') + '</span></div>' +\n                        '<div style="margin-top: 5px; font-size: 0.9rem; color: #00aa00;">ËÆøÈóÆÂú∞ÂùÄ: ' + currentUrl.split('/sub')[0] + '/sub</div>';\n                }\n            }\n\n            // Update wk region selection enabled/disabled state\n            function updateWkRegionState() {\n                const customIPInput = document.getElementById('customIP');\n                const wkRegion = document.getElementById('wkRegion');\n                const wkRegionHint = document.getElementById('wkRegionHint');\n\n                if (customIPInput && wkRegion) {\n                    const hasCustomIP = customIPInput.value.trim() !== '';\n                    wkRegion.disabled = hasCustomIP;\n\n                    // Add visual feedback\n                    if (hasCustomIP) {\n                        wkRegion.style.opacity = '0.5';\n                        wkRegion.style.cursor = 'not-allowed';\n                        wkRegion.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\n                        // Show hint message\n                        if (wkRegionHint) {\n                            wkRegionHint.style.display = 'block';\n                            wkRegionHint.style.color = '#ffaa00';\n                        }\n                    } else {\n                        wkRegion.style.opacity = '1';\n                        wkRegion.style.cursor = 'pointer';\n                        wkRegion.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\n                        // Hide hint message\n                        if (wkRegionHint) {\n                            wkRegionHint.style.display = 'none';\n                        }\n                    }\n                }\n            }\n\n            async function saveConfig(configData) {\n                const apiUrl = window.location.pathname + '/api/config';\n\n                try {\n                    const response = await fetch(apiUrl, {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json' },\n                        body: JSON.stringify(configData)\n                    });\n\n\n                    if (response.status === 503) {\n                        showStatus('KV not configured, cannot save. Please configure KV in Cloudflare Workers.', 'error');\n                        return;\n                    }\n\n                    if (!response.ok) {\n                        const errorText = await response.text();\n\n                        // Try parsing JSON error message\n                        try {\n                            const errorData = JSON.parse(errorText);\n                            showStatus(errorData.message || 'Save failed', 'error');\n                        } catch (parseError) {\n                            // If not JSON, display text directly\n                            showStatus('Save failed: ' + errorText, 'error');\n                        }\n                        return;\n                    }\n\n                    const result = await response.json();\n\n                    showStatus(result.message, result.success ? 'success' : 'error');\n\n                    if (result.success) {\n                        await loadCurrentConfig();\n                        // Êõ¥Êñ∞wkÂú∞Âå∫ÈÄâÊã©Áä∂ÊÄÅ\n                        updateWkRegionState();\n                        // Reload page after successful save to update system status\n                        setTimeout(function() {\n                            window.location.reload();\n                        }, 1500);\n                    } else {\n                    }\n                } catch (error) {\n                    showStatus('Save failed: ' + error.message, 'error');\n                }\n            }\n\n            function showStatus(message, type) {\n                const statusDiv = document.getElementById('statusMessage');\n                statusDiv.textContent = message;\n                statusDiv.style.display = 'block';\n                statusDiv.style.color = type === 'success' ? '#00ff00' : '#ff0000';\n                statusDiv.style.borderColor = type === 'success' ? '#00ff00' : '#ff0000';\n\n                setTimeout(function() {\n                    statusDiv.style.display = 'none';\n                }, 3000);\n            }\n\n            async function resetAllConfig() {\n                if (confirm('Are you sure to reset all config? This will clear KV config and revert to env vars.')) {\n                    try {\n                        const response = await fetch(window.location.pathname + '/api/config', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json' },\n                            body: JSON.stringify({\n                                wk: '',\n                                d: '',\n                                p: '',\n                                yx: '',\n                                yxURL: '',\n                                s: '', ae: '',\n                                rm: '',\n                                qj: '',\n                                dkby: '',\n                                yxby: '', ev: '', et: '', ex: '', tp: '', scu: '', epd: '', epi: '', egi: '',\n                                ipv4: '', ipv6: '', ispMobile: '', ispUnicom: '', ispTelecom: '',\n                                homepage: ''\n                            })\n                        });\n\n                        if (response.status === 503) {\n                            showStatus('KV not configured, cannot reset.', 'error');\n                            return;\n                        }\n\n                        if (!response.ok) {\n                            const errorText = await response.text();\n\n                            // Try parsing JSON error message\n                            try {\n                                const errorData = JSON.parse(errorText);\n                                showStatus(errorData.message || 'Reset failed', 'error');\n                            } catch (parseError) {\n                                // If not JSON, display text directly\n                                showStatus('Reset failed: ' + errorText, 'error');\n                            }\n                            return;\n                        }\n\n                        const result = await response.json();\n                        showStatus(result.message || 'Config reset', result.success ? 'success' : 'error');\n\n                        if (result.success) {\n                            await loadCurrentConfig();\n                            // Êõ¥Êñ∞wkÂú∞Âå∫ÈÄâÊã©Áä∂ÊÄÅ\n                            updateWkRegionState();\n                            // Reload page to update system status\n                            setTimeout(function() {\n                                window.location.reload();\n                            }, 1500);\n                        }\n                    } catch (error) {\n                        showStatus('Reset failed: ' + error.message, 'error');\n                    }\n                }\n            }\n\n            async function checkECHStatus() {\n                const echStatusEl = document.getElementById('echStatus');\n\n                if (!echStatusEl) return;\n\n                try {\n                    const currentUrl = window.location.href;\n                    const subscriptionUrl = currentUrl + '/sub';\n\n                    echStatusEl.innerHTML = 'ECH Status: <span style="color: #ffaa00;">Checking...</span>';\n\n                    const response = await fetch(subscriptionUrl, {\n                        method: 'GET',\n                        headers: {\n                            'Accept': 'text/plain'\n                        }\n                    });\n\n                    const echStatusHeader = response.headers.get('X-ECH-Status');\n                    const echConfigLength = response.headers.get('X-ECH-Config-Length');\n\n                    if (echStatusHeader === 'ENABLED') {\n                        echStatusEl.innerHTML = 'ECH Status: <span style="color: #44ff44;">‚úÖ Enabled' + (echConfigLength ? ' (ÈÖçÁΩÆÈïøÂ∫¶: ' + echConfigLength + ')' : '') + '</span>';\n                    } else {\n                        echStatusEl.innerHTML = 'ECH Status: <span style="color: #ffaa00;">‚ö†Ô∏è Disabled</span>';\n                    }\n                } catch (error) {\n                    echStatusEl.innerHTML = 'ECH Status: <span style="color: #ff4444;">‚ùå Check Failed: ' + error.message + '</span>';\n                }\n            }\n\n            document.addEventListener('DOMContentLoaded', function() {\n                createMatrixRain();\n                checkSystemStatus();\n                checkKVStatus();\n                checkECHStatus();\n\n                // Automatically enable TLS-only when ECH is enabled\n                const echCheckbox = document.getElementById('ech');\n                const portControl = document.getElementById('portControl');\n                if (echCheckbox && portControl) {\n                    echCheckbox.addEventListener('change', function() {\n                        if (this.checked) {\n                            // When ECH is enabled, automatically set TLS-only to yes\n                            portControl.value = 'yes';\n                        }\n                    });\n\n                    // On page load, if ECH is checked, also automatically set TLS-only\n                    if (echCheckbox.checked) {\n                        portControl.value = 'yes';\n                    }\n                }\n\n                // Listen for customIP input changes, update wk region selection state in real-time\n                const customIPInput = document.getElementById('customIP');\n                if (customIPInput) {\n                    customIPInput.addEventListener('input', function() {\n                        updateWkRegionState();\n                    });\n                }\n\n                // Bind form events\n                const regionForm = document.getElementById('regionForm');\n                if (regionForm) {\n                    regionForm.addEventListener('submit', async function(e) {\n                        e.preventDefault();\n                        const wkRegion = document.getElementById('wkRegion').value;\n                        await saveConfig({ wk: wkRegion });\n                    });\n                }\n\n                const saveProtocolBtn = document.getElementById('saveProtocolBtn');\n                if (saveProtocolBtn) {\n                    saveProtocolBtn.addEventListener('click', async function(e) {\n                        e.preventDefault();\n                        const configData = {\n                            ev: document.getElementById('ev').checked ? 'yes' : 'no',\n                            evm: document.getElementById('evm').checked ? 'yes' : 'no',\n                            ess: document.getElementById('ess').checked ? 'yes' : 'no',\n                            etu: document.getElementById('etu').checked ? 'yes' : 'no',\n                            ehy: document.getElementById('ehy').checked ? 'yes' : 'no',\n                            eg: document.getElementById('eg').checked ? 'yes' : 'no',\n                            et: document.getElementById('et').checked ? 'yes' : 'no',\n                            ex: document.getElementById('ex').checked ? 'yes' : 'no',\n                            ech: document.getElementById('ech').checked ? 'yes' : 'no',\n                            tp: document.getElementById('tp').value,\n                            customDNS: document.getElementById('customDNS').value,\n                            customECHDomain: document.getElementById('customECHDomain').value\n                        };\n\n                        if (!document.getElementById('ev').checked &&\n                            !document.getElementById('evm').checked &&\n                            !document.getElementById('ess').checked &&\n                            !document.getElementById('et').checked &&\n                            !document.getElementById('ex').checked) {\n                            alert('At least one protocol must be enabled!');\n                            return;\n                        }\n\n                        await saveConfig(configData);\n                    });\n                }\n\n                const otherConfigForm = document.getElementById('otherConfigForm');\n                if (otherConfigForm) {\n                    otherConfigForm.addEventListener('submit', async function(e) {\n                        e.preventDefault();\n                        const configData = {\n                            ev: document.getElementById('ev').checked ? 'yes' : 'no',\n                            evm: document.getElementById('evm').checked ? 'yes' : 'no',\n                            ess: document.getElementById('ess').checked ? 'yes' : 'no',\n                            etu: document.getElementById('etu').checked ? 'yes' : 'no',\n                            ehy: document.getElementById('ehy').checked ? 'yes' : 'no',\n                            eg: document.getElementById('eg').checked ? 'yes' : 'no',\n                            et: document.getElementById('et').checked ? 'yes' : 'no',\n                            ex: document.getElementById('ex').checked ? 'yes' : 'no',\n                            ech: document.getElementById('ech').checked ? 'yes' : 'no',\n                            tp: document.getElementById('tp').value,\n                            d: document.getElementById('customPath').value,\n                            p: document.getElementById('customIP').value,\n                            yx: document.getElementById('yx').value,\n                            yxURL: document.getElementById('yxURL').value,\n                            s: document.getElementById('socksConfig').value,\n                            homepage: document.getElementById('customHomepage').value,\n                            customDNS: document.getElementById('customDNS').value,\n                            customECHDomain: document.getElementById('customECHDomain').value\n                        };\n\n                        // Ensure at least one protocol is selected\n                        if (!document.getElementById('ev').checked &&\n                            !document.getElementById('evm').checked &&\n                            !document.getElementById('ess').checked &&\n                            !document.getElementById('et').checked &&\n                            !document.getElementById('ex').checked) {\n                            alert('At least one protocol must be enabled!');\n                            return;\n                        }\n\n                        await saveConfig(configData);\n                    });\n                }\n\n                const advancedConfigForm = document.getElementById('advancedConfigForm');\n                if (advancedConfigForm) {\n                    advancedConfigForm.addEventListener('submit', async function(e) {\n                        e.preventDefault();\n                        const configData = { scu: document.getElementById('scu').value, epd: document.getElementById('epd').checked ? 'yes' : 'no', epi: document.getElementById('epi').checked ? 'yes' : 'no', egi: document.getElementById('egi').checked ? 'yes' : 'no', edp: document.getElementById('enableDiverseProxies').checked ? 'yes' : 'no', ae: document.getElementById('apiEnabled').value,\n                            rm: document.getElementById('regionMatching').value,\n                            qj: document.getElementById('downgradeControl').value,\n                            dkby: document.getElementById('portControl').value,\n                            yxby: document.getElementById('preferredControl').value,\n                            ipv4: document.getElementById('ipv4Enabled').checked ? 'yes' : 'no',\n                            ipv6: document.getElementById('ipv6Enabled').checked ? 'yes' : 'no',\n                            ispMobile: document.getElementById('ispMobile').checked ? 'yes' : 'no',\n                            ispUnicom: document.getElementById('ispUnicom').checked ? 'yes' : 'no',\n                            ispTelecom: document.getElementById('ispTelecom').checked ? 'yes' : 'no'\n                        };\n                        await saveConfig(configData);\n                    });\n                }\n\n                let testAbortController = null;\n                let testResults = [];\n\n                const startTestBtn = document.getElementById('startLatencyTest');\n                const stopTestBtn = document.getElementById('stopLatencyTest');\n                const testStatus = document.getElementById('latencyTestStatus');\n                const testResultsDiv = document.getElementById('latencyTestResults');\n                const resultsList = document.getElementById('latencyResultsList');\n                const overwriteSelectedBtn = document.getElementById('overwriteSelectedToYx');\n                const appendSelectedBtn = document.getElementById('appendSelectedToYx');\n                const selectAllBtn = document.getElementById('selectAllResults');\n                const deselectAllBtn = document.getElementById('deselectAllResults');\n                const ipSourceSelect = document.getElementById('ipSourceSelect');\n                const manualInputDiv = document.getElementById('manualInputDiv');\n                const urlFetchDiv = document.getElementById('urlFetchDiv');\n                const latencyTestInput = document.getElementById('latencyTestInput');\n                const fetchURLInput = document.getElementById('fetchURLInput');\n                const latencyTestPort = document.getElementById('latencyTestPort');\n                const randomIPCount = document.getElementById('randomIPCount');\n                const cfRandomDiv = document.getElementById('cfRandomDiv');\n                const randomCountDiv = document.getElementById('randomCountDiv');\n                const generateCFIPBtn = document.getElementById('generateCFIPBtn');\n                const fetchIPBtn = document.getElementById('fetchIPBtn');\n\n                if (latencyTestInput) {\n                    const savedTestInput = localStorage.getItem('latencyTestInput');\n                    if (savedTestInput) latencyTestInput.value = savedTestInput;\n                    latencyTestInput.addEventListener('input', function() {\n                        localStorage.setItem('latencyTestInput', this.value);\n                    });\n                }\n                if (fetchURLInput) {\n                    const savedFetchURL = localStorage.getItem('fetchURLInput');\n                    if (savedFetchURL) fetchURLInput.value = savedFetchURL;\n                    fetchURLInput.addEventListener('input', function() {\n                        localStorage.setItem('fetchURLInput', this.value);\n                    });\n                }\n                if (latencyTestPort) {\n                    const savedPort = localStorage.getItem('latencyTestPort');\n                    if (savedPort) latencyTestPort.value = savedPort;\n                    latencyTestPort.addEventListener('input', function() {\n                        localStorage.setItem('latencyTestPort', this.value);\n                    });\n                }\n                if (randomIPCount) {\n                    const savedCount = localStorage.getItem('randomIPCount');\n                    if (savedCount) randomIPCount.value = savedCount;\n                    randomIPCount.addEventListener('input', function() {\n                        localStorage.setItem('randomIPCount', this.value);\n                    });\n                    // On init, if hidden by default, disable input box\n                    if (randomCountDiv && randomCountDiv.style.display === 'none') {\n                        randomIPCount.disabled = true;\n                    }\n                }\n                const testThreadsInput = document.getElementById('testThreads');\n                if (testThreadsInput) {\n                    const savedThreads = localStorage.getItem('testThreads');\n                    if (savedThreads) testThreadsInput.value = savedThreads;\n                    testThreadsInput.addEventListener('input', function() {\n                        localStorage.setItem('testThreads', this.value);\n                    });\n                }\n                if (ipSourceSelect) {\n                    const savedSource = localStorage.getItem('ipSourceSelect');\n                    const currentSource = savedSource || ipSourceSelect.value || 'manual';\n                    if (savedSource) {\n                        ipSourceSelect.value = savedSource;\n                    }\n                    manualInputDiv.style.display = currentSource === 'manual' ? 'block' : 'none';\n                    urlFetchDiv.style.display = currentSource === 'urlFetch' ? 'block' : 'none';\n                    cfRandomDiv.style.display = currentSource === 'cfRandom' ? 'block' : 'none';\n                    randomCountDiv.style.display = currentSource === 'cfRandom' ? 'block' : 'none';\n                    // When hidden, disable input box to avoid form validation errors\n                    if (randomIPCount) {\n                        randomIPCount.disabled = currentSource !== 'cfRandom';\n                    }\n                }\n\n                const CF_CIDR_LIST = [\n                    '173.245.48.0/20', '103.21.244.0/22', '103.22.200.0/22', '103.31.4.0/22',\n                    '141.101.64.0/18', '108.162.192.0/18', '190.93.240.0/20', '188.114.96.0/20',\n                    '197.234.240.0/22', '198.41.128.0/17', '162.158.0.0/15', '104.16.0.0/13',\n                    '104.24.0.0/14', '172.64.0.0/13', '131.0.72.0/22'\n                ];\n\n                function generateRandomIPFromCIDR(cidr) {\n                    const [baseIP, prefixLength] = cidr.split('/');\n                    const prefix = parseInt(prefixLength);\n                    const hostBits = 32 - prefix;\n                    const ipParts = baseIP.split('.').map(p => parseInt(p));\n                    const ipInt = (ipParts[0] << 24) | (ipParts[1] << 16) | (ipParts[2] << 8) | ipParts[3];\n                    const randomOffset = Math.floor(Math.random() * Math.pow(2, hostBits));\n                    const mask = (0xFFFFFFFF << hostBits) >>> 0;\n                    const randomIP = (((ipInt & mask) >>> 0) + randomOffset) >>> 0;\n                    return [(randomIP >>> 24) & 0xFF, (randomIP >>> 16) & 0xFF, (randomIP >>> 8) & 0xFF, randomIP & 0xFF].join('.');\n                }\n\n                function generateCFRandomIPs(count, port) {\n                    const ips = [];\n                    for (let i = 0; i < count; i++) {\n                        const cidr = CF_CIDR_LIST[Math.floor(Math.random() * CF_CIDR_LIST.length)];\n                        const ip = generateRandomIPFromCIDR(cidr);\n                        ips.push(ip + ':' + port);\n                    }\n                    return ips;\n                }\n\n                if (ipSourceSelect) {\n                    ipSourceSelect.addEventListener('change', function() {\n                        const value = this.value;\n                        localStorage.setItem('ipSourceSelect', value);\n                        manualInputDiv.style.display = value === 'manual' ? 'block' : 'none';\n                        urlFetchDiv.style.display = value === 'urlFetch' ? 'block' : 'none';\n                        cfRandomDiv.style.display = value === 'cfRandom' ? 'block' : 'none';\n                        randomCountDiv.style.display = value === 'cfRandom' ? 'block' : 'none';\n                        // When hidden, disable input box to avoid form validation errors\n                        if (randomIPCount) {\n                            randomIPCount.disabled = value !== 'cfRandom';\n                        }\n                    });\n                }\n\n                if (generateCFIPBtn) {\n                    generateCFIPBtn.addEventListener('click', function() {\n                        const count = parseInt(document.getElementById('randomIPCount').value) || 20;\n                        const port = document.getElementById('latencyTestPort').value || '443';\n                        const ips = generateCFRandomIPs(count, port);\n                        document.getElementById('latencyTestInput').value = ips.join(',');\n                        manualInputDiv.style.display = 'block';\n                        showStatus('${a?"ÿ™ŸàŸÑ€åÿØ ÿ¥ÿØ":"Generated"} ' + count + ' ${a?"IP ÿ™ÿµÿßÿØŸÅ€å CF":" CF Random IPs"}', 'success');\n                    });\n                }\n\n                if (fetchIPBtn) {\n                    fetchIPBtn.addEventListener('click', async function() {\n                        const urlInput = document.getElementById('fetchURLInput');\n                        const fetchUrl = urlInput.value.trim();\n                        if (!fetchUrl) {\n                            alert('${a?"ŸÑÿ∑ŸÅÿß URL ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ":"Please enter URL"}');\n                            return;\n                        }\n\n                        fetchIPBtn.disabled = true;\n                        fetchIPBtn.textContent = '${a?"ÿØÿ± ÿ≠ÿßŸÑ ÿØÿ±€åÿßŸÅÿ™...":"Fetching..."}';\n\n                        try {\n                            // Support multiple URLs (comma separated) and multiple IPs/nodes (comma separated) in response\n                            const urlList = Array.from(new Set(\n                                fetchUrl.split(',').map(u => u.trim()).filter(u => u)\n                            ));\n\n                            const allItems = [];\n\n                            for (const u of urlList) {\n                                const response = await fetch(u);\n                                if (!response.ok) {\n                                    throw new Error('HTTP ' + response.status + ' @ ' + u);\n                                }\n                                const text = await response.text();\n\n                                // Split by line first, then by comma in each line, compatible with both 'multi-line' and 'comma-separated' formats\n                                const perUrlItems = text\n                                    .split(/\\r?\\n/)\n                                    .map(l => l.trim())\n                                    .filter(l => l && !l.startsWith('#'))\n                                    .flatMap(l => l.split(',').map(p => p.trim()).filter(p => p));\n\n                                allItems.push(...perUrlItems);\n                            }\n\n                            if (allItems.length > 0) {\n                                document.getElementById('latencyTestInput').value = allItems.join(',');\n                                manualInputDiv.style.display = 'block';\n                                showStatus('${a?"ÿØÿ±€åÿßŸÅÿ™ ÿ¥ÿØ":"Fetched"} ' + allItems.length + ' ${a?"IP":" IPs"}', 'success');\n                            } else {\n                                showStatus('${a?"ÿØÿßÿØŸá‚Äåÿß€å €åÿßŸÅÿ™ ŸÜÿ¥ÿØ":"No data found"}', 'error');\n                            }\n                        } catch (err) {\n                            showStatus('${a?"ÿÆÿ∑ÿß ÿØÿ± ÿØÿ±€åÿßŸÅÿ™":"Fetch failed"}: ' + err.message, 'error');\n                        } finally {\n                            fetchIPBtn.disabled = false;\n                            fetchIPBtn.textContent = '‚¨á ${a?"ÿØÿ±€åÿßŸÅÿ™ IP":"Fetch IP"}';\n                        }\n                    });\n                }\n\n                if (startTestBtn) {\n                    startTestBtn.addEventListener('click', async function() {\n                        const inputField = document.getElementById('latencyTestInput');\n                        const portField = document.getElementById('latencyTestPort');\n                        const threadsField = document.getElementById('testThreads');\n                        const inputValue = inputField.value.trim();\n                        const defaultPort = portField.value || '443';\n                        const threads = parseInt(threadsField.value) || 5;\n\n                        if (!inputValue) {\n                            showStatus('${a?"ŸÑÿ∑ŸÅÿß IP €åÿß ÿØÿßŸÖŸÜŸá Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ":"Please enter IP or Domain"}', 'error');\n                            return;\n                        }\n\n                        const targets = inputValue.split(',').map(t => t.trim()).filter(t => t);\n                        if (targets.length === 0) return;\n\n                        startTestBtn.style.display = 'none';\n                        stopTestBtn.style.display = 'inline-block';\n                        testStatus.style.display = 'block';\n                        testResultsDiv.style.display = 'block';\n                        resultsList.innerHTML = '';\n                        testResults = [];\n                        if (cityFilterContainer) {\n                            cityFilterContainer.style.display = 'none';\n                        }\n\n                        testAbortController = new AbortController();\n\n                        let completed = 0;\n                        const total = targets.length;\n\n                        function parseTarget(target) {\n                            let host = target;\n                            let port = defaultPort;\n                            let nodeName = '';\n\n                            if (target.includes('#')) {\n                                const parts = target.split('#');\n                                nodeName = parts[1] || '';\n                                host = parts[0];\n                            }\n\n                            if (host.includes(':') && !host.startsWith('[')) {\n                                const lastColon = host.lastIndexOf(':');\n                                const possiblePort = host.substring(lastColon + 1);\n                                if (/^[0-9]+$/.test(possiblePort)) {\n                                    port = possiblePort;\n                                    host = host.substring(0, lastColon);\n                                }\n                            } else if (host.includes(']:')) {\n                                const parts = host.split(']:');\n                                host = parts[0] + ']';\n                                port = parts[1];\n                            }\n                            return { host, port, nodeName };\n                        }\n\n                        function renderResult(result, index, shouldShow = true) {\n                            // Only show successful online optimization results, failed/timed out ones are not shown\n                            if (!result.success) {\n                                return null;\n                            }\n\n                            const resultItem = document.createElement('div');\n                            resultItem.style.cssText = 'display: flex; align-items: center; padding: 8px; border-bottom: 1px solid #003300; gap: 10px;';\n                            resultItem.dataset.index = index;\n                            resultItem.dataset.colo = result.colo || '';\n                            if (!shouldShow) {\n                                resultItem.style.display = 'none';\n                            }\n\n                            const checkbox = document.createElement('input');\n                            checkbox.type = 'checkbox';\n                            checkbox.checked = true;\n                            checkbox.disabled = false;\n                            checkbox.dataset.index = index;\n                            checkbox.style.cssText = 'width: 18px; height: 18px; cursor: pointer;';\n\n                            const info = document.createElement('div');\n                            info.style.cssText = 'flex: 1; font-family: monospace; font-size: 13px;';\n\n                            const coloName = result.colo ? getColoName(result.colo) : '';\n                            const coloDisplay = coloName ? ' <span style="color: #00aaff;">[' + coloName + ']</span>' : '';\n                            info.innerHTML = '<span style="color: #00ff00;">' + result.host + ':' + result.port + '</span>' + coloDisplay + ' <span style="color: #ffff00;">' + result.latency + 'ms</span>';\n\n                            resultItem.appendChild(checkbox);\n                            resultItem.appendChild(info);\n                            resultsList.appendChild(resultItem);\n                            return resultItem;\n                        }\n\n                        async function testOne(target) {\n                            if (testAbortController.signal.aborted) return null;\n                            const { host, port, nodeName } = parseTarget(target);\n                            const result = await testLatency(host, port, testAbortController.signal);\n                            result.host = host;\n                            result.port = port;\n                            result.nodeName = (result.success && result.colo) ? (nodeName || ('CF-' + result.colo)) : (nodeName || host);\n                            return result;\n                        }\n\n                        for (let i = 0; i < total; i += threads) {\n                            if (testAbortController.signal.aborted) break;\n\n                            const batch = targets.slice(i, Math.min(i + threads, total));\n                            testStatus.textContent = '${a?"ÿØÿ± ÿ≠ÿßŸÑ ÿ™ÿ≥ÿ™":"Testing"}: ' + (i + 1) + '-' + Math.min(i + threads, total) + '/' + total + ' (${a?"ÿ±ÿ¥ÿ™Ÿá‚ÄåŸáÿß":"Á∫øÁ®ã"}: ' + threads + ')';\n\n                            const results = await Promise.all(batch.map(t => testOne(t)));\n\n                            for (const result of results) {\n                                if (result) {\n                                    const idx = testResults.length;\n                                    testResults.push(result);\n                                    renderResult(result, idx);\n                                    completed++;\n                                }\n                            }\n                        }\n\n                        testStatus.textContent = '${a?"ÿ™ÿ≥ÿ™ ⁄©ÿßŸÖŸÑ ÿ¥ÿØ":"Test Complete"}: ' + completed + '/' + total;\n                        startTestBtn.style.display = 'inline-block';\n                        stopTestBtn.style.display = 'none';\n\n                        // Update city filter\n                        updateCityFilter();\n                    });\n                }\n\n                if (stopTestBtn) {\n                    stopTestBtn.addEventListener('click', function() {\n                        if (testAbortController) {\n                            testAbortController.abort();\n                        }\n                        startTestBtn.style.display = 'inline-block';\n                        stopTestBtn.style.display = 'none';\n                        testStatus.textContent = '${a?"ÿ™ÿ≥ÿ™ ŸÖÿ™ŸàŸÇŸÅ ÿ¥ÿØ":"Test Stopped"}';\n                    });\n                }\n\n                if (selectAllBtn) {\n                    selectAllBtn.addEventListener('click', function() {\n                        const checkboxes = resultsList.querySelectorAll('input[type="checkbox"]:not(:disabled)');\n                        checkboxes.forEach(cb => cb.checked = true);\n                    });\n                }\n\n                if (deselectAllBtn) {\n                    deselectAllBtn.addEventListener('click', function() {\n                        const checkboxes = resultsList.querySelectorAll('input[type="checkbox"]');\n                        checkboxes.forEach(cb => cb.checked = false);\n                    });\n                }\n\n                // Generic function to get selected items\n                function getSelectedItems() {\n                    const checkboxes = resultsList.querySelectorAll('input[type="checkbox"]:checked');\n                    if (checkboxes.length === 0) {\n                        showStatus('${a?"ŸÑÿ∑ŸÅÿß ÿ≠ÿØÿßŸÇŸÑ €å⁄© ŸÖŸàÿ±ÿØ ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ":"Please select at least one item"}', 'error');\n                        return null;\n                    }\n\n                    const selectedItems = [];\n                    checkboxes.forEach(cb => {\n                        const idx = parseInt(cb.dataset.index);\n                        const result = testResults[idx];\n                        if (result && result.success) {\n                            const coloName = result.colo ? getColoName(result.colo) : result.nodeName;\n                            const itemStr = result.host + ':' + result.port + '#' + coloName;\n                            selectedItems.push(itemStr);\n                        }\n                    });\n\n                    return selectedItems;\n                }\n\n                // Overwrite add\n                if (overwriteSelectedBtn) {\n                    overwriteSelectedBtn.addEventListener('click', async function() {\n                        const selectedItems = getSelectedItems();\n                        if (!selectedItems || selectedItems.length === 0) return;\n\n                        const yxInput = document.getElementById('yx');\n                        const newValue = selectedItems.join(',');\n                        yxInput.value = newValue;\n\n                        overwriteSelectedBtn.disabled = true;\n                        appendSelectedBtn.disabled = true;\n                        overwriteSelectedBtn.textContent = '${a?"ÿØÿ± ÿ≠ÿßŸÑ ÿ∞ÿÆ€åÿ±Ÿá...":"Saving..."}';\n\n                        try {\n                            const configData = {\n                                p: document.getElementById('customIP').value,\n                                yx: newValue,\n                                yxURL: document.getElementById('yxURL').value,\n                                s: document.getElementById('socksConfig').value\n                            };\n                            await saveConfig(configData);\n                            showStatus('${a?"ŸÖŸàŸÅŸÇ€åÿ™‚Äåÿ¢ŸÖ€åÿ≤ ÿ®ŸàÿØ":"Overwritten"} ' + selectedItems.length + ' ${a?"ŸÖŸàÿ±ÿØ Ÿà ÿ∞ÿÆ€åÿ±Ÿá ÿ¥ÿØ":" items saved"}', 'success');\n                        } catch (err) {\n                            showStatus('${a?"ÿÆÿ∑ÿß ÿØÿ± ÿ∞ÿÆ€åÿ±Ÿá":"Save failed"}: ' + err.message, 'error');\n                        } finally {\n                            overwriteSelectedBtn.disabled = false;\n                            appendSelectedBtn.disabled = false;\n                            overwriteSelectedBtn.textContent = '${a?"Ë¶ÜÁõñÊ∑ªÂä†":"Overwrite Add"}';\n                        }\n                    });\n                }\n\n                // Append add\n                if (appendSelectedBtn) {\n                    appendSelectedBtn.addEventListener('click', async function() {\n                        const selectedItems = getSelectedItems();\n                        if (!selectedItems || selectedItems.length === 0) return;\n\n                        const yxInput = document.getElementById('yx');\n                        const currentValue = yxInput.value.trim();\n                        const newItems = selectedItems.join(',');\n                        const newValue = currentValue ? (currentValue + ',' + newItems) : newItems;\n                        yxInput.value = newValue;\n\n                        overwriteSelectedBtn.disabled = true;\n                        appendSelectedBtn.disabled = true;\n                        appendSelectedBtn.textContent = '${a?"ÿØÿ± ÿ≠ÿßŸÑ ÿ∞ÿÆ€åÿ±Ÿá...":"Saving..."}';\n\n                        try {\n                            const configData = {\n                                p: document.getElementById('customIP').value,\n                                yx: newValue,\n                                yxURL: document.getElementById('yxURL').value,\n                                s: document.getElementById('socksConfig').value\n                            };\n                            await saveConfig(configData);\n                            showStatus('${a?"ŸÖŸàŸÅŸÇ€åÿ™‚Äåÿ¢ŸÖ€åÿ≤ ÿ®ŸàÿØ":"Appended"} ' + selectedItems.length + ' ${a?"ŸÖŸàÿ±ÿØ Ÿà ÿ∞ÿÆ€åÿ±Ÿá ÿ¥ÿØ":" items saved"}', 'success');\n                        } catch (err) {\n                            showStatus('${a?"ÿÆÿ∑ÿß ÿØÿ± ÿ∞ÿÆ€åÿ±Ÿá":"Save failed"}: ' + err.message, 'error');\n                        } finally {\n                            overwriteSelectedBtn.disabled = false;\n                            appendSelectedBtn.disabled = false;\n                            appendSelectedBtn.textContent = '${a?"ËøΩÂä†Ê∑ªÂä†":"Append Add"}';\n                        }\n                    });\n                }\n\n                function ipToHex(ip) {\n                    const parts = ip.split('.');\n                    if (parts.length !== 4) return null;\n                    let hex = '';\n                    for (let i = 0; i < 4; i++) {\n                        const num = parseInt(parts[i]);\n                        if (isNaN(num) || num < 0 || num > 255) return null;\n                        hex += num.toString(16).padStart(2, '0');\n                    }\n                    return hex;\n                }\n\n                const coloMap = {\n                    'SJC': 'üá∫üá∏ Âú£‰ΩïÂ°û', 'LAX': 'üá∫üá∏ Ê¥õÊùâÁü∂', 'SEA': 'üá∫üá∏ Ë•øÈõÖÂõæ', 'SFO': 'üá∫üá∏ ÊóßÈáëÂ±±', 'DFW': 'üá∫üá∏ ËææÊãâÊñØ',\n                    'ORD': 'üá∫üá∏ ËäùÂä†Âì•', 'IAD': 'üá∫üá∏ ÂçéÁõõÈ°ø', 'ATL': 'üá∫üá∏ ‰∫öÁâπÂÖ∞Â§ß', 'MIA': 'üá∫üá∏ ËøàÈòøÂØÜ', 'DEN': 'üá∫üá∏ ‰∏π‰Ωõ',\n                    'PHX': 'üá∫üá∏ Âá§Âá∞Âüé', 'BOS': 'üá∫üá∏ Ê≥¢Â£´È°ø', 'EWR': 'üá∫üá∏ Á∫ΩÁì¶ÂÖã', 'JFK': 'üá∫üá∏ Á∫ΩÁ∫¶', 'LAS': 'üá∫üá∏ ÊãâÊñØÁª¥Âä†ÊñØ',\n                    'MSP': 'üá∫üá∏ ÊòéÂ∞ºÈòøÊ≥¢Âà©ÊñØ', 'DTW': 'üá∫üá∏ Â∫ïÁâπÂæã', 'PHL': 'üá∫üá∏ Ë¥πÂüé', 'CLT': 'üá∫üá∏ Â§èÊ¥õÁâπ', 'SLC': 'üá∫üá∏ ÁõêÊπñÂüé',\n                    'PDX': 'üá∫üá∏ Ê≥¢ÁâπÂÖ∞', 'SAN': 'üá∫üá∏ Âú£Âú∞‰∫öÂì•', 'TPA': 'üá∫üá∏ Âù¶Â∏ï', 'IAH': 'üá∫üá∏ ‰ºëÊñØÈ°ø', 'MCO': 'üá∫üá∏ Â••ÂÖ∞Â§ö',\n                    'AUS': 'üá∫üá∏ Â••ÊñØÊ±Ä', 'BNA': 'üá∫üá∏ Á∫≥‰ªÄÁª¥Â∞î', 'RDU': 'üá∫üá∏ ÁΩóÂà©', 'IND': 'üá∫üá∏ Âç∞Á¨¨ÂÆâÁ∫≥Ê≥¢Âà©ÊñØ', 'CMH': 'üá∫üá∏ Âì•‰º¶Â∏É',\n                    'MCI': 'üá∫üá∏ Â†™Ëê®ÊñØÂüé', 'OMA': 'üá∫üá∏ Â••È©¨Âìà', 'ABQ': 'üá∫üá∏ ÈòøÂ∞î‰ºØÂÖãÂü∫', 'OKC': 'üá∫üá∏ ‰øÑÂÖãÊãâËç∑È©¨Âüé', 'MEM': 'üá∫üá∏ Â≠üËè≤ÊñØ',\n                    'JAX': 'üá∫üá∏ Êù∞ÂÖãÈÄäÁª¥Â∞î', 'RIC': 'üá∫üá∏ ÈáåÂ£´Êª°', 'BUF': 'üá∫üá∏ Â∏ÉÊ≥ïÁΩó', 'PIT': 'üá∫üá∏ ÂåπÂÖπÂ†°', 'CLE': 'üá∫üá∏ ÂÖãÂà©Â§´ÂÖ∞',\n                    'CVG': 'üá∫üá∏ ËæõËæõÈÇ£Êèê', 'MKE': 'üá∫üá∏ ÂØÜÂ∞îÊ≤ÉÂü∫', 'STL': 'üá∫üá∏ Âú£Ë∑ØÊòìÊñØ', 'SAT': 'üá∫üá∏ Âú£ÂÆâ‰∏úÂ∞ºÂ••', 'HNL': 'üá∫üá∏ Ê™ÄÈ¶ôÂ±±',\n                    'ANC': 'üá∫üá∏ ÂÆâÂÖãÈõ∑Â•á', 'SMF': 'üá∫üá∏ Ëê®ÂÖãÊãâÈó®Êâò', 'ONT': 'üá∫üá∏ ÂÆâÂ§ßÁï•', 'OAK': 'üá∫üá∏ Â••ÂÖãÂÖ∞',\n                    'HKG': 'üá≠üá∞ È¶ôÊ∏Ø', 'TPE': 'üáπüáº Âè∞Âåó', 'TSA': 'üáπüáº Âè∞ÂåóÊùæÂ±±', 'KHH': 'üáπüáº È´òÈõÑ',\n                    'NRT': 'üáØüáµ ‰∏ú‰∫¨ÊàêÁî∞', 'HND': 'üáØüáµ ‰∏ú‰∫¨ÁæΩÁî∞', 'KIX': 'üáØüáµ Â§ßÈò™ÂÖ≥Ë•ø', 'ITM': 'üáØüáµ Â§ßÈò™‰ºä‰∏π', 'NGO': 'üáØüáµ ÂêçÂè§Â±ã',\n                    'FUK': 'üáØüáµ Á¶èÂÜà', 'CTS': 'üáØüáµ Êú≠Âπå', 'OKA': 'üáØüáµ ÂÜ≤Áª≥',\n                    'ICN': 'üá∞üá∑ È¶ñÂ∞î‰ªÅÂ∑ù', 'GMP': 'üá∞üá∑ È¶ñÂ∞îÈáëÊµ¶', 'PUS': 'üá∞üá∑ ÈáúÂ±±',\n                    'SIN': 'üá∏üá¨ Êñ∞Âä†Âù°', 'BKK': 'üáπüá≠ ÊõºË∞∑', 'DMK': 'üáπüá≠ ÊõºË∞∑ÂªäÊõº', 'KUL': 'üá≤üáæ ÂêâÈöÜÂù°', 'CGK': 'üáÆüá© ÈõÖÂä†Ëææ',\n                    'MNL': 'üáµüá≠ È©¨Â∞ºÊãâ', 'CEB': 'üáµüá≠ ÂÆøÂä°', 'HAN': 'üáªüá≥ Ê≤≥ÂÜÖ', 'SGN': 'üáªüá≥ ËÉ°ÂøóÊòé', 'DAD': 'üáªüá≥ Â≤òÊ∏Ø',\n                    'RGN': 'üá≤üá≤ ‰ª∞ÂÖâ', 'PNH': 'üá∞üá≠ ÈáëËæπ', 'REP': 'üá∞üá≠ ÊöπÁ≤í', 'VTE': 'üá±üá¶ ‰∏áË±°',\n                    'BOM': 'üáÆüá≥ Â≠ü‰π∞', 'DEL': 'üáÆüá≥ Êñ∞Âæ∑Èáå', 'MAA': 'üáÆüá≥ ÈáëÂ•à', 'BLR': 'üáÆüá≥ Áè≠Âä†ÁΩóÂ∞î', 'CCU': 'üáÆüá≥ Âä†Â∞îÂêÑÁ≠î',\n                    'HYD': 'üáÆüá≥ Êµ∑ÂæóÊãâÂ∑¥', 'AMD': 'üáÆüá≥ ËâæÂìàËøàËææÂ∑¥Âæ∑', 'COK': 'üáÆüá≥ ÁßëÈí¶', 'PNQ': 'üáÆüá≥ Êµ¶ÈÇ£', 'GOI': 'üáÆüá≥ ÊûúÈòø',\n                    'CMB': 'üá±üá∞ Áßë‰º¶Âù°', 'DAC': 'üáßüá© ËææÂç°', 'KTM': 'üá≥üáµ Âä†Âæ∑Êª°ÈÉΩ', 'ISB': 'üáµüá∞ ‰ºäÊñØÂÖ∞Â†°', 'KHI': 'üáµüá∞ Âç°ÊãâÂ•á', 'LHE': 'üáµüá∞ ÊãâÂêàÂ∞î',\n                    'LHR': 'üá¨üáß ‰º¶Êï¶Â∏åÊÄùÁΩó', 'LGW': 'üá¨üáß ‰º¶Êï¶ÁõñÁâπÂ®ÅÂÖã', 'STN': 'üá¨üáß ‰º¶Êï¶ÊñØÂù¶ÊñØÁâπÂæ∑', 'LTN': 'üá¨üáß ‰º¶Êï¶Âç¢È°ø', 'MAN': 'üá¨üáß ÊõºÂΩªÊñØÁâπ', 'EDI': 'üá¨üáß Áà±‰∏ÅÂ†°', 'BHX': 'üá¨üáß ‰ºØÊòéÁø∞',\n                    'CDG': 'üá´üá∑ Â∑¥ÈªéÊà¥È´ò‰πê', 'ORY': 'üá´üá∑ Â∑¥ÈªéÂ••Âà©', 'MRS': 'üá´üá∑ È©¨Ëµõ', 'LYS': 'üá´üá∑ ÈáåÊòÇ', 'NCE': 'üá´üá∑ Â∞ºÊñØ',\n                    'FRA': 'üá©üá™ Ê≥ïÂÖ∞ÂÖãÁ¶è', 'MUC': 'üá©üá™ ÊÖïÂ∞ºÈªë', 'TXL': 'üá©üá™ ÊüèÊûó', 'BER': 'üá©üá™ ÊüèÊûóÂãÉÂÖ∞ÁôªÂ†°', 'HAM': 'üá©üá™ Ê±âÂ†°', 'DUS': 'üá©üá™ ÊùúÂ°ûÂ∞îÂ§öÂ§´', 'CGN': 'üá©üá™ ÁßëÈöÜ', 'STR': 'üá©üá™ ÊñØÂõæÂä†Áâπ',\n                    'AMS': 'üá≥üá± ÈòøÂßÜÊñØÁâπ‰∏π', 'BRU': 'üáßüá™ Â∏ÉÈ≤ÅÂ°ûÂ∞î', 'LUX': 'üá±üá∫ Âç¢Ê£ÆÂ†°',\n                    'ZRH': 'üá®üá≠ ËãèÈªé‰∏ñ', 'GVA': 'üá®üá≠ Êó•ÂÜÖÁì¶', 'BSL': 'üá®üá≠ Â∑¥Â°ûÂ∞î',\n                    'VIE': 'üá¶üáπ Áª¥‰πüÁ∫≥', 'PRG': 'üá®üáø Â∏ÉÊãâÊ†º', 'BUD': 'üá≠üá∫ Â∏ÉËææ‰Ω©ÊñØ', 'WAW': 'üáµüá± ÂçéÊ≤ô', 'KRK': 'üáµüá± ÂÖãÊãâÁßëÂ§´',\n                    'MXP': 'üáÆüáπ Á±≥ÂÖ∞È©¨Â∞îÂΩ≠Ëê®', 'LIN': 'üáÆüáπ Á±≥ÂÖ∞Âà©Á∫≥Áâπ', 'FCO': 'üáÆüáπ ÁΩóÈ©¨', 'VCE': 'üáÆüáπ Â®ÅÂ∞ºÊñØ', 'NAP': 'üáÆüáπ ÈÇ£‰∏çÂãíÊñØ', 'FLR': 'üáÆüáπ ‰ΩõÁΩó‰º¶Ëê®', 'BGY': 'üáÆüáπ Ë¥ùÂä†Ëé´',\n                    'MAD': 'üá™üá∏ È©¨Âæ∑Èáå', 'BCN': 'üá™üá∏ Â∑¥Â°ûÁΩóÈÇ£', 'PMI': 'üá™üá∏ Â∏ïÂ∞îÈ©¨', 'AGP': 'üá™üá∏ È©¨ÊãâÂä†', 'VLC': 'üá™üá∏ Áì¶‰º¶Ë•ø‰∫ö', 'SVQ': 'üá™üá∏ Â°ûÁª¥Âà©‰∫ö', 'BIO': 'üá™üá∏ ÊØïÂ∞îÂ∑¥ÈÑÇ',\n                    'LIS': 'üáµüáπ ÈáåÊñØÊú¨', 'OPO': 'üáµüáπ Ê≥¢Â∞îÂõæ', 'FAO': 'üáµüáπ Ê≥ïÈ≤Å',\n                    'DUB': 'üáÆüá™ ÈÉΩÊüèÊûó', 'CPH': 'üá©üá∞ Âì•Êú¨ÂìàÊ†π', 'ARN': 'üá∏üá™ ÊñØÂæ∑Âì•Â∞îÊë©', 'GOT': 'üá∏üá™ Âì•Âæ∑Â†°',\n                    'OSL': 'üá≥üá¥ Â••ÊñØÈôÜ', 'BGO': 'üá≥üá¥ ÂçëÂ∞îÊ†π', 'HEL': 'üá´üáÆ Ëµ´Â∞îËæõÂü∫', 'RIX': 'üá±üáª ÈáåÂä†', 'TLL': 'üá™üá™ Â°îÊûó', 'VNO': 'üá±üáπ Áª¥Â∞îÁ∫ΩÊñØ',\n                    'ATH': 'üá¨üá∑ ÈõÖÂÖ∏', 'SKG': 'üá¨üá∑ Â°ûËê®Ê¥õÂ∞ºÂü∫', 'SOF': 'üáßüá¨ Á¥¢Èùû‰∫ö', 'OTP': 'üá∑üá¥ Â∏ÉÂä†ÂãíÊñØÁâπ', 'BEG': 'üá∑üá∏ Ë¥ùÂ∞îÊ†ºËé±Âæ∑', 'ZAG': 'üá≠üá∑ Ëê®Ê†ºÂãíÂ∏É', 'LJU': 'üá∏üáÆ Âç¢Â∏ÉÂ∞îÈõÖÈÇ£',\n                    'KBP': 'üá∫üá¶ Âü∫ËæÖ', 'IEV': 'üá∫üá¶ Âü∫ËæÖËåπËâØÂ∞º', 'ODS': 'üá∫üá¶ ÊïñÂæ∑Ëê®',\n                    'SVO': 'üá∑üá∫ Ëé´ÊñØÁßëË∞¢ÂàóÊ¢ÖÊç∑Ê≤É', 'DME': 'üá∑üá∫ Ëé´ÊñØÁßëÂ§öËé´Êù∞Â§öÊ≤É', 'VKO': 'üá∑üá∫ Ëé´ÊñØÁßë‰ºèÂä™ÁßëÊ≤É', 'LED': 'üá∑üá∫ Âú£ÂΩºÂæóÂ†°',\n                    'IST': 'üáπüá∑ ‰ºäÊñØÂù¶Â∏ÉÂ∞î', 'SAW': 'üáπüá∑ ‰ºäÊñØÂù¶Â∏ÉÂ∞îËê®ÊØîÂìà', 'ESB': 'üáπüá∑ ÂÆâÂç°Êãâ', 'AYT': 'üáπüá∑ ÂÆâÂ°îÂà©‰∫ö', 'ADB': 'üáπüá∑ ‰ºäÂÖπÂØÜÂ∞î',\n                    'TLV': 'üáÆüá± ÁâπÊãâÁª¥Â§´', 'AMM': 'üáØüá¥ ÂÆâÊõº', 'BEY': 'üá±üáß Ë¥ùÈ≤ÅÁâπ', 'BAH': 'üáßüá≠ Â∑¥Êûó', 'KWI': 'üá∞üáº ÁßëÂ®ÅÁâπ',\n                    'DXB': 'üá¶üá™ Ëø™Êãú', 'AUH': 'üá¶üá™ ÈòøÂ∏ÉÊâéÊØî', 'SHJ': 'üá¶üá™ Ê≤ôËø¶', 'DOH': 'üá∂üá¶ Â§öÂìà', 'MCT': 'üá¥üá≤ È©¨ÊñØÂñÄÁâπ',\n                    'RUH': 'üá∏üá¶ Âà©ÈõÖÂæó', 'JED': 'üá∏üá¶ ÂêâËææ', 'DMM': 'üá∏üá¶ ËææÊõº',\n                    'CAI': 'üá™üá¨ ÂºÄÁΩó', 'HBE': 'üá™üá¨ ‰∫öÂéÜÂ±±Â§ß', 'SSH': 'üá™üá¨ Ê≤ôÂßÜÊ≤ô‰ºäËµ´',\n                    'CMN': 'üá≤üá¶ Âç°Ëê®Â∏ÉÂÖ∞Âç°', 'RAK': 'üá≤üá¶ È©¨ÊãâÂñÄ‰ªÄ', 'TUN': 'üáπüá≥ Á™ÅÂ∞ºÊñØ', 'ALG': 'üá©üáø ÈòøÂ∞îÂèäÂ∞î',\n                    'LOS': 'üá≥üá¨ ÊãâÂêÑÊñØ', 'ABV': 'üá≥üá¨ ÈòøÂ∏ÉË¥æ', 'ACC': 'üá¨üá≠ ÈòøÂÖãÊãâ', 'NBO': 'üá∞üá™ ÂÜÖÁΩóÊØï', 'MBA': 'üá∞üá™ ËíôÂ∑¥Ëê®', 'ADD': 'üá™üáπ ‰∫öÁöÑÊñØ‰∫öË¥ùÂ∑¥', 'DAR': 'üáπüáø ËææÁ¥ØÊñØËê®ÊãâÂßÜ',\n                    'JNB': 'üáøüá¶ Á∫¶Áø∞ÂÜÖÊñØÂ†°', 'CPT': 'üáøüá¶ ÂºÄÊôÆÊï¶', 'DUR': 'üáøüá¶ Âæ∑Áè≠', 'HRE': 'üáøüáº ÂìàÊãâÈõ∑', 'LUN': 'üáøüá≤ Âç¢Ëê®Âç°',\n                    'MRU': 'üá≤üá∫ ÊØõÈáåÊ±ÇÊñØ', 'SEZ': 'üá∏üá® Â°ûËàåÂ∞î',\n                    'SYD': 'üá¶üá∫ ÊÇâÂ∞º', 'MEL': 'üá¶üá∫ Â¢®Â∞îÊú¨', 'BNE': 'üá¶üá∫ Â∏ÉÈáåÊñØÁè≠', 'PER': 'üá¶üá∫ ÁèÄÊñØ', 'ADL': 'üá¶üá∫ ÈòøÂæ∑Ëé±Âæ∑', 'CBR': 'üá¶üá∫ Â†™ÂüπÊãâ', 'OOL': 'üá¶üá∫ ÈªÑÈáëÊµ∑Â≤∏', 'CNS': 'üá¶üá∫ ÂáØÊÅ©ÊñØ',\n                    'AKL': 'üá≥üáø Â••ÂÖãÂÖ∞', 'WLG': 'üá≥üáø ÊÉ†ÁÅµÈ°ø', 'CHC': 'üá≥üáø Âü∫Áù£Âüé', 'ZQN': 'üá≥üáø ÁöáÂêéÈïá',\n                    'NAN': 'üá´üáØ Ê•†Ëø™', 'PPT': 'üáµüá´ Â∏ïÁöÆÊèê', 'GUM': 'üá¨üá∫ ÂÖ≥Â≤õ',\n                    'GRU': 'üáßüá∑ Âú£‰øùÁΩóÁìúÈ≤ÅÊü≥ÊñØ', 'CGH': 'üáßüá∑ Âú£‰øùÁΩóÂ≠îÊààÂ∞º‰∫öÊñØ', 'GIG': 'üáßüá∑ ÈáåÁ∫¶ÁÉ≠ÂÜÖÂç¢', 'BSB': 'üáßüá∑ Â∑¥Ë•øÂà©‰∫ö', 'CNF': 'üáßüá∑ Ë¥ùÊ¥õÂ••ÈáåËóèÁâπ', 'POA': 'üáßüá∑ ÈòøÈõ∑Ê†ºÈáåÊ∏Ø', 'CWB': 'üáßüá∑ Â∫ìÈáåËíÇÂ∑¥', 'FOR': 'üáßüá∑ Á¶èÂ°îËé±Ëê®', 'REC': 'üáßüá∑ Á¥ØË•øËÖì', 'SSA': 'üáßüá∑ Ëê®Â∞îÁì¶Â§ö',\n                    'EZE': 'üá¶üá∑ Â∏ÉÂÆúËØ∫ÊñØËâæÂà©ÊñØ', 'AEP': 'üá¶üá∑ Â∏ÉÂÆúËØ∫ÊñØËâæÂà©ÊñØÂüé', 'COR': 'üá¶üá∑ ÁßëÂ∞îÂ§öÁì¶', 'MDZ': 'üá¶üá∑ Èó®Â§öËê®',\n                    'SCL': 'üá®üá± Âú£Âú∞‰∫öÂì•', 'LIM': 'üáµüá™ Âà©È©¨', 'BOG': 'üá®üá¥ Ê≥¢Âì•Â§ß', 'MDE': 'üá®üá¥ È∫¶Âæ∑Êûó', 'CLO': 'üá®üá¥ Âç°Âà©',\n                    'UIO': 'üá™üá® Âü∫Â§ö', 'GYE': 'üá™üá® Áìú‰∫öÂü∫Â∞î', 'CCS': 'üáªüá™ Âä†ÊãâÂä†ÊñØ', 'MVD': 'üá∫üáæ ËíôÂæóÁª¥ÁöÑ‰∫ö', 'ASU': 'üáµüáæ ‰∫öÊùæÊ£Æ',\n                    'PTY': 'üáµüá¶ Â∑¥ÊãøÈ©¨Âüé', 'SJO': 'üá®üá∑ Âú£‰ΩïÂ°û', 'GUA': 'üá¨üáπ Âç±Âú∞È©¨ÊãâÂüé', 'SAL': 'üá∏üáª Âú£Ëê®Â∞îÁì¶Â§ö', 'TGU': 'üá≠üá≥ ÁâπÂè§Ë•øÂä†Â∞îÂ∑¥', 'MGA': 'üá≥üáÆ È©¨ÈÇ£Áìú', 'BZE': 'üáßüáø ‰ºØÂà©ÂÖπÂüé',\n                    'MEX': 'üá≤üáΩ Â¢®Ë•øÂì•Âüé', 'GDL': 'üá≤üáΩ ÁìúËææÊãâÂìàÊãâ', 'MTY': 'üá≤üáΩ ËíôÁâπÈõ∑', 'CUN': 'üá≤üáΩ ÂùéÊòÜ', 'TIJ': 'üá≤üáΩ ËíÇÂçéÁ∫≥', 'SJD': 'üá≤üáΩ Âú£‰ΩïÂ°ûÂæ∑Â∞îÂç°Ê≤É',\n                    'YYZ': 'üá®üá¶ Â§ö‰º¶Â§ö', 'YVR': 'üá®üá¶ Ê∏©Âì•Âçé', 'YUL': 'üá®üá¶ ËíôÁâπÂà©Â∞î', 'YYC': 'üá®üá¶ Âç°Â∞îÂä†Èáå', 'YEG': 'üá®üá¶ ÂüÉÂæ∑ËíôÈ°ø', 'YOW': 'üá®üá¶ Ê∏•Â§™Âçé', 'YWG': 'üá®üá¶ Ê∏©Â∞º‰ºØ', 'YHZ': 'üá®üá¶ ÂìàÂà©Ê≥ïÂÖãÊñØ',\n                    'HAV': 'üá®üá∫ ÂìàÁì¶ÈÇ£', 'SJU': 'üáµüá∑ Âú£ËÉ°ÂÆâ', 'SDQ': 'üá©üá¥ Âú£Â§öÊòéÂêÑ', 'PAP': 'üá≠üáπ Â§™Â≠êÊ∏Ø', 'KIN': 'üáØüá≤ ÈáëÊñØÈ°ø', 'NAS': 'üáßüá∏ ÊãøÈ™ö', 'MBJ': 'üáØüá≤ ËíôÁâπÂì•Ë¥ù'\n                };\n\n                function getColoName(colo) {\n                    return coloMap[colo] || colo;\n                }\n\n                // City filtering related functions\n                const cityFilterContainer = document.getElementById('cityFilterContainer');\n                const cityCheckboxesContainer = document.getElementById('cityCheckboxesContainer');\n\n                function updateCityFilter() {\n                    if (!cityFilterContainer || !cityCheckboxesContainer) return;\n\n                    // Extract all available cities from test results\n                    const cityMap = new Map();\n                    testResults.forEach((result, index) => {\n                        if (result.success && result.colo) {\n                            const colo = result.colo;\n                            if (!cityMap.has(colo)) {\n                                cityMap.set(colo, {\n                                    colo: colo,\n                                    name: getColoName(colo),\n                                    count: 0\n                                });\n                            }\n                            cityMap.get(colo).count++;\n                        }\n                    });\n\n                    if (cityMap.size === 0) {\n                        cityFilterContainer.style.display = 'none';\n                        return;\n                    }\n\n                    cityFilterContainer.style.display = 'block';\n                    cityCheckboxesContainer.innerHTML = '';\n\n                    // Sort by city name\n                    const cities = Array.from(cityMap.values()).sort((a, b) => a.name.localeCompare(b.name));\n\n                    cities.forEach(city => {\n                        const label = document.createElement('label');\n                        label.style.cssText = 'display: inline-flex; align-items: center; cursor: pointer; color: #00ff00; font-size: 0.85rem; padding: 4px 8px; background: rgba(0, 40, 0, 0.4); border: 1px solid #00aa00; border-radius: 4px;';\n\n                        const checkbox = document.createElement('input');\n                        checkbox.type = 'checkbox';\n                        checkbox.value = city.colo;\n                        checkbox.checked = true;\n                        checkbox.dataset.colo = city.colo;\n                        checkbox.style.cssText = 'margin-right: 6px; width: 16px; height: 16px; cursor: pointer;';\n\n                        const span = document.createElement('span');\n                        span.textContent = city.name + ' (' + city.count + ')';\n\n                        label.appendChild(checkbox);\n                        label.appendChild(span);\n                        cityCheckboxesContainer.appendChild(label);\n\n                        checkbox.addEventListener('change', filterResultsByCity);\n                    });\n\n                    // Listen for filter mode changes\n                    const filterModeRadios = document.querySelectorAll('input[name="cityFilterMode"]');\n                    filterModeRadios.forEach(radio => {\n                        radio.addEventListener('change', function() {\n                            if (this.value === 'all') {\n                                // When switching to 'All Cities' mode, automatically check all city checkboxes\n                                const cityCheckboxes = cityCheckboxesContainer.querySelectorAll('input[type="checkbox"]');\n                                cityCheckboxes.forEach(cb => {\n                                    cb.checked = true;\n                                    cb.disabled = false;\n                                });\n                            }\n                            filterResultsByCity();\n                        });\n                    });\n                }\n\n                function filterResultsByCity() {\n                    if (!resultsList || !cityCheckboxesContainer) return;\n\n                    const filterMode = document.querySelector('input[name="cityFilterMode"]:checked')?.value || 'all';\n                    const resultItems = resultsList.querySelectorAll('[data-index]');\n                    const cityCheckboxes = cityCheckboxesContainer.querySelectorAll('input[type="checkbox"]');\n\n                    if (filterMode === 'fastest10') {\n                        // Select only the fastest 10\n                        const sortedResults = testResults\n                            .map((result, index) => ({ result, index }))\n                            .filter(item => item.result.success)\n                            .sort((a, b) => a.result.latency - b.result.latency)\n                            .slice(0, 10);\n\n                        const fastestIndices = new Set(sortedResults.map(item => item.index));\n\n                        resultItems.forEach(item => {\n                            const index = parseInt(item.dataset.index);\n                            const checkbox = item.querySelector('input[type="checkbox"]');\n                            if (fastestIndices.has(index)) {\n                                item.style.display = 'flex';\n                                if (checkbox) checkbox.checked = true;\n                            } else {\n                                item.style.display = 'none';\n                                if (checkbox) checkbox.checked = false;\n                            }\n                        });\n\n                        // Disable city checkboxes\n                        cityCheckboxes.forEach(cb => cb.disabled = true);\n                    } else {\n                        // Filter by selected cities\n                        const selectedCities = new Set();\n                        cityCheckboxes.forEach(cb => {\n                            if (cb.checked) {\n                                selectedCities.add(cb.value);\n                            }\n                        });\n\n                        // If all cities are selected (or none), show all results\n                        const allChecked = cityCheckboxes.length > 0 && selectedCities.size === cityCheckboxes.length;\n                        const noneChecked = selectedCities.size === 0;\n\n                        resultItems.forEach(item => {\n                            const colo = item.dataset.colo || '';\n                            const checkbox = item.querySelector('input[type="checkbox"]');\n                            if (allChecked || noneChecked || selectedCities.has(colo)) {\n                                item.style.display = 'flex';\n                                // Sync update result item checkbox state\n                                if (checkbox) {\n                                    if (allChecked) {\n                                        // When all cities are selected, all result item checkboxes are checked\n                                        checkbox.checked = true;\n                                    } else if (noneChecked) {\n                                        // When no city is selected, all result item checkboxes are unchecked\n                                        checkbox.checked = false;\n                                    } else {\n                                        // Sync checkboxes based on city selection state\n                                        checkbox.checked = selectedCities.has(colo);\n                                    }\n                                }\n                            } else {\n                                item.style.display = 'none';\n                                // Uncheck hidden result item checkboxes\n                                if (checkbox) {\n                                    checkbox.checked = false;\n                                }\n                            }\n                        });\n\n                        // Enable city checkboxes\n                        cityCheckboxes.forEach(cb => cb.disabled = false);\n                    }\n                }\n\n                async function testLatency(host, port, signal) {\n                    const timeout = 8000;\n                    let colo = '';\n                    let testUrl = '';\n\n                    try {\n                        const controller = new AbortController();\n                        const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n                        if (signal) {\n                            signal.addEventListener('abort', () => controller.abort());\n                        }\n\n                        const cleanHost = host.replace(/^\\[|\\]$/g, '');\n                        const hexIP = ipToHex(cleanHost);\n                        const testDomain = hexIP ? (hexIP + '.nip.lfree.org') : (cleanHost + '.nip.lfree.org');\n                        testUrl = 'https://' + testDomain + ':' + port + '/';\n\n                        console.log('[LatencyTest] Testing:', testUrl, 'Original:', host + ':' + port, 'HexIP:', hexIP);\n\n                        const firstStart = Date.now();\n                        const response1 = await fetch(testUrl, {\n                            signal: controller.signal\n                        });\n                        const firstTime = Date.now() - firstStart;\n\n                        if (!response1.ok) {\n                            clearTimeout(timeoutId);\n                            return { success: false, latency: firstTime, error: 'HTTP ' + response1.status + ' ' + response1.statusText, colo: '', testUrl: testUrl };\n                        }\n\n                        try {\n                            const text = await response1.text();\n                            console.log('[LatencyTest] Response body:', text.substring(0, 200));\n                            const data = JSON.parse(text);\n                            if (data.colo) {\n                                colo = data.colo;\n                            }\n                        } catch (e) {\n                            console.log('[LatencyTest] Parse error:', e.message);\n                        }\n\n                        const secondStart = Date.now();\n                        const response2 = await fetch(testUrl, {\n                            signal: controller.signal\n                        });\n                        await response2.text();\n                        const latency = Date.now() - secondStart;\n\n                        clearTimeout(timeoutId);\n\n                        console.log('[LatencyTest] First:', firstTime + 'ms (DNS+TLS+RTT)', 'Second:', latency + 'ms (RTT only)');\n\n                        return { success: true, latency: latency, colo: colo, testUrl: testUrl };\n                    } catch (error) {\n                        const errorMsg = error.name === 'AbortError' ? '${a?"ÿ≤ŸÖÿßŸÜ ÿ™ŸÖÿßŸÖ ÿ¥ÿØ":"Timeout"}' : error.message;\n                        console.log('[LatencyTest] Error:', errorMsg, 'URL:', testUrl);\n                        return { success: false, latency: -1, error: errorMsg, colo: '', testUrl: testUrl };\n                    }\n                }\n            });\n        <\/script>\n    </body>\n    </html>`;return new Response(s,{status:200,headers:{"Content-Type":"text/html; charset=utf-8"}})}async function parseTrojanHeader(e,n){const t=tp||n,o=await sha224Hash(t);if(e.byteLength<56)return{hasError:!0,message:"invalid "+atob("dHJvamFu")+" data - too short"};if(13!==new Uint8Array(e.slice(56,57))[0]||10!==new Uint8Array(e.slice(57,58))[0])return{hasError:!0,message:"invalid "+atob("dHJvamFu")+" header format (missing CR LF)"};if((new TextDecoder).decode(e.slice(0,56))!==o)return{hasError:!0,message:"invalid "+atob("dHJvamFu")+" password"};const a=e.slice(58);if(a.byteLength<6)return{hasError:!0,message:atob("aW52YWxpZCBTT0NLUzUgcmVxdWVzdCBkYXRh")};const r=new DataView(a);if(1!==r.getUint8(0))return{hasError:!0,message:"unsupported command, only TCP (CONNECT) is allowed"};const s=r.getUint8(1);let i=0,l=2,c="";switch(s){case 1:i=4,c=new Uint8Array(a.slice(l,l+i)).join(".");break;case 3:i=new Uint8Array(a.slice(l,l+1))[0],l+=1,c=(new TextDecoder).decode(a.slice(l,l+i));break;case 4:i=16;const e=new DataView(a.slice(l,l+i)),n=[];for(let t=0;t<8;t++)n.push(e.getUint16(2*t).toString(16));c=n.join(":");break;default:return{hasError:!0,message:`invalid addressType is ${s}`}}if(!c)return{hasError:!0,message:`address is empty, addressType is ${s}`};const d=l+i,u=a.slice(d,d+2);return{hasError:!1,addressRemote:c,addressType:s,port:new DataView(u).getUint16(0),hostname:c,rawClientData:a.slice(d+4)}}async function sha224Hash(e){const n=(new TextEncoder).encode(e),t=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];let o=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428];const a=n.length,r=8*a,s=64*Math.ceil((a+9)/64),i=new Uint8Array(s);i.set(n),i[a]=128;const l=new DataView(i.buffer);l.setUint32(s-4,r,!1);for(let e=0;e<s;e+=64){const n=new Uint32Array(64);for(let t=0;t<16;t++)n[t]=l.getUint32(e+4*t,!1);for(let e=16;e<64;e++){const t=rightRotate(n[e-15],7)^rightRotate(n[e-15],18)^n[e-15]>>>3,o=rightRotate(n[e-2],17)^rightRotate(n[e-2],19)^n[e-2]>>>10;n[e]=n[e-16]+t+n[e-7]+o>>>0}let[a,r,s,i,c,d,u,p]=o;for(let e=0;e<64;e++){const o=p+(rightRotate(c,6)^rightRotate(c,11)^rightRotate(c,25))+(c&d^~c&u)+t[e]+n[e]>>>0,l=a&r^a&s^r&s;p=u,u=d,d=c,c=i+o>>>0,i=s,s=r,r=a,a=o+((rightRotate(a,2)^rightRotate(a,13)^rightRotate(a,22))+l>>>0)>>>0}o[0]=o[0]+a>>>0,o[1]=o[1]+r>>>0,o[2]=o[2]+s>>>0,o[3]=o[3]+i>>>0,o[4]=o[4]+c>>>0,o[5]=o[5]+d>>>0,o[6]=o[6]+u>>>0,o[7]=o[7]+p>>>0}const c=[];for(let e=0;e<7;e++)c.push((o[e]>>>24&255).toString(16).padStart(2,"0"),(o[e]>>>16&255).toString(16).padStart(2,"0"),(o[e]>>>8&255).toString(16).padStart(2,"0"),(255&o[e]).toString(16).padStart(2,"0"));return c.join("")}function rightRotate(e,n){return e>>>n|e<<32-n}let ACTIVE_CONNECTIONS=0;const XHTTP_BUFFER_SIZE=131072,CONNECT_TIMEOUT_MS=5e3,IDLE_TIMEOUT_MS=45e3,MAX_RETRIES=2,MAX_CONCURRENT=32;function xhttp_sleep(e){return new Promise(n=>setTimeout(n,e))}function validate_uuid_xhttp(e,n){for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}class XhttpCounter{#e;constructor(){this.#e=0}get(){return this.#e}add(e){this.#e+=e}}function concat_typed_arrays(e,...n){let t=e.length;for(let e of n)t+=e.length;const o=new e.constructor(t);o.set(e,0),t=e.length;for(let e of n)o.set(e,t),t+=e.length;return o}function parse_uuid_xhttp(e){e=e.replaceAll("-","");const n=[];for(let t=0;t<16;t++){const o=parseInt(e.substr(2*t,2),16);n.push(o)}return n}function get_xhttp_buffer(e){return new Uint8Array(new ArrayBuffer(e||131072))}async function read_xhttp_header(e,n){const t=e.getReader({mode:"byob"});try{let e=await t.readAtLeast(18,get_xhttp_buffer()),o=0,a=0,r=e.value;o+=e.value.length;const s=r[0],i=r.slice(1,17);if(!validate_uuid_xhttp(i,parse_uuid_xhttp(n)))return"invalid UUID";const l=r[17],c=18+l+1+2+1;if(c+1>o){if(e.done)return"header too short";a=c+1-o,e=await t.readAtLeast(a,get_xhttp_buffer()),o+=e.value.length,r=concat_typed_arrays(r,e.value)}const d=r[18+l];if(1!==d)return`unsupported command: ${d}`;const u=(r[c-1-2]<<8)+r[c-1-1],p=r[c-1];let g=-1;if(1===p?g=c+4:3===p?g=c+16:2===p&&(g=c+1+r[c]),g<0)return"read address type failed";if(a=g-o,a>0){if(e.done)return"read address failed";e=await t.readAtLeast(a,get_xhttp_buffer()),o+=e.value.length,r=concat_typed_arrays(r,e.value)}let m="";switch(a=c,p){case 1:m=r.slice(a,a+4).join(".");break;case 2:m=(new TextDecoder).decode(r.slice(a+1,a+1+r[a]));break;case 3:m=r.slice(a,a+16).reduce((e,n,t,o)=>t%2?e.concat(((o[t-1]<<8)+n).toString(16)):e,[]).join(":")}if(m.length<1)return"failed to parse hostname";return{hostname:m,port:u,data:r.slice(g),resp:new Uint8Array([s,0]),reader:t,done:e.done}}catch(e){try{t.releaseLock()}catch(e){}throw e}}async function upload_to_remote_xhttp(e,n,t){async function o(t){if(t&&0!==t.length){e.add(t.length);try{await n.write(t)}catch(e){throw e}}}try{await o(t.data);let e=0;for(;!t.done;){const n=await t.reader.read(get_xhttp_buffer());if(n.done)break;await o(n.value),t.done=n.done,e++,e%10==0&&await xhttp_sleep(0),n.value&&0!==n.value.length||await xhttp_sleep(2)}}catch(e){throw e}}function create_xhttp_uploader(e,n){const t=new XhttpCounter,o=n.getWriter(),a=(async()=>{try{await upload_to_remote_xhttp(t,o,e)}catch(e){throw e}finally{try{await o.close()}catch(e){}}})();return{counter:t,done:a,abort:()=>{try{o.abort()}catch(e){}}}}function create_xhttp_downloader(e,n){const t=new XhttpCounter;let o;const a=new Promise((a,r)=>{o=new TransformStream({start(n){t.add(e.length),n.enqueue(e)},transform(e,n){t.add(e.length),n.enqueue(e)},cancel(e){r(`download cancelled: ${e}`)}},null,new ByteLengthQueuingStrategy({highWaterMark:131072}));let s=Date.now();const i=setInterval(()=>{if(Date.now()-s>45e3){try{o.writable.abort?.("idle timeout")}catch(e){}clearInterval(i),r("idle timeout")}},5e3),l=n.getReader(),c=o.writable.getWriter();(async()=>{try{let e=0;for(;;){const n=await l.read();if(n.done)break;s=Date.now(),await c.write(n.value),e++,e%5==0&&await xhttp_sleep(0)}await c.close(),a()}catch(e){r(e)}finally{try{l.releaseLock()}catch(e){}try{c.releaseLock()}catch(e){}clearInterval(i)}})()});return{readable:o.readable,counter:t,done:a,abort:()=>{try{o.readable.cancel()}catch(e){}try{o.writable.abort()}catch(e){}}}}async function connect_to_remote_xhttp(e,...n){let t,o=0;const a=[e.hostname,...n.filter(n=>n&&n!==e.hostname)];for(const n of a)if(n)for(o=0;o<2;){o++;try{const t=connect({hostname:n,port:e.port}),o=xhttp_sleep(5e3).then(()=>{throw new Error(atob("Y29ubmVjdCB0aW1lb3V0"))});await Promise.race([t.opened,o]);const a=create_xhttp_uploader(e,t.writable);return{downloader:create_xhttp_downloader(e.resp,t.readable),uploader:a,close:()=>{try{t.close()}catch(e){}}}}catch(e){t=e,o<2&&await xhttp_sleep(500*o)}}return null}async function handle_xhttp_client(e,n){if(ACTIVE_CONNECTIONS>=32)return new Response("Too many connections",{status:429});ACTIVE_CONNECTIONS++;let t=!1;const o=()=>{t||(ACTIVE_CONNECTIONS=Math.max(0,ACTIVE_CONNECTIONS-1),t=!0)};try{const t=await read_xhttp_header(e,n);if("object"!=typeof t||!t)return null;const a=await connect_to_remote_xhttp(t,fallbackAddress,"13.230.34.30");if(null===a)return null;const r=Promise.race([(async()=>{try{await a.downloader.done}catch(e){}})(),(async()=>{try{await a.uploader.done}catch(e){}})(),xhttp_sleep(45e3).then(()=>{})]).finally(()=>{try{a.close()}catch(e){}try{a.downloader.abort()}catch(e){}try{a.uploader.abort()}catch(e){}o()});return{readable:a.downloader.readable,closed:r}}catch(e){return o(),null}}async function handleXhttpPost(e){try{return await handle_xhttp_client(e.body,at)}catch(e){return null}}function base64ToArray(e){if(!e)return{error:null};try{return e=e.replace(/-/g,"+").replace(/_/g,"/"),{earlyData:Uint8Array.from(atob(e),e=>e.charCodeAt(0)).buffer,error:null}}catch(e){return{error:e}}}function closeSocketQuietly(e){try{1!==e.readyState&&2!==e.readyState||e.close()}catch(e){}}const hexTable=Array.from({length:256},(e,n)=>(n+256).toString(16).slice(1));function formatIdentifier(e,n=0){const t=(hexTable[e[n]]+hexTable[e[n+1]]+hexTable[e[n+2]]+hexTable[e[n+3]]+"-"+hexTable[e[n+4]]+hexTable[e[n+5]]+"-"+hexTable[e[n+6]]+hexTable[e[n+7]]+"-"+hexTable[e[n+8]]+hexTable[e[n+9]]+"-"+hexTable[e[n+10]]+hexTable[e[n+11]]+hexTable[e[n+12]]+hexTable[e[n+13]]+hexTable[e[n+14]]+hexTable[e[n+15]]).toLowerCase();if(!isValidFormat(t))throw new TypeError(E_INVALID_ID_STR);return t}async function fetchAndParseNewIPs(){const e=piu||"https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt";try{const n=e.includes(",")?e.split(",").map(e=>e.trim()).filter(e=>e):[e],t=await fetchPreferredAPI(n,"443",5e3);if(t.length>0){const e=[],n=/^(\[[\da-fA-F:]+\]|[\d.]+|[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?)*)(?::(\d+))?(?:#(.+))?$/;for(const o of t){const t=o.match(n);t&&e.push({ip:t[1],port:parseInt(t[2]||"443",10),name:t[3]?.trim()||t[1]})}return e}const o=await fetch(e);if(!o.ok)return[];const a=await o.text(),r=[],s=a.trim().replace(/\r/g,"").split("\n"),i=/^([^:]+):(\d+)#(.*)$/;for(const e of s){const n=e.trim();if(!n)continue;const t=n.match(i);t&&r.push({ip:t[1],port:parseInt(t[2],10),name:t[3].trim()||t[1]})}return r}catch(e){return[]}}function generateLinksFromNewIPs(e,n,t,o=null){const a=[80,8080,8880,2052,2082,2086,2095],r=[443,2053,2083,2087,2096,8443],s=[],i="/?ed=2048",l=atob("dmxlc3M=");return e.forEach(e=>{const o=e.name.replace(/\s/g,"_"),c=e.port;if(r.includes(c)){const a=`${o}-${c}-WS-TLS`;let r=`${l}://${n}@${e.ip}:${c}?encryption=none&security=tls&sni=${t}&fp=${enableECH?"chrome":"randomized"}&type=ws&host=${t}&path=${i}`;if(enableECH){r+=`&alpn=h3%2Ch2%2Chttp%2F1.1&ech=${encodeURIComponent(`${customECHDomain||"cloudflare-ech.com"}+${customDNS||"https://dns.joeyblog.eu.org/joeyblog"}`)}`}r+=`#${encodeURIComponent(a)}`,s.push(r)}else if(a.includes(c)){if(!disableNonTLS){const a=`${o}-${c}-WS`,r=`${l}://${n}@${e.ip}:${c}?encryption=none&security=none&type=ws&host=${t}&path=${i}#${encodeURIComponent(a)}`;s.push(r)}}else{const a=`${o}-${c}-WS-TLS`;let r=`${l}://${n}@${e.ip}:${c}?encryption=none&security=tls&sni=${t}&fp=${enableECH?"chrome":"randomized"}&type=ws&host=${t}&path=${i}`;if(enableECH){r+=`&alpn=h3%2Ch2%2Chttp%2F1.1&ech=${encodeURIComponent(`${customECHDomain||"cloudflare-ech.com"}+${customDNS||"https://dns.joeyblog.eu.org/joeyblog"}`)}`}r+=`#${encodeURIComponent(a)}`,s.push(r)}}),s}function generateXhttpLinksFromSource(e,n,t,o=null){const a=[],r=n.substring(0,8);return e.forEach(e=>{let o=e.isp.replace(/\s/g,"_");e.colo&&e.colo.trim()&&(o=`${o}-${e.colo.trim()}`);const s=e.ip.includes(":")?`[${e.ip}]`:e.ip,i=e.port||443,l=`${o}-${i}-xhttp`,c=new URLSearchParams({encryption:"none",security:"tls",sni:t,fp:"chrome",type:"xhttp",host:t,path:`/${r}`,mode:"stream-one"});if(enableECH){const e=customDNS||"https://dns.joeyblog.eu.org/joeyblog",n=customECHDomain||"cloudflare-ech.com";c.set("alpn","h3,h2,http/1.1"),c.set("ech",`${n}+${e}`)}a.push(`vless://${n}@${s}:${i}?${c.toString()}#${encodeURIComponent(l)}`)}),a}async function generateTrojanLinksFromNewIPs(e,n,t,o=null){const a=[80,8080,8880,2052,2082,2086,2095],r=[443,2053,2083,2087,2096,8443],s=[],i="/?ed=2048",l=tp||n;return e.forEach(e=>{const n=e.name.replace(/\s/g,"_"),o=e.port;if(r.includes(o)){const a=`${n}-${o}-${atob("VHJvamFu")}-WS-TLS`;let r=`${atob("dHJvamFuOi8v")}${l}@${e.ip}:${o}?security=tls&sni=${t}&fp=chrome&type=ws&host=${t}&path=${i}`;if(enableECH){r+=`&alpn=h3%2Ch2%2Chttp%2F1.1&ech=${encodeURIComponent(`${customECHDomain||"cloudflare-ech.com"}+${customDNS||"https://dns.joeyblog.eu.org/joeyblog"}`)}`}r+=`#${encodeURIComponent(a)}`,s.push(r)}else if(a.includes(o)){if(!disableNonTLS){const a=`${n}-${o}-${atob("VHJvamFu")}-WS`,r=`${atob("dHJvamFuOi8v")}${l}@${e.ip}:${o}?security=none&type=ws&host=${t}&path=${i}#${encodeURIComponent(a)}`;s.push(r)}}else{const a=`${n}-${o}-${atob("VHJvamFu")}-WS-TLS`;let r=`${atob("dHJvamFuOi8v")}${l}@${e.ip}:${o}?security=tls&sni=${t}&fp=chrome&type=ws&host=${t}&path=${i}`;if(enableECH){r+=`&alpn=h3%2Ch2%2Chttp%2F1.1&ech=${encodeURIComponent(`${customECHDomain||"cloudflare-ech.com"}+${customDNS||"https://dns.joeyblog.eu.org/joeyblog"}`)}`}r+=`#${encodeURIComponent(a)}`,s.push(r)}}),s}async function handleConfigAPI(e){if("GET"===e.method)return kvStore?new Response(JSON.stringify({...kvConfig,kvEnabled:!0}),{headers:{"Content-Type":"application/json"}}):new Response(JSON.stringify({error:"KV Storage Not Configured",kvEnabled:!1}),{status:503,headers:{"Content-Type":"application/json"}});if("POST"===e.method){if(!kvStore)return new Response(JSON.stringify({success:!1,message:"KVÂ≠òÂÇ®Êú™ÈÖçÁΩÆÔºåÊó†Ê≥ï‰øùÂ≠òÈÖçÁΩÆ"}),{status:503,headers:{"Content-Type":"application/json"}});try{const n=await e.json();for(const[e,t]of Object.entries(n))""===t||null==t?delete kvConfig[e]:kvConfig[e]=t;await saveKVConfig(),updateConfigVariables(),void 0!==n.yx&&updateCustomPreferredFromYx();const t=getConfigValue("yxURL","")||"https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt";return t!=="https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt"?(directDomains.length=0,customPreferredIPs=[],customPreferredDomains=[]):(backupIPs=[{domain:"ProxyIP.US.CMLiussss.net",region:"US",regionCode:"US",port:443},{domain:"ProxyIP.SG.CMLiussss.net",region:"SG",regionCode:"SG",port:443},{domain:"ProxyIP.JP.CMLiussss.net",region:"JP",regionCode:"JP",port:443},{domain:"ProxyIP.KR.CMLiussss.net",region:"KR",regionCode:"KR",port:443},{domain:"ProxyIP.DE.CMLiussss.net",region:"DE",regionCode:"DE",port:443},{domain:"ProxyIP.SE.CMLiussss.net",region:"SE",regionCode:"SE",port:443},{domain:"ProxyIP.NL.CMLiussss.net",region:"NL",regionCode:"NL",port:443},{domain:"ProxyIP.FI.CMLiussss.net",region:"FI",regionCode:"FI",port:443},{domain:"ProxyIP.GB.CMLiussss.net",region:"GB",regionCode:"GB",port:443},{domain:"ProxyIP.IN.CMLiussss.net",region:"IN",regionCode:"IN",port:443},{domain:"ProxyIP.BR.CMLiussss.net",region:"BR",regionCode:"BR",port:443},{domain:"ProxyIP.PL.CMLiussss.net",region:"PL",regionCode:"PL",port:443},{domain:"ProxyIP.RU.CMLiussss.net",region:"RU",regionCode:"RU",port:443},{domain:"ProxyIP.LV.CMLiussss.net",region:"LV",regionCode:"LV",port:443},{domain:"ProxyIP.IR.CMLiussss.net",region:"IR",regionCode:"IR",port:443},{domain:"ProxyIP.Oracle.cmliussss.net",region:"Oracle",regionCode:"Oracle",port:443},{domain:"ProxyIP.DigitalOcean.CMLiussss.net",region:"DigitalOcean",regionCode:"DigitalOcean",port:443},{domain:"ProxyIP.Vultr.CMLiussss.net",region:"Vultr",regionCode:"Vultr",port:443},{domain:"ProxyIP.Multacom.CMLiussss.net",region:"Multacom",regionCode:"Multacom",port:443}],directDomains.length=0,directDomains.push({name:"cloudflare.182682.xyz",domain:"cloudflare.182682.xyz"},{name:"speed.marisalnc.com",domain:"speed.marisalnc.com"},{domain:"freeyx.cloudflare88.eu.org"},{domain:"bestcf.top"},{domain:"cdn.2020111.xyz"},{domain:"cfip.cfcdn.vip"},{domain:"cf.0sm.com"},{domain:"cf.090227.xyz"},{domain:"cf.zhetengsha.eu.org"},{domain:"cloudflare.9jy.cc"},{domain:"cf.zerone-cdn.pp.ua"},{domain:"cfip.1323123.xyz"},{domain:"cnamefuckxxs.yuchen.icu"},{domain:"cloudflare-ip.mofashi.ltd"},{domain:"115155.xyz"},{domain:"cname.xirancdn.us"},{domain:"f3058171cad.002404.xyz"},{domain:"8.889288.xyz"},{domain:"cdn.tzpro.xyz"},{domain:"cf.877771.xyz"},{domain:"xn--b6gac.eu.org"})),new Response(JSON.stringify({success:!0,message:"ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò",config:kvConfig}),{headers:{"Content-Type":"application/json"}})}catch(e){return new Response(JSON.stringify({success:!1,message:"‰øùÂ≠òÈÖçÁΩÆÂ§±Ë¥•: "+e.message}),{status:500,headers:{"Content-Type":"application/json"}})}}return new Response(JSON.stringify({error:"Method not allowed"}),{status:405,headers:{"Content-Type":"application/json"}})}async function handlePreferredIPsAPI(e){if(!kvStore)return new Response(JSON.stringify({success:!1,error:"KV Storage Not Configured",message:"Requires KV storage configuration"}),{status:503,headers:{"Content-Type":"application/json"}});if(!("yes"===getConfigValue("ae","")))return new Response(JSON.stringify({success:!1,error:"API Disabled",message:'API disabled for security. Enable "Allow API Management" in settings.'}),{status:403,headers:{"Content-Type":"application/json"}});try{if("GET"===e.method){const e=parseYxToArray(getConfigValue("yx",""));return new Response(JSON.stringify({success:!0,count:e.length,data:e}),{headers:{"Content-Type":"application/json"}})}if("POST"===e.method){const n=await e.json(),t=Array.isArray(n)?n:[n];if(0===t.length)return new Response(JSON.stringify({success:!1,error:"Request Body Empty",message:"Please provide IP data"}),{status:400,headers:{"Content-Type":"application/json"}});let o=parseYxToArray(getConfigValue("yx",""));const a=[],r=[],s=[];for(const e of t){if(!e.ip){s.push({ip:"Unknown",reason:"IP address is required"});continue}const n=e.port||443,t=e.name||`API‰ºòÈÄâ-${e.ip}:${n}`;if(!isValidIP(e.ip)&&!isValidDomain(e.ip)){s.push({ip:e.ip,reason:"Invalid IP or domain format"});continue}if(o.some(t=>t.ip===e.ip&&t.port===n)){r.push({ip:e.ip,port:n,reason:"Already exists"});continue}const i={ip:e.ip,port:n,name:t,addedAt:(new Date).toISOString()};o.push(i),a.push(i)}if(a.length>0){const e=arrayToYx(o);await setConfigValue("yx",e),updateCustomPreferredFromYx()}return new Response(JSON.stringify({success:a.length>0,message:`Successfully added ${a.length} IPs`,added:a.length,skipped:r.length,errors:s.length,data:{addedIPs:a,skippedIPs:r.length>0?r:void 0,errors:s.length>0?s:void 0}}),{headers:{"Content-Type":"application/json"}})}if("DELETE"===e.method){const n=await e.json();if(!0===n.all){const e=getConfigValue("yx",""),n=parseYxToArray(e).length;return await setConfigValue("yx",""),updateCustomPreferredFromYx(),new Response(JSON.stringify({success:!0,message:`All preferred IPs cleared, deleted ${n}`,deletedCount:n}),{headers:{"Content-Type":"application/json"}})}if(!n.ip)return new Response(JSON.stringify({success:!1,error:"IP address is required",message:'Provide ip field to delete, or use {"all": true} to clear all'}),{status:400,headers:{"Content-Type":"application/json"}});const t=n.port||443;let o=parseYxToArray(getConfigValue("yx",""));const a=o.length,r=o.filter(e=>!(e.ip===n.ip&&e.port===t));if(r.length===a)return new Response(JSON.stringify({success:!1,error:"Preferred IP Not Found",message:`${n.ip}:${t} not found`}),{status:404,headers:{"Content-Type":"application/json"}});const s=arrayToYx(r);return await setConfigValue("yx",s),updateCustomPreferredFromYx(),new Response(JSON.stringify({success:!0,message:"Preferred IP Deleted",deleted:{ip:n.ip,port:t}}),{headers:{"Content-Type":"application/json"}})}return new Response(JSON.stringify({success:!1,error:"Method Not Allowed",message:"Supported methods: GET, POST, DELETE"}),{status:405,headers:{"Content-Type":"application/json"}})}catch(e){return new Response(JSON.stringify({success:!1,error:"Processing Failed",message:e.message}),{status:500,headers:{"Content-Type":"application/json"}})}}function updateConfigVariables(){const e=getConfigValue("wk","");if(e&&e.trim())manualWorkerRegion=e.trim().toUpperCase(),currentWorkerRegion=manualWorkerRegion;else{const e=getConfigValue("p","");e&&e.trim()?currentWorkerRegion="CUSTOM":manualWorkerRegion=""}const n=getConfigValue("rm","");enableRegionMatching=!n||"no"!==n.toLowerCase();const t=getConfigValue("ev","");void 0!==t&&""!==t&&(ev="yes"===t||!0===t||"true"===t);const o=getConfigValue("et","");void 0!==o&&""!==o&&(et="yes"===o||!0===o||"true"===o),tp=getConfigValue("tp","")||"";const a=getConfigValue("ex","");void 0!==a&&""!==a&&(ex="yes"===a||!0===a||"true"===a);const r=getConfigValue("evm","");void 0!==r&&""!==r&&(evm="yes"===r||!0===r||"true"===r);const s=getConfigValue("ess","");void 0!==s&&""!==s&&(ess="yes"===s||!0===s||"true"===s);const i=getConfigValue("etu","");void 0!==i&&""!==i&&(etu="yes"===i||!0===i||"true"===i);const l=getConfigValue("ehy","");void 0!==l&&""!==l&&(ehy="yes"===l||!0===l||"true"===l);const c=getConfigValue("eg","");void 0!==c&&""!==c&&(eg="yes"===c||!0===c||"true"===c),ev||et||ex||evm||ess||etu||ehy||eg||(ev=!0),scu=getConfigValue("scu","")||"https://url.v1.mk/sub";const d=getConfigValue("epd","no");void 0!==d&&""!==d&&(epd="no"!==d&&!1!==d&&"false"!==d);const u=getConfigValue("epi","");void 0!==u&&""!==u&&(epi="no"!==u&&!1!==u&&"false"!==u);const p=getConfigValue("egi","");void 0!==p&&""!==p&&(egi="no"!==p&&!1!==p&&"false"!==p);const g=getConfigValue("ech","");void 0!==g&&""!==g&&(enableECH="yes"===g||!0===g||"true"===g);const m=getConfigValue("customDNS","");customDNS=m&&m.trim()?m.trim():"https://dns.joeyblog.eu.org/joeyblog";const f=getConfigValue("customECHDomain","");customECHDomain=f&&f.trim()?f.trim():"cloudflare-ech.com",enableECH&&(disableNonTLS=!0);const h=getConfigValue("dkby","");h&&"yes"===h.toLowerCase()&&(disableNonTLS=!0),cp=getConfigValue("d","")||"",piu=getConfigValue("yxURL","")||"https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt";const b=getConfigValue("p","");if(fallbackAddress=b?b.trim():"",socks5Config=getConfigValue("s","")||"",socks5Config)try{parsedSocks5Config=parseSocksConfig(socks5Config),isSocksEnabled=!0}catch(e){isSocksEnabled=!1}else isSocksEnabled=!1;const y=getConfigValue("yxby","");disablePreferred=!(!y||"yes"!==y.toLowerCase());"https://raw.githubusercontent.com/qwer-search/bestip/refs/heads/main/kejilandbestip.txt"!==piu&&(directDomains.length=0,customPreferredIPs=[],customPreferredDomains=[])}function updateCustomPreferredFromYx(){const e=getConfigValue("yx","");if(e)try{const n=e.split(",").map(e=>e.trim()).filter(e=>e);customPreferredIPs=[],customPreferredDomains=[],n.forEach(e=>{let n="",t=e;if(e.includes("#")){const o=e.split("#");t=o[0].trim(),n=o[1].trim()}const{address:o,port:a}=parseAddressAndPort(t);n||(n="CustomPreferred-"+o+(a?":"+a:"")),isValidIP(o)?customPreferredIPs.push({ip:o,port:a,isp:n}):customPreferredDomains.push({domain:o,port:a,name:n})})}catch(e){customPreferredIPs=[],customPreferredDomains=[]}else customPreferredIPs=[],customPreferredDomains=[]}function parseYxToArray(e){if(!e||!e.trim())return[];const n=e.split(",").map(e=>e.trim()).filter(e=>e),t=[];for(const e of n){let n="",o=e;if(e.includes("#")){const t=e.split("#");o=t[0].trim(),n=t[1].trim()}const{address:a,port:r}=parseAddressAndPort(o);n||(n=a+(r?":"+r:"")),t.push({ip:a,port:r||443,name:n,addedAt:(new Date).toISOString()})}return t}function arrayToYx(e){return e&&0!==e.length?e.map(e=>{const n=e.port||443;return`${e.ip}:${n}#${e.name}`}).join(","):""}function isValidDomain(e){return/^(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/.test(e)}async function parseTextToArray(e){var n=e.replace(/[	"'\r\n]+/g,",").replace(/,+/g,",");return","==n.charAt(0)&&(n=n.slice(1)),","==n.charAt(n.length-1)&&(n=n.slice(0,n.length-1)),n.split(",")}async function fetchPreferredAPI(e,n="443",t=3e3){if(!e?.length)return[];const o=new Set;return await Promise.allSettled(e.map(async e=>{try{const a=new AbortController,r=setTimeout(()=>a.abort(),t),s=await fetch(e,{signal:a.signal});clearTimeout(r);let i="";try{const e=await s.arrayBuffer(),n=(s.headers.get("content-type")||"").toLowerCase(),t=n.match(/charset=([^\s;]+)/i)?.[1]?.toLowerCase()||"";let o=["utf-8","gb2312"];(t.includes("gb")||t.includes("gbk")||t.includes("gb2312"))&&(o=["gb2312","utf-8"]);let a=!1;for(const n of o)try{const t=new TextDecoder(n).decode(e);if(t&&t.length>0&&!t.includes("ÔøΩ")){i=t,a=!0;break}if(t&&t.length>0)continue}catch(e){continue}if(a||(i=await s.text()),!i||0===i.trim().length)return}catch(e){return}const l=i.trim().split("\n").map(e=>e.trim()).filter(e=>e),c=l.length>1&&l[0].includes(","),d=/^[^\[\]]*:[^\[\]]*:[^\[\]]/;if(c){const t=l[0].split(",").map(e=>e.trim()),a=l.slice(1);if(t.includes("IPÂú∞ÂùÄ")&&t.includes("Á´ØÂè£")&&t.includes("Êï∞ÊçÆ‰∏≠ÂøÉ")){const e=t.indexOf("IPÂú∞ÂùÄ"),n=t.indexOf("Á´ØÂè£"),r=t.indexOf("ÂõΩÂÆ∂")>-1?t.indexOf("ÂõΩÂÆ∂"):t.indexOf("ÂüéÂ∏Ç")>-1?t.indexOf("ÂüéÂ∏Ç"):t.indexOf("Êï∞ÊçÆ‰∏≠ÂøÉ"),s=t.indexOf("TLS");a.forEach(t=>{const a=t.split(",").map(e=>e.trim());if(-1!==s&&"true"!==a[s]?.toLowerCase())return;const i=d.test(a[e])?`[${a[e]}]`:a[e];o.add(`${i}:${a[n]}#${a[r]}`)})}else if(t.some(e=>e.includes("IP"))&&t.some(e=>e.includes("Âª∂Ëøü"))&&t.some(e=>e.includes("‰∏ãËΩΩÈÄüÂ∫¶"))){const r=t.findIndex(e=>e.includes("IP")),s=t.findIndex(e=>e.includes("Âª∂Ëøü")),i=t.findIndex(e=>e.includes("‰∏ãËΩΩÈÄüÂ∫¶")),l=new URL(e).searchParams.get("port")||n;a.forEach(e=>{const n=e.split(",").map(e=>e.trim()),t=d.test(n[r])?`[${n[r]}]`:n[r];o.add(`${t}:${l}#CF Preferred ${n[s]}ms ${n[i]}MB/s`)})}}else l.forEach(t=>{const a=t.indexOf("#"),[r,s]=a>-1?[t.substring(0,a),t.substring(a)]:[t,""];let i=!1;if(r.startsWith("["))i=/\]:(\d+)$/.test(r);else{const e=r.lastIndexOf(":");i=e>-1&&/^\d+$/.test(r.substring(e+1))}const l=new URL(e).searchParams.get("port")||n;o.add(i?t:`${r}:${l}${s}`)})}catch(e){}})),Array.from(o)}const DOH_PROVIDERS=[{name:"Cloudflare",url:"https://cloudflare-dns.com/dns-query",weight:20},{name:"Google",url:"https://dns.google/dns-query",weight:15},{name:"Quad9",url:"https://dns.quad9.net/dns-query",weight:15},{name:"OpenDNS",url:"https://doh.opendns.com/dns-query",weight:10},{name:"AdGuard",url:"https://dns.adguard.com/dns-query",weight:10},{name:"ControlD",url:"https://freedns.controld.com/p2",weight:10},{name:"Mullvad",url:"https://adblock.dns.mullvad.net/dns-query",weight:10},{name:"NextDNS",url:"https://dns.nextdns.io/dns-query",weight:10}],CACHE_TTL=300;async function handleDoHRequest(e,n,t){const o=new URL(e.url);if("OPTIONS"===e.method)return handleCORS();const a="GET"===e.method,r="POST"===e.method;if(!a&&!r)return new Response("Method not allowed",{status:405});if(a&&!o.searchParams.has("dns"))return new Response("Missing DNS query parameter",{status:400});const s=selectProvider(DOH_PROVIDERS);try{const n=s.url+o.search,t=new Headers(e.headers);r?t.set("Content-Type","application/dns-message"):t.set("Accept","application/dns-message"),t.set("User-Agent","DoH-Proxy-Worker/1.0");const a=new Request(n,{method:e.method,headers:t,body:r?await e.arrayBuffer():null,redirect:"follow"}),i=await fetch(a),l=new Headers(i.headers);return l.set("Access-Control-Allow-Origin","*"),l.set("Access-Control-Allow-Methods","GET, POST, OPTIONS"),l.set("Access-Control-Allow-Headers","Content-Type, Accept"),l.set("Cache-Control",`public, max-age=${CACHE_TTL}`),new Response(i.body,{status:i.status,statusText:i.statusText,headers:l})}catch(n){return await tryFallbackProviders(e,o,s)}}function handleCORS(){return new Response(null,{status:204,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Accept","Access-Control-Max-Age":"86400"}})}function selectProvider(e){const n=e.reduce((e,n)=>e+n.weight,0);let t=Math.random()*n;for(const n of e){if(t<n.weight)return n;t-=n.weight}return e[0]}async function tryFallbackProviders(e,n,t){const o=DOH_PROVIDERS.filter(e=>e.name!==t.name);for(const t of o.slice(0,2))try{const o=t.url+n.search,a=new Headers(e.headers);"POST"===e.method?a.set("Content-Type","application/dns-message"):a.set("Accept","application/dns-message");const r=new Request(o,{method:e.method,headers:a,body:"POST"===e.method?await e.arrayBuffer():null}),s=await fetch(r);if(s.ok){const e=new Headers(s.headers);return e.set("Access-Control-Allow-Origin","*"),new Response(s.body,{status:s.status,headers:e})}}catch(e){continue}return new Response("All DNS providers failed",{status:503})}function serveDNSEncodingExplanation(){return new Response("DNS Encoding Explanation: GET requests must use base64url encoded DNS query in ?dns= param. POST requests send raw binary.",{status:200})}function generateVMessLinksFromSource(e,n,t){const o=[],a=[443,2053,2083,2087,2096,8443];return e.forEach(e=>{let r=e.isp.replace(/\s/g,"_");e.colo&&e.colo.trim()&&(r+=`-${e.colo.trim()}`);const s=parseInt(e.port||443),i=a.includes(s);if(!i&&disableNonTLS)return;const l={v:"2",ps:r,add:e.ip,port:s,id:n,aid:"0",scy:"auto",net:"ws",type:"none",host:t,path:"/vm?ed=2048",tls:i?"tls":"",sni:i?t:"",alpn:i?"h2,http/1.1":""},c=btoa(JSON.stringify(l));o.push(`vmess://${c}`)}),o}function generateVMessLinksFromNewIPs(e,n,t){const o=[],a=[443,2053,2083,2087,2096,8443];return e.forEach(e=>{const r=e.name.replace(/\s/g,"_"),s=parseInt(e.port),i=a.includes(s);if(!i&&disableNonTLS)return;const l={v:"2",ps:r,add:e.ip,port:s,id:n,aid:"0",scy:"auto",net:"ws",type:"none",host:t,path:"/vm?ed=2048",tls:i?"tls":"",sni:i?t:"",alpn:i?"h2,http/1.1":""},c=btoa(JSON.stringify(l));o.push(`vmess://${c}`)}),o}function generateShadowsocksLinksFromSource(e,n,t){const o=[],a=n,r=[443,2053,2083,2087,2096,8443];return e.forEach(e=>{let n=e.isp.replace(/\s/g,"_");e.colo&&e.colo.trim()&&(n+=`-${e.colo.trim()}`);const s=parseInt(e.port||443),i=r.includes(s);if(!i&&disableNonTLS)return;const l=btoa(`chacha20-ietf-poly1305:${a}`);let c=`v2ray-plugin;mode=websocket;host=${t};path=${encodeURIComponent("/ss?ed=2048")}`;i&&(c+=";tls"),o.push(`ss://${l}@${e.ip}:${s}?plugin=${encodeURIComponent(c)}#${encodeURIComponent(n)}`)}),o}function generateShadowsocksLinksFromNewIPs(e,n,t){const o=[],a=n,r=[443,2053,2083,2087,2096,8443];return e.forEach(e=>{const n=e.name.replace(/\s/g,"_"),s=parseInt(e.port),i=r.includes(s);if(!i&&disableNonTLS)return;const l=btoa(`chacha20-ietf-poly1305:${a}`);let c=`v2ray-plugin;mode=websocket;host=${t};path=${encodeURIComponent("/ss?ed=2048")}`;i&&(c+=";tls"),o.push(`ss://${l}@${e.ip}:${s}?plugin=${encodeURIComponent(c)}#${encodeURIComponent(n)}`)}),o}