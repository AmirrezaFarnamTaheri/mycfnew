# ุฑูุฒฺฏุฐุงุฑ ุฏุฑุฎูุงุณุช DNS ุจุฑุง DoH

ุงู ุณูุฏ ูุญูู ุฑูุฒฺฏุฐุงุฑ ุฏุฑุฎูุงุณุชโูุง DNS ููฺฏุงู ุงุณุชูุงุฏู ุงุฒ ุฑูุด `GET` ุจุง ุงู ูพุฑูฺฉุณ DoH ุฑุง ุทุจู ุงุณุชุงูุฏุงุฑุฏ [RFC 8484](https://tools.ietf.org/html/rfc8484) ุชูุถุญ ูโุฏูุฏ.

## ฺฉูุงุช

ููฺฏุงู ุงุฑุณุงู ุฏุฑุฎูุงุณุช DNS ุงุฒ ุทุฑู HTTP `POST`ุ ูพุงู ุจุงูุฑ DNS ูุณุชููุงู ุฏุฑ ุจุฏูู ุฏุฑุฎูุงุณุช ุงุฑุณุงู ูโุดูุฏ. ุงูุง ุจุฑุง ุฏุฑุฎูุงุณุชโูุง `GET`ุ ูพุงู DNS ุจุงุฏ ุฏุฑ ูพุงุฑุงูุชุฑูุง URL ุฑูุฒฺฏุฐุงุฑ ุดูุฏ.

## ูพุงุฑุงูุชุฑ `dns`

ุฏุฑุฎูุงุณุช `GET` ฺฉ ูพุงุฑุงูุชุฑ ฺฉูุฆุฑ ุจู ูุงู `dns` ูโูพุฐุฑุฏ.
ููุฏุงุฑ ุงู ูพุงุฑุงูุชุฑุ ููุงุด ุฑูุฒฺฏุฐุงุฑ ุดุฏู ูพุงู DNS (ูุฑูุช wire-format) ุจู ุตูุฑุช **base64url** ุงุณุช.

### ุฑูุฒฺฏุฐุงุฑ Base64url

ุฑูุด Base64url ููุน ุงุฒ Base64 ุงุณุช ฺฉู ุฏุฑ [RFC 4648](https://tools.ietf.org/html/rfc4648#section-5) ุชุนุฑู ุดุฏู ุงุณุช. ุงู ุฑูุด ุจุฑุง ุงุณุชูุงุฏู ุงูู ุฏุฑ URLูุง ู ูุงู ูุงูโูุง ุทุฑุงุญ ุดุฏู ุงุณุช.

**ุชูุงูุชโูุง ุจุง Base64 ุงุณุชุงูุฏุงุฑุฏ:**
1.  **ฺฉุงุฑุงฺฉุชุฑูุง:**
    -   ุฏุฑ Base64 ุงุณุชุงูุฏุงุฑุฏ ุงุฒ `+` ู `/` ุงุณุชูุงุฏู ูโุดูุฏ.
    -   ุฏุฑ Base64url ุงุฒ `-` (ููู) ุจู ุฌุง `+` ู ุงุฒ `_` (ุฒุฑุฎุท) ุจู ุฌุง `/` ุงุณุชูุงุฏู ูโุดูุฏ.
2.  **ูพุฏูฺฏ (Padding):**
    -   ุฏุฑ Base64 ุงุณุชุงูุฏุงุฑุฏ ุงุฒ `=` ุจุฑุง ูพุฏูฺฏ ุงุณุชูุงุฏู ูโุดูุฏ.
    -   ุฏุฑ Base64url ฺฉุงุฑุงฺฉุชุฑูุง ูพุฏูฺฏ (`=`) **ุญุฐู** ูโุดููุฏ.

### ูุซุงู

ูุฑุถ ฺฉูุฏ ูโุฎูุงูู ุฑฺฉูุฑุฏูุง `A` ุฑุง ุจุฑุง `example.com` ุฌุณุชุฌู ฺฉูู.

1.  **ูุฑูุช DNS Wire (ูฺฏุฒ):**
    ```hex
    000001000001000000000000076578616d706c6503636f6d0000010001
    ```

2.  **Base64 ุงุณุชุงูุฏุงุฑุฏ:**
    ```
    AAAAAQABAAAAAAAAA2V4YW1wbGUDY29tAAABAAE=
    ```

3.  **ุฑูุฒฺฏุฐุงุฑ ุดุฏู ุจุง Base64url:**
    -   ุฌุงฺฏุฒู `+` ุจุง `-` (ุงูุฌุง ูุฏุงุฑู).
    -   ุฌุงฺฏุฒู `/` ุจุง `_` (ุงูุฌุง ูุฏุงุฑู).
    -   ุญุฐู ูพุฏูฺฏ `=`.
    ```
    AAAAAQABAAAAAAAAA2V4YW1wbGUDY29tAAABAAE
    ```

4.  **URL ููุง:**
    ```
    https://your-worker.workers.dev/dns-query?dns=AAAAAQABAAAAAAAAA2V4YW1wbGUDY29tAAABAAE
    ```

## ฺุฑุง ุงุฒ GET ุงุณุชูุงุฏู ฺฉููุ

-   **ฺฉุด ฺฉุฑุฏู (Caching):** ฺฉููุฏููุฑ ู ูุฑูุฑฺฏุฑูุง ูโุชูุงููุฏ ูพุงุณุฎโูุง `GET` ุฑุง ฺฉุด ฺฉููุฏ ฺฉู ุนููฺฉุฑุฏ ุฑุง ุจุฑุง ฺฉูุฆุฑโูุง ุชฺฉุฑุงุฑ ุจู ุดุฏุช ุจูุจูุฏ ูโุจุฎุดุฏ.
-   **ุนููฺฉุฑุฏ:** ุงุฒ ุณุฑุจุงุฑ ุจุฏูู ฺฉุงูู ุฏุฑุฎูุงุณุช ุจุฑุง ฺฉูุฆุฑโูุง ฺฉูฺฺฉ ุฌููฺฏุฑ ูโฺฉูุฏ.

## ุชุณุช ุจุง ุงุจุฒุงุฑูุง

### `dig`
ุฏุณุชูุฑ `dig` ุฏุฑ ููู ูุณุฎูโูุง ูุณุชููุงู ุงุฒ ุฑูุฒฺฏุฐุงุฑ base64url ุจุฑุง ุฏุฑุฎูุงุณุชโูุง DoH `GET` ูพุดุชุจุงู ููโฺฉูุฏุ ุงูุง ูโุชูุงูุฏ ุงุฒ `doh-cli` ุง ุงุจุฒุงุฑูุง ูุดุงุจู ุงุณุชูุงุฏู ฺฉูุฏ.

### `curl`
ูโุชูุงูุฏ ุฑุดุชู ุฑุง ุจู ุตูุฑุช ุฏุณุช ุจุณุงุฒุฏ ุง ุงุฒ ุงุจุฒุงุฑูุง ุฎุท ูุฑูุงู ุจุฑุง ุฑูุฒฺฏุฐุงุฑ ุงุณุชูุงุฏู ฺฉูุฏ.

```bash
# ููููู ุฑูุฒฺฏุฐุงุฑ ุฏุฑ ุดู
echo -n -e '\x00\x00\x01\x00\x00\x01\x00\x00\x00\x00\x00\x00\x07\x65\x78\x61\x6d\x70\x6c\x65\x03\x63\x6f\x6d\x00\x00\x01\x00\x01' | base64 | tr '+/' '-_' | tr -d '=\n'
```

### ููููู ุงุณฺฉุฑูพุช ูพุงุชูู
ุงู ฺฉ ุงุณฺฉุฑูพุช ุณุงุฏู ูพุงุชูู ุจุฑุง ุชููุฏ ฺฉูุฆุฑ DNS ุฑูุฒฺฏุฐุงุฑ ุดุฏู ุจุง base64url ุจุฑุง ูุฑ ุฏุงูููโุง ุงุณุช.

```python
import base64
import struct

def encode_dns_query(domain, record_type=1): # 1 is 'A' record
    # Transaction ID (random) + Flags (Standard Query) + Questions (1) + Answer RRs (0) + Authority RRs (0) + Additional RRs (0)
    header = b'\x00\x00\x01\x00\x00\x01\x00\x00\x00\x00\x00\x00'

    # Domain Name Encoding (e.g., example.com -> \x07example\x03com\x00)
    qname = b''
    for part in domain.split('.'):
        qname += bytes([len(part)]) + part.encode('ascii')
    qname += b'\x00'

    # Type (A=1) + Class (IN=1)
    footer = struct.pack('>HH', record_type, 1)

    dns_msg = header + qname + footer

    # Base64url encoding (RFC 4648)
    encoded = base64.urlsafe_b64encode(dns_msg).decode('utf-8').rstrip('=')
    return encoded

domain = "example.com"
print(f"Domain: {domain}")
print(f"Encoded: {encode_dns_query(domain)}")
```

---

## ฺุฑุง DNS Over HTTPS (DoH)ุ ๐ก๏ธ

### ฑ. ุญุฑู ุฎุตูุต ู ุงููุช
ฺฉูุฆุฑโูุง DNS ุณูุช ุจู ุตูุฑุช ูุชู ุณุงุฏู (UDP/53) ุงุฑุณุงู ูโุดููุฏ. ูุฑ ฺฉุณ ุฏุฑ ุดุจฺฉู (ISPุ ูฺฉุฑูุงุ ูุงุฑูุงูโูุง ุฏููุช) ูโุชูุงูุฏ ุฏููุงู ุจุจูุฏ ุดูุง ุงุฒ ฺู ูุจโุณุงุชโูุง ุจุงุฒุฏุฏ ูโฺฉูุฏ.
*   **DoH** ุงู ุชุฑุงูฺฉ ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ HTTPS (TLS) ุฑูุฒฺฏุฐุงุฑ ูโฺฉูุฏ ู ููุตุฏ ุดูุง ุฑุง ุงุฒ ุฏุฏ ุฌุงุณูุณุงู ูุฎู ูฺฏู ูโุฏุงุฑุฏ.

### ฒ. ุฏูุฑ ุฒุฏู ุณุงูุณูุฑ
ุจุณุงุฑ ุงุฒ ุณุณุชูโูุง ููุชุฑูฺฏ ุจุฑ "ูุณูููโุณุงุฒ DNS" (DNS Poisoning) ุชฺฉู ุฏุงุฑูุฏ ุชุง ุณุงุชโูุง ุฑุง ูุณุฏูุฏ ฺฉููุฏ. ุขูโูุง ุฏุฑุฎูุงุณุช DNS ุดูุง ุจุฑุง `youtube.com` ุฑุง ุฑูฺฏุฑ ฺฉุฑุฏู ู ฺฉ ุขุฏุฑุณ IP ุฌุนู ุจุฑูโฺฏุฑุฏุงููุฏ.
*   **DoH** ุงู ุฑูุด ุฑุง ุฏูุฑ ูโุฒูุฏ ุฒุฑุง ุฏุฑุฎูุงุณุช ุดุจู ุชุฑุงูฺฉ ุนุงุฏ HTTPS ุจู ฺฉููุฏููุฑ ุจู ูุธุฑ ูโุฑุณุฏ ฺฉู ุณุงูุณูุฑฺ ููโุชูุงูุฏ ุจู ุฑุงุญุช ุขู ุฑุง ุจุฎูุงูุฏ ุง ุชุบุฑ ุฏูุฏ.

---

## ูพฺฉุฑุจูุฏ ูุฑูุฑฺฏุฑ โ๏ธ

ุดูุง ูโุชูุงูุฏ ุงุฒ ุงู Worker ุจู ุนููุงู ุงุฑุงุฆู ุฏููุฏู DNS ุงูู ุฎูุฏ ุฏุฑ ูุฑูุฑฺฏุฑูุง ูุฏุฑู ุงุณุชูุงุฏู ฺฉูุฏ.

### ฺฉุฑูู / ุงุฌ (Chrome / Edge)
1.  ุจู **Settings** -> **Privacy and security** -> **Security** ุจุฑูุฏ.
2.  ุจู ุจุฎุด **Use Secure DNS** ุงุณฺฉุฑูู ฺฉูุฏ.
3.  ฺฏุฒูู **With: Custom** ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ.
4.  ุขุฏุฑุณ Worker ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ: `https://your-worker.workers.dev/dns-query`

### ูุงุฑูุงฺฉุณ (Firefox)
1.  ุจู **Settings** -> **Privacy & Security** ุจุฑูุฏ.
2.  ุจู ุจุฎุด **DNS over HTTPS** ุงุณฺฉุฑูู ฺฉูุฏ.
3.  ฺฏุฒูู **Max Protection** ุง **Increased Protection** ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ.
4.  ุงุฑุงุฆู ุฏููุฏู **Custom** ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ.
5.  ูุงุฑุฏ ฺฉูุฏ: `https://your-worker.workers.dev/dns-query`

---

## ุนุจโุงุจ ูุดุช DNS ๐ง

ุงฺฏุฑ ุงุฒ ูพุฑูฺฉุณ ุงุณุชูุงุฏู ูโฺฉูุฏ ุงูุง DNS ุดูุง ููฺูุงู ูุดุช ูโฺฉูุฏ (ููุงุด ุณุฑูุฑ DNS ุณุฑูุณโุฏููุฏู ุงูุชุฑูุช ุดูุง):

1.  **ุจุฑุฑุณ ุชูุธูุงุช ฺฉูุงูุช**: ูุทูุฆู ุดูุฏ ฺฉูุงูุช V2Ray/Clash ุดูุง ฺฏุฒูู "Sniffing" (Traffic Sniffing) ุฑุง ูุนุงู ุฏุงุฑุฏ. ุงู ุจู ฺฉูุงูุช ุงุฌุงุฒู ูโุฏูุฏ ุฏุงููู ุฑุง ุงุฒ ุฑุงู ุฏูุฑ ุงุฒ ุทุฑู ูพุฑูฺฉุณ ุญู (Resolve) ฺฉูุฏ ูู ุจู ุตูุฑุช ูุญู.
2.  **ุงุณุชูุงุฏู ุงุฒ Remote DNS**: ุฏุฑ ูพฺฉุฑุจูุฏ ฺฉูุงูุช ุฎูุฏุ ูุทูุฆู ุดูุฏ ุณุฑูุฑ "Remote DNS" ุฑู ฺฉ ุงุฑุงุฆู ุฏููุฏู ูุนุชุจุฑ DoH ุง ุขุฏุฑุณ Worker ุดูุง ุชูุธู ุดุฏู ุจุงุดุฏ.
3.  **ุชุณุช**: ุจู ุณุงุช [dnsleaktest.com](https://www.dnsleaktest.com) ุจุฑูุฏ ุชุง ุจุฑุฑุณ ฺฉูุฏ. ุจุงุฏ IPูุง ฺฉููุฏููุฑ ุฑุง ุจุจูุฏุ ูู IP ุณุฑูุณโุฏููุฏู ุงูุชุฑูุช ุฎูุฏุชุงู ุฑุง.
