# CFnew - ç»ˆç«¯ v2.9.3

**è¯­è¨€:** [ä¸­æ–‡](README.md) | [ÙØ§Ø±Ø³ÛŒ](ÙØ§Ø±Ø³ÛŒ.md)

[Telegram äº¤æµç¾¤](https://t.me/+ft-zI76oovgwNmRh)

## ğŸ“– ç›®å½•

1.  [ç®€ä»‹ä¸åŠŸèƒ½](#ç®€ä»‹ä¸åŠŸèƒ½)
2.  [Capabilities Showcase (åŠŸèƒ½å±•ç¤º)](#capabilities-showcase-åŠŸèƒ½å±•ç¤º)
3.  [æ ¸å¿ƒæ¦‚å¿µæ‹†è§£](#æ ¸å¿ƒæ¦‚å¿µæ‹†è§£-unpacking-concepts)
4.  ["Link-Only" åè®®æ·±åº¦è§£æ](#link-only-åè®®æ·±åº¦è§£æ)
5.  [é…ç½®ç™¾ç§‘å…¨ä¹¦ (Configuration Encyclopedia)](#é…ç½®ç™¾ç§‘å…¨ä¹¦-configuration-encyclopedia)
    *   [åŸºç¡€èº«ä»½éªŒè¯](#1-åŸºç¡€èº«ä»½éªŒè¯-identity)
    *   [ç½‘ç»œä¸­ç»§ä¸éšè—](#2-ç½‘ç»œä¸­ç»§ä¸éšè—-relay--stealth)
    *   [åè®®å¼€å…³ä¸æŠ€æœ¯ç»†èŠ‚](#3-åè®®å¼€å…³ä¸æŠ€æœ¯ç»†èŠ‚-protocols)
    *   [é«˜çº§æ§åˆ¶ä¸ä¼˜é€‰](#4-é«˜çº§æ§åˆ¶ä¸ä¼˜é€‰-advanced--preferred)
6.  [ç»ˆæé…ç½®æŒ‡å—ï¼šå¼€å¯æ‰€æœ‰åŠŸèƒ½](#ç»ˆæé…ç½®æŒ‡å—å¼€å¯æ‰€æœ‰åŠŸèƒ½)
7.  [ä»é›¶å¼€å§‹å®‰è£… (Zero to Hero)](#ä»é›¶å¼€å§‹å®‰è£…-zero-to-hero)
8.  [ProxyIP æ·±åº¦è§£æ](#proxyip-æ·±åº¦è§£æ)
9.  [å®¢æˆ·ç«¯é…ç½®æŒ‡å—](#å®¢æˆ·ç«¯é…ç½®æŒ‡å—)
10. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤-troubleshooting)
11. [API ç®¡ç†](#api-ç®¡ç†)
12. [Star History](#star-history)

---

## ç®€ä»‹ä¸åŠŸèƒ½

CFnew æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ Cloudflare Workers ä¸Šçš„è½»é‡çº§ä»£ç†è„šæœ¬ã€‚å®ƒåˆ©ç”¨ Cloudflare çš„å…¨çƒè¾¹ç¼˜ç½‘ç»œï¼Œä¸ºæ‚¨æä¾›å¿«é€Ÿã€å®‰å…¨çš„ç½‘ç»œè¿æ¥ã€‚

*   **å¤šåè®®å¹¶å‘**ï¼šåŒæ—¶æ”¯æŒ VLESSã€Trojanã€xhttp ç­‰åŸç”Ÿåè®®ï¼Œä»¥åŠ VMessã€Shadowsocks ç­‰è½¬å‘åè®®ã€‚
*   **é«˜åº¦éšè”½**ï¼šæ”¯æŒè‡ªå®šä¹‰è·¯å¾„ (Path)ï¼Œä¼ªè£…æˆæ™®é€šç½‘ç«™ï¼Œé˜²æ­¢æ¢æµ‹ã€‚
*   **å›¾å½¢åŒ–ç®¡ç†**ï¼šé€šè¿‡ KV å­˜å‚¨é…ç½®ï¼Œæ— éœ€ä¿®æ”¹ä»£ç å³å¯åœ¨ç½‘é¡µç«¯å®æ—¶è°ƒæ•´è®¾ç½®ã€‚
*   **å†…ç½®å·¥å…·**ï¼šé›†æˆå»¶è¿Ÿæµ‹è¯•ã€ä¼˜é€‰ IP ç®¡ç†ã€DoH (DNS-over-HTTPS) ä»£ç†ã€‚
*   **æ™ºèƒ½è®¢é˜…**ï¼šæ ¹æ®æ‚¨çš„å®¢æˆ·ç«¯ (Clash, v2rayNG, etc.) è‡ªåŠ¨è¾“å‡ºæœ€åˆé€‚çš„é…ç½®æ ¼å¼ã€‚

---

## Capabilities Showcase (åŠŸèƒ½å±•ç¤º)

CFnew ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„ä»£ç†è„šæœ¬ï¼Œå®ƒé›†æˆäº†å¤šç§å¼ºå¤§çš„èƒ½åŠ›ï¼š

*   **ğŸ›¡ï¸ Proxy Power (ä»£ç†èƒ½åŠ›)**:
    *   **Native**: åŸç”Ÿæ”¯æŒ VLESSã€Trojanã€VLESS gRPCï¼Œæ€§èƒ½æœ€ä½³ã€‚
    *   **Relay**: æ”¯æŒ VMessã€Shadowsocks æµé‡è½¬å‘ï¼Œå…¼å®¹æ—§è®¾å¤‡ã€‚
*   **ğŸ“¡ Subscription Manager (è®¢é˜…ç®¡ç†)**:
    *   æ™ºèƒ½è¯†åˆ« Clash, v2rayNG, Sing-box, Surge, Quantumult X ç­‰å®¢æˆ·ç«¯ User-Agentã€‚
    *   è‡ªåŠ¨ç”Ÿæˆå¯¹åº”æ ¼å¼çš„é…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨è½¬æ¢ã€‚
*   **âš¡ Latency Test (å»¶è¿Ÿæµ‹è¯•)**:
    *   å†…ç½®å›¾å½¢åŒ–ç•Œé¢ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸­æµ‹è¯• Cloudflare å„ä¸ª IP çš„ HTTP æ¡æ‰‹å»¶è¿Ÿã€‚
    *   ä¸€é”®å°†æœ€å¿« IP æ·»åŠ åˆ°ä¼˜é€‰åˆ—è¡¨ã€‚
*   **ğŸ”’ DoH Relay (å®‰å…¨ DNS)**:
    *   æä¾› `/dns-query` æ¥å£ï¼Œæ”¯æŒæ ‡å‡† DoH åè®®ã€‚
    *   è‡ªåŠ¨è´Ÿè½½å‡è¡¡è¯·æ±‚åˆ° Google, Cloudflare, Quad9 ç­‰ä¸Šæ¸¸ï¼ŒæŠ— DNS æ±¡æŸ“ã€‚
*   **âš™ï¸ API Engine (è‡ªåŠ¨åŒ–å¼•æ“)**:
    *   æä¾› RESTful APIï¼Œå…è®¸é€šè¿‡è„šæœ¬è‡ªåŠ¨æ›´æ–°ä¼˜é€‰ IPã€‚
    *   æ”¯æŒ IP çš„å¢åˆ æ”¹æŸ¥ï¼Œé€‚åˆé«˜çº§ç”¨æˆ·ç¼–å†™å®šæ—¶ä»»åŠ¡ã€‚

---

## æ ¸å¿ƒæ¦‚å¿µæ‹†è§£ (Unpacking Concepts)

ä¸ºäº†è®©æ‚¨å½»åº•ç†è§£ Worker å¦‚ä½•å·¥ä½œï¼Œæˆ‘ä»¬å°†å…¶æ‹†è§£ã€‚

### ç½‘ç»œè¯·æ±‚çš„è§£å‰– (é‚®å·®æ¯”å–»)

æƒ³è±¡æ‚¨è¦å¯„ä¸€å°ä¿¡ï¼ˆè®¿é—® Googleï¼‰ï¼Œä½†é‚®å±€ï¼ˆé˜²ç«å¢™ï¼‰ç¦æ­¢å¯„ç»™ Googleã€‚

1.  **æ‰“åŒ… (å°è£…)**: æ‚¨æŠŠå†™ç»™ Google çš„ä¿¡ï¼Œè£…è¿›ä¸€ä¸ªå†™ç€ "ç»™ Cloudflare Worker" çš„ä¿¡å°é‡Œã€‚è¿™å°±æ˜¯ **VLESS/Trojan åè®®** çš„ä½œç”¨ã€‚
2.  **æŠ•é€’ (ä¼ è¾“)**: é‚®å±€çœ‹åˆ°ä¿¡æ˜¯å¯„ç»™ Cloudflareï¼ˆä¸€ä¸ªåˆæ³•çš„ CDN å…¬å¸ï¼‰çš„ï¼Œäºæ˜¯æ”¾è¡Œã€‚
3.  **æ‹†åŒ… (å¤„ç†)**: Worker æ”¶åˆ°ä¿¡ï¼Œæ‰“å¼€å‘ç°é‡Œé¢å…¶å®æ˜¯ç»™ Google çš„ã€‚
4.  **è½¬å‘ (ä¸­ç»§)**:
    *   **ç›´è¿æ¨¡å¼**: Worker å‡è£…æ˜¯æ‚¨ï¼Œç›´æ¥æŠŠä¿¡é€ç»™ Googleã€‚
    *   **ProxyIP æ¨¡å¼**: Worker è§‰å¾—ç›´æ¥å»ä¸å¤ªå®‰å…¨ï¼Œäºæ˜¯æŠŠä¿¡äº¤ç»™ä¸€ä¸ª "ç§˜å¯†ä¸­è½¬ç«™" (ProxyIP)ï¼Œç”±å®ƒé€ç»™ Googleã€‚
5.  **å›ä¿¡**: Google å›ä¿¡ç»™ Worker (æˆ– ProxyIP)ï¼ŒWorker å†æŠŠå›ä¿¡è£…è¿› "Cloudflare" çš„ä¿¡å°å¯„å›ç»™æ‚¨ã€‚

---

## "Link-Only" åè®®æ·±åº¦è§£æ

**ä¸ºä»€ä¹ˆ VMess, Shadowsocks, TUIC, Hysteria 2 è¢«ç§°ä¸º "Link-Only" (ä»…ç”Ÿæˆé“¾æ¥)?**

Cloudflare Workers è¿è¡Œåœ¨ä¸€ä¸ªç‰¹æ®Šçš„æ— æœåŠ¡å™¨ç¯å¢ƒä¸­ï¼Œè¿™å¸¦æ¥äº†ä¸€äº›å…³é”®é™åˆ¶ï¼š
1.  **UDP é™åˆ¶**: Workers ç›®å‰å¯¹ UDP çš„æ”¯æŒæœ‰é™ï¼Œæ— æ³•åƒæ ‡å‡†æœåŠ¡å™¨é‚£æ ·å¤„ç†å¤æ‚çš„ UDP æ¡æ‰‹ï¼ˆè¿™ç›´æ¥æ’é™¤äº† Hysteria 2 å’Œ TUIC çš„æœåŠ¡ç«¯è¿è¡Œï¼‰ã€‚
2.  **ç«¯å£ç›‘å¬**: Workers åªèƒ½ç”± Cloudflare è§¦å‘è¿è¡Œï¼Œä¸èƒ½ç›‘å¬ä»»æ„ç«¯å£ï¼ˆå¦‚ 1080 æˆ– 443 ä»¥å¤–çš„ç«¯å£ï¼‰ã€‚

**Worker çš„è§’è‰²**:
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒWorker å……å½“ **"é“¾æ¥ç”Ÿæˆå™¨"** å’Œ **"è®¢é˜…ç®¡ç†å™¨"**ã€‚
*   å®ƒ**ä¸**è¿è¡Œ Hysteria 2 æˆ– TUIC æœåŠ¡ç«¯ã€‚
*   å®ƒ**ç”Ÿæˆ**æŒ‡å‘æ‚¨è‡ªå»ºåç«¯æœåŠ¡å™¨çš„é…ç½®é“¾æ¥ã€‚

**å¦‚ä½•ä½¿ç”¨**:
1.  **å¿…é¡»æœ‰åç«¯**: æ‚¨å¿…é¡»æœ‰ä¸€å°ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼ˆVPS, Serv00, etc.ï¼‰å®é™…è¿è¡Œ Hysteria 2 / TUIC / VMess / Shadowsocks æœåŠ¡ã€‚
2.  **é…ç½®åˆ†å‘**: ä½¿ç”¨ Worker ç”Ÿæˆçš„è®¢é˜…é“¾æ¥ï¼Œå°†é…ç½®ä¸‹å‘ç»™æ‚¨çš„å®¢æˆ·ç«¯ã€‚
3.  **æµé‡èµ°å‘**:
    *   **TUIC/Hysteria**: å®¢æˆ·ç«¯ -> æ‚¨çš„åç«¯æœåŠ¡å™¨ (Worker ä»…ä½œä¸ºé…ç½®æº)ã€‚
    *   **VMess/SS (Relayæ¨¡å¼)**: å®¢æˆ·ç«¯ -> Worker -> æ‚¨çš„åç«¯æœåŠ¡å™¨ (é€šè¿‡ `p` æˆ– `s` å˜é‡è½¬å‘)ã€‚

---

## é…ç½®ç™¾ç§‘å…¨ä¹¦ (Configuration Encyclopedia)

è¿™é‡Œè¯¦ç»†è§£é‡Šæ¯ä¸€ä¸ªå˜é‡ã€‚

**KV vs ç¯å¢ƒå˜é‡ (Precedence)**:
*   **KV é…ç½®ä¼˜å…ˆ**: å¦‚æœæ‚¨åœ¨å›¾å½¢ç•Œé¢ (KV) å’Œ Worker è®¾ç½® (ç¯å¢ƒå˜é‡) ä¸­éƒ½é…ç½®äº†åŒä¸€ä¸ªå˜é‡ï¼Œ**KV ä¸­çš„å€¼ä¼šè¦†ç›–ç¯å¢ƒå˜é‡**ã€‚
*   **å»ºè®®**: ä½¿ç”¨ç¯å¢ƒå˜é‡è¿›è¡Œåˆå§‹è®¾ç½® (å¦‚ UUID)ï¼Œä½¿ç”¨å›¾å½¢ç•Œé¢è¿›è¡Œæ—¥å¸¸ç®¡ç†ã€‚

### 1. åŸºç¡€èº«ä»½éªŒè¯ (Identity)

| å˜é‡ | å…¨ç§° | ç±»å‹ | é»˜è®¤å€¼ | è¯¦ç»†è¯´æ˜ | ä¸ºä»€ä¹ˆä½¿ç”¨? | ç¤ºä¾‹ |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **`u`** | **UUID** | String | (å¿…éœ€) | è¿™é‡Œçš„ `u` ä»£è¡¨ User IDã€‚å®ƒæ˜¯ VLESS/Trojan åè®®è®¤è¯çš„æ ¸å¿ƒã€‚Worker ä¼šæ£€æŸ¥è¯·æ±‚ä¸­çš„ UUID æ˜¯å¦ä¸æ­¤å˜é‡åŒ¹é…ã€‚ | **å®‰å…¨**ã€‚é˜²æ­¢æœªæˆæƒç”¨æˆ·ä½¿ç”¨æ‚¨çš„ä»£ç†æ¶ˆè€—æµé‡ã€‚ | `84439981-04b6-4103-aa4b-864aa9c91469` |

**Tip: å¦‚ä½•ç”Ÿæˆ UUID?**
æ‚¨å¯ä»¥åœ¨ Linux/Mac ç»ˆç«¯è¿è¡Œ `uuidgen`ï¼Œæˆ–è€…åœ¨ Windows PowerShell è¿è¡Œ `[guid]::NewGuid()`ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨çº¿ç”Ÿæˆå™¨ã€‚

**å…³äº UUID ç‰ˆæœ¬ (v1 vs v4 vs v7):**
*   **v4 (éšæœº)**: **æœ€æ¨è**ã€‚å®Œå…¨éšæœºç”Ÿæˆï¼Œéšç§æ€§æœ€å¥½ï¼Œä¹Ÿæ˜¯æœ€é€šç”¨çš„æ ‡å‡†ã€‚
*   **v1 (æ—¶é—´+MAC)**: åŒ…å«ç”Ÿæˆæ—¶é—´æˆ³å’Œç½‘å¡ MAC åœ°å€ã€‚è™½ç„¶ä¿è¯å”¯ä¸€ï¼Œä½†å¯èƒ½ä¼šæš´éœ²æ‚¨çš„è®¾å¤‡ä¿¡æ¯ï¼Œä¸æ¨èç”¨äºå…¬å¼€ä»£ç†ã€‚
*   **v7 (æ—¶é—´æ’åº)**: æ–°æ ‡å‡†ï¼ŒæŒ‰æ—¶é—´é¡ºåºç”Ÿæˆï¼Œé€‚åˆæ•°æ®åº“ç´¢å¼•ã€‚å¯¹äºä»£ç†è®¤è¯æ¥è¯´ï¼Œä¸ v4 åŒºåˆ«ä¸å¤§ï¼Œå¯ä»¥ä½¿ç”¨ã€‚

### 2. ç½‘ç»œä¸­ç»§ä¸éšè— (Relay & Stealth)

| å˜é‡ | å…¨ç§° | ç±»å‹ | é»˜è®¤å€¼ | è¯¦ç»†è¯´æ˜ | ä¸ºä»€ä¹ˆä½¿ç”¨? | ç¤ºä¾‹ |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **`p`** | **ProxyIP** | String | (ç©º) | æµé‡è½¬å‘ç›®æ ‡ã€‚æ ¼å¼ `IP:Port`ã€‚Worker æ”¶åˆ°è¯·æ±‚åï¼Œä¸ç›´æ¥è®¿é—®ç›®æ ‡ï¼Œè€Œæ˜¯è½¬å‘ç»™è¿™ä¸ª IPã€‚ | **è§£å°/éšè—**ã€‚è§£å†³ CF IP è¢«å¢™ã€è¢«ç½‘ç«™å±è”½ (å¦‚ Netflix) é—®é¢˜ï¼›éšè— Worker çœŸå® IPã€‚ | `1.2.3.4` æˆ– `proxy.example.com` |
| **`s`** | **SOCKS5** | String | (ç©º) | SOCKS5 ä»£ç†åœ°å€ã€‚æ ¼å¼ `user:pass@host:port`ã€‚ä¼˜å…ˆçº§é«˜äº `p`ã€‚ | **ç‰¹å®šå‡ºå£**ã€‚å¦‚æœæ‚¨æœ‰ç‰¹å®šå›½å®¶çš„ SOCKS5 ä»£ç†ï¼Œæƒ³è®©æµé‡ä»é‚£é‡Œå‡ºæ¥ã€‚ | `user:123456@1.1.1.1:1080` |
| **`d`** | **Directory** | String | (ç©º) | è‡ªå®šä¹‰è®¿é—®è·¯å¾„ã€‚è®¾ç½®åï¼ŒUUID è·¯å¾„å¤±æ•ˆã€‚ | **é˜²æ¢æµ‹**ã€‚è®© Worker çœ‹èµ·æ¥åƒä¸ªæ™®é€šç½‘ç«™ï¼Œåªæœ‰çŸ¥é“è·¯å¾„çš„äººæ‰èƒ½çœ‹åˆ°é¢æ¿ã€‚ | `/my-secret-path` |
| **`wk`** | **Worker Region** | String | (è‡ªåŠ¨) | å¼ºåˆ¶ Worker åŒ¹é…çš„åœ°åŒºä»£ç ã€‚æ”¯æŒ `SG`, `US`, `JP`, `HK` ç­‰ã€‚ | **å°±è¿‘æ¥å…¥**ã€‚å¼ºåˆ¶ Worker ä½¿ç”¨æŒ‡å®šåœ°åŒºçš„ä¼˜é€‰ IPï¼Œé™ä½å»¶è¿Ÿã€‚ | `SG` |

**ProxyIP ä¸ SOCKS5 è¿›é˜¶**:
*   **`p` (ProxyIP)**: ä»…æ”¯æŒ TCP è½¬å‘ã€‚ç›®æ ‡å¿…é¡»æ”¯æŒ HTTP/HTTPS æµé‡ã€‚å¦‚æœå¡«å…¥åŸŸåï¼ŒWorker ä¼šè§£æè¯¥åŸŸåã€‚
*   **`s` (SOCKS5)**: æ”¯æŒæ›´å¤æ‚çš„è®¤è¯ã€‚æ ¼å¼ä¸¥æ ¼ä¸º `user:pass@host:port`ã€‚å¦‚æœå¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œè¯·è¿›è¡Œ URL ç¼–ç ã€‚

### 3. åè®®å¼€å…³ä¸æŠ€æœ¯ç»†èŠ‚ (Protocols)

è®¾ç½®ä¸º `yes` å¼€å¯ï¼Œ`no` å…³é—­ã€‚

| å˜é‡ | åè®® | ç±»å‹ | é»˜è®¤ | è¯´æ˜ |
| :--- | :--- | :--- | :--- | :--- |
| **`ev`** | **VLESS** | Bool | `yes` | **åŸç”Ÿå¤„ç†**ã€‚æœ€æ¨èï¼Œæ€§èƒ½æœ€å¥½ã€‚ |
| **`et`** | **Trojan** | Bool | `no` | **åŸç”Ÿå¤„ç†**ã€‚ä¼ªè£…æˆ HTTPS æµé‡ï¼ŒæŠ—å¹²æ‰°å¼ºã€‚ |
| **`ex`** | **xhttp** | Bool | `no` | **åŸç”Ÿå¤„ç†**ã€‚åŸºäº HTTP POSTã€‚éœ€å¼€å¯ Cloudflare gRPCã€‚ |
| **`evm`** | **VMess** | Bool | `no` | **ä»…ç”Ÿæˆé“¾æ¥**ã€‚éœ€åç«¯æ”¯æŒã€‚ |
| **`ess`** | **Shadowsocks** | Bool | `no` | **ä»…ç”Ÿæˆé“¾æ¥**ã€‚éœ€åç«¯æ”¯æŒã€‚ |
| **`etu`** | **TUIC** | Bool | `no` | **ä»…ç”Ÿæˆé“¾æ¥**ã€‚UDP åè®®ã€‚éœ€ç‹¬ç«‹åç«¯ã€‚ |
| **`ehy`** | **Hysteria 2** | Bool | `no` | **ä»…ç”Ÿæˆé“¾æ¥**ã€‚UDP åè®®ã€‚éœ€ç‹¬ç«‹åç«¯ã€‚ |
| **`eg`** | **VLESS gRPC** | Bool | `no` | **åŸç”Ÿå¤„ç†**ã€‚æµé‡é€šè¿‡ gRPC ä¼ è¾“ã€‚ |

**Technical Deep Dive: VLESS vs Trojan**
*   **VLESS (Native)**: ä¸€ç§æ— çŠ¶æ€çš„è½»é‡çº§ä¼ è¾“åè®®ã€‚å®ƒä¸è¿›è¡Œæ¡æ‰‹ç­¾åï¼Œè€Œæ˜¯ä¾èµ–åº•å±‚çš„ä¼ è¾“å±‚ï¼ˆå¦‚ TLSï¼‰è¿›è¡ŒåŠ å¯†ã€‚
    *   *ä¼˜åŠ¿*: æä½çš„æ¡æ‰‹å»¶è¿Ÿï¼Œèµ„æºå ç”¨æå°ã€‚
*   **Trojan (Native)**: æ—¨åœ¨æ¨¡ä»¿äº’è”ç½‘ä¸Šæœ€å¸¸è§çš„ HTTPS æµé‡ã€‚å®ƒåœ¨è¿æ¥å»ºç«‹æ—¶éªŒè¯ SHA224 å“ˆå¸Œåçš„å¯†ç ã€‚
    *   *ä¼˜åŠ¿*: åœ¨å¼ºå®¡æŸ¥ç½‘ç»œä¸­ï¼Œå…¶æµé‡ç‰¹å¾æ›´åƒæ­£å¸¸çš„ç½‘é¡µæµè§ˆï¼ŒæŠ—å°é”èƒ½åŠ›ç†è®ºä¸Šæ›´å¼ºã€‚

### 4. é«˜çº§æ§åˆ¶ä¸ä¼˜é€‰ (Advanced & Preferred)

| å˜é‡ | å…¨ç§° | é»˜è®¤ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| **`yx`** | **ä¼˜é€‰ IP** | (ç©º) | **æœ€é«˜ä¼˜å…ˆçº§**ã€‚æ‰‹åŠ¨æŒ‡å®šçš„ä¼˜é€‰åˆ—è¡¨ã€‚æ ¼å¼: `IP:Port#å¤‡æ³¨`ã€‚ |
| **`yxURL`** | **ä¼˜é€‰ URL** | (é»˜è®¤) | ä»è¿œç¨‹ TXT æ–‡ä»¶è·å–ä¼˜é€‰ IPã€‚è¦†ç›–å†…ç½®é»˜è®¤æºã€‚ |
| **`ipv4`** | **IPv4 æº** | `yes` | æ˜¯å¦ä»ä¼˜é€‰æºè·å– IPv4 åœ°å€ã€‚ |
| **`ipv6`** | **IPv6 æº** | `yes` | æ˜¯å¦ä»ä¼˜é€‰æºè·å– IPv6 åœ°å€ã€‚ |
| **`ispMobile`** | **ç§»åŠ¨** | `yes` | æ˜¯å¦åŒ…å«ä¸­å›½ç§»åŠ¨çš„ä¼˜é€‰ IPã€‚ |
| **`ispTelecom`**| **ç”µä¿¡** | `yes` | æ˜¯å¦åŒ…å«ä¸­å›½ç”µä¿¡çš„ä¼˜é€‰ IPã€‚ |
| **`ispUnicom`** | **è”é€š** | `yes` | æ˜¯å¦åŒ…å«ä¸­å›½è”é€šçš„ä¼˜é€‰ IPã€‚ |
| **`qj`** | **å¼ºåˆ¶é™çº§** | `yes` | **æ³¨æ„**ï¼šè®¾ä¸º `no` æ‰æ˜¯å¼€å¯é™çº§ï¼é€»è¾‘ï¼šCFç›´è¿å¤±è´¥ -> SOCKS5 -> ProxyIPã€‚ |
| **`dkby`** | **ç«¯å£æ§åˆ¶** | `no` | è®¾ä¸º `yes` å¼€å¯ "ä»… TLS"ã€‚åªç”Ÿæˆ 443 ç­‰å®‰å…¨ç«¯å£èŠ‚ç‚¹ï¼Œå±è”½ 80 ç«¯å£ã€‚ |
| **`ae`** | **API Enable** | `no` | è®¾ä¸º `yes` å¼€å¯ API ç®¡ç†åŠŸèƒ½ã€‚ |
| **`customDNS`** | **Custom DNS** | (Built-in) | **KV ä¸“ç”¨**ã€‚æŒ‡å®šç”¨äº ECH é…ç½®æŸ¥è¯¢çš„ DoH åœ°å€ã€‚é»˜è®¤ä¸º `https://dns.joeyblog.eu.org/joeyblog`ã€‚ |
| **`customECHDomain`** | **ECH Domain** | (Built-in) | **KV ä¸“ç”¨**ã€‚æŒ‡å®šç”¨äºæŸ¥è¯¢ ECH é…ç½®çš„ç›®æ ‡åŸŸåã€‚é»˜è®¤ä¸º `cloudflare-ech.com`ã€‚ |

---

## ç»ˆæé…ç½®æŒ‡å—ï¼šå¼€å¯æ‰€æœ‰åŠŸèƒ½

å¦‚æœæ‚¨å¸Œæœ›è·å¾—æœ€å®Œæ•´ã€æœ€å¼ºå¤§çš„åŠŸèƒ½ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤é…ç½®ï¼š

### ç›®æ ‡
1.  å¼€å¯ **VLESS** å’Œ **Trojan** (åŒåè®®å¤‡ç”¨)ã€‚
2.  å¼€å¯ **ECH** (æœ€é«˜æŠ—å°é”)ã€‚
3.  é…ç½® **ProxyIP** (è§£é” Netflix/ChatGPT)ã€‚
4.  è®¾ç½® **è‡ªå®šä¹‰è·¯å¾„** (é˜²æ­¢è¢«æ‰«)ã€‚
5.  å¼€å¯ **API ç®¡ç†** (è‡ªåŠ¨åŒ–æ›´æ–° IP)ã€‚

### æ“ä½œæ­¥éª¤ (KV é…ç½®æ³•)

1.  éƒ¨ç½² Worker å¹¶ç»‘å®š KV (å˜é‡å `C`)ã€‚
2.  è®¿é—® Worker é¢æ¿ï¼Œå¡«å…¥ä»¥ä¸‹å€¼å¹¶ä¿å­˜ï¼š

*   **`ev` (VLESS)**: `yes`
*   **`et` (Trojan)**: `yes`
*   **`ech` (ECH)**: `yes`
*   **`tp` (Trojanå¯†ç )**: `mysecurepass123` (è‡ªå®šä¹‰ä¸€ä¸ªå¥½è®°çš„)
*   **`p` (ProxyIP)**: `proxyip.fxxk.dedyn.io` (æ‰¾ä¸€ä¸ªç¨³å®šçš„ä¼˜é€‰åŸŸå)
*   **`d` (è‡ªå®šä¹‰è·¯å¾„)**: `/admin-panel`
*   **`ae` (API)**: `yes`
*   **`qj` (é™çº§)**: `no` (å¼€å¯è‡ªåŠ¨æ•…éšœè½¬ç§»)
*   **`homepage`**: `https://www.microsoft.com` (ä¼ªè£…æˆå¾®è½¯é¦–é¡µ)

### ç»“æœ
*   æ‚¨çš„è®¢é˜…é“¾æ¥å˜ä¸º: `https://your-domain.com/admin-panel`
*   å®¢æˆ·ç«¯ä¼šæ”¶åˆ° VLESS å’Œ Trojan ä¸¤ç§èŠ‚ç‚¹ã€‚
*   æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ç”¨äº† ECH åŠ å¯†ã€‚
*   è®¿é—®è¢«å¢™ç½‘ç«™æ—¶ï¼Œæµé‡ä¼šè‡ªåŠ¨ç»è¿‡ ProxyIPã€‚
*   æ‚¨å¯ä»¥ç¼–å†™è„šæœ¬é€šè¿‡ API è‡ªåŠ¨å‘ `yx` åˆ—è¡¨æ·»åŠ æœ€æ–°çš„ä¼˜é€‰ IPã€‚

---

## ä»é›¶å¼€å§‹å®‰è£… (Zero to Hero)

åªéœ€è¦ 5 åˆ†é’Ÿã€‚

### æ­¥éª¤ 1: å‡†å¤‡
1.  æ³¨å†Œä¸€ä¸ª [Cloudflare](https://dash.cloudflare.com/sign-up) è´¦å·ã€‚
2.  ç”Ÿæˆä¸€ä¸ª UUID (å»ºè®®ä½¿ç”¨ `uuidgen` æˆ–åœ¨çº¿ç”Ÿæˆå™¨)ã€‚

### æ­¥éª¤ 2: åˆ›å»º Worker
1.  ç™»å½• Cloudflare é¢æ¿ï¼Œé€‰æ‹©å·¦ä¾§çš„ **"Workers & Pages"**ã€‚
2.  ç‚¹å‡» **"Create Application"**ï¼Œç„¶åç‚¹å‡» **"Create Worker"**ã€‚
3.  è¾“å…¥åå­— (ä¾‹å¦‚ `my-proxy`) å¹¶ç‚¹å‡» **"Deploy"**ã€‚
4.  ç‚¹å‡» **"Edit code"**ã€‚
5.  å°†æœ¬é¡¹ç›®çš„ `_worker.js` (æˆ– `snippets` ä¸­çš„ä»£ç ) å¤åˆ¶å¹¶è¦†ç›–ç¼–è¾‘å™¨ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚
6.  ç‚¹å‡»å³ä¸Šè§’çš„ **"Save and deploy"**ã€‚

### æ­¥éª¤ 3: é…ç½® KV (å…³é”®)
*è¦ä½¿ç”¨å›¾å½¢åŒ–é¢æ¿ï¼Œè¿™ä¸€æ­¥æ˜¯å¿…é¡»çš„ã€‚*
1.  å›åˆ° Cloudflare é¢æ¿ï¼Œè¿›å…¥ **"Workers & Pages"** -> **"KV"**ã€‚
2.  ç‚¹å‡» **"Create a namespace"**ï¼Œå‘½åä¸º `CONFIG`ï¼Œç‚¹å‡» **"Add"**ã€‚
3.  å›åˆ°æ‚¨çš„ Worker è®¾ç½®é¡µé¢ï¼Œé€‰æ‹© **"Settings"** -> **"Variables"**ã€‚
4.  å‘ä¸‹æ»šåŠ¨åˆ° **"KV Namespace Bindings"**ã€‚
5.  ç‚¹å‡» **"Add binding"**ã€‚
    *   **Variable name**: è¾“å…¥ `C` (å¿…é¡»æ˜¯å¤§å†™ C)ã€‚
    *   **KV Namespace**: é€‰æ‹©åˆšæ‰åˆ›å»ºçš„ `CONFIG`ã€‚
6.  ç‚¹å‡» **"Save and deploy"**ã€‚

### æ­¥éª¤ 4: è®¾ç½®å˜é‡
1.  åœ¨åŒä¸€ä¸ª **"Settings"** -> **"Variables"** é¡µé¢ï¼Œæ‰¾åˆ° **"Environment Variables"**ã€‚
2.  ç‚¹å‡» **"Add variable"**ã€‚
    *   **Variable name**: `u`
    *   **Value**: ç²˜è´´ç¬¬ä¸€æ­¥ç”Ÿæˆçš„ UUIDã€‚
3.  ç‚¹å‡» **"Save and deploy"**ã€‚

### æ­¥éª¤ 5: å¼€å§‹ä½¿ç”¨
è®¿é—® `https://æ‚¨çš„-worker-åŸŸå/æ‚¨çš„-UUID`ã€‚æ‚¨å°†çœ‹åˆ°ç®¡ç†é¢æ¿ï¼

### æ­¥éª¤ 6: éªŒè¯ä¸è¿æ¥
1.  åœ¨é¢æ¿ä¸­ç‚¹å‡»é¡¶éƒ¨çš„ **[ è®¢é˜…ç®¡ç† ]** (æˆ–è€…ç›´æ¥å¤åˆ¶é¡µé¢ä¸Šçš„è®¢é˜…é“¾æ¥)ã€‚
2.  å°†é“¾æ¥å¯¼å…¥åˆ°æ‚¨çš„å®¢æˆ·ç«¯ (v2rayNG, Clash, Shadowrocket)ã€‚
3.  æµ‹è¯•è¿æ¥ (çœŸè¿æ¥æµ‹è¯•ï¼Œä¸ä»…ä»…æ˜¯ Ping)ã€‚å¦‚æœé€šäº†ï¼Œæ­å–œï¼

---

## ProxyIP æ·±åº¦è§£æ

**åŸç†**:
é€šå¸¸æƒ…å†µä¸‹ï¼ŒWorker è®¿é—®ç½‘ç«™æ—¶ï¼Œç›®æ ‡ç½‘ç«™çœ‹åˆ°çš„æ˜¯ Cloudflare çš„ IPã€‚ProxyIP æ˜¯æ‚¨åœ¨ Worker å’Œç›®æ ‡ç½‘ç«™ä¹‹é—´æ¶è®¾çš„ä¸€åº§æ¡¥ã€‚

**å¦‚ä½•å¯»æ‰¾å¯ç”¨çš„ ProxyIP? (Mini-Guide)**
1.  **ä¼˜é€‰åŸŸå**: ç¤¾åŒºç»´æŠ¤äº†ä¸€äº›é•¿æœŸå¯ç”¨çš„ä¼˜é€‰åŸŸåï¼Œå¦‚ `proxyip.fxxk.dedyn.io`ã€‚
2.  **è‡ªå»º**: å¯ä»¥åœ¨æ”¯æŒé 443 ç«¯å£çš„ VPS ä¸Šæ­å»º VLESS/Trojan æœåŠ¡ï¼Œå¹¶å°†å…¶ IP:Port å¡«å…¥ `p`ã€‚
3.  **æ‰«æ**: ä½¿ç”¨ä¸“é—¨çš„ Cloudflare IP æ‰«æå·¥å…·ï¼Œå¯»æ‰¾å¼€æ”¾äº†éæ ‡å‡†ç«¯å£ï¼ˆå¦‚ 2053, 2083ï¼‰çš„ Cloudflare CDN IPã€‚

---

## å®¢æˆ·ç«¯é…ç½®æŒ‡å—

ä¸ºäº†è·å¾—æœ€ä½³ä½“éªŒï¼Œè¯·æ³¨æ„ä»¥ä¸‹å®¢æˆ·ç«¯è®¾ç½®ï¼š

### v2rayNG (Android)
*   **Mux (å¤šè·¯å¤ç”¨)**: å»ºè®®**å…³é—­**ã€‚è™½ç„¶ç†è®ºä¸Šèƒ½é™ä½æ¡æ‰‹å»¶è¿Ÿï¼Œä½†åœ¨æŸäº›ç½‘ç»œç¯å¢ƒä¸‹ä¼šå¯¼è‡´æ–­æµã€‚
*   **è·³è¿‡è¯ä¹¦éªŒè¯**: å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰åŸŸåï¼Œå»ºè®®è®¾ä¸º `true` (å…è®¸ä¸å®‰å…¨)ã€‚
*   **Sniffing (æµé‡å—…æ¢)**: å»ºè®®**å¼€å¯**ï¼Œä»¥ä¾¿æ­£ç¡®åˆ†æµå›½å†…å¤–æµé‡ã€‚

### Shadowrocket (iOS)
*   **Allow Insecure**: åœ¨è®¾ç½®ä¸­å¼€å¯ã€‚
*   **è®¢é˜…æ›´æ–°**: å»ºè®®å¼€å¯ "æ‰“å¼€æ—¶æ›´æ–°"ï¼Œç¡®ä¿è·å¾—æœ€æ–°çš„ä¼˜é€‰ IPã€‚

### Clash Meta / Mihomo (PC/Android)
*   **å†…æ ¸**: è¯·åŠ¡å¿…ä½¿ç”¨ Meta (Mihomo) å†…æ ¸ã€‚å®˜æ–¹ Premium å†…æ ¸å¯èƒ½ä¸æ”¯æŒ VLESS Reality æˆ–æŸäº› ECH ç‰¹æ€§ã€‚
*   **Client Fingerprint**: å»ºè®®è®¾ç½®ä¸º `chrome`ï¼Œæ¨¡æ‹ŸçœŸå®æµè§ˆå™¨æŒ‡çº¹ã€‚

---

## æ•…éšœæ’é™¤ (Troubleshooting)

**åœºæ™¯ 1: èƒ½æ‰“å¼€è®¢é˜…é¡µé¢ï¼Œä½†èŠ‚ç‚¹å…¨éƒ¨è¶…æ—¶/æ— æ³•è¿æ¥**
*   **åŸå›  A**: æ‚¨çš„ç½‘ç»œæ— æ³•ç›´æ¥è¿æ¥ Cloudflare Worker åŸŸå (workers.dev)ã€‚
    *   *è§£æ³•*: ç»‘å®šè‡ªå®šä¹‰åŸŸå (Custom Domain)ï¼Œæˆ–è€…ä½¿ç”¨ä¼˜é€‰ IPã€‚
*   **åŸå›  B**: ç«¯å£è¢«å°ã€‚
    *   *è§£æ³•*: å°è¯•ä½¿ç”¨éæ ‡å‡†ç«¯å£ (å¦‚ 2053, 2083, 8443) çš„èŠ‚ç‚¹ã€‚
*   **åŸå›  C**: UUID é”™è¯¯ã€‚
    *   *è§£æ³•*: æ£€æŸ¥å®¢æˆ·ç«¯é…ç½®ä¸­çš„ UUID æ˜¯å¦ä¸ Worker å˜é‡ `u` ä¸€è‡´ã€‚

**åœºæ™¯ 2: è®¿é—®æ˜¾ç¤º "Error 1101: Worker Threw Exception"**
*   **åŸå› **: Worker ä»£ç è¿è¡Œå‡ºé”™ã€‚
*   *è§£æ³•*: é€šå¸¸æ˜¯å› ä¸º KV æœªç»‘å®šã€‚è¯·æ£€æŸ¥ "KV Namespace Bindings" æ˜¯å¦æœ‰åä¸º `C` çš„å˜é‡ã€‚

**åœºæ™¯ 3: è®¿é—®æ˜¾ç¤º "Error 502: Bad Gateway"**
*   **åŸå› **: Worker æ— æ³•è¿æ¥åˆ°ä¸Šæ¸¸ (ProxyIP æˆ– ç›®æ ‡ç½‘ç«™)ã€‚
*   *è§£æ³•*: æ‚¨é…ç½®çš„ ProxyIP (`p` å˜é‡) å¯èƒ½å·²å¤±æ•ˆã€‚è¯·æ›´æ¢ ProxyIP æˆ–æš‚æ—¶æ¸…ç©º `p` å˜é‡æµ‹è¯•ç›´è¿ã€‚

**å¸¸è§é”™è¯¯ä»£ç **:
*   **522 Connection Timed Out**: Worker æ— æ³•è¿æ¥åˆ°æºç«™ (ProxyIP)ã€‚æ£€æŸ¥ IP æ˜¯å¦è¢«å¢™ã€‚
*   **523 Origin Unreachable**: æ— æ³•åˆ°è¾¾æºç«™ã€‚æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚
*   **1000 DNS Error**: é…ç½®äº†é”™è¯¯çš„ DNS æˆ–å¾ªç¯é‡å®šå‘ã€‚æ£€æŸ¥ ProxyIP æ˜¯å¦æŒ‡å‘äº†å¦ä¸€ä¸ª CF èŠ‚ç‚¹ (Loop)ã€‚

**è°ƒè¯•æŠ€å·§**:
*   æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å° (F12 -> Console)ï¼ŒæŸ¥çœ‹è¿æ¥æ—¶çš„å…·ä½“æŠ¥é”™ä¿¡æ¯ã€‚
*   ä½¿ç”¨ `/test-api` è·¯å¾„æ£€æŸ¥ API æ˜¯å¦æ­£å¸¸å“åº”ã€‚

---

## API ç®¡ç†

**API åŸºç¡€ URL**: `https://æ‚¨çš„åŸŸå/æ‚¨çš„UUID/api/preferred-ips`

| æ–¹æ³• | æè¿° | Body (JSON) |
| :--- | :--- | :--- |
| `GET` | è·å–å½“å‰ IP åˆ—è¡¨ | (æ— ) |
| `POST` | æ·»åŠ  IP | `{"ip": "1.2.3.4", "port": 443, "name": "å¤‡æ³¨"}` |
| `DELETE` | åˆ é™¤ IP | `{"ip": "1.2.3.4"}` |
| `DELETE` | æ¸…ç©ºæ‰€æœ‰ | `{"all": true}` |

*æç¤º: éœ€åœ¨å›¾å½¢ç•Œé¢å¼€å¯ "å…è®¸ API ç®¡ç†" æ‰èƒ½ä½¿ç”¨ã€‚*

---

## Star History

[![Star History Chart](https://api.star-history.com/svg?repos=byJoey/cfnew&type=Timeline)](https://www.star-history.com/#byJoey/cfnew&Timeline&LogScale)
